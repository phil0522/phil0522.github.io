import{G as p,O as h,i as d,l as n,m as b}from"./chunk-JA4E3MB7.js";import{I as o,N as r,Pb as c,Y as l,da as a,ea as u}from"./chunk-5NVNCA6J.js";var g=class i{datastore=r(p);seasonService=r(h);destroyRef=r(l);_registration=a(null);registration=this._registration.asReadonly();subscription=null;currentSeasonId=null;constructor(){u(()=>{let t=this.seasonService.selectedSeason();t&&t.id!==this.currentSeasonId&&this.subscribeToSeason(t.id)})}subscribeToSeason(t){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=t,this.subscription=this.datastore.subscribeToRegistration(t).pipe(d(this.destroyRef)).subscribe({next:e=>this._registration.set(e),error:e=>{console.error("Registration subscription error:",e),this._registration.set(null)}})}getClassEnrollment(t){return this.registration()?.classes[t]}getEnrolledCount(t){return this.getClassEnrollment(t)?.enrolledStudents?.length??0}getAvailableSpots(t){let e=this.getEnrolledCount(t.id);return Math.max(0,t.capacity-e)}classesWithEnrollment=c(()=>{let t=this.seasonService.classes(),e=this._registration();return b(t,e)});getClassWithEnrollment(t){let e=this.seasonService.classes().find(s=>s.id===t);return e?n(e,this.getClassEnrollment(t)):null}createViewType(t){return n(t,this.getClassEnrollment(t.id))}isFullForPublic(t){return this.getAvailableSpots(t)<=0}getEnrollmentStatus(t){let e=this.getAvailableSpots(t);return e===0?"waitlist-only":e<=3?"almost-full":"open"}getStatusMessage(t){let e=this.getEnrollmentStatus(t),s=this.getAvailableSpots(t);switch(e){case"open":return`${s} spots available`;case"almost-full":return`Only ${s} spots left!`;case"full":return"Full";case"waitlist-only":return"Full - Join Waitlist";default:return""}}unsubscribe(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=null,this._registration.set(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a};
