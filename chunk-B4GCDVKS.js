import{A as g,B as A,C as c,D as m,E as P,F as w}from"./chunk-Z6M3NQZL.js";import{Ba as T,Da as S,F as b,_ as f,aa as i,db as r,gb as h,ha as I,jb as n}from"./chunk-UYHN5VVP.js";import{I as _}from"./chunk-5O64VQN5.js";import{a as d}from"./chunk-Q7L6LLAK.js";var D=["admin","email","templates",P],E=["admin","email","season_template_stats"],y=["admin","email","batch_jobs"],B=class l{firestore=I(b());buildSeasonTemplateStatsDocId(a,t,e){return`${a}__${t}__${e}`}async getTemplatesDocOrCreate(a){let t=i(this.firestore,...D),e=await r(t);if(!e.exists()){let s=w(a);return await n(t,s),s}return A.parse(e.data())}async saveTemplatesDoc(a){let t=A.parse(a),e=i(this.firestore,...D);await n(e,t)}async getSeasonTemplateStats(a,t,e){let s=g.parse(t),o=this.buildSeasonTemplateStatsDocId(a,s,e),p=i(this.firestore,...E,o),u=await r(p);return u.exists()?c.parse(u.data()):null}async listSeasonTemplateStats(a){let t=f(this.firestore,...E),e=T(t,S("seasonId","==",a));return(await h(e)).docs.map(o=>c.parse(o.data()))}async saveSeasonTemplateStats(a){let t=c.parse(a),e=this.buildSeasonTemplateStatsDocId(t.seasonId,t.notificationType,t.templateId),s=i(this.firestore,...E,e);await n(s,t)}async createBatchJob(a){let t=m.parse(a),e=i(this.firestore,...y,t.jobId);await n(e,t)}async updateBatchJob(a,t){let e=i(this.firestore,...y,a),s=await r(e);if(!s.exists())throw new Error(`Batch job ${a} not found`);let o=d(d({},s.data()),t),p=m.parse(o);await n(e,p)}async listSeasonBatchJobs(a){let t=f(this.firestore,...y),e=T(t,S("seasonId","==",a));return(await h(e)).docs.map(o=>m.parse(o.data()))}static \u0275fac=function(t){return new(t||l)};static \u0275prov=_({token:l,factory:l.\u0275fac,providedIn:"root"})};export{B as a};
