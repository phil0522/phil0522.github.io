import{a as Ae,b as ke,c as Te,d as Ve,e as je,f as B,g as j}from"./chunk-P2AFQSJG.js";import{a as Me,b as Oe}from"./chunk-HH3RN2VX.js";import{a as Ee}from"./chunk-HVU3FOF6.js";import{a as Ie}from"./chunk-LUBMWWAI.js";import{a as De}from"./chunk-FXOCASSC.js";import"./chunk-KZ27A6Z5.js";import{a as _e,b as ge,c as fe,d as xe,e as Ce,f as he,g as ye,i as be,j as ve,k as Se,m as Pe,q as we}from"./chunk-6HJTJ7XI.js";import{a as pe,b as ue}from"./chunk-RYIKU5Y3.js";import{$ as ae,R as ee,S as te,U as ne,V as ie,Z as oe,_ as re,aa as de,b as Q,h as X,ia as se,ja as le,ka as ce,n as $,na as me}from"./chunk-ZAFEDDMR.js";import"./chunk-UYHN5VVP.js";import{$a as u,Da as K,Db as a,Ea as s,Eb as x,Fb as b,Gb as J,Jb as v,Kb as S,Lb as P,N as E,Pb as Y,Qa as Z,S as m,T as p,Tb as C,Wb as z,ab as _,bb as F,da as D,db as A,eb as k,fb as h,gb as i,hb as o,ib as I,ob as M,qb as g,sb as l}from"./chunk-5O64VQN5.js";import{a as H,b as U}from"./chunk-Q7L6LLAK.js";var Be=r=>({"text-warning":r}),Ge=(r,t)=>t.id,qe=(r,t)=>t.sessionId,He=(r,t)=>t.sessionId+"-"+t.studentId;function Ue(r,t){r&1&&(i(0,"div",2),I(1,"div",6),i(2,"p"),a(3,"Loading order details..."),o()())}function Ke(r,t){if(r&1){let e=M();i(0,"div",3)(1,"strong"),a(2,"Error:"),o(),a(3),i(4,"button",7),g("click",function(){m(e);let n=l();return p(n.clearError())}),a(5,"\xD7"),o()()}if(r&2){let e=l();s(3),b(" ",e.error()," ")}}function Ze(r,t){if(r&1&&(i(0,"div",18)(1,"span",10),a(2,"Phone:"),o(),i(3,"span",11),a(4),o()()),r&2){let e=l(3);s(4),x(e.userData().phone)}}function Je(r,t){if(r&1&&a(0),r&2){let e=l(4);b(" ",e.userData().wechatName," ")}}function Ye(r,t){if(r&1&&a(0),r&2){let e=l(5);b(" (",e.userData().wechatId,") ")}}function Qe(r,t){if(r&1&&a(0),r&2){let e=l(5);b(" ",e.userData().wechatId," ")}}function Xe(r,t){if(r&1&&u(0,Ye,1,1)(1,Qe,1,1),r&2){let e=l(4);_(e.userData().wechatName?0:1)}}function $e(r,t){if(r&1&&(i(0,"div",18)(1,"span",10),a(2,"WeChat:"),o(),i(3,"span",11),u(4,Je,1,1),u(5,Xe,2,1),o()()),r&2){let e=l(3);s(4),_(e.userData().wechatName?4:-1),s(),_(e.userData().wechatId?5:-1)}}function et(r,t){if(r&1&&(i(0,"div",18)(1,"span",10),a(2,"Address:"),o(),i(3,"span",11),a(4),o()()),r&2){let e=l(3);s(4),x(e.userData().address)}}function tt(r,t){if(r&1&&(i(0,"div",15)(1,"h2"),a(2,"User Information"),o(),i(3,"div",27)(4,"div",18)(5,"span",10),a(6,"Name:"),o(),i(7,"span",11),a(8),o()(),i(9,"div",18)(10,"span",10),a(11,"Email:"),o(),i(12,"span",11),a(13),o()(),u(14,Ze,5,1,"div",18),u(15,$e,6,2,"div",18),u(16,et,5,1,"div",18),o()()),r&2){let e=l(2);s(8),x(e.userData().displayName),s(5),x(e.userData().email),s(),_(e.userData().phone?14:-1),s(),_(e.userData().wechatId||e.userData().wechatName?15:-1),s(),_(e.userData().address?16:-1)}}function nt(r,t){if(r&1&&(i(0,"span",29),a(1),o()),r&2){let e=l(3);s(),J(" (",e.remainingLockTime().hours,"h ",e.remainingLockTime().minutes,"m remaining) ")}}function it(r,t){if(r&1&&(i(0,"div",18)(1,"span",10),a(2,"Lock Expires:"),o(),i(3,"span",28),a(4),u(5,nt,2,2,"span",29),o()()),r&2){let e=l(2);s(3),h("ngClass",Y(3,Be,e.isExpiringSoon())),s(),b(" ",e.formatDateTime(e.order().lockExpiresAt)," "),s(),_(e.remainingLockTime()?5:-1)}}function ot(r,t){r&1&&(i(0,"div",20)(1,"p"),a(2,"No items in this order."),o()())}function rt(r,t){if(r&1){let e=M();i(0,"app-ledger-order-items",30),g("cancelItemsClick",function(){m(e);let n=l(2);return p(n.openCancelItemsDialog())})("confirmScreenshot",function(n){m(e);let c=l(2);return p(c.confirmScreenshotPayment(n))})("rejectScreenshot",function(n){m(e);let c=l(2);return p(c.rejectScreenshotPayment(n))}),o()}if(r&2){let e=l(2);h("lockedItems",e.lockedItemsTransformed())("submittedItems",e.submittedItemsTransformed())("securedItems",e.securedItemsTransformed())("paidItems",e.paidItemsTransformed())("editable",!1)("isAdmin",!0)("screenshotGroups",e.screenshotGroups())}}function at(r,t){if(r&1){let e=M();i(0,"div",38)(1,"button",39),g("click",function(){m(e);let n=l().$implicit,c=l(3);return p(c.openEditPaymentDialog(n))}),a(2," Edit payment "),o()()}}function dt(r,t){if(r&1){let e=M();i(0,"tr")(1,"td"),a(2),o(),i(3,"td",33),a(4),o(),i(5,"td")(6,"span",34),a(7),o()(),i(8,"td"),a(9),o(),i(10,"td"),a(11),o(),i(12,"td",35)(13,"div",36),g("click",function(n){return m(e),p(n.stopPropagation())}),i(14,"button",37),g("click",function(n){let c=m(e).$implicit,y=l(3);return p(y.togglePaymentMenu(c.id,n))}),a(15," \u22EF "),o(),u(16,at,3,0,"div",38),o()()()}if(r&2){let e=t.$implicit,d=l(3);s(2),x(d.formatDateTime(e.recordedAt)),s(2),x(d.formatCurrency(e.amount)),s(3),x(e.method),s(2),x(e.reference||"-"),s(2),x(e.notes||"-"),s(5),_(d.activePaymentMenuId()===e.id?16:-1)}}function st(r,t){if(r&1&&(i(0,"div",22)(1,"h2"),a(2,"Payment History"),o(),i(3,"table",31)(4,"thead")(5,"tr")(6,"th"),a(7,"Date"),o(),i(8,"th"),a(9,"Amount"),o(),i(10,"th"),a(11,"Method"),o(),i(12,"th"),a(13,"Reference"),o(),i(14,"th"),a(15,"Notes"),o(),I(16,"th",32),o()(),i(17,"tbody"),A(18,dt,17,6,"tr",null,Ge),o()()()),r&2){let e=l(2);s(18),k(e.payments())}}function lt(r,t){if(r&1){let e=M();i(0,"div",41)(1,"div",42)(2,"span",43),a(3),o()(),i(4,"div",44)(5,"div",45)(6,"span",10),a(7,"Joined:"),o(),i(8,"span",11),a(9),o()()(),i(10,"button",46),g("click",function(){let n=m(e).$implicit,c=l(3);return p(c.openRemoveWaitlistDialog(n.sessionId))}),a(11," Remove Entry "),o()()}if(r&2){let e=t.$implicit,d=l(3);s(3),x(d.getClassName(e.sessionId)),s(6),x(d.formatDateTime(e.joinedAt))}}function ct(r,t){if(r&1&&(i(0,"div",23)(1,"h2"),a(2,"Waitlist Entries"),o(),i(3,"div",40),A(4,lt,12,2,"div",41,qe),o()()),r&2){let e=l(2);s(4),k(e.waitlistEntries())}}function mt(r,t){if(r&1&&(i(0,"div",54),a(1),o()),r&2){let e=l().$implicit;s(),x(e.details)}}function pt(r,t){r&1&&(i(0,"span",60),a(1,"Lunch"),o())}function ut(r,t){r&1&&(i(0,"span",60),a(1,"Extended Care"),o())}function _t(r,t){if(r&1&&(i(0,"span",59),u(1,pt,2,0,"span",60),u(2,ut,2,0,"span",60),o()),r&2){let e=l().$implicit;s(),_(e.options.lunch?1:-1),s(),_(e.options.extendedCare?2:-1)}}function gt(r,t){if(r&1&&(i(0,"div",56)(1,"span",57),a(2),o(),i(3,"span",58),a(4),o(),u(5,_t,3,2,"span",59),o()),r&2){let e=t.$implicit,d=l(6);s(2),x(e.className),s(2),x(d.getStudentName(e.studentId)),s(),_(e.options?5:-1)}}function ft(r,t){if(r&1&&(i(0,"div",55),A(1,gt,6,3,"div",56,F),o()),r&2){let e=l().$implicit;s(),k(e.affectedItems)}}function xt(r,t){if(r&1&&(i(0,"div",50)(1,"div",51),a(2),o(),i(3,"div",52)(4,"div",53),a(5),o(),u(6,mt,2,1,"div",54),u(7,ft,3,0,"div",55),o()()),r&2){let e=t.$implicit,d=l(4);s(2),x(d.formatDateTime(e.timestamp)),s(3),x(e.action),s(),_(e.details?6:-1),s(),_(e.affectedItems&&e.affectedItems.length>0?7:-1)}}function Ct(r,t){if(r&1&&(i(0,"div",49),A(1,xt,8,4,"div",50,F),o()),r&2){let e=l(3);s(),k(e.reversedHistory())}}function ht(r,t){if(r&1){let e=M();i(0,"div",24)(1,"div",47),g("click",function(){m(e);let n=l(2);return p(n.historyExpanded.set(!n.historyExpanded()))}),i(2,"h2"),a(3),o(),i(4,"button",48),a(5),o()(),u(6,Ct,3,0,"div",49),o()}if(r&2){let e=l(2);s(3),b("Order History (",e.reversedHistory().length,")"),s(2),b(" ",e.historyExpanded()?"\u25BC":"\u25B6"," "),s(),_(e.historyExpanded()?6:-1)}}function yt(r,t){if(r&1){let e=M();i(0,"div",4)(1,"div",8)(2,"div",9)(3,"span",10),a(4,"User ID:"),o(),i(5,"span",11),a(6),o()(),i(7,"span",12),a(8),o()(),i(9,"div",13)(10,"div",14),u(11,tt,17,5,"div",15),i(12,"div",16)(13,"h2"),a(14,"Order Status"),o(),i(15,"div",17)(16,"div",18)(17,"span",10),a(18,"Status:"),o(),i(19,"span",19),a(20),o()(),u(21,it,6,5,"div",18),i(22,"div",18)(23,"span",10),a(24,"Created:"),o(),i(25,"span",11),a(26),o()(),i(27,"div",18)(28,"span",10),a(29,"Last Updated:"),o(),i(30,"span",11),a(31),o()()()(),u(32,ot,3,0,"div",20)(33,rt,1,7,"app-ledger-order-items",21),u(34,st,20,0,"div",22),u(35,ct,6,0,"div",23),u(36,ht,7,3,"div",24),o(),i(37,"div",25)(38,"app-ledger-settlement-sidebar",26),g("recordPaymentClick",function(){m(e);let n=l();return p(n.openRecordPaymentDialog())})("addAdjustmentClick",function(){m(e);let n=l();return p(n.openAddAdjustmentDialog())}),o()()()()}if(r&2){let e=l();s(6),x(e.order().userDisplayId),s(),h("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),s(),b(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),s(3),_(e.userData()?11:-1),s(8),h("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),s(),b(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),s(),_(e.order().lockExpiresAt?21:-1),s(5),x(e.formatDateTime(e.order().createdAt)),s(5),x(e.formatDateTime(e.order().updatedAt)),s(),_(e.allItems().length===0?32:33),s(2),_(e.payments().length>0?34:-1),s(),_(e.waitlistEntries().length>0?35:-1),s(),_(e.reversedHistory().length>0?36:-1),s(2),h("isAdmin",!0)("orderSummary",e.orderSummaryData())}}function bt(r,t){if(r&1&&(i(0,"div",76)(1,"div",86)(2,"span"),a(3,"Original Amount Due:"),o(),i(4,"span"),a(5),o()(),i(6,"div",87)(7,"span"),a(8,"Cash Discount (3%):"),o(),i(9,"span"),a(10),o()(),i(11,"div",88)(12,"span"),a(13,"Cash Amount Due:"),o(),i(14,"span"),a(15),o()(),i(16,"small",69),a(17),o()()),r&2){let e=l(2);s(5),x(e.formatCurrency(e.amountDue())),s(5),b("-",e.formatCurrency(e.cashDiscount())),s(5),x(e.formatCurrency(e.cashAmountDue())),s(2),b(" A credit of ",e.formatCurrency(e.cashDiscount())," will be automatically applied. ")}}function vt(r,t){if(r&1){let e=M();i(0,"div",81)(1,"label",89)(2,"input",90),P("ngModelChange",function(n){m(e);let c=l(2);return S(c.formPayment.isDepositConfirmation,n)||(c.formPayment.isDepositConfirmation=n),p(n)}),o(),i(3,"span"),a(4,"Deposit Only (mark as secured, not fully paid)"),o()(),i(5,"small",69),a(6,' Check this for cash deposit confirmations. Items will be marked as "secured" instead of "paid", and user keeps their spot until full payment. '),o()()}if(r&2){let e=l(2);s(2),v("ngModel",e.formPayment.isDepositConfirmation)}}function St(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function Pt(r,t){r&1&&(I(0,"span",91),a(1," Recording... "))}function wt(r,t){r&1&&a(0," Record Payment ")}function Mt(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Record Payment"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.recordPayment())}),i(9,"div",66)(10,"label",67),a(11,"Amount *"),o(),i(12,"input",68),P("ngModelChange",function(n){m(e);let c=l();return S(c.formPayment.amountInput,n)||(c.formPayment.amountInput=n),p(n)}),o(),i(13,"small",69),a(14),o()(),i(15,"div",66)(16,"label",70),a(17,"Payment Method *"),o(),i(18,"select",71),P("ngModelChange",function(n){m(e);let c=l();return S(c.formPayment.method,n)||(c.formPayment.method=n),p(n)}),g("ngModelChange",function(n){m(e);let c=l();return p(c.onPaymentMethodChange(n))}),i(19,"option",72),a(20,"Zelle"),o(),i(21,"option",73),a(22,"Check"),o(),i(23,"option",74),a(24,"Cash (3% off)"),o(),i(25,"option",75),a(26,"Other"),o()()(),u(27,bt,18,4,"div",76),i(28,"div",66)(29,"label",77),a(30," Reference (optional) "),o(),i(31,"input",78),P("ngModelChange",function(n){m(e);let c=l();return S(c.formPayment.reference,n)||(c.formPayment.reference=n),p(n)}),o()(),i(32,"div",66)(33,"label",79),a(34,"Notes"),o(),i(35,"textarea",80),P("ngModelChange",function(n){m(e);let c=l();return S(c.formPayment.notes,n)||(c.formPayment.notes=n),p(n)}),o()(),u(36,vt,7,1,"div",81),u(37,St,2,1,"div",82),i(38,"div",83)(39,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(40," Cancel "),o(),i(41,"button",85),u(42,Pt,2,0)(43,wt,1,0),o()()()()()()}if(r&2){let e=l();s(12),v("ngModel",e.formPayment.amountInput),s(2),b(" Amount due: ",e.formatCurrency(e.amountDue())," "),s(4),v("ngModel",e.formPayment.method),s(9),_(e.formPayment.method==="cash"&&e.cashDiscount()>0?27:-1),s(4),v("ngModel",e.formPayment.reference),s(4),v("ngModel",e.formPayment.notes),s(),_(e.submittedItems().length>0?36:-1),s(),_(e.actionError()?37:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()),s(),_(e.actionLoading()?42:43)}}function Ot(r,t){if(r&1){let e=M();i(0,"label",93)(1,"input",97),g("change",function(){let n=m(e).$implicit,c=l(2);return p(c.toggleItemSelection(n))}),o(),i(2,"span",98)(3,"span",43),a(4),o(),a(5," - "),i(6,"span",99),a(7),o(),i(8,"span",100),a(9),o()()()}if(r&2){let e=t.$implicit,d=l(2);s(),h("checked",d.isItemSelected(e)),s(3),x(d.getClassName(e.sessionId,e.snapshot.className)),s(3),x(d.getStudentName(e.studentId)),s(),h("ngClass",d.getItemStatusBadgeClass(e.status)),s(),b(" ",d.getItemStatusLabel(e.status)," ")}}function Dt(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function It(r,t){r&1&&(I(0,"span",91),a(1," Cancelling... "))}function Et(r,t){if(r&1&&a(0),r&2){let e=l(2);b(" Cancel ",e.selectedItems().size," Item(s) ")}}function At(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Cancel Order Items"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.cancelItems())}),i(9,"div",66)(10,"label"),a(11,"Select items to cancel:"),o(),i(12,"div",92),A(13,Ot,10,5,"label",93,He),o()(),i(15,"div",66)(16,"label",94),a(17,"Cancellation Reason *"),o(),i(18,"textarea",95),P("ngModelChange",function(n){m(e);let c=l();return S(c.formCancel.reason,n)||(c.formCancel.reason=n),p(n)}),o()(),u(19,Dt,2,1,"div",82),i(20,"div",83)(21,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(22," Cancel "),o(),i(23,"button",96),u(24,It,2,0)(25,Et,1,1),o()()()()()()}if(r&2){let e=l();s(13),k(e.cancellableItems()),s(5),v("ngModel",e.formCancel.reason),s(),_(e.actionError()?19:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()||e.selectedItems().size===0),s(),_(e.actionLoading()?24:25)}}function kt(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function Tt(r,t){r&1&&(I(0,"span",91),a(1," Removing... "))}function Vt(r,t){r&1&&a(0," Remove Entry ")}function jt(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Remove Waitlist Entry"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.removeWaitlist())}),i(9,"div",66)(10,"label"),a(11,"Class:"),o(),i(12,"div",101),a(13),o()(),i(14,"div",102),a(15," This will remove the user from the waitlist for this class. "),o(),u(16,kt,2,1,"div",82),i(17,"div",83)(18,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(19," Cancel "),o(),i(20,"button",96),u(21,Tt,2,0)(22,Vt,1,0),o()()()()()()}if(r&2){let e=l();s(13),b(" ",e.getClassName(e.formRemoveWaitlist.sessionId)," "),s(3),_(e.actionError()?16:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()),s(),_(e.actionLoading()?21:22)}}function Nt(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function Rt(r,t){r&1&&(I(0,"span",91),a(1," Adding... "))}function Lt(r,t){if(r&1&&a(0),r&2){let e=l(2);b(" Add ",e.formAdjustment.type==="credit"?"Credit":"Fee"," ")}}function Wt(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Add Credit or Fee"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.addAdjustment())}),i(9,"div",66)(10,"label",103),a(11,"Type *"),o(),i(12,"select",104),P("ngModelChange",function(n){m(e);let c=l();return S(c.formAdjustment.type,n)||(c.formAdjustment.type=n),p(n)}),i(13,"option",105),a(14,"Credit (reduce amount due)"),o(),i(15,"option",106),a(16,"Fee (increase amount due)"),o()()(),i(17,"div",66)(18,"label",107),a(19,"Amount *"),o(),i(20,"input",108),P("ngModelChange",function(n){m(e);let c=l();return S(c.formAdjustment.amountInput,n)||(c.formAdjustment.amountInput=n),p(n)}),o(),i(21,"small",69),a(22," Enter the amount in dollars (e.g., 25.00) "),o()(),i(23,"div",66)(24,"label",109),a(25,"Reason *"),o(),i(26,"textarea",110),P("ngModelChange",function(n){m(e);let c=l();return S(c.formAdjustment.reason,n)||(c.formAdjustment.reason=n),p(n)}),o()(),i(27,"div",111),a(28),o(),u(29,Nt,2,1,"div",82),i(30,"div",83)(31,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(32," Cancel "),o(),i(33,"button",85),u(34,Rt,2,0)(35,Lt,1,1),o()()()()()()}if(r&2){let e=l();s(12),v("ngModel",e.formAdjustment.type),s(8),v("ngModel",e.formAdjustment.amountInput),s(6),v("ngModel",e.formAdjustment.reason),s(2),b(" ",e.formAdjustment.type==="credit"?"A credit will reduce the amount the user owes.":"A fee will increase the amount the user owes."," "),s(),_(e.actionError()?29:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()||!e.formAdjustment.amountInput||!e.formAdjustment.reason.trim()),s(),_(e.actionLoading()?34:35)}}function Ft(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function zt(r,t){r&1&&(I(0,"span",91),a(1," Rejecting... "))}function Bt(r,t){r&1&&a(0," Reject Screenshot ")}function Gt(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Reject Screenshot"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.submitRejectScreenshot())}),i(9,"div",66)(10,"label",112),a(11,"Rejection Reason *"),o(),i(12,"textarea",113),P("ngModelChange",function(n){m(e);let c=l();return S(c.formRejectScreenshot.reason,n)||(c.formRejectScreenshot.reason=n),p(n)}),o(),i(13,"small",69),a(14," This message will be shown to the user explaining why their screenshot was rejected. "),o()(),u(15,Ft,2,1,"div",82),i(16,"div",83)(17,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(18," Cancel "),o(),i(19,"button",96),u(20,zt,2,0)(21,Bt,1,0),o()()()()()()}if(r&2){let e=l();s(12),v("ngModel",e.formRejectScreenshot.reason),s(3),_(e.actionError()?15:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()||!e.formRejectScreenshot.reason.trim()),s(),_(e.actionLoading()?20:21)}}function qt(r,t){if(r&1&&(i(0,"div",82),a(1),o()),r&2){let e=l(2);s(),x(e.actionError())}}function Ht(r,t){r&1&&(I(0,"span",91),a(1," Saving... "))}function Ut(r,t){r&1&&a(0," Save Payment Edit ")}function Kt(r,t){if(r&1){let e=M();i(0,"div",61),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),i(1,"div",62),g("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",63)(3,"h3"),a(4,"Edit Payment Record"),o(),i(5,"button",7),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(6,"\xD7"),o()(),i(7,"div",64)(8,"form",65),g("ngSubmit",function(){m(e);let n=l();return p(n.updatePaymentRecord())}),i(9,"div",82)(10,"strong"),a(11,"Dangerous operation:"),o(),a(12," this replaces payment history data and can change account balance. "),o(),i(13,"div",66)(14,"label",114),a(15,"Amount *"),o(),i(16,"input",115),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.amountInput,n)||(c.formEditPayment.amountInput=n),p(n)}),o()(),i(17,"div",66)(18,"label",116),a(19,"Payment Method *"),o(),i(20,"select",117),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.method,n)||(c.formEditPayment.method=n),p(n)}),i(21,"option",72),a(22,"Zelle"),o(),i(23,"option",73),a(24,"Check"),o(),i(25,"option",74),a(26,"Cash"),o(),i(27,"option",75),a(28,"Other"),o()()(),i(29,"div",66)(30,"label",118),a(31,"Reference"),o(),i(32,"input",119),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.reference,n)||(c.formEditPayment.reference=n),p(n)}),o()(),i(33,"div",66)(34,"label",120),a(35,"Notes"),o(),i(36,"textarea",121),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.notes,n)||(c.formEditPayment.notes=n),p(n)}),o()(),i(37,"div",66)(38,"label",122),a(39,"Change Reason *"),o(),i(40,"textarea",123),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.reason,n)||(c.formEditPayment.reason=n),p(n)}),o(),i(41,"small",69),a(42,"Saved to order history for audit."),o()(),i(43,"div",66)(44,"label",124)(45,"input",125),P("ngModelChange",function(n){m(e);let c=l();return S(c.formEditPayment.confirmDanger,n)||(c.formEditPayment.confirmDanger=n),p(n)}),o(),i(46,"span"),a(47,"I understand this can impact billing records."),o()()(),u(48,qt,2,1,"div",82),i(49,"div",83)(50,"button",84),g("click",function(){m(e);let n=l();return p(n.closeDialog())}),a(51," Cancel "),o(),i(52,"button",96),u(53,Ht,2,0)(54,Ut,1,0),o()()()()()()}if(r&2){let e=l();s(16),v("ngModel",e.formEditPayment.amountInput),s(4),v("ngModel",e.formEditPayment.method),s(12),v("ngModel",e.formEditPayment.reference),s(4),v("ngModel",e.formEditPayment.notes),s(4),v("ngModel",e.formEditPayment.reason),s(5),v("ngModel",e.formEditPayment.confirmDanger),s(3),_(e.actionError()?48:-1),s(2),h("disabled",e.actionLoading()),s(2),h("disabled",e.actionLoading()||!e.formEditPayment.reason.trim()||!e.formEditPayment.confirmDanger),s(),_(e.actionLoading()?53:54)}}var Ne=class r{orderId=z.required();seasonId=z(null);adminOrdersStore=E(Ee);orderRpc=E(se);userService=E(me);seasonService=E(ce);configService=E(le);router=E($);notificationService=E(De);unsubscribeOrder=null;order=D(null);loading=D(!1);error=D(null);userData=D(null);studentMap=D(new Map);actionLoading=this.orderRpc.loading;actionError=this.orderRpc.error;dialogMode=D(null);formPayment={amountInput:"",method:"zelle",reference:"",notes:"",isDepositConfirmation:!1};formCancel={reason:""};selectedItems=D(new Set);historyExpanded=D(!1);reversedHistory=C(()=>{let t=this.order()?.history;return t?[...t].reverse():[]});formRemoveWaitlist={sessionId:""};formAdjustment={type:"credit",amountInput:"",reason:""};formRejectScreenshot={screenshotId:"",reason:"Please re-upload a clearer image of your payment receipt."};formEditPayment={paymentId:"",amountInput:"",method:"zelle",reference:"",notes:"",reason:"",confirmDanger:!1};activePaymentMenuId=D(null);Math=Math;allItems=C(()=>this.order()?.items??[]);paidItems=C(()=>{let t=this.order();return t?te(t):[]});submittedItems=C(()=>{let t=this.order();return t?ee(t):[]});securedItems=C(()=>{let t=this.order();return t?ne(t):[]});lockedItems=C(()=>this.allItems().filter(t=>t.status==="locked"));cancellableItems=C(()=>[...this.lockedItems(),...this.paidItems(),...this.submittedItems(),...this.securedItems()]);waitlistEntries=C(()=>this.order()?.waitlist??[]);payments=C(()=>this.order()?.payments??[]);totalDue=C(()=>{let t=this.order();return t?oe(t):0});amountDue=C(()=>{let t=this.order();return t?ie(t):0});cashDiscount=C(()=>{let t=this.amountDue();return t<=0?0:ae(t)});cashAmountDue=C(()=>{let t=this.amountDue();return t<=0?0:de(t)});isExpiringSoon=C(()=>{let t=this.order();if(!t||!t.lockExpiresAt)return!1;let e=this.configService.currentTime(),d=new Date(t.lockExpiresAt),n=new Date(e),c=(d.getTime()-n.getTime())/(1e3*60*60);return c>0&&c<=12});remainingLockTime=C(()=>{let t=this.order();if(!t||!t.lockExpiresAt)return null;let e=this.configService.currentTime(),d=new Date(t.lockExpiresAt),n=new Date(e),c=d.getTime()-n.getTime();if(c<=0)return null;let y=Math.floor(c/(1e3*60*60)),O=Math.floor(c%(1e3*60*60)/(1e3*60));return{hours:y,minutes:O}});transformToLedgerItem(t){return{sessionId:t.sessionId,studentId:t.studentId,studentName:this.getStudentName(t.studentId),className:this.getClassName(t.sessionId,t.snapshot.className),startDate:t.snapshot?.startDate??"",endDate:t.snapshot?.endDate??"",status:t.status,options:t.options,pricing:{basePrice:t.snapshot?.priceSnapshot?.basePrice??0,lunchPrice:t.snapshot?.priceSnapshot?.lunchPrice??0,extendedCarePrice:t.snapshot?.priceSnapshot?.extendedCarePrice??0,itemTotal:t.snapshot?.priceSnapshot?.itemTotal??0}}}lockedItemsTransformed=C(()=>this.lockedItems().map(t=>this.transformToLedgerItem(t)));submittedItemsTransformed=C(()=>this.submittedItems().map(t=>this.transformToLedgerItem(t)));securedItemsTransformed=C(()=>this.securedItems().map(t=>this.transformToLedgerItem(t)));paidItemsTransformed=C(()=>this.paidItems().map(t=>this.transformToLedgerItem(t)));screenshotGroups=C(()=>{let t=this.order();if(!t)return[];let e=t.paymentScreenshots??[],d=this.submittedItemsTransformed();return e.map(n=>{let c=new Set(n.lockedItemKeys),y=d.filter(O=>{let G=`${O.sessionId}:${O.studentId}`;return c.has(G)});return{screenshot:n,items:y}}).filter(n=>n.items.length>0)});orderSummaryData=C(()=>{let t=this.order(),e=t?.pricing;if(!e)return null;let n=[...this.lockedItemsTransformed(),...this.submittedItemsTransformed(),...this.securedItemsTransformed(),...this.paidItemsTransformed()].reduce((f,w)=>f+w.pricing.itemTotal,0),c=new Map;for(let f of e.discounts){let w=c.get(f.type)??0;c.set(f.type,w+f.amount)}for(let f of t.processingFees??[]){if(f.type==="adjustment")continue;let w=c.get(f.type)??0;c.set(f.type,w+f.amount)}let y=[],O={returning_family:"Returning Family",returning_student:"Returning Student",sibling:"Sibling Discount",multi_session:"Multi-Session",coupon:"Coupon Credit",manual:"Manual Adjustment",referral:"Referral Bonus",cash_discount:"Cash Discount (3%)",adjustment:"Adjustment",forfeited_deposit:"Forfeited Deposit"};for(let[f,w]of c)w!==0&&y.push({key:`type:${f}`,type:f,label:O[f]??f,amount:w});for(let f of t.processingFees??[])f.type!=="adjustment"||f.amount===0||y.push({key:`adjustment:${f.id}`,type:"adjustment",label:f.description?.trim()?`Adjustment: ${f.description.trim()}`:"Adjustment",amount:f.amount});let Re=(t.paymentScreenshots??[]).reduce((f,w)=>f+(w.claimedAmountCents??0),0),N=(t.payments??[]).reduce((f,w)=>f+w.amount,0),V=this.securedItems().length,R=this.paidItems().length,Le=5e3,L=0,W=0;V>0&&R===0?L=N:V===0&&R>0?W=N:V>0&&R>0&&(L=Math.min(V*Le,N),W=N-L);let We=[{status:"locked",label:"Awaiting Payment",count:this.lockedItems().length,total:this.lockedItemsTransformed().reduce((f,w)=>f+w.pricing.itemTotal,0)},{status:"submitted",label:"Pending Verification",count:this.submittedItems().length,total:Re},{status:"secured",label:"Deposit Confirmed",count:V,total:L},{status:"paid",label:"Payment Confirmed",count:R,total:W}],Fe=y.reduce((f,w)=>f+w.amount,0),q=t.totalPaid??0,ze=Math.max(0,n+Fe-q);return{subtotal:n,totalPaid:q,discounts:y,amountDue:ze,statusCounts:We}});formatCurrency=je;formatDate=pe;formatDateTime=ue;getOrderStatus=re;getStatusBadgeClass=Ae;getStatusLabel=ke;getItemStatusBadgeClass=Te;getItemStatusLabel=Ve;onDocumentClick(){this.activePaymentMenuId.set(null)}async ngOnInit(){if(!this.userService.isAuthenticated()){await this.router.navigate(["/login"]);return}this.seasonService.hasClasses()||this.seasonService.loadAllClasses().catch(t=>{console.warn("[AdminOrderDetail] Failed to load classes for name resolution:",t)}),this.subscribeToOrder()}ngOnDestroy(){this.unsubscribeOrder&&(this.unsubscribeOrder(),this.unsubscribeOrder=null)}subscribeToOrder(){this.loading.set(!0),this.error.set(null);let t=this.seasonId();if(!t){this.error.set("Missing seasonId for admin order detail"),this.loading.set(!1);return}this.unsubscribeOrder=this.adminOrdersStore.subscribeToOrder(this.orderId(),async e=>{if(!e){this.order.set(null);let d=this.seasonId()?` (season: ${this.seasonId()})`:"";this.error.set(`Order not found for user: ${this.orderId()}${d}`),this.loading.set(!1);return}this.error.set(null),this.order.set(e),this.loading.set(!1),await this.loadUserData(e.userDisplayId)},e=>{let d=e instanceof Error?e.message:String(e);this.error.set(d),this.loading.set(!1)},t)}async loadUserData(t){try{let e=await this.userService.getUserByDisplayId(t);if(e){this.userData.set({displayName:e.displayName,email:e.email,phone:e.primaryGuardian?.phone,wechatId:e.primaryGuardian?.wechatId??void 0,wechatName:e.primaryGuardian?.wechatName??void 0,address:e.primaryGuardian?.address?`${e.primaryGuardian.address.street}, ${e.primaryGuardian.address.city}, ${e.primaryGuardian.address.state} ${e.primaryGuardian.address.zipCode}`:void 0});let d=new Map;for(let n of e.students??[])d.set(n.id,`${n.firstName} ${n.lastName}`);this.studentMap.set(d)}}catch(e){console.error("Failed to load user data:",e)}}getClassName(t,e=null){return this.seasonService.classes().find(n=>n.id===t)?.name??e??t}getStudentName(t){return this.studentMap().get(t)??t}getItemsTotal(t){return t.reduce((e,d)=>e+(d.snapshot?.priceSnapshot?.itemTotal??0),0)}openRecordPaymentDialog(){this.formPayment.amountInput=j(Math.max(0,this.amountDue())),this.formPayment.method="zelle",this.formPayment.reference="",this.formPayment.notes="",this.formPayment.isDepositConfirmation=!1,this.dialogMode.set("record-payment")}openCancelItemsDialog(){this.selectedItems.set(new Set),this.formCancel.reason="",this.dialogMode.set("cancel-items")}openRemoveWaitlistDialog(t){this.formRemoveWaitlist.sessionId=t,this.dialogMode.set("remove-waitlist")}openAddAdjustmentDialog(){this.formAdjustment.type="credit",this.formAdjustment.amountInput="",this.formAdjustment.reason="",this.dialogMode.set("add-adjustment")}closeDialog(){this.dialogMode.set(null),this.orderRpc.clearError(),this.activePaymentMenuId.set(null),this.formEditPayment.paymentId="",this.formEditPayment.amountInput="",this.formEditPayment.method="zelle",this.formEditPayment.reference="",this.formEditPayment.notes="",this.formEditPayment.reason="",this.formEditPayment.confirmDanger=!1}togglePaymentMenu(t,e){e.stopPropagation(),this.activePaymentMenuId.update(d=>d===t?null:t)}openEditPaymentDialog(t){this.formEditPayment.paymentId=t.id,this.formEditPayment.amountInput=j(t.amount),this.formEditPayment.method=t.method,this.formEditPayment.reference=t.reference??"",this.formEditPayment.notes=t.notes??"",this.formEditPayment.reason="",this.formEditPayment.confirmDanger=!1,this.activePaymentMenuId.set(null),this.dialogMode.set("edit-payment")}onPaymentMethodChange(t){t==="cash"?this.formPayment.amountInput=j(this.cashAmountDue()):this.formPayment.amountInput=j(this.amountDue())}isItemSelected(t){let e=`${t.sessionId}::${t.studentId}`;return this.selectedItems().has(e)}toggleItemSelection(t){let e=`${t.sessionId}::${t.studentId}`,d=new Set(this.selectedItems());d.has(e)?d.delete(e):d.add(e),this.selectedItems.set(d)}async recordPayment(){let t=this.order();if(!t)return;let e=B(this.formPayment.amountInput);if(e<0){this.notificationService.warning("Please enter a valid payment amount.");return}if(e===0&&this.amountDue()>0){this.notificationService.warning("Please enter a valid payment amount.");return}try{await this.orderRpc.recordPayment({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,amount:e,reference:this.formPayment.reference||null,method:this.formPayment.method,notes:this.formPayment.notes||null,isDepositConfirmation:this.formPayment.isDepositConfirmation,itemKeys:null}),this.closeDialog()}catch(d){console.error("Failed to record payment:",d)}}async confirmScreenshotPayment(t){let e=this.order();if(!e)return;let d=e.paymentScreenshots?.find(O=>O.id===t);if(!d){this.notificationService.error("Screenshot not found");return}let n=d.claimedAmountCents??0;if(n<=0){this.notificationService.warning("No claimed amount on this screenshot");return}let c=d.paymentOption==="cash_deposit",y=c?"cash":"zelle";try{await this.orderRpc.recordPayment({year:2026,seasonId:e.seasonId,userAuthId:e.userAuthId,amount:n,reference:t,method:y,notes:c?"Registration fee confirmed via screenshot":"Payment confirmed via screenshot",isDepositConfirmation:c,itemKeys:d.lockedItemKeys}),this.notificationService.success(c?"Registration fee confirmed":"Payment confirmed")}catch(O){console.error("Failed to confirm screenshot payment:",O),this.notificationService.error("Failed to confirm payment")}}rejectScreenshotPayment(t){this.formRejectScreenshot.screenshotId=t,this.formRejectScreenshot.reason="Please re-upload a clearer image of your payment receipt.",this.dialogMode.set("reject-screenshot")}async submitRejectScreenshot(){let t=this.order();if(!t)return;let{screenshotId:e,reason:d}=this.formRejectScreenshot;if(!(!e||!d.trim()))try{await this.orderRpc.deleteScreenshot({seasonId:t.seasonId,screenshotId:e,userAuthId:t.userAuthId,rejectionReason:d.trim()}),this.notificationService.success("Screenshot rejected, items reverted to awaiting payment"),this.closeDialog()}catch(n){console.error("Failed to reject screenshot:",n),this.notificationService.error("Failed to reject screenshot")}}async cancelItems(){let t=this.order();if(t){if(this.selectedItems().size===0){this.notificationService.warning("Please select at least one item to cancel.");return}if(!this.formCancel.reason.trim()){this.notificationService.warning("Please enter a cancellation reason.");return}try{let e=Array.from(this.selectedItems()).map(d=>{let[n,c]=d.split("::");return{sessionId:n,studentId:c}});await this.orderRpc.cancelItems({year:2026,seasonId:t.seasonId,items:e,reason:this.formCancel.reason,userAuthId:t.userAuthId}),this.closeDialog()}catch(e){console.error("Failed to cancel items:",e)}}}async removeWaitlist(){let t=this.order();if(t)try{await this.orderRpc.removeWaitlistEntry({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,sessionId:this.formRemoveWaitlist.sessionId}),this.closeDialog()}catch(e){console.error("Failed to remove waitlist entry:",e)}}async addAdjustment(){let t=this.order();if(!t)return;let e=B(this.formAdjustment.amountInput);if(e<=0){this.notificationService.warning("Please enter a valid amount.");return}if(!this.formAdjustment.reason.trim()){this.notificationService.warning("Please enter a reason for the adjustment.");return}let d=this.formAdjustment.type==="credit"?-e:e;try{await this.orderRpc.addAdjustment({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,amount:d,reason:this.formAdjustment.reason}),this.closeDialog(),this.notificationService.success(this.formAdjustment.type==="credit"?"Credit added successfully.":"Fee added successfully.")}catch(n){console.error("Failed to add adjustment:",n)}}async updatePaymentRecord(){let t=this.order();if(!t)return;if(!this.formEditPayment.confirmDanger){this.notificationService.warning("Please confirm the dangerous operation checkbox.");return}if(!this.formEditPayment.reason.trim()){this.notificationService.warning("Please provide a reason for the payment history change.");return}let e=this.parseSignedCurrencyInput(this.formEditPayment.amountInput);if(e===0){this.notificationService.warning("Payment amount cannot be zero.");return}let d=this.formEditPayment.paymentId;if(!d){this.notificationService.error("No payment selected to edit.");return}let n=!1,c=this.payments().map(y=>y.id!==d?y:(n=!0,U(H({},y),{amount:e,method:this.formEditPayment.method,reference:this.formEditPayment.reference.trim()?this.formEditPayment.reference.trim():null,notes:this.formEditPayment.notes.trim()?this.formEditPayment.notes.trim():null})));if(!n){this.notificationService.error("Selected payment record no longer exists.");return}try{await this.orderRpc.replaceOrderPayments({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,payments:c,reason:this.formEditPayment.reason.trim()}),this.notificationService.success("Payment history updated."),this.closeDialog()}catch(y){console.error("Failed to update payment record:",y)}}clearError(){this.error.set(null)}parseSignedCurrencyInput(t){let e=t.replace(/[^0-9.-]/g,""),d=parseFloat(e);return Number.isFinite(d)?Math.round(d*100):0}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=Z({type:r,selectors:[["app-admin-order-detail"]],hostBindings:function(e,d){e&1&&g("click",function(){return d.onDocumentClick()},K)},inputs:{orderId:[1,"orderId"],seasonId:[1,"seasonId"]},decls:11,vars:9,consts:[["pageTitle","Order Details","pageSubtitle","View and manage order"],[1,"admin-order-detail-container"],[1,"loading-state"],[1,"error-banner"],[1,"order-content"],[1,"modal-overlay"],[1,"spinner"],["type","button",1,"btn-close",3,"click"],[1,"order-header-info"],[1,"order-user-id"],[1,"label"],[1,"value"],[1,"status-badge",3,"ngClass"],[1,"order-layout"],[1,"main-column"],[1,"info-card","user-info-card"],[1,"info-card","status-card"],[1,"status-details"],[1,"detail-row"],[1,"value","status-badge",3,"ngClass"],[1,"empty-state"],[3,"lockedItems","submittedItems","securedItems","paidItems","editable","isAdmin","screenshotGroups"],[1,"info-card","payments-card"],[1,"info-card","waitlist-card"],[1,"info-card","history-card"],[1,"sidebar-column"],[3,"recordPaymentClick","addAdjustmentClick","isAdmin","orderSummary"],[1,"user-details"],[1,"value",3,"ngClass"],[1,"remaining-time"],[3,"cancelItemsClick","confirmScreenshot","rejectScreenshot","lockedItems","submittedItems","securedItems","paidItems","editable","isAdmin","screenshotGroups"],[1,"payments-table"],[1,"actions-column"],[1,"amount"],[1,"method-badge"],[1,"actions-cell"],[1,"row-actions",3,"click"],["type","button","aria-label","Payment actions",1,"row-menu-trigger",3,"click"],[1,"row-menu"],["type","button",1,"row-menu-item","danger",3,"click"],[1,"waitlist-list"],[1,"waitlist-item"],[1,"waitlist-header"],[1,"class-name"],[1,"waitlist-details"],[1,"detail-item"],["type","button",1,"btn","btn-danger-outline","btn-sm",3,"click"],[1,"section-header",3,"click"],["type","button",1,"toggle-btn"],[1,"history-timeline"],[1,"history-event"],[1,"event-time"],[1,"event-details"],[1,"event-action"],[1,"event-metadata"],[1,"affected-items"],[1,"affected-item"],[1,"item-class"],[1,"item-student"],[1,"item-options"],[1,"option-tag"],[1,"modal-overlay",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"modal-body"],[3,"ngSubmit"],[1,"form-group"],["for","payment-amount"],["type","text","id","payment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text"],["for","payment-method"],["id","payment-method","name","method","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","zelle"],["value","check"],["value","cash"],["value","other"],[1,"cash-discount-info"],["for","payment-reference"],["type","text","id","payment-reference","name","reference","placeholder","Confirmation number, check number, etc.",1,"form-control",3,"ngModelChange","ngModel"],["for","payment-notes"],["id","payment-notes","name","notes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","deposit-confirmation"],[1,"alert","alert-danger"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"cash-info-row"],[1,"cash-info-row","discount"],[1,"cash-info-row","total"],[1,"checkbox-label"],["type","checkbox","name","isDepositConfirmation",3,"ngModelChange","ngModel"],[1,"spinner-small"],[1,"items-checklist"],[1,"checkbox-item"],["for","cancel-reason"],["id","cancel-reason","name","reason","rows","3","placeholder","Enter reason for cancellation...","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-danger",3,"disabled"],["type","checkbox",3,"change","checked"],[1,"item-info"],[1,"student-name"],[1,"item-status-badge",3,"ngClass"],[1,"read-only-value"],[1,"alert","alert-warning"],["for","adjustment-type"],["id","adjustment-type","name","type","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","credit"],["value","fee"],["for","adjustment-amount"],["type","text","id","adjustment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","adjustment-reason"],["id","adjustment-reason","name","reason","rows","3","placeholder","Explain the reason for this adjustment...","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-info"],["for","reject-reason"],["id","reject-reason","name","reason","rows","3","required","","placeholder","Enter reason shown to user...",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-amount"],["type","text","id","edit-payment-amount","name","editAmount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-method"],["id","edit-payment-method","name","editMethod","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-reference"],["type","text","id","edit-payment-reference","name","editReference","placeholder","Confirmation number, check number, etc.",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-notes"],["id","edit-payment-notes","name","editNotes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-reason"],["id","edit-payment-reason","name","editReason","rows","3","placeholder","Explain why this payment history edit is needed...","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"checkbox-label","danger-checkbox"],["type","checkbox","name","confirmDanger",3,"ngModelChange","ngModel"]],template:function(e,d){e&1&&(i(0,"app-admin-layout",0)(1,"div",1),u(2,Ue,4,0,"div",2),u(3,Ke,6,1,"div",3),u(4,yt,39,15,"div",4),u(5,Mt,44,11,"div",5),u(6,At,26,5,"div",5),u(7,jt,23,5,"div",5),u(8,Wt,36,8,"div",5),u(9,Gt,22,5,"div",5),u(10,Kt,55,10,"div",5),o()()),e&2&&(s(2),_(d.loading()?2:-1),s(),_(d.error()&&!d.loading()?3:-1),s(),_(d.order()&&!d.loading()?4:-1),s(),_(d.dialogMode()==="record-payment"?5:-1),s(),_(d.dialogMode()==="cancel-items"?6:-1),s(),_(d.dialogMode()==="remove-waitlist"?7:-1),s(),_(d.dialogMode()==="add-adjustment"?8:-1),s(),_(d.dialogMode()==="reject-screenshot"?9:-1),s(),_(d.dialogMode()==="edit-payment"?10:-1))},dependencies:[X,Q,we,ye,ve,Se,ge,_e,be,fe,xe,Pe,he,Ce,Oe,Me,Ie],styles:[".admin-order-detail-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:15px;border-radius:4px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.btn-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;cursor:pointer;color:inherit}.order-header-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;padding:1rem;background:#fff;border:1px solid #e0e0e0;border-radius:8px}.order-user-id[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.order-user-id[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.order-user-id[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-family:monospace;font-weight:500;font-size:.9375rem}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e0e0e0}.user-id[_ngcontent-%COMP%]{color:#666;font-size:14px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.order-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 350px;gap:1.5rem;align-items:start}.main-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.sidebar-column[_ngcontent-%COMP%]{position:sticky;top:20px}@media(max-width:900px){.order-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.sidebar-column[_ngcontent-%COMP%]{position:static;order:-1}}.info-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:20px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;color:#333}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.user-details[_ngcontent-%COMP%], .status-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.status-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:4px;font-size:12px;font-weight:600;text-transform:uppercase;display:inline-block}.status-submitted[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-paid[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-cancelled[_ngcontent-%COMP%], .status-refunded[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-partial[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460}.status-empty[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.remaining-time[_ngcontent-%COMP%]{font-size:12px;color:#666}.alert[_ngcontent-%COMP%]{padding:12px 16px;border-radius:4px;margin-top:15px}.alert-danger[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.alert-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}.alert-info[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}.items-section[_ngcontent-%COMP%]{margin-bottom:30px}.items-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:15px;color:#333}.item-count[_ngcontent-%COMP%]{color:#666;font-weight:400;font-size:14px}.items-list[_ngcontent-%COMP%]{display:grid;gap:12px}.item-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.item-card.locked[_ngcontent-%COMP%]{background:#f3e5f5;border-color:#ce93d8}.item-card.pending[_ngcontent-%COMP%]{background:#fff3cd;border-color:#ffeaa7}.item-card.secured[_ngcontent-%COMP%]{background:#f3e5f5;border-color:#ce93d8}.item-card.cancelled[_ngcontent-%COMP%]{background:#f8d7da;border-color:#f5c6cb;opacity:.7}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.class-name[_ngcontent-%COMP%]{font-weight:600;color:#333}.item-status-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:3px;font-size:11px;font-weight:600;text-transform:uppercase}.item-status-locked[_ngcontent-%COMP%]{background:#7b1fa2;color:#fff}.item-status-submitted[_ngcontent-%COMP%]{background:#ffc107;color:#000}.item-status-paid[_ngcontent-%COMP%]{background:#28a745;color:#fff}.item-status-secured[_ngcontent-%COMP%]{background:#7b1fa2;color:#fff}.item-status-cancelled[_ngcontent-%COMP%], .item-status-refunded[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.detail-item[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:14px}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.option-badge[_ngcontent-%COMP%]{background:#007bff;color:#fff;padding:2px 8px;border-radius:3px;font-size:11px;margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px;background:#f8f9fa;border-bottom:2px solid #dee2e6;font-weight:600}.payments-table[_ngcontent-%COMP%]   th.actions-column[_ngcontent-%COMP%]{width:64px}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #dee2e6;vertical-align:middle}.payments-table[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-weight:600}.method-badge[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;text-transform:uppercase}.actions-cell[_ngcontent-%COMP%]{text-align:right}.row-actions[_ngcontent-%COMP%]{position:relative;display:inline-flex;justify-content:flex-end}.row-menu-trigger[_ngcontent-%COMP%]{border:1px solid #dee2e6;background:#fff;color:#495057;border-radius:6px;width:30px;height:30px;line-height:1;font-size:20px;cursor:pointer}.row-menu-trigger[_ngcontent-%COMP%]:hover{background:#f8f9fa}.row-menu[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 6px);right:0;z-index:20;min-width:140px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 8px 20px #0000001f;padding:6px}.row-menu-item[_ngcontent-%COMP%]{width:100%;text-align:left;border:none;background:transparent;border-radius:6px;padding:8px 10px;font-size:13px;cursor:pointer}.row-menu-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.row-menu-item.danger[_ngcontent-%COMP%]{color:#c62828}.waitlist-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.waitlist-item[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.waitlist-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.promoted-badge[_ngcontent-%COMP%]{background:#28a745;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;font-weight:600}.waitlist-details[_ngcontent-%COMP%]{margin-bottom:10px}.section-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;cursor:pointer;-webkit-user-select:none;user-select:none;margin-bottom:15px}.section-header[_ngcontent-%COMP%]:hover{opacity:.8}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.toggle-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:14px;color:#666;cursor:pointer;padding:4px 8px}.history-timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.history-event[_ngcontent-%COMP%]{display:flex;gap:15px;padding:12px;background:#f8f9fa;border-radius:6px}.event-time[_ngcontent-%COMP%]{color:#666;font-size:12px;white-space:nowrap;min-width:150px}.event-details[_ngcontent-%COMP%]{flex:1}.event-action[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.event-metadata[_ngcontent-%COMP%]{color:#666;font-size:14px}.affected-items[_ngcontent-%COMP%]{margin-top:8px;padding:8px;background:#e9ecef;border-radius:4px}.affected-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:13px;border-bottom:1px solid #dee2e6}.affected-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.affected-item[_ngcontent-%COMP%]   .item-class[_ngcontent-%COMP%]{font-weight:500;color:#333}.affected-item[_ngcontent-%COMP%]   .item-student[_ngcontent-%COMP%]{color:#666}.affected-item[_ngcontent-%COMP%]   .item-options[_ngcontent-%COMP%]{display:flex;gap:4px;margin-left:auto}.affected-item[_ngcontent-%COMP%]   .option-tag[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:2px 6px;border-radius:3px;font-size:10px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-primary-outline[_ngcontent-%COMP%]{background:#fff;color:#007bff;border:1px solid #007bff}.btn-primary-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#007bff;color:#fff}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-danger-outline[_ngcontent-%COMP%]{background:#fff;color:#dc3545;border:1px solid #dc3545}.btn-danger-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc3545;color:#fff}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.modal-body[_ngcontent-%COMP%]{padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:8px;color:#333}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:14px}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.form-text[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:12px;color:#6c757d}.items-checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow-y:auto;padding:8px;background:#f8f9fa;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:8px;cursor:pointer}.checkbox-item[_ngcontent-%COMP%]:hover{background:#e9ecef;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.item-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.read-only-value[_ngcontent-%COMP%]{padding:8px 12px;background:#f8f9fa;border-radius:4px;font-weight:500}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px;padding-top:20px;border-top:1px solid #dee2e6}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite;margin-right:8px}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.cash-discount-info[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #c8e6c9;border-radius:8px;padding:12px;margin-bottom:15px}.cash-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.cash-info-row.discount[_ngcontent-%COMP%]{color:#2e7d32}.cash-info-row.total[_ngcontent-%COMP%]{font-weight:600;font-size:16px;border-top:1px solid #c8e6c9;padding-top:8px;margin-top:4px}.cash-discount-info[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{margin-top:8px;color:#666;font-style:italic}.deposit-confirmation[_ngcontent-%COMP%]{background:#f3e5f5;border:1px solid #ce93d8;border-radius:8px;padding:12px}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:500}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#7b1fa2}.deposit-confirmation[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{margin-top:8px;color:#7b1fa2}.danger-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{accent-color:#c62828}"]})};export{Ne as AdminOrderDetailComponent};
