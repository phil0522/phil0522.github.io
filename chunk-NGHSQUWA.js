import{a as V}from"./chunk-IRMFFHZE.js";import{ba as E,ca as T,ga as F,h as M,l as O,n as A}from"./chunk-YIOKCNBW.js";import"./chunk-CIPCES67.js";import{$a as u,Bb as v,Db as r,Ea as s,N as f,Qa as S,S as d,T as m,ab as _,da as w,ea as y,fb as C,gb as t,hb as i,ib as p,ob as h,qb as g,sb as l,wb as k,xb as b,yb as P}from"./chunk-CNMR2ZL6.js";import"./chunk-Q7L6LLAK.js";var B=["contentCard"];function I(n,o){n&1&&(t(0,"div",11),p(1,"div",17),t(2,"span"),r(3,"Loading..."),i()())}function q(n,o){if(n&1&&p(0,"app-markdown-renderer",12),n&2){let e=l(2);C("content",e.releaseAgreementContent())}}function N(n,o){n&1&&(t(0,"div",13)(1,"p"),r(2,"No liability release content has been configured."),i(),t(3,"p",18),r(4,"Please contact the administrator."),i()())}function z(n,o){if(n&1){let e=h();t(0,"div",7)(1,"div",8)(2,"h1"),r(3,"Stage 1: Liability Release"),i(),t(4,"p",9),r(5,"Legal Acknowledgement Required"),i()(),t(6,"div",10,0),g("scroll",function(){d(e);let c=l();return m(c.onContentScroll())}),u(8,I,4,0,"div",11)(9,q,1,1,"app-markdown-renderer",12)(10,N,5,0,"div",13),i(),t(11,"div",14)(12,"button",15),g("click",function(){d(e);let c=l();return m(c.goBack())}),r(13,"Go Back"),i(),t(14,"button",16),g("click",function(){d(e);let c=l();return m(c.nextStage())}),r(15," Continue "),i()()()}if(n&2){let e=l();s(8),_(e.configService.loading()?8:e.releaseAgreementContent()?9:10),s(6),C("disabled",!e.releaseAgreementContent()||!e.canProceed())}}function D(n,o){n&1&&(t(0,"div",11),p(1,"div",17),t(2,"span"),r(3,"Loading..."),i()())}function L(n,o){if(n&1&&p(0,"app-markdown-renderer",12),n&2){let e=l(2);C("content",e.returnInstructionsContent())}}function j(n,o){n&1&&(t(0,"div",13)(1,"p"),r(2,"No financial terms content has been configured."),i(),t(3,"p",18),r(4,"Please contact the administrator."),i()())}function H(n,o){if(n&1){let e=h();t(0,"div",7)(1,"div",8)(2,"h1"),r(3,"Stage 2: Financial Terms"),i(),t(4,"p",9),r(5,"Strict Refund Policy Agreement"),i()(),t(6,"div",10,0),g("scroll",function(){d(e);let c=l();return m(c.onContentScroll())}),u(8,D,4,0,"div",11)(9,L,1,1,"app-markdown-renderer",12)(10,j,5,0,"div",13),i(),t(11,"div",14)(12,"button",15),g("click",function(){d(e);let c=l();return m(c.previousStage())}),r(13,"Back"),i(),t(14,"button",16),g("click",function(){d(e);let c=l();return m(c.nextStage())}),r(15," Continue "),i()()()}if(n&2){let e=l();s(8),_(e.configService.loading()?8:e.returnInstructionsContent()?9:10),s(6),C("disabled",!e.returnInstructionsContent()||!e.canProceed())}}function Q(n,o){n&1&&(t(0,"div",11),p(1,"div",17),t(2,"span"),r(3,"Loading..."),i()())}function G(n,o){if(n&1&&p(0,"app-markdown-renderer",12),n&2){let e=l(2);C("content",e.mediaPolicyContent())}}function U(n,o){n&1&&(t(0,"div",13)(1,"p"),r(2,"No media policy content has been configured."),i(),t(3,"p",18),r(4,"Please contact the administrator."),i()())}function W(n,o){if(n&1){let e=h();t(0,"div",7)(1,"div",8)(2,"h1"),r(3,"Stage 3: Media Policy"),i(),t(4,"p",9),r(5,"Photo & Video Consent"),i()(),t(6,"div",10,0),g("scroll",function(){d(e);let c=l();return m(c.onContentScroll())}),u(8,Q,4,0,"div",11)(9,G,1,1,"app-markdown-renderer",12)(10,U,5,0,"div",13),i(),t(11,"div",14)(12,"button",15),g("click",function(){d(e);let c=l();return m(c.previousStage())}),r(13,"Back"),i(),t(14,"button",19),g("click",function(){d(e);let c=l();return m(c.completeAcknowledgement())}),r(15," I Fully Agree & Consent "),i()()()}if(n&2){let e=l();s(8),_(e.configService.loading()?8:e.mediaPolicyContent()?9:10),s(6),C("disabled",!e.mediaPolicyContent()||!e.canProceed())}}var R=class n{configService=f(E);seasonService=f(T);acknowledgementService=f(F);router=f(A);route=f(O);currentStage=w(1);requiresScroll=w(!1);hasReachedBottom=w(!1);scrollCheckTimer=null;contentCard;constructor(){y(()=>{this.currentStage(),this.currentContent(),this.scheduleScrollCheck()})}ngOnInit(){this.configService.isSystemInitialized()||this.configService.fetchConfig()}releaseAgreementContent(){return this.configService.releaseAgreementContent()?.content??""}returnInstructionsContent(){return this.configService.returnInstructions()?.content??""}mediaPolicyContent(){return this.configService.mediaPolicyContent()?.content??""}currentContent(){switch(this.currentStage()){case 1:return this.releaseAgreementContent();case 2:return this.returnInstructionsContent();case 3:return this.mediaPolicyContent();default:return""}}onContentScroll(){this.updateScrollState()}canProceed(){return!this.requiresScroll()||this.hasReachedBottom()}scheduleScrollCheck(){this.scrollCheckTimer&&clearTimeout(this.scrollCheckTimer),this.scrollCheckTimer=setTimeout(()=>this.updateScrollState(),0)}updateScrollState(){let o=this.contentCard?.nativeElement;if(!o){this.requiresScroll.set(!1),this.hasReachedBottom.set(!1);return}let e=o.scrollHeight>o.clientHeight+4;if(this.requiresScroll.set(e),!e){this.hasReachedBottom.set(!0);return}let a=o.scrollTop+o.clientHeight>=o.scrollHeight-2;this.hasReachedBottom.set(a)}nextStage(){this.currentStage()<3&&this.currentStage.update(o=>o+1)}previousStage(){this.currentStage()>1&&this.currentStage.update(o=>o-1)}goBack(){this.router.navigate(["/"])}completeAcknowledgement(){let o=this.seasonService.selectedSeason();if(!o){console.error("No season selected"),this.router.navigate(["/"]);return}this.acknowledgementService.saveAcknowledgement(o.id);let e=this.route.snapshot.queryParamMap.get("students"),a=e?e.split(",").map(x=>x.trim()).filter(x=>x.length>0):[];a.length>0&&this.acknowledgementService.saveReservationAcknowledgementForStudents(o.id,a);let c=this.route.snapshot.queryParamMap.get("redirect");if(c&&c.startsWith("/")){this.router.navigateByUrl(c);return}this.router.navigate(["/ledger"])}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=S({type:n,selectors:[["app-acknowledgement-flow"]],viewQuery:function(e,a){if(e&1&&k(B,5),e&2){let c;b(c=P())&&(a.contentCard=c.first)}},decls:22,vars:17,consts:[["contentCard",""],[1,"acknowledgement-flow"],[1,"progress-indicator"],[1,"step"],[1,"step-number"],[1,"step-label"],[1,"step-connector"],[1,"stage-content"],[1,"stage-header"],[1,"subtitle"],[1,"content-card",3,"scroll"],[1,"loading"],[3,"content"],[1,"empty-content"],[1,"stage-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"spinner"],[1,"note"],[1,"btn-primary","btn-confirm",3,"click","disabled"]],template:function(e,a){e&1&&(t(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),r(4,"1"),i(),t(5,"span",5),r(6,"Liability Release"),i()(),p(7,"div",6),t(8,"div",3)(9,"span",4),r(10,"2"),i(),t(11,"span",5),r(12,"Financial Terms"),i()(),p(13,"div",6),t(14,"div",3)(15,"span",4),r(16,"3"),i(),t(17,"span",5),r(18,"Media Policy"),i()()(),u(19,z,16,2,"div",7),u(20,H,16,2,"div",7),u(21,W,16,2,"div",7),i()),e&2&&(s(2),v("active",a.currentStage()===1)("completed",a.currentStage()>1),s(5),v("completed",a.currentStage()>1),s(),v("active",a.currentStage()===2)("completed",a.currentStage()>2),s(5),v("completed",a.currentStage()>2),s(),v("active",a.currentStage()===3),s(5),_(a.currentStage()===1?19:-1),s(),_(a.currentStage()===2?20:-1),s(),_(a.currentStage()===3?21:-1))},dependencies:[M,V],styles:[".acknowledgement-flow[_ngcontent-%COMP%]{min-height:100vh;background:var(--sys-surface, #fafafa);padding:2rem 1rem}.progress-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:2rem;padding:0 2rem}.step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem}.step-number[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);display:flex;align-items:center;justify-content:center;font-weight:600;font-size:1rem;transition:all .3s ease}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;box-shadow:0 2px 8px #c628284d}.step.completed[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background:var(--sys-tertiary, #2e7d32);color:#fff}.step-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666);white-space:nowrap}.step.active[_ngcontent-%COMP%]   .step-label[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828);font-weight:600}.step-connector[_ngcontent-%COMP%]{width:80px;height:3px;background:var(--sys-outline, #e0e0e0);margin:0 1rem 1.5rem;transition:background .3s ease}.step-connector.completed[_ngcontent-%COMP%]{background:var(--sys-tertiary, #2e7d32)}.stage-content[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.stage-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.stage-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem;color:var(--sys-on-surface, #212121)}.stage-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666);font-size:1rem}.content-card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:16px;padding:2rem;margin-bottom:1.5rem;max-height:60vh;overflow-y:auto;box-shadow:0 2px 8px #0000000d}.loading[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:1rem;padding:2rem;color:var(--sys-on-surface-variant, #666)}.spinner[_ngcontent-%COMP%]{width:24px;height:24px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.empty-content[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--sys-on-surface-variant, #666)}.empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0}.empty-content[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #999)}.stage-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:1rem 2rem;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;border:none}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;flex:1}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c);box-shadow:0 4px 12px #c628284d}.btn-primary[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #999);cursor:not-allowed}.btn-primary.btn-confirm[_ngcontent-%COMP%]{background:var(--sys-tertiary, #2e7d32)}.btn-primary.btn-confirm[_ngcontent-%COMP%]:hover:not(:disabled){background:#1b5e20;box-shadow:0 4px 12px #2e7d324d}.btn-secondary[_ngcontent-%COMP%]{background:#fff;color:var(--sys-on-surface-variant, #666);border:1px solid var(--sys-outline, #e0e0e0)}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}@media(max-width:600px){.acknowledgement-flow[_ngcontent-%COMP%]{padding:1rem}.progress-indicator[_ngcontent-%COMP%]{padding:0}.step-connector[_ngcontent-%COMP%]{width:40px}.step-label[_ngcontent-%COMP%]{font-size:.75rem}.content-card[_ngcontent-%COMP%]{padding:1rem;max-height:50vh}.stage-actions[_ngcontent-%COMP%]{flex-direction:column}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{width:100%}}"]})};export{R as AcknowledgementFlowComponent};
