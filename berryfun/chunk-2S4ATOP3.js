import{d as G}from"./chunk-6CU2GE2E.js";import{a as H}from"./chunk-QZGAVVE5.js";import{a as $,d as z}from"./chunk-RYIKU5Y3.js";import{R as k,S as U,Z as F,d as N,h as R,j as A,k as T}from"./chunk-NR32JDWD.js";import"./chunk-UYHN5VVP.js";import{Ab as P,Ea as s,Jb as O,Kb as L,N as u,Ob as M,Pa as D,Za as b,_a as _,bb as w,cb as I,da as f,db as C,eb as n,fb as i,gb as E,ob as x,yb as a,zb as l}from"./chunk-AFX6RXNX.js";import"./chunk-Q7L6LLAK.js";var j=()=>["/admin/users"],q=r=>({q:r}),Y=(r,t)=>t.studentId;function K(r,t){r&1&&(n(0,"div",2),E(1,"div",4),n(2,"p"),a(3,"Loading roster..."),i()())}function J(r,t){if(r&1&&(n(0,"div",3)(1,"div",5),a(2,"!"),i(),n(3,"p"),a(4),i()()),r&2){let e=x();s(4),l(e.error())}}function Q(r,t){r&1&&(n(0,"div",10)(1,"h3"),a(2,"No registrations found"),i(),n(3,"p"),a(4,"This session has no enrolled students."),i()())}function V(r,t){if(r&1&&(n(0,"a",17),a(1),i()),r&2){let e=x().$implicit;C("routerLink",O(3,j))("queryParams",L(4,q,e.parentDisplayId)),s(),P(" ",e.parentName," ")}}function W(r,t){if(r&1&&(n(0,"span",18),a(1),i()),r&2){let e=x().$implicit;s(),l(e.parentName)}}function X(r,t){if(r&1&&(n(0,"tr")(1,"td",13)(2,"div",14),a(3),i(),n(4,"div",15),a(5),i()(),n(6,"td"),a(7),i(),n(8,"td"),a(9),i(),n(10,"td"),a(11),i(),n(12,"td"),a(13),i(),n(14,"td"),a(15),i(),n(16,"td"),a(17),i(),n(18,"td",16),b(19,V,2,6,"a",17)(20,W,2,1,"span",18),n(21,"div",19)(22,"span",20),a(23),i(),n(24,"span"),a(25),i(),n(26,"span"),a(27),i()()(),n(28,"td")(29,"span",21),a(30),i()()()),r&2){let e=t.$implicit;s(3),l(e.studentName),s(2),l(e.studentId),s(2),l(e.ageLabel),s(2),l(e.genderLabel),s(2),l(e.dobLabel),s(2),l(e.gradeLabel),s(2),l(e.schoolLabel),s(2),l(e.allergiesLabel),s(2),_(e.parentDisplayId?19:20),s(4),l(e.parentDisplayId||"--"),s(2),l(e.parentEmail),s(2),l(e.parentPhone),s(3),l(e.orderStatusLabel)}}function Z(r,t){if(r&1&&(n(0,"div",11)(1,"table",12)(2,"thead")(3,"tr")(4,"th"),a(5,"Student"),i(),n(6,"th"),a(7,"Age"),i(),n(8,"th"),a(9,"Gender"),i(),n(10,"th"),a(11,"DOB"),i(),n(12,"th"),a(13,"Grade"),i(),n(14,"th"),a(15,"School"),i(),n(16,"th"),a(17,"Allergies"),i(),n(18,"th"),a(19,"Parent"),i(),n(20,"th"),a(21,"Status"),i()()(),n(22,"tbody"),w(23,X,31,13,"tr",null,Y),i()()()),r&2){let e=x(2);s(23),I(e.rows())}}function ee(r,t){if(r&1&&(n(0,"div",6)(1,"div",7)(2,"span",8),a(3,"Session"),i(),n(4,"span",9),a(5),i()(),n(6,"div",7)(7,"span",8),a(8,"Dates"),i(),n(9,"span",9),a(10),i()(),n(11,"div",7)(12,"span",8),a(13,"Enrolled"),i(),n(14,"span",9),a(15),i()()(),b(16,Q,5,0,"div",10)(17,Z,25,0,"div",11)),r&2){let e,o=x();s(5),l((e=o.session())==null?null:e.name),s(5),l(o.dateRange()),s(5),l(o.rows().length),s(),_(o.rows().length===0?16:17)}}var B=class r{route=u(R);router=u(A);userService=u(F);seasonDatastore=u(k);orderDatastore=u(U);loading=f(!0);error=f(null);season=f(null);session=f(null);rows=f([]);subtitle=M(()=>{let t=this.season()?.name??"Season",e=this.session()?.name??"Session";return`${t} - ${e}`});dateRange=M(()=>{let t=this.session();return!t?.startDate||!t?.endDate?"--":z(t.startDate,t.endDate)});async ngOnInit(){if(!this.userService.isAuthenticated()){this.router.navigate(["/login"]);return}if(!this.userService.isAdmin()){this.router.navigate(["/"]);return}let t=this.route.snapshot.paramMap.get("sessionId");if(!t){this.error.set("Missing session ID."),this.loading.set(!1);return}try{let{season:e,session:o}=await this.loadSessionContext(t);this.season.set(e),this.session.set(o);let p=(await this.seasonDatastore.getRegistration(e.id))?.classes[t]?.enrolledStudents??[];await this.userService.loadAllUsers();let c=this.userService.users(),m=new Map(c.map(g=>[g.displayId,g])),h=await this.orderDatastore.listOrdersBySessionId(e.id,t),y=new Map;for(let g of h)for(let v of g.items)v.sessionId===t&&y.set(v.studentId,v.status);let S=p.map(g=>this.buildRow(g,m,y.get(g)??null,o.startDate??null));S.sort((g,v)=>g.studentName.localeCompare(v.studentName)),this.rows.set(S)}catch(e){let o=e instanceof Error?e.message:"Failed to load session registrations.";this.error.set(o)}finally{this.loading.set(!1)}}async loadSessionContext(t){let e=await this.seasonDatastore.listAllSeasons();for(let o of e){let d=o.sessions?.find(p=>p.id===t);if(d)return{season:o,session:d}}throw new Error("Session not found.")}buildRow(t,e,o,d){let p=this.getParentDisplayId(t),c=p?e.get(p):null,m=c?.students?.find(S=>S.id===t)??null,h=m?`${m.firstName} ${m.lastName}`:t,y=this.getAgeLabel(m,d);return{studentId:t,studentName:h,ageLabel:y,dobLabel:m?.dob?$(m.dob,{month:"short",day:"numeric",year:"numeric"}):"--",genderLabel:this.getGenderLabel(m),gradeLabel:m?.grade??"--",schoolLabel:m?.school??"--",allergiesLabel:m?.allergies??"--",parentName:c?.displayName??"Unknown Parent",parentDisplayId:c?.displayId??"",parentEmail:c?.email??"--",parentPhone:c?.primaryGuardian?.phone??"--",orderStatusLabel:o?G(o):"Unknown"}}getParentDisplayId(t){let e=t.match(/^(U-\d{8})-K\d+$/);return e?e[1]:null}getGenderLabel(t){return t?.gender?t.gender==="M"?"Male":"Female":"--"}getAgeLabel(t,e){if(!t?.dob)return"--";let o=e??t.dob,d=this.calculateAge(t.dob,o);return Number.isNaN(d)?"--":String(d)}calculateAge(t,e){let o=this.parseDateOnly(t),d=this.parseDateOnly(e),p=d.getUTCFullYear()-o.getUTCFullYear(),c=d.getUTCMonth()-o.getUTCMonth();return(c<0||c===0&&d.getUTCDate()<o.getUTCDate())&&(p-=1),p}parseDateOnly(t){let[e,o,d]=t.split("T")[0].split("-").map(Number);return new Date(Date.UTC(e,o-1,d,12))}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=D({type:r,selectors:[["app-admin-session-registrations"]],decls:5,vars:2,consts:[["pageTitle","Session Registrations",3,"pageSubtitle"],[1,"session-registrations"],[1,"loading-container"],[1,"error-container"],[1,"spinner"],[1,"error-icon"],[1,"session-summary"],[1,"summary-item"],[1,"summary-label"],[1,"summary-value"],[1,"empty-state"],[1,"table-container"],[1,"roster-table"],[1,"col-student"],[1,"student-name"],[1,"student-id"],[1,"col-parent"],[1,"parent-link",3,"routerLink","queryParams"],[1,"parent-link","disabled"],[1,"parent-meta"],[1,"mono"],[1,"status-pill"]],template:function(e,o){e&1&&(n(0,"app-admin-layout",0)(1,"div",1),b(2,K,4,0,"div",2)(3,J,5,1,"div",3)(4,ee,18,4),i()()),e&2&&(C("pageSubtitle",o.subtitle()),s(2),_(o.loading()?2:o.error()?3:4))},dependencies:[N,T,H],styles:[".session-registrations[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin-bottom:1rem}.session-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1rem;padding:1rem 1.25rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:12px;margin-bottom:1.5rem}.summary-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.summary-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.04em;color:var(--sys-on-surface-variant, #666)}.summary-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--sys-on-surface, #212121)}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.roster-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.85rem}.roster-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:.625rem .75rem;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--sys-on-surface-variant, #666);border-bottom:2px solid var(--sys-outline-variant, #e0e0e0);white-space:nowrap}.roster-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.625rem .75rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);color:var(--sys-on-surface, #212121);vertical-align:top}.col-student[_ngcontent-%COMP%]{min-width:180px}.student-name[_ngcontent-%COMP%]{font-weight:600}.student-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666);margin-top:.2rem}.col-parent[_ngcontent-%COMP%]{min-width:220px}.parent-link[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828);text-decoration:none;font-weight:600}.parent-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.parent-link.disabled[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #888);cursor:default}.parent-meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem;font-size:.75rem;color:var(--sys-on-surface-variant, #666);margin-top:.25rem}.mono[_ngcontent-%COMP%]{font-family:monospace}.status-pill[_ngcontent-%COMP%]{display:inline-block;padding:.2rem .5rem;border-radius:999px;background:var(--sys-surface-variant, #f5f5f5);font-size:.75rem;font-weight:600}@media(max-width:960px){.session-summary[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{B as AdminSessionRegistrationsComponent};
