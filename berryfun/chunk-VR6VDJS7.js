import{a as pe}from"./chunk-J5E2CEGS.js";import{a as se}from"./chunk-G3HAGKMW.js";import{a as me}from"./chunk-5XJQS36E.js";import"./chunk-6MNJR2G7.js";import{a as ce}from"./chunk-3YBVA2PI.js";import"./chunk-DLJK6BWM.js";import{$ as ae,Z as L,_ as re,aa as le,ba as de,d as U,j as X,r as te,s as ne,t as oe,u as ie}from"./chunk-C54VLDTI.js";import{F as ee}from"./chunk-UYHN5VVP.js";import{Aa as j,Ab as r,Bb as M,Cb as v,Db as J,Ea as i,I as G,N as x,Pa as I,Rb as f,S as _,T as y,Ub as D,Vb as K,Za as p,_ as Q,_a as u,bb as q,cb as H,da as C,db as S,ea as R,eb as c,fb as s,gb as w,hb as m,ib as l,jb as k,kb as h,lb as T,mb as O,nb as b,ob as d,ub as W,vb as Y,xb as Z,yb as P}from"./chunk-WXZFQYIJ.js";import{a as B,b as $}from"./chunk-Q7L6LLAK.js";var ve=5*1024*1024,xe=["image/jpeg","image/png"],N=class o{storage=ie(ee());uploadProgress=C(0);uploading=C(!1);currentUploadTask=null;validateFile(t){return t.size>ve?{type:"file_too_large",message:`File size (${(t.size/(1024*1024)).toFixed(1)} MB) exceeds the 5 MB limit.`}:xe.includes(t.type)?null:{type:"invalid_type",message:"Only JPEG and PNG images are accepted."}}async uploadScreenshot(t,e){let n=this.validateFile(t);if(n)throw new Error(n.message);let a=t.type==="image/png"?"png":"jpg",g=`SS-${Date.now()}`,E=`orders/${e}/${g}.${a}`,A=oe(this.storage,E);this.uploading.set(!0),this.uploadProgress.set(0);try{let V=te(A,t,{contentType:t.type});this.currentUploadTask=V,await new Promise((_e,ye)=>{V.on("state_changed",F=>{let Ce=Math.round(F.bytesTransferred/F.totalBytes*100);this.uploadProgress.set(Ce)},F=>ye(F),()=>_e())});let fe=await ne(A);return{storagePath:E,downloadUrl:fe}}finally{this.uploading.set(!1),this.currentUploadTask=null}}cancelUpload(){this.currentUploadTask&&(this.currentUploadTask.cancel(),this.currentUploadTask=null,this.uploading.set(!1),this.uploadProgress.set(0))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var be=["policyContent"];function Pe(o,t){o&1&&(m(0,"span",4),r(1,"tap to expand"),l())}function Ee(o,t){o&1&&(m(0,"span",4),r(1,"tap to collapse"),l())}function Oe(o,t){if(o&1){let e=h();m(0,"div",7,0),b("scroll",function(a){_(e);let g=d();return y(g.onPolicyScroll(a))}),l(),m(2,"label",8)(3,"input",9),b("change",function(){_(e);let a=d();return y(a.agreedToPolicy.set(!a.agreedToPolicy()))}),l(),r(4," I've read and agreed to the return policy "),l()}if(o&2){let e=d();T("innerHTML",e.returnPolicyHtml(),j),i(2),P("disabled",!e.scrolledToEnd()),i(),T("disabled",!e.scrolledToEnd())("checked",e.agreedToPolicy())}}function Me(o,t){if(o&1&&(m(0,"div",19)(1,"span",29),r(2,"Registration Fee $50 per class per student:"),l(),m(3,"span",30),r(4),l()()),o&2){let e=d(2);i(4),M(e.formatCurrency(e.depositAmount()))}}function Se(o,t){if(o&1&&(m(0,"div",31)(1,"span",32),r(2,"\u23F1\uFE0F"),l(),m(3,"span"),r(4),l()()),o&2){let e=d(2);P("urgent",e.minutesRemaining()!==null&&e.minutesRemaining()<5),i(4),M(e.timeRemainingText())}}function we(o,t){o&1&&(m(0,"span",24)(1,"span",33),r(2,"\u{1F4CE}"),l(),r(3," Choose JPEG or PNG image (max 5 MB) "),l())}function ke(o,t){if(o&1&&(m(0,"span",25)(1,"span",33),r(2,"\u2705"),l(),r(3),l()),o&2){let e=d(2);i(3),J(" ",e.selectedFile().name," (",e.formatFileSize(e.selectedFile().size),") ")}}function Te(o,t){if(o&1&&(m(0,"div",26),r(1),l()),o&2){let e=d(2);i(),v(" ",e.validationError()," ")}}function De(o,t){if(o&1&&(m(0,"div",27)(1,"div",34),k(2,"div",35),l(),m(3,"span",36),r(4),l()()),o&2){let e=d(2);i(2),Z("width",e.uploadProgress(),"%"),i(2),v("",e.uploadProgress(),"%")}}function Fe(o,t){o&1&&r(0," Uploading... ")}function Ie(o,t){o&1&&r(0," Upload & Confirm ")}function Ue(o,t){if(o&1){let e=h();m(0,"div",5)(1,"div",10)(2,"strong",11),r(3,"Payment Methods"),l(),m(4,"div",12)(5,"div",13)(6,"div",14),r(7,"Zelle"),l(),m(8,"div",15),r(9,"\u{1F4E7} cambrianexplorer@gmail.com"),l(),m(10,"div",16),r(11," \u{1F4DD} Kindly include your child's full name in the memo and upload a screenshot of the payment confirmation. "),l(),m(12,"img",17),b("click",function(){_(e);let a=d();return y(a.showQrOverlay.set(!0))}),l()(),m(13,"div",13)(14,"div",14),r(15,"Cash(3% Off)"),l(),m(16,"div",15),r(17," Reach out to us via WeChat to arrange cash payment. "),k(18,"br")(19,"br"),r(20," If you choose to pay by cash, please first submit the $50 weekly Registration Fee via Zelle to secure your spot. The Registration Fee is non-refundable. "),l(),m(21,"img",18),b("click",function(){_(e);let a=d();return y(a.showWechatQrOverlay.set(!0))}),l(),p(22,Me,5,1,"div",19),l()()(),p(23,Se,5,3,"div",20),m(24,"div",21)(25,"label",22)(26,"input",23),b("change",function(a){_(e);let g=d();return y(g.onFileSelected(a))}),l(),p(27,we,4,0,"span",24)(28,ke,4,2,"span",25),l()(),p(29,Te,2,1,"div",26),p(30,De,5,3,"div",27),m(31,"button",28),b("click",function(){_(e);let a=d();return y(a.onSubmit())}),p(32,Fe,1,0)(33,Ie,1,0),l()()}if(o&2){let e=d();i(22),u(e.depositAmount()>0?22:-1),i(),u(e.timeRemainingText()?23:-1),i(2),P("disabled",e.uploading()),i(),T("disabled",e.uploading()),i(),u(e.selectedFile()?28:27),i(2),u(e.validationError()?29:-1),i(),u(e.uploading()?30:-1),i(),T("disabled",!e.canSubmit()),i(),u(e.uploading()?32:33)}}function Le(o,t){if(o&1){let e=h();m(0,"div",37),b("click",function(){_(e);let a=d();return y(a.showQrOverlay.set(!1))}),k(1,"img",38),l()}}function Ne(o,t){if(o&1){let e=h();m(0,"div",37),b("click",function(){_(e);let a=d();return y(a.showWechatQrOverlay.set(!1))}),k(1,"img",39),l()}}var z=class o{configService=x(L);lockExpiresAt=D(null);depositAmount=D(0);uploading=D(!1);uploadProgress=D(0);uploadFile=new Q;selectedFile=C(null);validationError=C(null);showQrOverlay=C(!1);showWechatQrOverlay=C(!1);returnPolicyOpen=C(!1);scrolledToEnd=C(!1);agreedToPolicy=C(!1);returnPolicyHtml=f(()=>{let t=this.configService.returnInstructions().content;return t?se.parse(t,{async:!1}):"<p>No release and agreement configured.</p>"});policyContentRef=K("policyContent");constructor(){R(()=>{this.lockExpiresAt()&&this.returnPolicyOpen.set(!0)}),R(()=>{this.returnPolicyOpen()&&setTimeout(()=>this.checkIfScrollNeeded(),50)})}checkIfScrollNeeded(){let t=this.policyContentRef()?.nativeElement;t&&t.scrollHeight<=t.clientHeight&&this.scrolledToEnd.set(!0)}canSubmit=f(()=>this.selectedFile()!==null&&!this.uploading()&&!this.validationError());minutesRemaining=f(()=>{let t=this.lockExpiresAt();if(!t)return null;let e=Date.now(),a=new Date(t).getTime()-e;return a<=0?0:Math.ceil(a/(1e3*60))});timeRemainingText=f(()=>{let t=this.minutesRemaining();if(t===null)return null;if(t===0)return"Time expired!";if(t===1)return"1 minute remaining to upload";if(t<60)return`${t} minutes remaining to upload`;let e=Math.floor(t/60),n=t%60;return n===0?`${e} hour${e>1?"s":""} remaining`:`${e}h ${n}m remaining to upload`});onPolicyScroll(t){let e=t.target;e.scrollHeight-e.scrollTop-e.clientHeight<10&&this.scrolledToEnd.set(!0)}onFileSelected(t){let n=t.target.files?.[0]??null;if(this.validationError.set(null),!n){this.selectedFile.set(null);return}let a=5*1024*1024;if(n.size>a){this.validationError.set(`File size (${(n.size/(1024*1024)).toFixed(1)} MB) exceeds the 5 MB limit.`),this.selectedFile.set(null);return}if(!["image/jpeg","image/png"].includes(n.type)){this.validationError.set("Only JPEG and PNG images are accepted."),this.selectedFile.set(null);return}this.selectedFile.set(n)}onSubmit(){let t=this.selectedFile();t&&!this.uploading()&&this.uploadFile.emit(t)}formatCurrency(t){return`$${(t/100).toFixed(2)}`}formatFileSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-payment-upload"]],viewQuery:function(e,n){e&1&&W(n.policyContentRef,be,5),e&2&&Y()},inputs:{lockExpiresAt:[1,"lockExpiresAt"],depositAmount:[1,"depositAmount"],uploading:[1,"uploading"],uploadProgress:[1,"uploadProgress"]},outputs:{uploadFile:"uploadFile"},decls:12,vars:6,consts:[["policyContent",""],[1,"return-policy-section"],[1,"return-policy-header",3,"click"],[1,"fold-icon"],[1,"fold-hint"],[1,"upload-section"],[1,"qr-overlay"],[1,"return-policy-content",3,"scroll","innerHTML"],[1,"agree-label"],["type","checkbox",3,"change","disabled","checked"],[1,"upload-header"],[1,"payment-title"],[1,"payment-grid"],[1,"payment-col"],[1,"method-label"],[1,"method-value"],[1,"payment-note"],["src","bf-zelle.jpg","alt","Zelle QR Code",1,"zelle-qr-img",3,"click"],["src","wechat_blueberry.png","alt","WeChat QR Code",1,"wechat-qr-img",3,"click"],[1,"payment-amount"],[1,"countdown",3,"urgent"],[1,"file-input-area"],[1,"file-label"],["type","file","accept","image/jpeg,image/png",1,"file-input",3,"change","disabled"],[1,"file-placeholder"],[1,"file-selected"],[1,"validation-error"],[1,"progress-container"],[1,"btn-upload",3,"click","disabled"],[1,"amount-label"],[1,"amount-value"],[1,"countdown"],[1,"countdown-icon"],[1,"file-icon"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"qr-overlay",3,"click"],["src","bf-zelle.jpg","alt","Zelle QR Code",1,"qr-overlay-img"],["src","wechat_blueberry.png","alt","WeChat QR Code",1,"qr-overlay-img"]],template:function(e,n){e&1&&(m(0,"div",1)(1,"div",2),b("click",function(){return n.returnPolicyOpen.set(!n.returnPolicyOpen())}),m(2,"span",3),r(3),l(),m(4,"strong"),r(5,"Release and Agreement"),l(),p(6,Pe,2,0,"span",4)(7,Ee,2,0,"span",4),l(),p(8,Oe,5,5),l(),p(9,Ue,34,10,"div",5),p(10,Le,2,0,"div",6),p(11,Ne,2,0,"div",6)),e&2&&(i(3),M(n.returnPolicyOpen()?"\u25BE":"\u25B8"),i(3),u(n.returnPolicyOpen()?n.agreedToPolicy()?7:-1:6),i(2),u(n.returnPolicyOpen()?8:-1),i(),u(n.agreedToPolicy()?9:-1),i(),u(n.showQrOverlay()?10:-1),i(),u(n.showWechatQrOverlay()?11:-1))},dependencies:[U],styles:[".return-policy-section[_ngcontent-%COMP%]{background:#fff8e1;border:1px solid #ffcc02;border-radius:12px;padding:1.25rem;margin-bottom:1rem}.return-policy-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;-webkit-user-select:none;user-select:none}.return-policy-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#f57f17;font-size:1rem}.fold-icon[_ngcontent-%COMP%]{font-size:.875rem;color:#f57f17}.fold-hint[_ngcontent-%COMP%]{font-size:.75rem;color:#c0a000;font-style:italic;margin-left:auto}.return-policy-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;background:#fff;border-radius:8px;padding:1rem 1.25rem;margin-top:.75rem;font-size:.875rem;color:#444;line-height:1.6}.return-policy-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:.75rem 0 .25rem;font-size:.9375rem;font-weight:600;color:#333}.return-policy-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.0625rem}.return-policy-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem}.return-policy-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0 0 .5rem;padding-left:1.5rem}.return-policy-content[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-top:1px solid #ddd;margin:.75rem 0}.agree-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem;font-size:.875rem;color:#333;cursor:pointer;-webkit-user-select:none;user-select:none}.agree-label.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.agree-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#f57f17}.upload-section[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #66bb6a;border-radius:12px;padding:1.25rem;margin-bottom:1rem}.upload-header[_ngcontent-%COMP%]{margin-bottom:1rem}.payment-title[_ngcontent-%COMP%]{display:block;color:#2e7d32;font-size:1rem;margin-bottom:.75rem}.payment-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.payment-col[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:.75rem;display:flex;flex-direction:column;gap:.375rem}.method-label[_ngcontent-%COMP%]{font-weight:700;font-size:.9375rem;color:#2e7d32}.method-value[_ngcontent-%COMP%]{font-size:.875rem;color:#333;word-break:break-all}.payment-note[_ngcontent-%COMP%]{font-size:.875rem;color:#333;margin-top:.25rem}.zelle-qr-img[_ngcontent-%COMP%], .wechat-qr-img[_ngcontent-%COMP%]{width:140px;height:auto;border-radius:8px;margin-top:.5rem;cursor:pointer;transition:opacity .2s;align-self:center}.zelle-qr-img[_ngcontent-%COMP%]:hover, .wechat-qr-img[_ngcontent-%COMP%]:hover{opacity:.8}.qr-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;cursor:pointer}.qr-overlay-img[_ngcontent-%COMP%]{max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 4px 24px #0000004d}.countdown[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:#fff3e0;border-radius:8px;font-size:.875rem;color:#e65100;margin-bottom:1rem}.countdown.urgent[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;font-weight:600}.countdown-icon[_ngcontent-%COMP%]{font-size:1.1rem}.payment-amount[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#fff;border-radius:8px;margin-bottom:1rem}.amount-label[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.amount-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#2e7d32}.file-input-area[_ngcontent-%COMP%]{margin-bottom:.75rem}.file-label[_ngcontent-%COMP%]{display:block;padding:1rem;background:#fff;border:2px dashed #a5d6a7;border-radius:8px;cursor:pointer;text-align:center;transition:border-color .2s}.file-label[_ngcontent-%COMP%]:hover:not(.disabled){border-color:#66bb6a}.file-label.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.file-input[_ngcontent-%COMP%]{display:none}.file-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;color:#666;font-size:.875rem}.file-selected[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;color:#2e7d32;font-size:.875rem}.file-icon[_ngcontent-%COMP%]{font-size:1.25rem}.validation-error[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#ffebee;border-radius:6px;color:#c62828;font-size:.875rem;margin-bottom:.75rem}.progress-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.progress-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#c8e6c9;border-radius:4px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#43a047;border-radius:4px;transition:width .3s ease}.progress-text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#2e7d32;min-width:40px;text-align:right}.btn-upload[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#2e7d32;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:background .2s}.btn-upload[_ngcontent-%COMP%]:hover:not(:disabled){background:#1b5e20}.btn-upload[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})};var ze=(o,t)=>t.sessionId;function Re(o,t){if(o&1){let e=h();c(0,"app-payment-upload",14),O("uploadFile",function(a){_(e);let g=d();return y(g.onUploadFile(a))}),s()}if(o&2){let e=d();S("lockExpiresAt",e.orderService.lockExpiresAt())("depositAmount",e.lockedBatchDepositAmount())("uploading",e.uploadService.uploading())("uploadProgress",e.uploadService.uploadProgress())}}function Ae(o,t){if(o&1&&(c(0,"div",16)(1,"span",17),r(2,"\u26A0\uFE0F"),s(),c(3,"div",18)(4,"strong"),r(5,"Payment deadline has passed"),s(),c(6,"span",19),r(7),s()()()),o&2){let e=d(2);i(7),v(" Deadline was: ",e.formatDeadline(e.orderService.lockExpiresAt())," ")}}function Ve(o,t){if(o&1&&(c(0,"div",16)(1,"span",17),r(2,"\u23F0"),s(),c(3,"div",18)(4,"strong"),r(5),s(),c(6,"span",19),r(7),s()()()),o&2){let e=d(2);i(5),M(e.daysRemainingText()),i(2),v(" Deadline: ",e.formatDeadline(e.orderService.lockExpiresAt())," ")}}function Be(o,t){if(o&1&&(c(0,"div",15),p(1,Ae,8,1,"div",16)(2,Ve,8,2,"div",16),s()),o&2){let e=d();P("overdue",e.orderService.isOverdue()),i(),u(e.orderService.isOverdue()?1:2)}}function $e(o,t){if(o&1&&w(0,"app-payment-screenshot-gallery",5),o&2){let e=d();S("screenshots",e.orderService.paymentScreenshots())}}function Ge(o,t){if(o&1){let e=h();c(0,"button",7),O("click",function(){_(e);let a=d();return y(a.setFilter("locked"))}),r(1),s()}if(o&2){let e=d();P("active",e.activeFilter()==="locked"),i(),v(" Locked (",e.orderService.lockedCount(),") ")}}function Qe(o,t){o&1&&(c(0,"div",9),w(1,"div",20),c(2,"p"),r(3,"Loading..."),s()())}function je(o,t){if(o&1){let e=h();c(0,"div",10)(1,"div",21),r(2,"!"),s(),c(3,"p"),r(4),s(),c(5,"button",22),O("click",function(){_(e);let a=d();return y(a.orderService.clearError())}),r(6,"Retry"),s()()}if(o&2){let e=d();i(4),M(e.orderService.error())}}function qe(o,t){if(o&1){let e=h();c(0,"div",23),r(1,"\u{1F4E6}"),s(),c(2,"h2"),r(3,"No Enrollments"),s(),c(4,"p"),r(5,"You don't have any enrollments yet"),s(),c(6,"button",24),O("click",function(){_(e);let a=d(2);return y(a.goToCatalog())}),r(7,"Browse Classes"),s()}}function He(o,t){if(o&1&&(c(0,"div",23),r(1,"\u{1F50D}"),s(),c(2,"h2"),r(3),s(),c(4,"p"),r(5,"Try a different filter"),s()),o&2){let e=d(2);i(3),v("No ",e.filterName()," enrollments")}}function We(o,t){if(o&1&&(c(0,"div",11),p(1,qe,8,0)(2,He,6,1),s()),o&2){let e=d();i(),u(e.activeFilter()==="all"?1:2)}}function Ye(o,t){if(o&1&&w(0,"app-class-registration-card",25),o&2){let e=t.$implicit;S("data",e)("showGroupStatus",!0)("showStudentStatus",e.status==="mixed")}}function Ze(o,t){if(o&1&&(c(0,"div",12),q(1,Ye,1,3,"app-class-registration-card",25,ze),s()),o&2){let e=d();i(),H(e.filteredGroupedItems())}}function Je(o,t){if(o&1&&(c(0,"div",13)(1,"h2"),r(2,"Summary"),s(),w(3,"app-price-breakdown",26),s()),o&2){let e=d();i(3),S("data",e.priceBreakdownData())}}var ge=class o{orderService=x(ae);uploadService=x(N);configService=x(L);seasonService=x(re);userService=x(le);authService=x(de);router=x(X);activeFilter=C("all");ngOnInit(){this.seasonService.selectedSeason()||this.seasonService.loadSeasons()}groupedItems=f(()=>{let t=this.orderService.items(),e=new Map;for(let n of t){let a={studentId:n.studentId,studentName:(()=>{let E=this.userService.getStudentById(n.studentId);return E?`${E.firstName} ${E.lastName}`.trim():"Unknown"})(),options:n.options,status:n.status},g=e.get(n.sessionId);g?(g.students.push(a),g.status!==n.status&&g.status!=="mixed"&&(g.status="mixed")):e.set(n.sessionId,{sessionId:n.sessionId,className:n.snapshot.className,startDate:n.snapshot.startDate,endDate:n.snapshot.endDate,status:n.status,students:[a]})}return Array.from(e.values()).sort((n,a)=>n.className.localeCompare(a.className))});groupedItemsCount=f(()=>this.groupedItems().length);filteredGroupedItems=f(()=>{let t=this.activeFilter(),e=this.groupedItems();return t==="all"?e:e.map(n=>$(B({},n),{students:n.students.filter(a=>a.status===t)})).filter(n=>n.students.length>0)});filterName=f(()=>{let t=this.activeFilter();return{all:"All",locked:"Locked",submitted:"Pending Payment",paid:"Paid",cancelled:"Cancelled"}[t]});priceBreakdownData=f(()=>{let t=this.orderService.order();if(!t?.pricing)return null;let e=(t.processingFees??[]).map(n=>({description:n.description,amount:n.amount}));return{pricing:t.pricing,couponCredit:t.couponDiscount??0,totalPaid:this.orderService.totalPaid(),totalRefunded:this.orderService.totalRefunded(),processingFees:e,amountDue:this.orderService.amountDue()}});showPaymentDeadline=f(()=>this.orderService.hasSubmittedItems()&&this.orderService.lockExpiresAt()!==null);daysRemaining=f(()=>{let t=this.orderService.lockExpiresAt();if(!t)return null;let e=new Date(this.configService.currentTime()),a=new Date(t).getTime()-e.getTime();return a<=0?null:Math.ceil(a/(1e3*60*60*24))});daysRemainingText=f(()=>{let t=this.daysRemaining();return t===null?"":t===1?"You have 1 day to complete payment":`You have ${t} days to complete payment`});lockedBatchDepositAmount=f(()=>{let t=this.orderService.lockedItems(),e=5e3,n=t.reduce((g,E)=>g+E.snapshot.priceSnapshot.itemTotal,0),a=t.length*e;return Math.min(a,n)});async onUploadFile(t){try{let e=this.authService.firebaseUser()?.uid;if(!e)throw new Error("Not authenticated");let n=await this.uploadService.uploadScreenshot(t,e);await this.orderService.placeOrder(n.storagePath)}catch(e){console.error("Upload failed:",e)}}setFilter(t){this.activeFilter.set(t)}goToCatalog(){this.router.navigate(["/catalog"])}formatDeadline(t){return t?new Date(t).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}):""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-order-list"]],decls:22,vars:18,consts:[[1,"order-list-page"],[1,"page-header"],[1,"subtitle"],[3,"lockExpiresAt","depositAmount","uploading","uploadProgress"],[1,"payment-deadline-banner",3,"overdue"],[3,"screenshots"],[1,"filter-tabs"],[1,"tab",3,"click"],[1,"tab",3,"active"],[1,"loading-container"],[1,"error-container"],[1,"empty-container"],[1,"orders-grid"],[1,"orders-summary"],[3,"uploadFile","lockExpiresAt","depositAmount","uploading","uploadProgress"],[1,"payment-deadline-banner"],[1,"deadline-content"],[1,"deadline-icon"],[1,"deadline-text"],[1,"deadline-detail"],[1,"spinner"],[1,"error-icon"],[1,"btn-retry",3,"click"],[1,"empty-icon"],[1,"btn-primary",3,"click"],[3,"data","showGroupStatus","showStudentStatus"],[3,"data"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"header",1)(2,"h1"),r(3,"My Orders"),s(),c(4,"p",2),r(5,"View and manage your orders"),s()(),p(6,Re,1,4,"app-payment-upload",3),p(7,Be,3,3,"div",4),p(8,$e,1,1,"app-payment-screenshot-gallery",5),c(9,"div",6)(10,"button",7),O("click",function(){return n.setFilter("all")}),r(11),s(),p(12,Ge,2,3,"button",8),c(13,"button",7),O("click",function(){return n.setFilter("submitted")}),r(14),s(),c(15,"button",7),O("click",function(){return n.setFilter("paid")}),r(16),s()(),p(17,Qe,4,0,"div",9),p(18,je,7,1,"div",10),p(19,We,3,1,"div",11),p(20,Ze,3,0,"div",12),p(21,Je,4,1,"div",13),s()),e&2&&(i(6),u(n.orderService.hasLockedItems()?6:-1),i(),u(n.showPaymentDeadline()&&!n.orderService.hasLockedItems()?7:-1),i(),u(n.orderService.paymentScreenshots().length>0?8:-1),i(2),P("active",n.activeFilter()==="all"),i(),v(" All (",n.groupedItemsCount(),") "),i(),u(n.orderService.lockedCount()>0?12:-1),i(),P("active",n.activeFilter()==="submitted"),i(),v(" Pending Payment (",n.orderService.submittedCount(),") "),i(),P("active",n.activeFilter()==="paid"),i(),v(" Paid (",n.orderService.paidCount(),") "),i(),u(n.orderService.loading()?17:-1),i(),u(n.orderService.error()?18:-1),i(),u(!n.orderService.loading()&&!n.orderService.error()&&n.filteredGroupedItems().length===0?19:-1),i(),u(n.filteredGroupedItems().length>0?20:-1),i(),u(n.priceBreakdownData()?21:-1))},dependencies:[U,me,z,pe,ce],styles:[".order-list-page[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.payment-deadline-banner[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;border-radius:12px;padding:1rem 1.25rem;margin-bottom:1.5rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);border-color:var(--sys-error, #c62828)}.deadline-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.deadline-icon[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1}.deadline-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#856404;font-size:1rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.deadline-detail[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-detail[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem;color:var(--sys-on-surface, #212121)}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);overflow-x:auto}.tab[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:1px solid var(--sys-outline, #e0e0e0);border-radius:20px;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;white-space:nowrap;transition:all .2s ease}.tab[_ngcontent-%COMP%]:hover{border-color:var(--sys-primary, #c62828);color:var(--sys-primary, #c62828)}.tab.active[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828);color:#fff}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--sys-on-surface-variant, #666)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c);margin-bottom:1rem}.btn-retry[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:var(--sys-error, #c62828);color:#fff;border:none;border-radius:6px;cursor:pointer}.empty-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--sys-on-surface, #212121)}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666);margin-bottom:1.5rem}.btn-primary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}.orders-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.orders-summary[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:var(--sys-surface-container, #fafafa);border-radius:12px;border:1px solid var(--sys-outline-variant, #e0e0e0)}.orders-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem;color:var(--sys-on-surface, #212121)}"]})};export{ge as OrderListComponent};
