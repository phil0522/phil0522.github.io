import{a as xe}from"./chunk-5XJQS36E.js";import"./chunk-6MNJR2G7.js";import{a as be}from"./chunk-3YBVA2PI.js";import{a as Se}from"./chunk-SBVEKNFO.js";import{b as ye,c as ve,f as he,q as X}from"./chunk-WPE6VZLJ.js";import{a as ge,b as fe,c as Ce,d as Y,e as _e}from"./chunk-ASTRUMTA.js";import{a as ue}from"./chunk-I2V4CZ3E.js";import{a as U}from"./chunk-DLJK6BWM.js";import{$ as me,B as ae,C as re,D as se,I as de,W as ce,Z as le,aa as pe,d as T,j as oe,k as ie}from"./chunk-C54VLDTI.js";import"./chunk-UYHN5VVP.js";import{Ab as a,Bb as S,Cb as I,Db as Q,Ea as r,Gb as Z,Hb as ee,Ib as te,Lb as ne,N as O,Pa as D,Rb as C,S as _,T as y,Tb as k,U as v,Ub as f,V as h,Za as u,_a as g,bb as z,cb as F,da as R,db as x,eb as s,fb as d,gb as b,hb as c,ib as l,jb as M,kb as w,lb as W,mb as E,nb as P,ob as m,yb as V}from"./chunk-WXZFQYIJ.js";import"./chunk-Q7L6LLAK.js";var ke=()=>({tab:"students"});function we(o,t){o&1&&(s(0,"div",0),v(),s(1,"svg",2),b(2,"path",3),d(),h(),s(3,"span"),a(4,"You haven't added any students yet."),d(),s(5,"a",4),a(6,"Add Student"),d()()),o&2&&(r(5),x("queryParams",ne(1,ke)))}function Ie(o,t){if(o&1&&(s(0,"div",1),v(),s(1,"svg",2),b(2,"path",5),d(),h(),s(3,"span"),a(4),d()()),o&2){let e=m();r(4),I("",e.itemsMissingStudents()," item(s) need student selection")}}function Oe(o,t){o&1&&(s(0,"div",1),v(),s(1,"svg",2),b(2,"path",5),d(),h(),s(3,"span"),a(4,"Please "),s(5,"a",6),a(6,"complete your profile"),d(),a(7," before checkout (phone, WeChat, address, emergency contact required)"),d()())}function De(o,t){if(o&1&&(s(0,"div",0),v(),s(1,"svg",2),b(2,"path",7),d(),h(),s(3,"span"),a(4),d()()),o&2){let e=m();r(4),I("Checkout failed: ",e.checkoutError())}}var K=(o,t)=>t.id;function Te(o,t){o&1&&(c(0,"span",14),a(1,"Required"),l())}function Ne(o,t){if(o&1&&(c(0,"span",15),a(1),l()),o&2){let e=m();r(),I("",e.item().students.length," selected")}}function ze(o,t){if(o&1&&(c(0,"span",36),a(1),l()),o&2){let e=m();V("at-capacity",e.isAtCapacity()),r(),I(" ",e.remainingSelectableSpots()," spot(s) left ")}}function Fe(o,t){o&1&&(c(0,"div",17)(1,"span"),a(2,"No students found. Please add student information first."),l()())}function Ve(o,t){o&1&&(c(0,"span",46),a(1,"Enrolled"),l())}function Le(o,t){o&1&&(c(0,"span",47),a(1,"Ineligible"),l())}function Re(o,t){o&1&&(c(0,"span",48),a(1,"Full"),l())}function We(o,t){if(o&1){let e=w();c(0,"label",38)(1,"input",39),P("change",function(){let i=_(e).$implicit,p=m(2);return y(p.onStudentToggle(i))}),l(),c(2,"span",40),v(),c(3,"svg",5),M(4,"path",41),l()(),h(),c(5,"span",42),a(6,"\u{1F464}"),l(),c(7,"span",43)(8,"span",44),a(9),l(),c(10,"span",45),a(11),l()(),u(12,Ve,2,0,"span",46)(13,Le,2,0,"span",47)(14,Re,2,0,"span",48),l()}if(o&2){let e=t.$implicit,n=m(2);V("selected",n.isStudentSelected(e.id))("ineligible",!n.isStudentEligible(e))("registered",n.isStudentRegistered(e.id))("capacity-blocked",n.isCapacityBlocked(e.id)),r(),W("checked",n.isStudentSelected(e.id))("disabled",!n.isStudentSelectable(e)),r(8),Q("",e.firstName," ",e.lastName),r(2),I("",n.calculateStudentAge(e.dob)," yrs"),r(),g(n.isStudentRegistered(e.id)?12:n.isStudentEligible(e)?n.isCapacityBlocked(e.id)?14:-1:13)}}function je(o,t){if(o&1&&(c(0,"div",18),z(1,We,15,14,"label",37,K),l()),o&2){let e=m();r(),F(e.students())}}function Be(o,t){o&1&&(c(0,"span",21),a(1,"Locked (existing registration)"),l())}function Ae(o,t){o&1&&(c(0,"span",22),a(1,"Optional"),l())}function He(o,t){if(o&1&&a(0),o&2){let e=m();I(" Subtotal (",e.item().students.length," student(s)) ")}}function $e(o,t){o&1&&a(0," Select students to see price ")}function Je(o,t){if(o&1&&(c(0,"span",35),a(1),l()),o&2){let e=m();r(),S(e.formatPrice(e.itemSubtotal()))}}function Ge(o,t){o&1&&(s(0,"div",2),b(1,"div",7),s(2,"span"),a(3,"Calculating..."),d()())}function qe(o,t){if(o&1&&(s(0,"div",3),v(),s(1,"svg",8),b(2,"path",9),d(),h(),s(3,"span"),a(4),d()()),o&2){let e=m();r(4),S(e.error())}}function Ue(o,t){if(o&1&&b(0,"app-price-breakdown",4),o&2){let e=m();x("data",e.priceBreakdownData())}}function Ye(o,t){o&1&&(s(0,"div",5)(1,"span"),a(2,"Add classes to cart to see pricing"),d()())}function Xe(o,t){o&1&&(b(0,"div",11),s(1,"span"),a(2,"Submitting..."),d())}function Ke(o,t){o&1&&(s(0,"span"),a(1,"Checkout"),d(),v(),s(2,"svg",8),b(3,"path",12),d())}function Qe(o,t){if(o&1){let e=w();s(0,"button",10),E("click",function(){_(e);let i=m();return y(i.checkout.emit())}),u(1,Xe,3,0)(2,Ke,4,0),d()}if(o&2){let e=m();x("disabled",e.checkoutDisabled()),r(),g(e.checkoutLoading()?1:2)}}function Ze(o,t){o&1&&b(0,"span",8)}function et(o,t){o&1&&a(0," Add ")}function tt(o,t){if(o&1&&(s(0,"div",9),a(1),d()),o&2){let e=m();r(),S(e.couponError())}}function nt(o,t){if(o&1&&(s(0,"div",10),a(1),d()),o&2){let e=m();r(),S(e.couponSuccess())}}function ot(o,t){o&1&&(s(0,"div",11),b(1,"div",12),s(2,"span"),a(3,"Loading coupons..."),d()())}function it(o,t){if(o&1&&(s(0,"div",14)(1,"div",17)(2,"span",18),a(3,"\u2713"),d()(),s(4,"div",19)(5,"span",20),a(6),d(),s(7,"span",21),a(8),d()(),s(9,"div",22)(10,"span",23),a(11),d(),s(12,"span",24),a(13,"Auto-applied"),d()()()),o&2){let e=t.$implicit,n=m(2);r(6),S(e.name),r(2),S(e.description),r(3),S(n.formatPrice(e.maxCreditCents))}}function at(o,t){o&1&&(s(0,"span",27),a(1,"Per Student"),d())}function rt(o,t){o&1&&(s(0,"span",28),a(1,"\xD7 students"),d())}function st(o,t){if(o&1){let e=w();s(0,"label",25)(1,"input",26),E("change",function(){let i=_(e).$implicit,p=m(2);return y(p.toggleCoupon.emit(i.id))}),d(),s(2,"div",17)(3,"span",18),a(4,"\u2713"),d()(),s(5,"div",19)(6,"span",20),a(7),d(),s(8,"span",21),a(9),d(),u(10,at,2,0,"span",27),d(),s(11,"div",22)(12,"span",23),a(13),d(),u(14,rt,2,0,"span",28),d()()}if(o&2){let e=t.$implicit,n=m(2);V("selected",n.isCouponSelected(e.id)),r(),x("checked",n.isCouponSelected(e.id)),r(6),S(e.name),r(2),S(e.description),r(),g(e.coupon_type==="student_credit"?10:-1),r(3),S(n.formatPrice(e.maxCreditCents)),r(),g(e.coupon_type==="student_credit"?14:-1)}}function dt(o,t){if(o&1&&(s(0,"div",16)(1,"span",29),a(2,"Total Coupon Credit"),d(),s(3,"span",30),a(4),d()()),o&2){let e=m(2);r(4),S(e.formatPrice(e.totalCredit()))}}function ct(o,t){if(o&1&&(s(0,"div",13),z(1,it,14,3,"div",14,K),z(3,st,15,8,"label",15,K),d(),u(5,dt,5,1,"div",16)),o&2){let e=m();r(),F(e.seasonCoupons()),r(2),F(e.userCoupons()),r(2),g(e.totalCredit()>0?5:-1)}}var lt=(o,t)=>t.sessionId+t.studentId;function mt(o,t){o&1&&(c(0,"span",15),a(1,"Already on waitlist"),l())}function pt(o,t){o&1&&M(0,"span",18)}function ut(o,t){o&1&&a(0," Join Waitlist ")}function gt(o,t){if(o&1){let e=w();c(0,"button",17),P("click",function(){_(e);let i=m().$implicit,p=m(2);return y(p.joinWaitlist.emit(i))}),u(1,pt,1,0,"span",18)(2,ut,1,0),l()}if(o&2){let e=m().$implicit,n=m(2);W("disabled",n.joiningWaitlist()),r(),g(n.isJoiningWaitlistFor(e)?1:2)}}function ft(o,t){if(o&1&&(c(0,"div",8)(1,"div",12)(2,"span",13),a(3),l(),c(4,"span",14),a(5),l()(),u(6,mt,2,0,"span",15)(7,gt,3,2,"button",16),l()),o&2){let e=t.$implicit,n=m(2);r(3),S(e.className),r(2),I("for ",e.studentName),r(),g(n.isAlreadyOnWaitlist(e.sessionId)?6:7)}}function Ct(o,t){if(o&1){let e=w();c(0,"button",19),P("click",function(){_(e);let i=m(2);return y(i.continueWithRemaining.emit())}),a(1," Continue with Available Classes "),l()}}function _t(o,t){if(o&1){let e=w();c(0,"div",1),P("click",function(){_(e);let i=m();return y(i.close.emit())}),c(1,"div",2),P("click",function(i){return _(e),y(i.stopPropagation())}),c(2,"div",3),v(),c(3,"svg",4),M(4,"path",5),l(),h(),c(5,"h2"),a(6,"Classes Full"),l()(),c(7,"p",6),a(8," The following class(es) are now full. This can happen when spots fill up while you were checking out. "),l(),c(9,"div",7),z(10,ft,8,3,"div",8,lt),l(),c(12,"div",9)(13,"button",10),P("click",function(){_(e);let i=m();return y(i.close.emit())}),a(14,"Cancel"),l(),u(15,Ct,2,0,"button",11),l()()()}if(o&2){let e=m();r(10),F(e.failedItems()),r(5),g(e.hasRemainingItems()?15:-1)}}var j=class o{itemCount=f.required();back=k();static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-header"]],inputs:{itemCount:[1,"itemCount"]},outputs:{back:"back"},decls:8,vars:1,consts:[[1,"cart-header"],[1,"btn-back",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor"],["d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"],[1,"item-count"]],template:function(e,n){e&1&&(c(0,"header",0)(1,"button",1),P("click",function(){return n.back.emit()}),v(),c(2,"svg",2),M(3,"path",3),l()(),h(),c(4,"h1"),a(5,"Shopping Cart"),l(),c(6,"span",4),a(7),l()()),e&2&&(r(7),I("",n.itemCount()," item(s)"))},dependencies:[T],styles:[".cart-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:#fff;border-bottom:1px solid var(--sys-outline, #e0e0e0);position:sticky;top:0;z-index:10}.btn-back[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:var(--sys-on-surface, #212121);border-radius:50%;transition:background .2s ease}.btn-back[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}h1[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121);flex:1}.item-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}"]})},B=class o{browse=k();static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-empty"]],outputs:{browse:"browse"},decls:9,vars:0,consts:[[1,"empty-cart"],["width","64","height","64","viewBox","0 0 24 24","fill","currentColor",1,"empty-icon"],["d","M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"],[1,"btn-browse",3,"click"]],template:function(e,n){e&1&&(c(0,"div",0),v(),c(1,"svg",1),M(2,"path",2),l(),h(),c(3,"h2"),a(4,"Your cart is empty"),l(),c(5,"p"),a(6,"Browse the catalog and find the perfect summer camp for your child"),l(),c(7,"button",3),P("click",function(){return n.browse.emit()}),a(8,"Browse Classes"),l()())},dependencies:[T],styles:[".empty-cart[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.empty-icon[_ngcontent-%COMP%]{color:var(--sys-outline, #e0e0e0);margin-bottom:1rem}h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.5rem;color:var(--sys-on-surface, #212121)}p[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666)}.btn-browse[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:.875rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-browse[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})},A=class o{showNoStudents=f(!1);itemsMissingStudents=f(0);showProfileIncomplete=f(!1);checkoutError=f("");static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-warning-banner"]],inputs:{showNoStudents:[1,"showNoStudents"],itemsMissingStudents:[1,"itemsMissingStudents"],showProfileIncomplete:[1,"showProfileIncomplete"],checkoutError:[1,"checkoutError"]},decls:4,vars:4,consts:[[1,"warning-banner"],[1,"warning-banner","warning-info"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],["routerLink","/profile",1,"add-student-link",3,"queryParams"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"],["routerLink","/profile",1,"warning-link"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"]],template:function(e,n){e&1&&(u(0,we,7,2,"div",0),u(1,Ie,5,1,"div",1),u(2,Oe,8,0,"div",1),u(3,De,5,1,"div",0)),e&2&&(g(n.showNoStudents()?0:-1),r(),g(n.itemsMissingStudents()>0&&!n.showNoStudents()?1:-1),r(),g(n.showProfileIncomplete()?2:-1),r(),g(n.checkoutError()?3:-1))},dependencies:[T,ie],styles:[".warning-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;margin-bottom:1rem;background:var(--sys-error-container, #ffebee);border:1px solid var(--sys-error, #c62828);border-radius:8px;color:var(--sys-error, #c62828);font-size:.875rem}.warning-banner.warning-info[_ngcontent-%COMP%]{background:#fff3e0;border-color:#ff9800;color:#e65100}.add-student-link[_ngcontent-%COMP%]{color:var(--sys-error, #c62828);font-weight:600;text-decoration:underline}.warning-link[_ngcontent-%COMP%]{color:#e65100;font-weight:600;text-decoration:underline}.warning-link[_ngcontent-%COMP%]:hover{color:#bf360c}"]})},H=class o{configService=O(le);Infinity=1/0;formatPrice=U;formatDateRange=ge;item=f.required();students=f.required();registeredStudentIds=f([]);availableSpots=f(1/0);selectedInOtherItems=f(0);addonsLocked=C(()=>this.registeredStudentIds().length>0);remove=k();optionsChange=k();studentToggle=k();serverTime=C(()=>{let t=this.configService.currentTime();return new Date(t)});selectedInThisItem=C(()=>this.item().students.length);remainingSelectableSpots=C(()=>{let t=this.availableSpots(),e=this.selectedInOtherItems(),n=this.selectedInThisItem();return Math.max(0,t-e-n)});isAtCapacity=C(()=>this.remainingSelectableSpots()===0);itemSubtotal=C(()=>{let t=this.item(),e=t.students.length;if(e===0)return 0;let n=t.class.basePrice;return t.options.lunch&&(n+=t.class.lunchPrice),t.options.extendedCare&&(n+=t.class.extendedCarePrice),n*e});isStudentSelected(t){return this.item().students.some(e=>e.id===t)}calculateStudentAge(t){let e=this.serverTime().toISOString().split("T")[0];return re(t,e)}isStudentEligible(t){if(!this.configService.config())return!1;let n=ae(this.configService.activeYear());return se(t.dob,n)}isStudentRegistered(t){return this.registeredStudentIds().includes(t)}isCapacityBlocked(t){return this.isStudentSelected(t)?!1:this.remainingSelectableSpots()===0}isStudentSelectable(t){return this.isStudentEligible(t)&&!this.isStudentRegistered(t.id)&&!this.isCapacityBlocked(t.id)}onStudentToggle(t){this.studentToggle.emit({id:this.item().id,student:t})}toggleLunch(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{lunch:!this.item().options.lunch}})}toggleExtendedCare(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{extendedCare:!this.item().options.extendedCare}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-item"]],inputs:{item:[1,"item"],students:[1,"students"],registeredStudentIds:[1,"registeredStudentIds"],availableSpots:[1,"availableSpots"],selectedInOtherItems:[1,"selectedInOtherItems"]},outputs:{remove:"remove",optionsChange:"optionsChange",studentToggle:"studentToggle"},decls:61,vars:22,consts:[[1,"cart-item"],[1,"section-header"],[1,"class-info"],[1,"class-name"],[1,"class-dates"],["width","14","height","14","viewBox","0 0 24 24","fill","currentColor"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"],["aria-label","Remove",1,"btn-remove",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"section-student"],[1,"section-label"],["width","16","height","16","viewBox","0 0 24 24","fill","currentColor"],["d","M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"],[1,"required-badge"],[1,"selected-count"],[1,"spots-info",3,"at-capacity"],[1,"no-students-message"],[1,"student-checkboxes"],[1,"section-addons"],["d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"],[1,"locked-tag"],[1,"optional-tag"],[1,"addon-grid"],[1,"addon-card",3,"click","disabled"],[1,"addon-icon"],[1,"addon-info"],[1,"addon-name"],[1,"addon-price"],[1,"addon-toggle"],[1,"toggle-track"],[1,"toggle-thumb"],[1,"section-total"],[1,"total-row"],[1,"total-label"],[1,"total-value"],[1,"spots-info"],[1,"student-checkbox",3,"selected","ineligible","registered","capacity-blocked"],[1,"student-checkbox"],["type","checkbox",3,"change","checked","disabled"],[1,"checkbox-mark"],["d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"],[1,"chip-avatar"],[1,"chip-content"],[1,"chip-name"],[1,"chip-age"],[1,"chip-registered"],[1,"chip-ineligible"],[1,"chip-full"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"section",1)(2,"div",2)(3,"h4",3),a(4),l(),c(5,"div",4),v(),c(6,"svg",5),M(7,"path",6),l(),h(),c(8,"span"),a(9),l()()(),c(10,"button",7),P("click",function(){return n.remove.emit(n.item().id)}),v(),c(11,"svg",8),M(12,"path",9),l()()(),h(),c(13,"section",10)(14,"div",11),v(),c(15,"svg",12),M(16,"path",13),l(),h(),c(17,"span"),a(18,"Select Students"),l(),u(19,Te,2,0,"span",14)(20,Ne,2,1,"span",15),u(21,ze,2,3,"span",16),l(),u(22,Fe,3,0,"div",17)(23,je,3,0,"div",18),l(),c(24,"section",19)(25,"div",11),v(),c(26,"svg",12),M(27,"path",20),l(),h(),c(28,"span"),a(29,"Add-ons"),l(),u(30,Be,2,0,"span",21)(31,Ae,2,0,"span",22),l(),c(32,"div",23)(33,"button",24),P("click",function(){return n.toggleLunch()}),c(34,"div",25),a(35,"\u{1F371}"),l(),c(36,"div",26)(37,"span",27),a(38,"Lunch"),l(),c(39,"span",28),a(40),l()(),c(41,"div",29)(42,"span",30),M(43,"span",31),l()()(),c(44,"button",24),P("click",function(){return n.toggleExtendedCare()}),c(45,"div",25),a(46,"\u23F0"),l(),c(47,"div",26)(48,"span",27),a(49,"Extended Care"),l(),c(50,"span",28),a(51),l()(),c(52,"div",29)(53,"span",30),M(54,"span",31),l()()()()(),c(55,"section",32)(56,"div",33)(57,"span",34),u(58,He,1,1)(59,$e,1,0),l(),u(60,Je,2,1,"span",35),l()()()),e&2&&(V("needs-student",n.item().students.length===0),r(4),S(n.item().class.name),r(5),S(n.formatDateRange(n.item().class.startDate,n.item().class.endDate)),r(10),g(n.item().students.length===0?19:20),r(2),g(n.availableSpots()<n.Infinity?21:-1),r(),g(n.students().length===0?22:23),r(2),V("disabled",n.item().students.length===0)("locked",n.addonsLocked()),r(6),g(n.addonsLocked()?30:31),r(3),V("active",n.item().options.lunch),W("disabled",n.item().students.length===0||n.addonsLocked()),r(7),I("+",n.formatPrice(n.item().class.lunchPrice),"/person"),r(4),V("active",n.item().options.extendedCare),W("disabled",n.item().students.length===0||n.addonsLocked()),r(7),I("+",n.formatPrice(n.item().class.extendedCarePrice),"/person"),r(7),g(n.item().students.length>0?58:59),r(2),g(n.item().students.length>0?60:-1))},dependencies:[T,X],styles:[".cart-item[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}.cart-item.needs-student[_ngcontent-%COMP%]{border-color:var(--color-warning, #ff9800)}section[_ngcontent-%COMP%]{padding:1rem}section[_ngcontent-%COMP%] + section[_ngcontent-%COMP%]{border-top:1px solid var(--sys-outline-variant, #f0f0f0)}.section-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666);margin-bottom:.75rem}.section-label[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;background:var(--sys-surface-variant, #f5f5f5)}.class-info[_ngcontent-%COMP%]{flex:1}.class-name[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;font-weight:600;color:var(--sys-on-surface, #212121)}.class-dates[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-remove[_ngcontent-%COMP%]{background:none;border:none;padding:.375rem;cursor:pointer;color:var(--sys-on-surface-variant, #666);border-radius:50%;transition:all .2s ease}.btn-remove[_ngcontent-%COMP%]:hover{background-color:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.required-badge[_ngcontent-%COMP%]{background:var(--color-warning, #ff9800);color:#fff;font-size:.6875rem;padding:.125rem .5rem;border-radius:4px;font-weight:600}.selected-count[_ngcontent-%COMP%]{font-size:.75rem;padding:.125rem .5rem;background:var(--sys-primary-container, #ffebee);color:var(--sys-primary, #c62828);border-radius:4px;font-weight:600}.spots-info[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2);border-radius:4px;margin-left:auto}.spots-info.at-capacity[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.no-students-message[_ngcontent-%COMP%]{padding:.75rem;text-align:center;color:var(--sys-on-surface-variant, #666);font-size:.875rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:8px}.student-checkboxes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.student-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:#fff;border:2px solid var(--sys-outline, #e0e0e0);border-radius:12px;cursor:pointer;transition:all .2s ease}.student-checkbox[_ngcontent-%COMP%]:hover:not(.ineligible):not(.registered):not(.capacity-blocked){border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.student-checkbox.selected[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffcdd2)}.student-checkbox.ineligible[_ngcontent-%COMP%], .student-checkbox.capacity-blocked[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.student-checkbox.registered[_ngcontent-%COMP%]{opacity:.7;cursor:not-allowed;background:var(--sys-tertiary-container, #e3f2fd);border-color:var(--sys-tertiary, #1976d2)}.student-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.checkbox-mark[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s ease;background:#fff}.checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:0;color:#fff;transition:opacity .2s ease}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828)}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:1}.chip-avatar[_ngcontent-%COMP%]{font-size:1.25rem}.chip-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;text-align:left;flex:1}.chip-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121);line-height:1.2}.chip-age[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.chip-ineligible[_ngcontent-%COMP%], .chip-full[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:4px;white-space:nowrap}.chip-full[_ngcontent-%COMP%]{background:var(--sys-outline, #9e9e9e);color:#fff;font-weight:600}.chip-registered[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-tertiary, #1976d2);color:#fff;border-radius:4px;white-space:nowrap;font-weight:600}.section-addons.disabled[_ngcontent-%COMP%]{opacity:.5}.section-addons.locked[_ngcontent-%COMP%]{opacity:.7}.optional-tag[_ngcontent-%COMP%], .locked-tag[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666);border-radius:4px}.locked-tag[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.addon-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.75rem}.addon-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s ease;font-family:inherit;text-align:left}.addon-card[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--sys-outline, #e0e0e0);background:#fff}.addon-card.active[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.addon-card[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.addon-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.addon-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.addon-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121)}.addon-price[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.addon-toggle[_ngcontent-%COMP%]{flex-shrink:0}.toggle-track[_ngcontent-%COMP%]{display:block;width:36px;height:20px;background:var(--sys-outline, #e0e0e0);border-radius:10px;position:relative;transition:background .2s ease}.addon-card.active[_ngcontent-%COMP%]   .toggle-track[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828)}.toggle-thumb[_ngcontent-%COMP%]{display:block;width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:transform .2s ease;box-shadow:0 1px 3px #0003}.addon-card.active[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(16px)}.section-total[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5)}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.total-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.total-value[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--sys-primary, #c62828)}@media(max-width:480px){.addon-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})},$=class o{summary=f(null);loading=f(!1);error=f(null);checkoutLoading=f(!1);checkoutDisabled=f(!1);couponCredit=f(0);checkout=k();priceBreakdownData=C(()=>{let t=this.summary();return t?{pricing:t.pricing,couponCredit:this.couponCredit(),totalPaid:t.totalPaid,totalRefunded:t.totalRefunded,amountDue:t.amountDue}:null});static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-summary"]],inputs:{summary:[1,"summary"],loading:[1,"loading"],error:[1,"error"],checkoutLoading:[1,"checkoutLoading"],checkoutDisabled:[1,"checkoutDisabled"],couponCredit:[1,"couponCredit"]},outputs:{checkout:"checkout"},decls:8,vars:2,consts:[[1,"cart-summary"],[1,"summary-title"],[1,"loading-state"],[1,"error-state"],[3,"data"],[1,"empty-state"],[1,"btn-checkout",3,"disabled"],[1,"spinner"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"],[1,"btn-checkout",3,"click","disabled"],[1,"spinner-small"],["d","M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"h3",1),a(2,"Order Summary"),d(),u(3,Ge,4,0,"div",2)(4,qe,5,1,"div",3)(5,Ue,1,1,"app-price-breakdown",4)(6,Ye,3,0,"div",5),u(7,Qe,3,2,"button",6),d()),e&2&&(r(3),g(n.loading()?3:n.error()?4:n.priceBreakdownData()?5:6),r(4),g(n.summary()&&!n.loading()?7:-1))},dependencies:[T,be],styles:[".cart-summary[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.summary-title[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--sys-on-surface, #212121)}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.error-state[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner-small[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.btn-checkout[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:1rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;margin-top:.5rem}.btn-checkout[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c);transform:translateY(-1px);box-shadow:0 4px 12px #c628284d}.btn-checkout[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);cursor:not-allowed}"]})},J=class o{formatPrice=U;seasonCoupons=f([]);userCoupons=f([]);selectedCouponIds=f([]);loading=f(!1);validating=f(!1);couponError=f(null);couponSuccess=f(null);toggleCoupon=k();addCoupon=k();couponCode="";isCouponSelected(t){return this.selectedCouponIds().includes(t)}totalCredit=C(()=>{let t=this.seasonCoupons().reduce((n,i)=>n+i.maxCreditCents,0),e=this.userCoupons().filter(n=>this.isCouponSelected(n.id)).reduce((n,i)=>n+i.maxCreditCents,0);return t+e});onAddCoupon(){let t=this.couponCode.trim();t&&(this.addCoupon.emit(t),this.couponCode="")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["cart-coupon-section"]],inputs:{seasonCoupons:[1,"seasonCoupons"],userCoupons:[1,"userCoupons"],selectedCouponIds:[1,"selectedCouponIds"],loading:[1,"loading"],validating:[1,"validating"],couponError:[1,"couponError"],couponSuccess:[1,"couponSuccess"]},outputs:{toggleCoupon:"toggleCoupon",addCoupon:"addCoupon"},decls:16,vars:7,consts:[[1,"coupon-section"],[1,"coupon-title"],["width","18","height","18","viewBox","0 0 24 24","fill","currentColor"],["d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"],[1,"coupon-input-section"],[1,"coupon-input-row"],["type","text","placeholder","Enter coupon code",1,"coupon-input",3,"ngModelChange","keydown.enter","ngModel","disabled"],[1,"btn-add-coupon",3,"click","disabled"],[1,"spinner-small"],[1,"coupon-error"],[1,"coupon-success"],[1,"loading-state"],[1,"spinner"],[1,"coupon-list"],[1,"coupon-item","season-coupon"],[1,"coupon-item","user-coupon",3,"selected"],[1,"total-credit"],[1,"coupon-checkbox"],[1,"check-icon"],[1,"coupon-details"],[1,"coupon-name"],[1,"coupon-description"],[1,"coupon-credit"],[1,"credit-value"],[1,"auto-applied"],[1,"coupon-item","user-coupon"],["type","checkbox",3,"change","checked"],[1,"coupon-type-badge","student-credit"],[1,"credit-note"],[1,"total-label"],[1,"total-value"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"h4",1),v(),s(2,"svg",2),b(3,"path",3),d(),h(),s(4,"span"),a(5,"Coupons & Credits"),d()(),s(6,"div",4)(7,"div",5)(8,"input",6),te("ngModelChange",function(p){return ee(n.couponCode,p)||(n.couponCode=p),p}),E("keydown.enter",function(){return n.onAddCoupon()}),d(),s(9,"button",7),E("click",function(){return n.onAddCoupon()}),u(10,Ze,1,0,"span",8)(11,et,1,0),d()(),u(12,tt,2,1,"div",9),u(13,nt,2,1,"div",10),d(),u(14,ot,4,0,"div",11)(15,ct,6,1),d()),e&2&&(r(8),Z("ngModel",n.couponCode),x("disabled",n.validating()),r(),x("disabled",!n.couponCode.trim()||n.validating()),r(),g(n.validating()?10:11),r(2),g(n.couponError()?12:-1),r(),g(n.couponSuccess()?13:-1),r(),g(n.loading()?14:15))},dependencies:[T,X,ye,ve,he],styles:[".coupon-section[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1rem}.coupon-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0 0 1rem;font-size:.9375rem;font-weight:600;color:var(--sys-on-surface, #212121)}.coupon-title[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828)}.coupon-input-section[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px dashed var(--sys-outline-variant, #e0e0e0)}.coupon-input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.coupon-input[_ngcontent-%COMP%]{flex:1;padding:.625rem .875rem;border:2px solid var(--sys-outline, #e0e0e0);border-radius:8px;font-size:.875rem;font-family:inherit;transition:border-color .2s ease}.coupon-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--sys-primary, #c62828)}.coupon-input[_ngcontent-%COMP%]:disabled{background:var(--sys-surface-variant, #f5f5f5);cursor:not-allowed}.btn-add-coupon[_ngcontent-%COMP%]{padding:.625rem 1rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease;min-width:60px;display:flex;align-items:center;justify-content:center}.btn-add-coupon[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-add-coupon[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);cursor:not-allowed}.spinner-small[_ngcontent-%COMP%]{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.coupon-error[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem .75rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);font-size:.8125rem;border-radius:6px}.coupon-success[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem .75rem;background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32);font-size:.8125rem;border-radius:6px}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--sys-on-surface-variant, #666);font-size:.8125rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.coupon-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.coupon-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border:2px solid transparent;border-radius:10px;transition:all .2s ease}.coupon-item.season-coupon[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9)}.coupon-item.user-coupon[_ngcontent-%COMP%]{cursor:pointer}.coupon-item.user-coupon[_ngcontent-%COMP%]:hover{border-color:var(--sys-primary, #c62828)}.coupon-item.selected[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.coupon-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.coupon-checkbox[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:#fff;transition:all .2s ease}.season-coupon[_ngcontent-%COMP%]   .coupon-checkbox[_ngcontent-%COMP%]{background:var(--sys-secondary, #2e7d32);border-color:var(--sys-secondary, #2e7d32)}.user-coupon.selected[_ngcontent-%COMP%]   .coupon-checkbox[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828)}.check-icon[_ngcontent-%COMP%]{color:#fff;font-size:.75rem;font-weight:700;opacity:0;transition:opacity .2s ease}.season-coupon[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%], .user-coupon.selected[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%]{opacity:1}.coupon-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.coupon-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121)}.coupon-description[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.coupon-credit[_ngcontent-%COMP%]{text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:.125rem}.credit-value[_ngcontent-%COMP%]{font-size:.9375rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}.auto-applied[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--sys-on-secondary-container, #1b5e20);background:var(--sys-secondary, #2e7d32);color:#fff;padding:.125rem .375rem;border-radius:4px}.coupon-type-badge[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .375rem;border-radius:4px;margin-top:.25rem;width:fit-content}.coupon-type-badge.student-credit[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.credit-note[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--sys-on-surface-variant, #666)}.total-credit[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:.75rem;padding-top:.75rem;border-top:1px dashed var(--sys-outline-variant, #e0e0e0)}.total-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666)}.total-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}"]})},G=class o{show=f(!1);failedItems=f([]);joiningWaitlist=f(!1);currentJoiningItem=f(null);hasRemainingItems=f(!1);waitlistSessionIds=f(new Set);close=k();joinWaitlist=k();continueWithRemaining=k();isJoiningWaitlistFor(t){let e=this.currentJoiningItem();return e!==null&&e.sessionId===t.sessionId&&e.studentId===t.studentId}isAlreadyOnWaitlist(t){return this.waitlistSessionIds().has(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["capacity-error-dialog"]],inputs:{show:[1,"show"],failedItems:[1,"failedItems"],joiningWaitlist:[1,"joiningWaitlist"],currentJoiningItem:[1,"currentJoiningItem"],hasRemainingItems:[1,"hasRemainingItems"],waitlistSessionIds:[1,"waitlistSessionIds"]},outputs:{close:"close",joinWaitlist:"joinWaitlist",continueWithRemaining:"continueWithRemaining"},decls:1,vars:1,consts:[[1,"dialog-overlay"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[1,"dialog-header"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor",1,"warning-icon"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],[1,"dialog-message"],[1,"failed-items"],[1,"failed-item"],[1,"dialog-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary"],[1,"failed-item-details"],[1,"class-name"],[1,"student-name"],[1,"already-on-waitlist"],[1,"btn-waitlist",3,"disabled"],[1,"btn-waitlist",3,"click","disabled"],[1,"spinner"],[1,"btn-primary",3,"click"]],template:function(e,n){e&1&&u(0,_t,16,1,"div",0),e&2&&g(n.show()?0:-1)},dependencies:[T],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.dialog-content[_ngcontent-%COMP%]{background:#fff;border-radius:16px;max-width:500px;width:100%;padding:1.5rem;box-shadow:0 8px 32px #0003}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem}.dialog-header[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121)}.dialog-message[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem;line-height:1.5}.failed-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.failed-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.75rem 1rem;background:var(--sys-error-container, #ffebee);border-radius:8px}.failed-item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface, #212121)}.student-name[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-waitlist[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.5rem 1rem;font-size:.8125rem;font-weight:600;cursor:pointer;white-space:nowrap;min-width:100px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.btn-waitlist[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-waitlist[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.already-on-waitlist[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-tertiary, #1976d2);font-weight:500;padding:.5rem 1rem;background:var(--sys-tertiary-container, #e3f2fd);border-radius:8px;white-space:nowrap}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end}.btn-secondary[_ngcontent-%COMP%]{background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})};var yt=(o,t)=>t.id,vt=(o,t)=>t.sessionId;function ht(o,t){if(o&1){let e=w();s(0,"cart-empty",4),E("browse",function(){_(e);let i=m();return y(i.browseCatalog())}),d()}}function bt(o,t){if(o&1&&b(0,"app-class-registration-card",19),o&2){let e=t.$implicit;x("data",e)("showGroupStatus",!0)("showStudentStatus",e.status==="mixed")}}function xt(o,t){if(o&1&&(s(0,"section",6)(1,"h2"),a(2,"Your Confirmed Registrations"),d(),s(3,"div",18),z(4,bt,1,3,"app-class-registration-card",19,vt),d()()),o&2){let e=m(2);r(4),F(e.confirmedRegistrations())}}function St(o,t){if(o&1){let e=w();s(0,"cart-item",20),E("remove",function(i){_(e);let p=m(2);return y(p.onRemove(i))})("optionsChange",function(i){_(e);let p=m(2);return y(p.onOptionsChange(i))})("studentToggle",function(i){_(e);let p=m(2);return y(p.onStudentToggle(i))}),d()}if(o&2){let e=t.$implicit,n=m(2);x("item",e)("students",n.students())("registeredStudentIds",n.getRegisteredStudentIds(e.class.id))("availableSpots",n.getAvailableSpots(e.class.id))("selectedInOtherItems",n.getSelectedInOtherItems(e.class.id,e.id))}}function Et(o,t){o&1&&(s(0,"div",16),a(1," Please select students for all classes before checkout "),d())}function Mt(o,t){if(o&1){let e=w();b(0,"cart-warning-banner",5),u(1,xt,6,0,"section",6),s(2,"div",7)(3,"div",8),z(4,St,1,5,"cart-item",9,yt),s(6,"button",10),E("click",function(){_(e);let i=m();return y(i.clearCart())}),v(),s(7,"svg",11),b(8,"path",12),d(),a(9," Clear Cart "),d()(),h(),s(10,"aside",13)(11,"cart-coupon-section",14),E("toggleCoupon",function(i){_(e);let p=m();return y(p.onToggleCoupon(i))})("addCoupon",function(i){_(e);let p=m();return y(p.onAddCoupon(i))}),d(),s(12,"cart-summary",15),E("checkout",function(){_(e);let i=m();return y(i.onCheckout())}),d(),u(13,Et,2,0,"div",16),s(14,"div",17)(15,"h4"),a(16,"Important Info"),d(),s(17,"ul")(18,"li"),a(19,"After submitting, your spots are reserved for 48 hours"),d(),s(20,"li"),a(21,"Please complete payment within 48 hours"),d(),s(22,"li"),a(23,"Spots are confirmed once payment is received"),d()()()()()}if(o&2){let e=m();x("showNoStudents",e.students().length===0)("itemsMissingStudents",e.store.itemsMissingStudentsCount())("showProfileIncomplete",!e.userService.isProfileComplete())("checkoutError",e.checkoutError()),r(),g(e.hasConfirmedRegistrations()?1:-1),r(3),F(e.store.items()),r(7),x("seasonCoupons",e.store.seasonCoupons())("userCoupons",e.store.userCoupons())("selectedCouponIds",e.store.selectedCouponIds())("loading",e.store.couponsLoading())("validating",e.store.couponsValidating())("couponError",e.store.couponValidationError())("couponSuccess",e.store.couponValidationSuccess()),r(),x("summary",e.financialSummary())("loading",e.store.pricingLoading())("error",e.store.pricingError())("checkoutLoading",e.store.submitting())("checkoutDisabled",e.isCheckoutDisabled())("couponCredit",e.store.totalCouponCredit()),r(),g(e.store.allStudentsAssigned()?-1:13)}}var Ee=class o{store=O(_e);router=O(oe);userService=O(pe);orderService=O(me);registrationService=O(ue);impersonationService=O(ce);confirmDialogService=O(Se);students=this.userService.students;orderItems=this.orderService.items;_checkoutError=R("");checkoutError=this._checkoutError.asReadonly();_capacityFailedItems=R([]);_joiningWaitlist=R(!1);_currentJoiningItem=R(null);capacityFailedItems=this._capacityFailedItems.asReadonly();joiningWaitlist=this._joiningWaitlist.asReadonly();currentJoiningItem=this._currentJoiningItem.asReadonly();showCapacityErrorDialog=C(()=>this._capacityFailedItems().length>0);hasRemainingItems=C(()=>{let t=this._capacityFailedItems(),e=this.store.items();if(t.length===0||e.length===0)return!1;let n=new Set(t.map(p=>`${p.sessionId}:${p.studentId}`)),i=0;for(let p of e)for(let N of p.students)n.has(`${p.class.id}:${N.id}`)||i++;return i>0});waitlistSessionIds=C(()=>new Set(this.orderService.waitlistEntries().map(t=>t.sessionId)));registeredStudentsByClass=C(()=>{let t=this.orderItems(),e=new Map;for(let n of t)if(n.status==="submitted"||n.status==="paid"){let i=e.get(n.sessionId)||[];i.includes(n.studentId)||i.push(n.studentId),e.set(n.sessionId,i)}return e});getRegisteredStudentIds(t){return this.registeredStudentsByClass().get(t)||[]}confirmedRegistrations=C(()=>{let t=this.orderItems();if(t.length===0)return[];let e=new Map;for(let n of t){if(n.status!=="submitted"&&n.status!=="paid")continue;let i=e.get(n.sessionId);i||(i={sessionId:n.sessionId,className:n.snapshot.className,startDate:n.snapshot.startDate,endDate:n.snapshot.endDate,status:n.status,students:[]},e.set(n.sessionId,i)),i.status!==n.status&&i.status!=="mixed"&&(i.status="mixed"),i.students.push({studentId:n.studentId,studentName:(()=>{let p=this.userService.getStudentById(n.studentId);return p?`${p.firstName} ${p.lastName}`.trim():"Unknown"})(),status:n.status,options:n.options})}return Array.from(e.values()).sort((n,i)=>n.startDate.localeCompare(i.startDate))});hasConfirmedRegistrations=C(()=>this.confirmedRegistrations().length>0);availableSpotsByClass=C(()=>{let t=new Map;for(let e of this.store.items()){let n=e.class;if(!t.has(n.id)){let i=this.registrationService.getAvailableSpots(n);t.set(n.id,Math.max(0,i))}}return t});getAvailableSpots(t){return this.impersonationService.adminBypassEnabled()?1/0:this.availableSpotsByClass().get(t)??1/0}getSelectedInOtherItems(t,e){let n=0;for(let i of this.store.items())i.class.id===t&&i.id!==e&&(n+=i.students.length);return n}financialSummary=C(()=>{let t=this.store.pricing();if(!t)return null;let e=de(t.subtotal,t.discounts),n=this.store.totalCouponCredit(),i=Math.max(0,e-n);return{pricing:t,totalPaid:0,totalRefunded:0,amountDue:i}});isCheckoutDisabled=C(()=>this.store.pricingLoading()||this.store.submitting()||!this.store.pricing()||!this.store.allStudentsAssigned()||!this.userService.isProfileComplete());async ngOnInit(){if(!this.userService.currentUser()){this.router.navigate(["/login"]);return}this.store.hasItems()&&await this.store.loadCoupons()}goBack(){history.back()}browseCatalog(){this.router.navigate(["/"])}onRemove(t){this.store.removeFromCart(t)}onOptionsChange(t){this.store.updateItemOptions(t.id,t.options)}onStudentToggle(t){try{this.store.toggleStudent(t.id,t.student)}catch(e){console.error("Failed to toggle student:",e)}}async clearCart(){await this.confirmDialogService.confirm({title:"Clear Cart",message:"Are you sure you want to clear the cart?",confirmText:"Clear",confirmButtonClass:"danger"})&&this.store.clearCart()}onToggleCoupon(t){this.store.toggleCoupon(t)}onAddCoupon(t){this.store.validateAndAddCoupon(t)}async onCheckout(){this._checkoutError.set("");try{await this.store.submit(),this.router.navigate(["/orders"])}catch(t){if(fe(t)){let e=Ce(t);e.length===0&&(e=this.buildFailedItemsFromError(t)),this._capacityFailedItems.set(e)}else{let e=Y(t)||"An unexpected error occurred. Please try again.";this._checkoutError.set(e),console.error("Checkout failed:",t)}}}buildFailedItemsFromError(t){let n=Y(t).match(/Class\s+(CL-\d+)\s+is full/i);if(!n){let N=[];for(let L of this.store.items())for(let q of L.students)N.push({sessionId:L.class.id,studentId:q.id,className:L.class.name,studentName:`${q.firstName} ${q.lastName}`.trim()});return N}let i=n[1],p=[];for(let N of this.store.items())if(N.class.id===i)for(let L of N.students)p.push({sessionId:i,studentId:L.id,className:N.class.name,studentName:`${L.firstName} ${L.lastName}`.trim()});return p}closeCapacityDialog(){this._capacityFailedItems.set([])}async joinWaitlistForItem(t){this._joiningWaitlist.set(!0),this._currentJoiningItem.set(t);try{await this.orderService.joinWaitlist(t.sessionId),this.handleWaitlistJoinSuccess(t.sessionId)}catch(e){this.isAlreadyOnWaitlistError(e)?this.handleWaitlistJoinSuccess(t.sessionId):console.error("Failed to join waitlist:",e)}finally{this._joiningWaitlist.set(!1),this._currentJoiningItem.set(null)}}isAlreadyOnWaitlistError(t){return!t||typeof t!="object"?!1:t.error?.status==="ALREADY_EXISTS"}handleWaitlistJoinSuccess(t){let e=this._capacityFailedItems().filter(n=>n.sessionId!==t);this._capacityFailedItems.set(e);for(let n of this.store.items())if(n.class.id===t)for(let i of[...n.students])try{this.store.toggleStudent(n.id,i)}catch{}this.store.refreshPricing()}continueWithRemainingItems(){let t=this._capacityFailedItems(),e=new Set(t.map(n=>`${n.sessionId}:${n.studentId}`));for(let n of this.store.items())for(let i of n.students)if(e.has(`${n.class.id}:${i.id}`))try{this.store.toggleStudent(n.id,i)}catch{}this._capacityFailedItems.set([]),this.store.refreshPricing()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=D({type:o,selectors:[["app-cart-page"]],decls:6,vars:8,consts:[[1,"cart-page"],[3,"back","itemCount"],[1,"cart-content"],[3,"close","joinWaitlist","continueWithRemaining","show","failedItems","joiningWaitlist","currentJoiningItem","hasRemainingItems","waitlistSessionIds"],[3,"browse"],[3,"showNoStudents","itemsMissingStudents","showProfileIncomplete","checkoutError"],[1,"confirmed-section"],[1,"cart-layout"],[1,"cart-items"],[3,"item","students","registeredStudentIds","availableSpots","selectedInOtherItems"],[1,"btn-clear",3,"click"],["width","18","height","18","viewBox","0 0 24 24","fill","currentColor"],["d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"],[1,"cart-sidebar"],[3,"toggleCoupon","addCoupon","seasonCoupons","userCoupons","selectedCouponIds","loading","validating","couponError","couponSuccess"],[3,"checkout","summary","loading","error","checkoutLoading","checkoutDisabled","couponCredit"],[1,"checkout-warning"],[1,"info-card"],[1,"confirmed-groups"],[3,"data","showGroupStatus","showStudentStatus"],[3,"remove","optionsChange","studentToggle","item","students","registeredStudentIds","availableSpots","selectedInOtherItems"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"cart-header",1),E("back",function(){return n.goBack()}),d(),s(2,"div",2),u(3,ht,1,0,"cart-empty")(4,Mt,24,19),d(),s(5,"capacity-error-dialog",3),E("close",function(){return n.closeCapacityDialog()})("joinWaitlist",function(p){return n.joinWaitlistForItem(p)})("continueWithRemaining",function(){return n.continueWithRemainingItems()}),d()()),e&2&&(r(),x("itemCount",n.store.itemCount()),r(2),g(n.store.isEmpty()?3:4),r(2),x("show",n.showCapacityErrorDialog())("failedItems",n.capacityFailedItems())("joiningWaitlist",n.joiningWaitlist())("currentJoiningItem",n.currentJoiningItem())("hasRemainingItems",n.hasRemainingItems())("waitlistSessionIds",n.waitlistSessionIds()))},dependencies:[T,j,B,A,H,$,G,J,xe],styles:[".cart-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--sys-surface, #fafafa)}.cart-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.cart-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 400px;gap:1.5rem;align-items:start}@media(max-width:768px){.cart-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.cart-sidebar[_ngcontent-%COMP%]{position:sticky;bottom:0;left:0;right:0;padding:1rem;background:#fff;border-top:1px solid var(--sys-outline, #e0e0e0);box-shadow:0 -4px 12px #0000001a}}.cart-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.btn-clear[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-clear[_ngcontent-%COMP%]:hover{border-color:var(--sys-error, #c62828);color:var(--sys-error, #c62828);background:var(--sys-error-container, #ffebee)}.cart-sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;position:sticky;top:80px}.info-card[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);border-radius:12px;padding:1rem}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;font-weight:600;color:var(--sys-on-tertiary-container, #01579b)}.info-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 1.25rem;font-size:.8125rem;color:var(--sys-on-tertiary-container, #01579b);line-height:1.6}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.checkout-warning[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fff3e0;border:1px solid #ff9800;border-radius:8px;color:#e65100;font-size:.8125rem;text-align:center}.checkout-warning[_ngcontent-%COMP%]   .warning-link[_ngcontent-%COMP%]{color:#e65100;font-weight:600;text-decoration:underline}.checkout-warning[_ngcontent-%COMP%]   .warning-link[_ngcontent-%COMP%]:hover{color:#bf360c}.confirmed-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;background:var(--sys-secondary-container, #e8f5e9);border-radius:12px;padding:1rem 1.25rem}.confirmed-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}.confirmed-groups[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}"]})};export{Ee as CartPageComponent};
