import{r as le}from"./chunk-7AXV5RBH.js";import{a as ie}from"./chunk-MGCKCUAB.js";import{a as G,b as oe,c as ae,d as re,e as se,f as de,g as ce}from"./chunk-KWH3YEID.js";import{a as me}from"./chunk-EHHOKWNV.js";import{b as ne}from"./chunk-4K25L6M5.js";import{h as te}from"./chunk-OFYILGNH.js";import"./chunk-XQE4VKQH.js";import"./chunk-CFIO2EPB.js";import"./chunk-7VTHX3C4.js";import{a as ee}from"./chunk-PVPSCU6Z.js";import{d as O,ha as K,ia as Q,j as U,ja as Z,k as X}from"./chunk-2LEHUDM5.js";import{Ab as s,Bb as S,Cb as b,Ha as d,Lb as Y,R as D,Rb as C,Sa as w,Tb as I,Ub as f,W as y,X as v,Y as h,Z as x,ab as l,bb as m,db as N,eb as F,fb as k,gb as p,ha as W,hb as g,ib as z,jb as o,kb as a,lb as _,mb as P,nb as V,ob as L,pb as E,qb as c,yb as T}from"./chunk-EVJ2WVWM.js";var fe=()=>({tab:"students"});function Ce(i,t){i&1&&(p(0,"div",0),h(),p(1,"svg",2),z(2,"path",3),g(),x(),p(3,"span"),s(4,"You haven't added any students yet."),g(),p(5,"a",4),s(6,"Add Student"),g()()),i&2&&(d(5),k("queryParams",Y(1,fe)))}function _e(i,t){if(i&1&&(p(0,"div",1),h(),p(1,"svg",2),z(2,"path",5),g(),x(),p(3,"span"),s(4),g()()),i&2){let e=c();d(4),b("",e.itemsMissingStudents()," item(s) need student selection")}}var ye=(i,t)=>t.id;function ve(i,t){i&1&&(o(0,"span",14),s(1,"Required"),a())}function he(i,t){if(i&1&&(o(0,"span",15),s(1),a()),i&2){let e=c();d(),b("",e.item().students.length," selected")}}function be(i,t){if(i&1&&(o(0,"span",36),s(1),a()),i&2){let e=c();T("at-capacity",e.isAtCapacity()),d(),b(" ",e.remainingSelectableSpots()," spot(s) left ")}}function xe(i,t){i&1&&(o(0,"div",17)(1,"span"),s(2,"No students found. Please add student information first."),a()())}function Ee(i,t){i&1&&(o(0,"span",46),s(1,"Enrolled"),a())}function Se(i,t){i&1&&(o(0,"span",47),s(1,"Ineligible"),a())}function Me(i,t){i&1&&(o(0,"span",48),s(1,"Full"),a())}function Pe(i,t){if(i&1){let e=P();o(0,"label",38)(1,"input",39),E("change",function(){let r=y(e).$implicit,u=c(2);return v(u.onStudentToggle(r))}),a(),o(2,"span",40),h(),o(3,"svg",5),_(4,"path",41),a()(),x(),o(5,"span",42),s(6,"\u{1F464}"),a(),o(7,"span",43)(8,"span",44),s(9),a(),o(10,"span",45),s(11),a()(),l(12,Ee,2,0,"span",46)(13,Se,2,0,"span",47)(14,Me,2,0,"span",48),a()}if(i&2){let e=t.$implicit,n=c(2);T("selected",n.isStudentSelected(e.id))("ineligible",!n.isStudentEligible(e))("registered",n.isStudentRegistered(e.id))("capacity-blocked",n.isCapacityBlocked(e.id)),d(),V("checked",n.isStudentSelected(e.id))("disabled",!n.isStudentSelectable(e)),d(8),S(e.fullName),d(2),b("",n.calculateStudentAge(e.dob)," yrs"),d(),m(n.isStudentRegistered(e.id)?12:n.isStudentEligible(e)?n.isCapacityBlocked(e.id)?14:-1:13)}}function Ie(i,t){if(i&1&&(o(0,"div",18),N(1,Pe,15,13,"label",37,ye),a()),i&2){let e=c();d(),F(e.students())}}function we(i,t){i&1&&(o(0,"span",21),s(1,"Locked (existing registration)"),a())}function ke(i,t){i&1&&(o(0,"span",22),s(1,"Optional"),a())}function Oe(i,t){if(i&1&&s(0),i&2){let e=c();b(" Subtotal (",e.item().students.length," student(s)) ")}}function De(i,t){i&1&&s(0," Select students to see price ")}function Te(i,t){if(i&1&&(o(0,"span",35),s(1),a()),i&2){let e=c();d(),S(e.formatPrice(e.itemSubtotal()))}}var Ne=(i,t)=>t.type;function Fe(i,t){i&1&&(o(0,"div",2),_(1,"div",7),o(2,"span"),s(3,"Calculating..."),a()())}function ze(i,t){if(i&1&&(o(0,"div",3),h(),o(1,"svg",8),_(2,"path",9),a(),x(),o(3,"span"),s(4),a()()),i&2){let e=c();d(4),S(e.error())}}function Le(i,t){if(i&1&&(o(0,"div",13)(1,"span",11)(2,"span",21),s(3),a(),s(4),a(),o(5,"span",22),s(6),a()()),i&2){let e=t.$implicit,n=c(2);d(3),S(n.getDiscountIcon(e.type)),d(),b(" ",e.description," "),d(2),S(n.formatPrice(e.amount))}}function Re(i,t){if(i&1&&(o(0,"div",15)(1,"span",11),s(2,"Paid"),a(),o(3,"span",23),s(4),a()()),i&2){let e=c(2);d(4),b("-",e.formatPrice(e.summary().totalPaid))}}function Ve(i,t){if(i&1&&(o(0,"div",16)(1,"span",11),s(2,"Refunded"),a(),o(3,"span",24),s(4),a()()),i&2){let e=c(2);d(4),b("+",e.formatPrice(e.summary().totalRefunded))}}function We(i,t){i&1&&(o(0,"div",19),s(1,"Paid in Full"),a())}function je(i,t){if(i&1&&(o(0,"div",20),s(1),a()),i&2){let e=c(2);d(),b("You saved ",e.formatPrice(e.totalSavings()),"!")}}function He(i,t){if(i&1&&(o(0,"div",4)(1,"div",10)(2,"span",11),s(3,"Subtotal"),a(),o(4,"span",12),s(5),a()(),N(6,Le,7,3,"div",13,Ne),o(8,"div",14)(9,"span",11),s(10,"Order Total"),a(),o(11,"span",12),s(12),a()(),l(13,Re,5,1,"div",15),l(14,Ve,5,1,"div",16),_(15,"div",17),o(16,"div",18)(17,"span",11),s(18,"Amount Due"),a(),o(19,"span",12),s(20),a()(),l(21,We,2,0,"div",19),l(22,je,2,1,"div",20),a()),i&2){let e=c();d(5),S(e.formatPrice(e.summary().pricing.subtotal)),d(),F(e.summary().pricing.discounts),d(6),S(e.formatPrice(e.orderTotal())),d(),m(e.summary().totalPaid>0?13:-1),d(),m(e.summary().totalRefunded>0?14:-1),d(5),T("paid-in-full",e.summary().amountDue===0),d(),b(" ",e.formatPrice(e.summary().amountDue)," "),d(),m(e.summary().amountDue===0&&e.summary().totalPaid>0?21:-1),d(),m(e.totalSavings()>0?22:-1)}}function Be(i,t){i&1&&(o(0,"div",5)(1,"span"),s(2,"Add classes to cart to see pricing"),a()())}function Ae(i,t){i&1&&(_(0,"div",26),o(1,"span"),s(2,"Submitting..."),a())}function Je(i,t){i&1&&(o(0,"span"),s(1,"Checkout"),a(),h(),o(2,"svg",8),_(3,"path",27),a())}function $e(i,t){if(i&1){let e=P();o(0,"button",25),E("click",function(){y(e);let r=c();return v(r.checkout.emit())}),l(1,Ae,3,0)(2,Je,4,0),a()}if(i&2){let e=c();V("disabled",e.checkoutDisabled()),d(),m(e.checkoutLoading()?1:2)}}var Ge=(i,t)=>t.sessionId+t.studentId;function qe(i,t){i&1&&(o(0,"span",15),s(1,"Already on waitlist"),a())}function Ye(i,t){i&1&&_(0,"span",18)}function Ue(i,t){i&1&&s(0," Join Waitlist ")}function Xe(i,t){if(i&1){let e=P();o(0,"button",17),E("click",function(){y(e);let r=c().$implicit,u=c(2);return v(u.joinWaitlist.emit(r))}),l(1,Ye,1,0,"span",18)(2,Ue,1,0),a()}if(i&2){let e=c().$implicit,n=c(2);V("disabled",n.joiningWaitlist()),d(),m(n.isJoiningWaitlistFor(e)?1:2)}}function Ke(i,t){if(i&1&&(o(0,"div",8)(1,"div",12)(2,"span",13),s(3),a(),o(4,"span",14),s(5),a()(),l(6,qe,2,0,"span",15)(7,Xe,3,2,"button",16),a()),i&2){let e=t.$implicit,n=c(2);d(3),S(e.className),d(2),b("for ",e.studentName),d(),m(n.isAlreadyOnWaitlist(e.sessionId)?6:7)}}function Qe(i,t){if(i&1){let e=P();o(0,"button",19),E("click",function(){y(e);let r=c(2);return v(r.continueWithRemaining.emit())}),s(1," Continue with Available Classes "),a()}}function Ze(i,t){if(i&1){let e=P();o(0,"div",1),E("click",function(){y(e);let r=c();return v(r.close.emit())}),o(1,"div",2),E("click",function(r){return y(e),v(r.stopPropagation())}),o(2,"div",3),h(),o(3,"svg",4),_(4,"path",5),a(),x(),o(5,"h2"),s(6,"Classes Full"),a()(),o(7,"p",6),s(8," The following class(es) are now full. This can happen when spots fill up while you were checking out. "),a(),o(9,"div",7),N(10,Ke,8,3,"div",8,Ge),a(),o(12,"div",9)(13,"button",10),E("click",function(){y(e);let r=c();return v(r.close.emit())}),s(14,"Cancel"),a(),l(15,Qe,2,0,"button",11),a()()()}if(i&2){let e=c();d(10),F(e.failedItems()),d(5),m(e.hasRemainingItems()?15:-1)}}var j=class i{itemCount=f.required();back=I();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["cart-header"]],inputs:{itemCount:[1,"itemCount"]},outputs:{back:"back"},decls:8,vars:1,consts:[[1,"cart-header"],[1,"btn-back",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor"],["d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"],[1,"item-count"]],template:function(e,n){e&1&&(o(0,"header",0)(1,"button",1),E("click",function(){return n.back.emit()}),h(),o(2,"svg",2),_(3,"path",3),a()(),x(),o(4,"h1"),s(5,"Shopping Cart"),a(),o(6,"span",4),s(7),a()()),e&2&&(d(7),b("",n.itemCount()," item(s)"))},dependencies:[O],styles:[".cart-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:#fff;border-bottom:1px solid var(--sys-outline, #e0e0e0);position:sticky;top:0;z-index:10}.btn-back[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:var(--sys-on-surface, #212121);border-radius:50%;transition:background .2s ease}.btn-back[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}h1[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121);flex:1}.item-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}"]})},H=class i{browse=I();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["cart-empty"]],outputs:{browse:"browse"},decls:9,vars:0,consts:[[1,"empty-cart"],["width","64","height","64","viewBox","0 0 24 24","fill","currentColor",1,"empty-icon"],["d","M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"],[1,"btn-browse",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0),h(),o(1,"svg",1),_(2,"path",2),a(),x(),o(3,"h2"),s(4,"Your cart is empty"),a(),o(5,"p"),s(6,"Browse the catalog and find the perfect summer camp for your child"),a(),o(7,"button",3),E("click",function(){return n.browse.emit()}),s(8,"Browse Classes"),a()())},dependencies:[O],styles:[".empty-cart[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.empty-icon[_ngcontent-%COMP%]{color:var(--sys-outline, #e0e0e0);margin-bottom:1rem}h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.5rem;color:var(--sys-on-surface, #212121)}p[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666)}.btn-browse[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:.875rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-browse[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})},B=class i{showNoStudents=f(!1);itemsMissingStudents=f(0);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["cart-warning-banner"]],inputs:{showNoStudents:[1,"showNoStudents"],itemsMissingStudents:[1,"itemsMissingStudents"]},decls:2,vars:2,consts:[[1,"warning-banner"],[1,"warning-banner","warning-info"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],["routerLink","/profile",1,"add-student-link",3,"queryParams"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"]],template:function(e,n){e&1&&(l(0,Ce,7,2,"div",0),l(1,_e,5,1,"div",1)),e&2&&(m(n.showNoStudents()?0:-1),d(),m(n.itemsMissingStudents()>0&&!n.showNoStudents()?1:-1))},dependencies:[O,X],styles:[".warning-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;margin-bottom:1rem;background:var(--sys-error-container, #ffebee);border:1px solid var(--sys-error, #c62828);border-radius:8px;color:var(--sys-error, #c62828);font-size:.875rem}.warning-banner.warning-info[_ngcontent-%COMP%]{background:#fff3e0;border-color:#ff9800;color:#e65100}.add-student-link[_ngcontent-%COMP%]{color:var(--sys-error, #c62828);font-weight:600;text-decoration:underline}"]})},A=class i{configService=D(ee);Infinity=1/0;formatPrice=G;formatDateRange=oe;item=f.required();students=f.required();registeredStudentIds=f([]);availableSpots=f(1/0);selectedInOtherItems=f(0);addonsLocked=C(()=>this.registeredStudentIds().length>0);remove=I();optionsChange=I();studentToggle=I();serverTime=C(()=>{let t=this.configService.currentTime();return new Date(t)});selectedInThisItem=C(()=>this.item().students.length);remainingSelectableSpots=C(()=>{let t=this.availableSpots(),e=this.selectedInOtherItems(),n=this.selectedInThisItem();return Math.max(0,t-e-n)});isAtCapacity=C(()=>this.remainingSelectableSpots()===0);itemSubtotal=C(()=>{let t=this.item(),e=t.students.length;if(e===0)return 0;let n=t.class.basePrice;return t.options.lunch&&(n+=t.class.lunchPrice),t.options.extendedCare&&(n+=t.class.extendedCarePrice),n*e});isStudentSelected(t){return this.item().students.some(e=>e.id===t)}calculateStudentAge(t){let e=this.serverTime().toISOString().split("T")[0];return Q(t,e)}isStudentEligible(t){let e=this.configService.config();if(!e)return!1;let n=K(e.currentActiveYear);return Z(t.dob,n)}isStudentRegistered(t){return this.registeredStudentIds().includes(t)}isCapacityBlocked(t){return this.isStudentSelected(t)?!1:this.remainingSelectableSpots()===0}isStudentSelectable(t){return this.isStudentEligible(t)&&!this.isStudentRegistered(t.id)&&!this.isCapacityBlocked(t.id)}onStudentToggle(t){this.studentToggle.emit({id:this.item().id,student:t})}toggleLunch(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{lunch:!this.item().options.lunch}})}toggleExtendedCare(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{extendedCare:!this.item().options.extendedCare}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["cart-item"]],inputs:{item:[1,"item"],students:[1,"students"],registeredStudentIds:[1,"registeredStudentIds"],availableSpots:[1,"availableSpots"],selectedInOtherItems:[1,"selectedInOtherItems"]},outputs:{remove:"remove",optionsChange:"optionsChange",studentToggle:"studentToggle"},decls:61,vars:22,consts:[[1,"cart-item"],[1,"section-header"],[1,"class-info"],[1,"class-name"],[1,"class-dates"],["width","14","height","14","viewBox","0 0 24 24","fill","currentColor"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"],["aria-label","Remove",1,"btn-remove",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"section-student"],[1,"section-label"],["width","16","height","16","viewBox","0 0 24 24","fill","currentColor"],["d","M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"],[1,"required-badge"],[1,"selected-count"],[1,"spots-info",3,"at-capacity"],[1,"no-students-message"],[1,"student-checkboxes"],[1,"section-addons"],["d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"],[1,"locked-tag"],[1,"optional-tag"],[1,"addon-grid"],[1,"addon-card",3,"click","disabled"],[1,"addon-icon"],[1,"addon-info"],[1,"addon-name"],[1,"addon-price"],[1,"addon-toggle"],[1,"toggle-track"],[1,"toggle-thumb"],[1,"section-total"],[1,"total-row"],[1,"total-label"],[1,"total-value"],[1,"spots-info"],[1,"student-checkbox",3,"selected","ineligible","registered","capacity-blocked"],[1,"student-checkbox"],["type","checkbox",3,"change","checked","disabled"],[1,"checkbox-mark"],["d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"],[1,"chip-avatar"],[1,"chip-content"],[1,"chip-name"],[1,"chip-age"],[1,"chip-registered"],[1,"chip-ineligible"],[1,"chip-full"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"section",1)(2,"div",2)(3,"h4",3),s(4),a(),o(5,"div",4),h(),o(6,"svg",5),_(7,"path",6),a(),x(),o(8,"span"),s(9),a()()(),o(10,"button",7),E("click",function(){return n.remove.emit(n.item().id)}),h(),o(11,"svg",8),_(12,"path",9),a()()(),x(),o(13,"section",10)(14,"div",11),h(),o(15,"svg",12),_(16,"path",13),a(),x(),o(17,"span"),s(18,"Select Students"),a(),l(19,ve,2,0,"span",14)(20,he,2,1,"span",15),l(21,be,2,3,"span",16),a(),l(22,xe,3,0,"div",17)(23,Ie,3,0,"div",18),a(),o(24,"section",19)(25,"div",11),h(),o(26,"svg",12),_(27,"path",20),a(),x(),o(28,"span"),s(29,"Add-ons"),a(),l(30,we,2,0,"span",21)(31,ke,2,0,"span",22),a(),o(32,"div",23)(33,"button",24),E("click",function(){return n.toggleLunch()}),o(34,"div",25),s(35,"\u{1F371}"),a(),o(36,"div",26)(37,"span",27),s(38,"Lunch"),a(),o(39,"span",28),s(40),a()(),o(41,"div",29)(42,"span",30),_(43,"span",31),a()()(),o(44,"button",24),E("click",function(){return n.toggleExtendedCare()}),o(45,"div",25),s(46,"\u23F0"),a(),o(47,"div",26)(48,"span",27),s(49,"Extended Care"),a(),o(50,"span",28),s(51),a()(),o(52,"div",29)(53,"span",30),_(54,"span",31),a()()()()(),o(55,"section",32)(56,"div",33)(57,"span",34),l(58,Oe,1,1)(59,De,1,0),a(),l(60,Te,2,1,"span",35),a()()()),e&2&&(T("needs-student",n.item().students.length===0),d(4),S(n.item().class.name),d(5),S(n.formatDateRange(n.item().class.startDate,n.item().class.endDate)),d(10),m(n.item().students.length===0?19:20),d(2),m(n.availableSpots()<n.Infinity?21:-1),d(),m(n.students().length===0?22:23),d(2),T("disabled",n.item().students.length===0)("locked",n.addonsLocked()),d(6),m(n.addonsLocked()?30:31),d(3),T("active",n.item().options.lunch),V("disabled",n.item().students.length===0||n.addonsLocked()),d(7),b("+",n.formatPrice(n.item().class.lunchPrice),"/person"),d(4),T("active",n.item().options.extendedCare),V("disabled",n.item().students.length===0||n.addonsLocked()),d(7),b("+",n.formatPrice(n.item().class.extendedCarePrice),"/person"),d(7),m(n.item().students.length>0?58:59),d(2),m(n.item().students.length>0?60:-1))},dependencies:[O,le],styles:[".cart-item[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}.cart-item.needs-student[_ngcontent-%COMP%]{border-color:var(--color-warning, #ff9800)}section[_ngcontent-%COMP%]{padding:1rem}section[_ngcontent-%COMP%] + section[_ngcontent-%COMP%]{border-top:1px solid var(--sys-outline-variant, #f0f0f0)}.section-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666);margin-bottom:.75rem}.section-label[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;background:var(--sys-surface-variant, #f5f5f5)}.class-info[_ngcontent-%COMP%]{flex:1}.class-name[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;font-weight:600;color:var(--sys-on-surface, #212121)}.class-dates[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-remove[_ngcontent-%COMP%]{background:none;border:none;padding:.375rem;cursor:pointer;color:var(--sys-on-surface-variant, #666);border-radius:50%;transition:all .2s ease}.btn-remove[_ngcontent-%COMP%]:hover{background-color:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.required-badge[_ngcontent-%COMP%]{background:var(--color-warning, #ff9800);color:#fff;font-size:.6875rem;padding:.125rem .5rem;border-radius:4px;font-weight:600}.selected-count[_ngcontent-%COMP%]{font-size:.75rem;padding:.125rem .5rem;background:var(--sys-primary-container, #ffebee);color:var(--sys-primary, #c62828);border-radius:4px;font-weight:600}.spots-info[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2);border-radius:4px;margin-left:auto}.spots-info.at-capacity[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.no-students-message[_ngcontent-%COMP%]{padding:.75rem;text-align:center;color:var(--sys-on-surface-variant, #666);font-size:.875rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:8px}.student-checkboxes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.student-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:#fff;border:2px solid var(--sys-outline, #e0e0e0);border-radius:12px;cursor:pointer;transition:all .2s ease}.student-checkbox[_ngcontent-%COMP%]:hover:not(.ineligible):not(.registered):not(.capacity-blocked){border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.student-checkbox.selected[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffcdd2)}.student-checkbox.ineligible[_ngcontent-%COMP%], .student-checkbox.capacity-blocked[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.student-checkbox.registered[_ngcontent-%COMP%]{opacity:.7;cursor:not-allowed;background:var(--sys-tertiary-container, #e3f2fd);border-color:var(--sys-tertiary, #1976d2)}.student-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.checkbox-mark[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s ease;background:#fff}.checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:0;color:#fff;transition:opacity .2s ease}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828)}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:1}.chip-avatar[_ngcontent-%COMP%]{font-size:1.25rem}.chip-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;text-align:left;flex:1}.chip-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121);line-height:1.2}.chip-age[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.chip-ineligible[_ngcontent-%COMP%], .chip-full[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:4px;white-space:nowrap}.chip-full[_ngcontent-%COMP%]{background:var(--sys-outline, #9e9e9e);color:#fff;font-weight:600}.chip-registered[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-tertiary, #1976d2);color:#fff;border-radius:4px;white-space:nowrap;font-weight:600}.section-addons.disabled[_ngcontent-%COMP%]{opacity:.5}.section-addons.locked[_ngcontent-%COMP%]{opacity:.7}.optional-tag[_ngcontent-%COMP%], .locked-tag[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666);border-radius:4px}.locked-tag[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.addon-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.75rem}.addon-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s ease;font-family:inherit;text-align:left}.addon-card[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--sys-outline, #e0e0e0);background:#fff}.addon-card.active[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.addon-card[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.addon-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.addon-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.addon-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121)}.addon-price[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.addon-toggle[_ngcontent-%COMP%]{flex-shrink:0}.toggle-track[_ngcontent-%COMP%]{display:block;width:36px;height:20px;background:var(--sys-outline, #e0e0e0);border-radius:10px;position:relative;transition:background .2s ease}.addon-card.active[_ngcontent-%COMP%]   .toggle-track[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828)}.toggle-thumb[_ngcontent-%COMP%]{display:block;width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:transform .2s ease;box-shadow:0 1px 3px #0003}.addon-card.active[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(16px)}.section-total[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5)}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.total-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.total-value[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--sys-primary, #c62828)}@media(max-width:480px){.addon-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})},J=class i{formatPrice=G;getDiscountIcon=de;summary=f(null);loading=f(!1);error=f(null);checkoutLoading=f(!1);checkoutDisabled=f(!1);checkout=I();totalSavings=C(()=>{let t=this.summary();return t?Math.abs(t.pricing.discounts.reduce((e,n)=>e+n.amount,0)):0});orderTotal=C(()=>{let t=this.summary();if(!t)return 0;let e=t.pricing.discounts.reduce((n,r)=>n+r.amount,0);return Math.max(0,t.pricing.subtotal+e)});static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["cart-summary"]],inputs:{summary:[1,"summary"],loading:[1,"loading"],error:[1,"error"],checkoutLoading:[1,"checkoutLoading"],checkoutDisabled:[1,"checkoutDisabled"]},outputs:{checkout:"checkout"},decls:8,vars:2,consts:[[1,"cart-summary"],[1,"summary-title"],[1,"loading-state"],[1,"error-state"],[1,"price-breakdown"],[1,"empty-state"],[1,"btn-checkout",3,"disabled"],[1,"spinner"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"],[1,"price-row"],[1,"label"],[1,"value"],[1,"price-row","discount"],[1,"price-row","subtotal"],[1,"price-row","paid"],[1,"price-row","refund"],[1,"divider"],[1,"price-row","total"],[1,"paid-badge"],[1,"savings-badge"],[1,"discount-badge"],[1,"value","discount-value"],[1,"value","paid-value"],[1,"value","refund-value"],[1,"btn-checkout",3,"click","disabled"],[1,"spinner-small"],["d","M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"h3",1),s(2,"Order Summary"),a(),l(3,Fe,4,0,"div",2)(4,ze,5,1,"div",3)(5,He,23,9,"div",4)(6,Be,3,0,"div",5),l(7,$e,3,2,"button",6),a()),e&2&&(d(3),m(n.loading()?3:n.error()?4:n.summary()?5:6),d(4),m(n.summary()&&!n.loading()?7:-1))},dependencies:[O],styles:[".cart-summary[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.summary-title[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--sys-on-surface, #212121)}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.error-state[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner-small[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.price-breakdown[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.price-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.875rem}.price-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666);display:flex;align-items:center;gap:.375rem}.price-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--sys-on-surface, #212121);font-weight:500}.price-row.discount[_ngcontent-%COMP%]   .discount-value[_ngcontent-%COMP%]{color:var(--sys-secondary, #2e7d32)}.discount-badge[_ngcontent-%COMP%]{font-size:1rem}.divider[_ngcontent-%COMP%]{height:1px;background:var(--sys-outline, #e0e0e0);margin:.25rem 0}.price-row.total[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600}.price-row.total[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--sys-on-surface, #212121)}.price-row.total[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828);font-size:1.25rem}.price-row.subtotal[_ngcontent-%COMP%]{padding-top:.5rem;border-top:1px dashed var(--sys-outline-variant, #e0e0e0)}.price-row.paid[_ngcontent-%COMP%]   .paid-value[_ngcontent-%COMP%]{color:var(--sys-secondary, #2e7d32)}.price-row.refund[_ngcontent-%COMP%]   .refund-value[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.price-row.total[_ngcontent-%COMP%]   .value.paid-in-full[_ngcontent-%COMP%]{color:var(--sys-secondary, #2e7d32)}.savings-badge[_ngcontent-%COMP%], .paid-badge[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-on-secondary-container, #1b5e20);padding:.5rem .75rem;border-radius:8px;font-size:.875rem;text-align:center;font-weight:500}.paid-badge[_ngcontent-%COMP%]{font-weight:600}.btn-checkout[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:1rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;margin-top:.5rem}.btn-checkout[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c);transform:translateY(-1px);box-shadow:0 4px 12px #c628284d}.btn-checkout[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);cursor:not-allowed}"]})},$=class i{show=f(!1);failedItems=f([]);joiningWaitlist=f(!1);currentJoiningItem=f(null);hasRemainingItems=f(!1);waitlistSessionIds=f(new Set);close=I();joinWaitlist=I();continueWithRemaining=I();isJoiningWaitlistFor(t){let e=this.currentJoiningItem();return e!==null&&e.sessionId===t.sessionId&&e.studentId===t.studentId}isAlreadyOnWaitlist(t){return this.waitlistSessionIds().has(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["capacity-error-dialog"]],inputs:{show:[1,"show"],failedItems:[1,"failedItems"],joiningWaitlist:[1,"joiningWaitlist"],currentJoiningItem:[1,"currentJoiningItem"],hasRemainingItems:[1,"hasRemainingItems"],waitlistSessionIds:[1,"waitlistSessionIds"]},outputs:{close:"close",joinWaitlist:"joinWaitlist",continueWithRemaining:"continueWithRemaining"},decls:1,vars:1,consts:[[1,"dialog-overlay"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[1,"dialog-header"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor",1,"warning-icon"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],[1,"dialog-message"],[1,"failed-items"],[1,"failed-item"],[1,"dialog-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary"],[1,"failed-item-details"],[1,"class-name"],[1,"student-name"],[1,"already-on-waitlist"],[1,"btn-waitlist",3,"disabled"],[1,"btn-waitlist",3,"click","disabled"],[1,"spinner"],[1,"btn-primary",3,"click"]],template:function(e,n){e&1&&l(0,Ze,16,1,"div",0),e&2&&m(n.show()?0:-1)},dependencies:[O],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.dialog-content[_ngcontent-%COMP%]{background:#fff;border-radius:16px;max-width:500px;width:100%;padding:1.5rem;box-shadow:0 8px 32px #0003}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem}.dialog-header[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121)}.dialog-message[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem;line-height:1.5}.failed-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.failed-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.75rem 1rem;background:var(--sys-error-container, #ffebee);border-radius:8px}.failed-item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface, #212121)}.student-name[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-waitlist[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.5rem 1rem;font-size:.8125rem;font-weight:600;cursor:pointer;white-space:nowrap;min-width:100px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.btn-waitlist[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-waitlist[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.already-on-waitlist[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-tertiary, #1976d2);font-weight:500;padding:.5rem 1rem;background:var(--sys-tertiary-container, #e3f2fd);border-radius:8px;white-space:nowrap}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end}.btn-secondary[_ngcontent-%COMP%]{background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})};var et=(i,t)=>t.id,tt=(i,t)=>t.sessionId;function nt(i,t){if(i&1){let e=P();p(0,"cart-empty",4),L("browse",function(){y(e);let r=c();return v(r.browseCatalog())}),g()}}function it(i,t){if(i&1&&z(0,"app-class-registration-card",18),i&2){let e=t.$implicit;k("data",e)("showGroupStatus",!0)("showStudentStatus",e.status==="mixed")}}function ot(i,t){if(i&1&&(p(0,"section",6)(1,"h2"),s(2,"Your Confirmed Registrations"),g(),p(3,"div",17),N(4,it,1,3,"app-class-registration-card",18,tt),g()()),i&2){let e=c(2);d(4),F(e.confirmedRegistrations())}}function at(i,t){if(i&1){let e=P();p(0,"cart-item",19),L("remove",function(r){y(e);let u=c(2);return v(u.onRemove(r))})("optionsChange",function(r){y(e);let u=c(2);return v(u.onOptionsChange(r))})("studentToggle",function(r){y(e);let u=c(2);return v(u.onStudentToggle(r))}),g()}if(i&2){let e=t.$implicit,n=c(2);k("item",e)("students",n.students())("registeredStudentIds",n.getRegisteredStudentIds(e.class.id))("availableSpots",n.getAvailableSpots(e.class.id))("selectedInOtherItems",n.getSelectedInOtherItems(e.class.id,e.id))}}function rt(i,t){i&1&&(p(0,"div",15),s(1," Please select students for all classes before checkout "),g())}function st(i,t){if(i&1){let e=P();z(0,"cart-warning-banner",5),l(1,ot,6,0,"section",6),p(2,"div",7)(3,"div",8),N(4,at,1,5,"cart-item",9,et),p(6,"button",10),L("click",function(){y(e);let r=c();return v(r.clearCart())}),h(),p(7,"svg",11),z(8,"path",12),g(),s(9," Clear Cart "),g()(),x(),p(10,"aside",13)(11,"cart-summary",14),L("checkout",function(){y(e);let r=c();return v(r.onCheckout())}),g(),l(12,rt,2,0,"div",15),p(13,"div",16)(14,"h4"),s(15,"Important Info"),g(),p(16,"ul")(17,"li"),s(18,"After submitting, your spots are reserved for 48 hours"),g(),p(19,"li"),s(20,"Please complete payment within 48 hours"),g(),p(21,"li"),s(22,"Spots are confirmed once payment is received"),g()()()()()}if(i&2){let e=c();k("showNoStudents",e.students().length===0)("itemsMissingStudents",e.store.itemsMissingStudentsCount()),d(),m(e.hasConfirmedRegistrations()?1:-1),d(3),F(e.store.items()),d(7),k("summary",e.financialSummary())("loading",e.store.pricingLoading())("error",e.store.pricingError())("checkoutLoading",e.store.submitting())("checkoutDisabled",e.isCheckoutDisabled()),d(),m(e.store.allStudentsAssigned()?-1:12)}}var pe=class i{store=D(ce);router=D(U);userService=D(ne);orderService=D(te);registrationService=D(ie);students=this.userService.students;orderItems=this.orderService.items;_capacityFailedItems=W([]);_joiningWaitlist=W(!1);_currentJoiningItem=W(null);capacityFailedItems=this._capacityFailedItems.asReadonly();joiningWaitlist=this._joiningWaitlist.asReadonly();currentJoiningItem=this._currentJoiningItem.asReadonly();showCapacityErrorDialog=C(()=>this._capacityFailedItems().length>0);hasRemainingItems=C(()=>{let t=this._capacityFailedItems(),e=this.store.items();if(t.length===0||e.length===0)return!1;let n=new Set(t.map(u=>`${u.sessionId}:${u.studentId}`)),r=0;for(let u of e)for(let M of u.students)n.has(`${u.class.id}:${M.id}`)||r++;return r>0});waitlistSessionIds=C(()=>new Set(this.orderService.waitlistEntries().map(t=>t.sessionId)));registeredStudentsByClass=C(()=>{let t=this.orderItems(),e=new Map;for(let n of t)if(n.status==="submitted"||n.status==="paid"){let r=e.get(n.sessionId)||[];r.includes(n.studentId)||r.push(n.studentId),e.set(n.sessionId,r)}return e});getRegisteredStudentIds(t){return this.registeredStudentsByClass().get(t)||[]}confirmedRegistrations=C(()=>{let t=this.orderItems();if(t.length===0)return[];let e=new Map;for(let n of t){if(n.status!=="submitted"&&n.status!=="paid")continue;let r=e.get(n.sessionId);r||(r={sessionId:n.sessionId,className:n.snapshot.className,startDate:n.snapshot.startDate,endDate:n.snapshot.endDate,status:n.status,students:[]},e.set(n.sessionId,r)),r.status!==n.status&&r.status!=="mixed"&&(r.status="mixed"),r.students.push({studentId:n.studentId,studentName:this.userService.getStudentById(n.studentId)?.fullName??"Unknown",status:n.status,options:n.options})}return Array.from(e.values()).sort((n,r)=>n.startDate.localeCompare(r.startDate))});hasConfirmedRegistrations=C(()=>this.confirmedRegistrations().length>0);availableSpotsByClass=C(()=>{let t=new Map;for(let e of this.store.items()){let n=e.class;if(!t.has(n.id)){let r;e.isWaitlistClaim?r=this.orderService.waitlistEntriesWithEligibility().find(M=>M.sessionId===n.id)?.claimableSpots??0:r=this.registrationService.getPublicAvailableSpots(n),t.set(n.id,Math.max(0,r))}}return t});getAvailableSpots(t){return this.availableSpotsByClass().get(t)??1/0}getSelectedInOtherItems(t,e){let n=0;for(let r of this.store.items())r.class.id===t&&r.id!==e&&(n+=r.students.length);return n}financialSummary=C(()=>{let t=this.store.pricing();if(!t)return null;let e=t.discounts.reduce((r,u)=>r+u.amount,0),n=Math.max(0,t.subtotal+e);return{pricing:t,totalPaid:0,totalRefunded:0,amountDue:n}});isCheckoutDisabled=C(()=>this.store.pricingLoading()||this.store.submitting()||!this.store.pricing()||!this.store.allStudentsAssigned());async ngOnInit(){if(!this.userService.currentUser()){this.router.navigate(["/login"]);return}}goBack(){history.back()}browseCatalog(){this.router.navigate(["/"])}onRemove(t){this.store.removeFromCart(t)}onOptionsChange(t){this.store.updateItemOptions(t.id,t.options)}onStudentToggle(t){try{this.store.toggleStudent(t.id,t.student)}catch(e){console.error("Failed to toggle student:",e)}}clearCart(){confirm("Are you sure you want to clear the cart?")&&this.store.clearCart()}async onCheckout(){try{await this.store.submit(),this.router.navigate(["/orders","confirmation"])}catch(t){if(ae(t)){let e=re(t);e.length===0&&(e=this.buildFailedItemsFromError(t)),this._capacityFailedItems.set(e)}else console.error("Checkout failed:",t)}}buildFailedItemsFromError(t){let n=se(t).match(/Class\s+(CL-\d+)\s+is full/i);if(!n){let M=[];for(let R of this.store.items())for(let q of R.students)M.push({sessionId:R.class.id,studentId:q.id,className:R.class.name,studentName:q.fullName});return M}let r=n[1],u=[];for(let M of this.store.items())if(M.class.id===r)for(let R of M.students)u.push({sessionId:r,studentId:R.id,className:M.class.name,studentName:R.fullName});return u}closeCapacityDialog(){this._capacityFailedItems.set([])}async joinWaitlistForItem(t){this._joiningWaitlist.set(!0),this._currentJoiningItem.set(t);try{await this.orderService.joinWaitlist(t.sessionId),this.handleWaitlistJoinSuccess(t.sessionId)}catch(e){this.isAlreadyOnWaitlistError(e)?this.handleWaitlistJoinSuccess(t.sessionId):console.error("Failed to join waitlist:",e)}finally{this._joiningWaitlist.set(!1),this._currentJoiningItem.set(null)}}isAlreadyOnWaitlistError(t){return!t||typeof t!="object"?!1:t.error?.status==="ALREADY_EXISTS"}handleWaitlistJoinSuccess(t){let e=this._capacityFailedItems().filter(n=>n.sessionId!==t);this._capacityFailedItems.set(e);for(let n of this.store.items())if(n.class.id===t)for(let r of[...n.students])try{this.store.toggleStudent(n.id,r)}catch{}this.store.refreshPricing()}continueWithRemainingItems(){let t=this._capacityFailedItems(),e=new Set(t.map(n=>`${n.sessionId}:${n.studentId}`));for(let n of this.store.items())for(let r of n.students)if(e.has(`${n.class.id}:${r.id}`))try{this.store.toggleStudent(n.id,r)}catch{}this._capacityFailedItems.set([]),this.store.refreshPricing()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-cart-page"]],decls:6,vars:8,consts:[[1,"cart-page"],[3,"back","itemCount"],[1,"cart-content"],[3,"close","joinWaitlist","continueWithRemaining","show","failedItems","joiningWaitlist","currentJoiningItem","hasRemainingItems","waitlistSessionIds"],[3,"browse"],[3,"showNoStudents","itemsMissingStudents"],[1,"confirmed-section"],[1,"cart-layout"],[1,"cart-items"],[3,"item","students","registeredStudentIds","availableSpots","selectedInOtherItems"],[1,"btn-clear",3,"click"],["width","18","height","18","viewBox","0 0 24 24","fill","currentColor"],["d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"],[1,"cart-sidebar"],[3,"checkout","summary","loading","error","checkoutLoading","checkoutDisabled"],[1,"checkout-warning"],[1,"info-card"],[1,"confirmed-groups"],[3,"data","showGroupStatus","showStudentStatus"],[3,"remove","optionsChange","studentToggle","item","students","registeredStudentIds","availableSpots","selectedInOtherItems"]],template:function(e,n){e&1&&(p(0,"div",0)(1,"cart-header",1),L("back",function(){return n.goBack()}),g(),p(2,"div",2),l(3,nt,1,0,"cart-empty")(4,st,23,9),g(),p(5,"capacity-error-dialog",3),L("close",function(){return n.closeCapacityDialog()})("joinWaitlist",function(u){return n.joinWaitlistForItem(u)})("continueWithRemaining",function(){return n.continueWithRemainingItems()}),g()()),e&2&&(d(),k("itemCount",n.store.itemCount()),d(2),m(n.store.isEmpty()?3:4),d(2),k("show",n.showCapacityErrorDialog())("failedItems",n.capacityFailedItems())("joiningWaitlist",n.joiningWaitlist())("currentJoiningItem",n.currentJoiningItem())("hasRemainingItems",n.hasRemainingItems())("waitlistSessionIds",n.waitlistSessionIds()))},dependencies:[O,j,H,B,A,J,$,me],styles:[".cart-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--sys-surface, #fafafa)}.cart-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.cart-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 400px;gap:1.5rem;align-items:start}@media(max-width:768px){.cart-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.cart-sidebar[_ngcontent-%COMP%]{position:sticky;bottom:0;left:0;right:0;padding:1rem;background:#fff;border-top:1px solid var(--sys-outline, #e0e0e0);box-shadow:0 -4px 12px #0000001a}}.cart-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.btn-clear[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-clear[_ngcontent-%COMP%]:hover{border-color:var(--sys-error, #c62828);color:var(--sys-error, #c62828);background:var(--sys-error-container, #ffebee)}.cart-sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;position:sticky;top:80px}.info-card[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);border-radius:12px;padding:1rem}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;font-weight:600;color:var(--sys-on-tertiary-container, #01579b)}.info-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 1.25rem;font-size:.8125rem;color:var(--sys-on-tertiary-container, #01579b);line-height:1.6}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.checkout-warning[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fff3e0;border:1px solid #ff9800;border-radius:8px;color:#e65100;font-size:.8125rem;text-align:center}.confirmed-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;background:var(--sys-secondary-container, #e8f5e9);border-radius:12px;padding:1rem 1.25rem}.confirmed-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}.confirmed-groups[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}"]})};export{pe as CartPageComponent};
