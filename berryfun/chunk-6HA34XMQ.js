import{a as se}from"./chunk-5GCN6JML.js";import{a as ae}from"./chunk-44FB2YCH.js";import{f as re}from"./chunk-OCJJPC5S.js";import{a as K,b as X,c as ee,d as te}from"./chunk-BENLYYZ6.js";import{a as le,b as de}from"./chunk-ZEZHUBVP.js";import"./chunk-XYFRHGXZ.js";import"./chunk-XKJWOYIG.js";import{c as oe}from"./chunk-GZ2C2WLL.js";import{a as ne}from"./chunk-6THQUTU6.js";import"./chunk-35QEJLB4.js";import"./chunk-BV4MKCLK.js";import{a as L}from"./chunk-TZNWTF3S.js";import{b as ie}from"./chunk-VVYVTIM6.js";import{U as J,d as U,j as Z}from"./chunk-UBU22GLA.js";import{Ab as P,Cb as r,Db as M,Ea as Q,Eb as y,Fb as Y,Ia as i,M as $,R as x,Ta as F,Tb as f,W as _,Wb as T,X as C,a as V,b as B,bb as p,ca as G,cb as u,fb as q,gb as H,ha as v,hb as S,ia as j,ib as c,jb as s,kb as w,lb as m,mb as l,nb as I,ob as h,pb as k,qb as O,rb as b,sb as d,zb as W}from"./chunk-UKFGIOHC.js";var _e=5*1024*1024,Ce=["image/jpeg","image/png"],N=class n{storage=te(J());uploadProgress=v(0);uploading=v(!1);currentUploadTask=null;validateFile(t){return t.size>_e?{type:"file_too_large",message:`File size (${(t.size/(1024*1024)).toFixed(1)} MB) exceeds the 5 MB limit.`}:Ce.includes(t.type)?null:{type:"invalid_type",message:"Only JPEG and PNG images are accepted."}}async uploadScreenshot(t,e){let o=this.validateFile(t);if(o)throw new Error(o.message);let a=t.type==="image/png"?"png":"jpg",g=`SS-${Date.now()}`,E=`orders/${e}/${g}.${a}`,A=ee(this.storage,E);this.uploading.set(!0),this.uploadProgress.set(0);try{let R=K(A,t,{contentType:t.type});this.currentUploadTask=R,await new Promise((ue,ge)=>{R.on("state_changed",D=>{let fe=Math.round(D.bytesTransferred/D.totalBytes*100);this.uploadProgress.set(fe)},D=>ge(D),()=>ue())});let pe=await X(A);return{storagePath:E,downloadUrl:pe}}finally{this.uploading.set(!1),this.currentUploadTask=null}}cancelUpload(){this.currentUploadTask&&(this.currentUploadTask.cancel(),this.currentUploadTask=null,this.uploading.set(!1),this.uploadProgress.set(0))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})};function ye(n,t){n&1&&(m(0,"span",3),r(1,"tap to expand"),l())}function xe(n,t){n&1&&(m(0,"span",3),r(1,"tap to collapse"),l())}function he(n,t){if(n&1){let e=h();m(0,"div",6),b("scroll",function(a){_(e);let g=d();return C(g.onPolicyScroll(a))}),l(),m(1,"label",7)(2,"input",8),b("change",function(){_(e);let a=d();return C(a.agreedToPolicy.set(!a.agreedToPolicy()))}),l(),r(3," I've read and agreed to the return policy "),l()}if(n&2){let e=d();k("innerHTML",e.returnPolicyHtml(),Q),i(),P("disabled",!e.scrolledToEnd()),i(),k("disabled",!e.scrolledToEnd())("checked",e.agreedToPolicy())}}function be(n,t){if(n&1&&(m(0,"div",28)(1,"span",29),r(2,"\u23F1\uFE0F"),l(),m(3,"span"),r(4),l()()),n&2){let e=d(2);P("urgent",e.minutesRemaining()!==null&&e.minutesRemaining()<5),i(4),M(e.timeRemainingText())}}function Pe(n,t){if(n&1&&(m(0,"div",19)(1,"span",30),r(2,"Amount to pay:"),l(),m(3,"span",31),r(4),l()()),n&2){let e=d(2);i(4),M(e.formatCurrency(e.depositAmount()))}}function Ee(n,t){n&1&&(m(0,"span",23)(1,"span",32),r(2,"\u{1F4CE}"),l(),r(3," Choose JPEG or PNG image (max 5 MB) "),l())}function Oe(n,t){if(n&1&&(m(0,"span",24)(1,"span",32),r(2,"\u2705"),l(),r(3),l()),n&2){let e=d(2);i(3),Y(" ",e.selectedFile().name," (",e.formatFileSize(e.selectedFile().size),") ")}}function Me(n,t){if(n&1&&(m(0,"div",25),r(1),l()),n&2){let e=d(2);i(),y(" ",e.validationError()," ")}}function Se(n,t){if(n&1&&(m(0,"div",26)(1,"div",33),I(2,"div",34),l(),m(3,"span",35),r(4),l()()),n&2){let e=d(2);i(2),W("width",e.uploadProgress(),"%"),i(2),y("",e.uploadProgress(),"%")}}function we(n,t){n&1&&r(0," Uploading... ")}function ke(n,t){n&1&&r(0," Upload & Confirm ")}function Te(n,t){if(n&1){let e=h();m(0,"div",4)(1,"div",9)(2,"strong",10),r(3,"Payment Methods"),l(),m(4,"div",11)(5,"div",12)(6,"div",13),r(7,"Zelle"),l(),m(8,"div",14),r(9,"\u{1F4E7} cambrianexplorer@gmail.com"),l(),m(10,"div",15),r(11," \u{1F4DD} Kindly include your child's full name in the memo and upload a screenshot of the payment confirmation. "),l(),m(12,"img",16),b("click",function(){_(e);let a=d();return C(a.showQrOverlay.set(!0))}),l()(),m(13,"div",12)(14,"div",13),r(15,"Cash(2% Off)"),l(),m(16,"div",14),r(17," reach out to us via wechat to arrange cash payment. "),l(),m(18,"img",17),b("click",function(){_(e);let a=d();return C(a.showWechatQrOverlay.set(!0))}),l()()()(),p(19,be,5,3,"div",18),p(20,Pe,5,1,"div",19),m(21,"div",20)(22,"label",21)(23,"input",22),b("change",function(a){_(e);let g=d();return C(g.onFileSelected(a))}),l(),p(24,Ee,4,0,"span",23)(25,Oe,4,2,"span",24),l()(),p(26,Me,2,1,"div",25),p(27,Se,5,3,"div",26),m(28,"button",27),b("click",function(){_(e);let a=d();return C(a.onSubmit())}),p(29,we,1,0)(30,ke,1,0),l()()}if(n&2){let e=d();i(19),u(e.timeRemainingText()?19:-1),i(),u(e.depositAmount()>0?20:-1),i(2),P("disabled",e.uploading()),i(),k("disabled",e.uploading()),i(),u(e.selectedFile()?25:24),i(2),u(e.validationError()?26:-1),i(),u(e.uploading()?27:-1),i(),k("disabled",!e.canSubmit()),i(),u(e.uploading()?29:30)}}function De(n,t){if(n&1){let e=h();m(0,"div",36),b("click",function(){_(e);let a=d();return C(a.showQrOverlay.set(!1))}),I(1,"img",37),l()}}function Fe(n,t){if(n&1){let e=h();m(0,"div",36),b("click",function(){_(e);let a=d();return C(a.showWechatQrOverlay.set(!1))}),I(1,"img",38),l()}}var z=class n{configService=x(L);lockExpiresAt=T(null);depositAmount=T(0);uploading=T(!1);uploadProgress=T(0);uploadFile=new G;selectedFile=v(null);validationError=v(null);showQrOverlay=v(!1);showWechatQrOverlay=v(!1);returnPolicyOpen=v(!1);scrolledToEnd=v(!1);agreedToPolicy=v(!1);returnPolicyHtml=f(()=>{let t=this.configService.returnInstructions().content;return t?ae.parse(t,{async:!1}):"<p>No return instructions configured.</p>"});constructor(){j(()=>{this.lockExpiresAt()&&this.returnPolicyOpen.set(!0)})}canSubmit=f(()=>this.selectedFile()!==null&&!this.uploading()&&!this.validationError());minutesRemaining=f(()=>{let t=this.lockExpiresAt();if(!t)return null;let e=Date.now(),a=new Date(t).getTime()-e;return a<=0?0:Math.ceil(a/(1e3*60))});timeRemainingText=f(()=>{let t=this.minutesRemaining();if(t===null)return null;if(t===0)return"Time expired!";if(t===1)return"1 minute remaining to upload";if(t<60)return`${t} minutes remaining to upload`;let e=Math.floor(t/60),o=t%60;return o===0?`${e} hour${e>1?"s":""} remaining`:`${e}h ${o}m remaining to upload`});onPolicyScroll(t){let e=t.target;e.scrollHeight-e.scrollTop-e.clientHeight<10&&this.scrolledToEnd.set(!0)}onFileSelected(t){let o=t.target.files?.[0]??null;if(this.validationError.set(null),!o){this.selectedFile.set(null);return}let a=5*1024*1024;if(o.size>a){this.validationError.set(`File size (${(o.size/(1024*1024)).toFixed(1)} MB) exceeds the 5 MB limit.`),this.selectedFile.set(null);return}if(!["image/jpeg","image/png"].includes(o.type)){this.validationError.set("Only JPEG and PNG images are accepted."),this.selectedFile.set(null);return}this.selectedFile.set(o)}onSubmit(){let t=this.selectedFile();t&&!this.uploading()&&this.uploadFile.emit(t)}formatCurrency(t){return`$${(t/100).toFixed(2)}`}formatFileSize(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-payment-upload"]],inputs:{lockExpiresAt:[1,"lockExpiresAt"],depositAmount:[1,"depositAmount"],uploading:[1,"uploading"],uploadProgress:[1,"uploadProgress"]},outputs:{uploadFile:"uploadFile"},decls:12,vars:6,consts:[[1,"return-policy-section"],[1,"return-policy-header",3,"click"],[1,"fold-icon"],[1,"fold-hint"],[1,"upload-section"],[1,"qr-overlay"],[1,"return-policy-content",3,"scroll","innerHTML"],[1,"agree-label"],["type","checkbox",3,"change","disabled","checked"],[1,"upload-header"],[1,"payment-title"],[1,"payment-grid"],[1,"payment-col"],[1,"method-label"],[1,"method-value"],[1,"payment-note"],["src","bf-zelle.jpg","alt","Zelle QR Code",1,"zelle-qr-img",3,"click"],["src","wechat_blueberry.png","alt","WeChat QR Code",1,"wechat-qr-img",3,"click"],[1,"countdown",3,"urgent"],[1,"payment-amount"],[1,"file-input-area"],[1,"file-label"],["type","file","accept","image/jpeg,image/png",1,"file-input",3,"change","disabled"],[1,"file-placeholder"],[1,"file-selected"],[1,"validation-error"],[1,"progress-container"],[1,"btn-upload",3,"click","disabled"],[1,"countdown"],[1,"countdown-icon"],[1,"amount-label"],[1,"amount-value"],[1,"file-icon"],[1,"progress-bar"],[1,"progress-fill"],[1,"progress-text"],[1,"qr-overlay",3,"click"],["src","bf-zelle.jpg","alt","Zelle QR Code",1,"qr-overlay-img"],["src","wechat_blueberry.png","alt","WeChat QR Code",1,"qr-overlay-img"]],template:function(e,o){e&1&&(m(0,"div",0)(1,"div",1),b("click",function(){return o.returnPolicyOpen.set(!o.returnPolicyOpen())}),m(2,"span",2),r(3),l(),m(4,"strong"),r(5,"Return Instructions"),l(),p(6,ye,2,0,"span",3)(7,xe,2,0,"span",3),l(),p(8,he,4,5),l(),p(9,Te,31,10,"div",4),p(10,De,2,0,"div",5),p(11,Fe,2,0,"div",5)),e&2&&(i(3),M(o.returnPolicyOpen()?"\u25BE":"\u25B8"),i(3),u(o.returnPolicyOpen()?o.agreedToPolicy()?7:-1:6),i(2),u(o.returnPolicyOpen()?8:-1),i(),u(o.agreedToPolicy()?9:-1),i(),u(o.showQrOverlay()?10:-1),i(),u(o.showWechatQrOverlay()?11:-1))},dependencies:[U],styles:[".return-policy-section[_ngcontent-%COMP%]{background:#fff8e1;border:1px solid #ffcc02;border-radius:12px;padding:1.25rem;margin-bottom:1rem}.return-policy-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;cursor:pointer;-webkit-user-select:none;user-select:none}.return-policy-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#f57f17;font-size:1rem}.fold-icon[_ngcontent-%COMP%]{font-size:.875rem;color:#f57f17}.fold-hint[_ngcontent-%COMP%]{font-size:.75rem;color:#c0a000;font-style:italic;margin-left:auto}.return-policy-content[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;background:#fff;border-radius:8px;padding:1rem 1.25rem;margin-top:.75rem;font-size:.875rem;color:#444;line-height:1.6}.return-policy-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:.75rem 0 .25rem;font-size:.9375rem;font-weight:600;color:#333}.return-policy-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.0625rem}.return-policy-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem}.return-policy-content[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .return-policy-content[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0 0 .5rem;padding-left:1.5rem}.return-policy-content[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-top:1px solid #ddd;margin:.75rem 0}.agree-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:.75rem;font-size:.875rem;color:#333;cursor:pointer;-webkit-user-select:none;user-select:none}.agree-label.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.agree-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:1rem;height:1rem;accent-color:#f57f17}.upload-section[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #66bb6a;border-radius:12px;padding:1.25rem;margin-bottom:1rem}.upload-header[_ngcontent-%COMP%]{margin-bottom:1rem}.payment-title[_ngcontent-%COMP%]{display:block;color:#2e7d32;font-size:1rem;margin-bottom:.75rem}.payment-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.payment-col[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:.75rem;display:flex;flex-direction:column;gap:.375rem}.method-label[_ngcontent-%COMP%]{font-weight:700;font-size:.9375rem;color:#2e7d32}.method-value[_ngcontent-%COMP%]{font-size:.875rem;color:#333;word-break:break-all}.payment-note[_ngcontent-%COMP%]{font-size:.875rem;color:#333;margin-top:.25rem}.zelle-qr-img[_ngcontent-%COMP%], .wechat-qr-img[_ngcontent-%COMP%]{width:140px;height:auto;border-radius:8px;margin-top:.5rem;cursor:pointer;transition:opacity .2s;align-self:center}.zelle-qr-img[_ngcontent-%COMP%]:hover, .wechat-qr-img[_ngcontent-%COMP%]:hover{opacity:.8}.qr-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000;cursor:pointer}.qr-overlay-img[_ngcontent-%COMP%]{max-width:90vw;max-height:90vh;border-radius:12px;box-shadow:0 4px 24px #0000004d}.countdown[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;background:#fff3e0;border-radius:8px;font-size:.875rem;color:#e65100;margin-bottom:1rem}.countdown.urgent[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;font-weight:600}.countdown-icon[_ngcontent-%COMP%]{font-size:1.1rem}.payment-amount[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem;background:#fff;border-radius:8px;margin-bottom:1rem}.amount-label[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.amount-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#2e7d32}.file-input-area[_ngcontent-%COMP%]{margin-bottom:.75rem}.file-label[_ngcontent-%COMP%]{display:block;padding:1rem;background:#fff;border:2px dashed #a5d6a7;border-radius:8px;cursor:pointer;text-align:center;transition:border-color .2s}.file-label[_ngcontent-%COMP%]:hover:not(.disabled){border-color:#66bb6a}.file-label.disabled[_ngcontent-%COMP%]{opacity:.6;cursor:not-allowed}.file-input[_ngcontent-%COMP%]{display:none}.file-placeholder[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;color:#666;font-size:.875rem}.file-selected[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;color:#2e7d32;font-size:.875rem}.file-icon[_ngcontent-%COMP%]{font-size:1.25rem}.validation-error[_ngcontent-%COMP%]{padding:.5rem .75rem;background:#ffebee;border-radius:6px;color:#c62828;font-size:.875rem;margin-bottom:.75rem}.progress-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}.progress-bar[_ngcontent-%COMP%]{flex:1;height:8px;background:#c8e6c9;border-radius:4px;overflow:hidden}.progress-fill[_ngcontent-%COMP%]{height:100%;background:#43a047;border-radius:4px;transition:width .3s ease}.progress-text[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#2e7d32;min-width:40px;text-align:right}.btn-upload[_ngcontent-%COMP%]{width:100%;padding:.75rem;background:#2e7d32;color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:background .2s}.btn-upload[_ngcontent-%COMP%]:hover:not(:disabled){background:#1b5e20}.btn-upload[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}"]})};var Ie=(n,t)=>t.sessionId;function Ue(n,t){if(n&1){let e=h();c(0,"app-payment-upload",14),O("uploadFile",function(a){_(e);let g=d();return C(g.onUploadFile(a))}),s()}if(n&2){let e=d();S("lockExpiresAt",e.orderService.lockExpiresAt())("depositAmount",e.lockedBatchDepositAmount())("uploading",e.uploadService.uploading())("uploadProgress",e.uploadService.uploadProgress())}}function Le(n,t){if(n&1&&(c(0,"div",16)(1,"span",17),r(2,"\u26A0\uFE0F"),s(),c(3,"div",18)(4,"strong"),r(5,"Payment deadline has passed"),s(),c(6,"span",19),r(7),s()()()),n&2){let e=d(2);i(7),y(" Deadline was: ",e.formatDeadline(e.orderService.lockExpiresAt())," ")}}function Ne(n,t){if(n&1&&(c(0,"div",16)(1,"span",17),r(2,"\u23F0"),s(),c(3,"div",18)(4,"strong"),r(5),s(),c(6,"span",19),r(7),s()()()),n&2){let e=d(2);i(5),M(e.daysRemainingText()),i(2),y(" Deadline: ",e.formatDeadline(e.orderService.lockExpiresAt())," ")}}function ze(n,t){if(n&1&&(c(0,"div",15),p(1,Le,8,1,"div",16)(2,Ne,8,2,"div",16),s()),n&2){let e=d();P("overdue",e.orderService.isOverdue()),i(),u(e.orderService.isOverdue()?1:2)}}function Ae(n,t){if(n&1&&w(0,"app-payment-screenshot-gallery",5),n&2){let e=d();S("screenshots",e.orderService.paymentScreenshots())}}function Re(n,t){if(n&1){let e=h();c(0,"button",7),O("click",function(){_(e);let a=d();return C(a.setFilter("locked"))}),r(1),s()}if(n&2){let e=d();P("active",e.activeFilter()==="locked"),i(),y(" Locked (",e.orderService.lockedCount(),") ")}}function Ve(n,t){n&1&&(c(0,"div",9),w(1,"div",20),c(2,"p"),r(3,"Loading..."),s()())}function Be(n,t){if(n&1){let e=h();c(0,"div",10)(1,"div",21),r(2,"!"),s(),c(3,"p"),r(4),s(),c(5,"button",22),O("click",function(){_(e);let a=d();return C(a.orderService.clearError())}),r(6,"Retry"),s()()}if(n&2){let e=d();i(4),M(e.orderService.error())}}function $e(n,t){if(n&1){let e=h();c(0,"div",23),r(1,"\u{1F4E6}"),s(),c(2,"h2"),r(3,"No Enrollments"),s(),c(4,"p"),r(5,"You don't have any enrollments yet"),s(),c(6,"button",24),O("click",function(){_(e);let a=d(2);return C(a.goToCatalog())}),r(7,"Browse Classes"),s()}}function Ge(n,t){if(n&1&&(c(0,"div",23),r(1,"\u{1F50D}"),s(),c(2,"h2"),r(3),s(),c(4,"p"),r(5,"Try a different filter"),s()),n&2){let e=d(2);i(3),y("No ",e.filterName()," enrollments")}}function je(n,t){if(n&1&&(c(0,"div",11),p(1,$e,8,0)(2,Ge,6,1),s()),n&2){let e=d();i(),u(e.activeFilter()==="all"?1:2)}}function Qe(n,t){if(n&1&&w(0,"app-class-registration-card",25),n&2){let e=t.$implicit;S("data",e)("showGroupStatus",!0)("showStudentStatus",e.status==="mixed")}}function qe(n,t){if(n&1&&(c(0,"div",12),q(1,Qe,1,3,"app-class-registration-card",25,Ie),s()),n&2){let e=d();i(),H(e.filteredGroupedItems())}}function He(n,t){if(n&1&&(c(0,"div",13)(1,"h2"),r(2,"Summary"),s(),w(3,"app-price-breakdown",26),s()),n&2){let e=d();i(3),S("data",e.priceBreakdownData())}}var me=class n{orderService=x(oe);uploadService=x(N);configService=x(L);seasonService=x(ne);userService=x(ie);authService=x(re);router=x(Z);activeFilter=v("all");ngOnInit(){if(!this.seasonService.selectedSeason()){let t=this.configService.currentActiveYear();t&&this.seasonService.loadSeasons(t)}}groupedItems=f(()=>{let t=this.orderService.items(),e=new Map;for(let o of t){let a={studentId:o.studentId,studentName:(()=>{let E=this.userService.getStudentById(o.studentId);return E?`${E.firstName} ${E.lastName}`.trim():"Unknown"})(),options:o.options,status:o.status},g=e.get(o.sessionId);g?(g.students.push(a),g.status!==o.status&&g.status!=="mixed"&&(g.status="mixed")):e.set(o.sessionId,{sessionId:o.sessionId,className:o.snapshot.className,startDate:o.snapshot.startDate,endDate:o.snapshot.endDate,status:o.status,students:[a]})}return Array.from(e.values()).sort((o,a)=>o.className.localeCompare(a.className))});groupedItemsCount=f(()=>this.groupedItems().length);filteredGroupedItems=f(()=>{let t=this.activeFilter(),e=this.groupedItems();return t==="all"?e:e.map(o=>B(V({},o),{students:o.students.filter(a=>a.status===t)})).filter(o=>o.students.length>0)});filterName=f(()=>{let t=this.activeFilter();return{all:"All",locked:"Locked",submitted:"Pending Payment",paid:"Paid",cancelled:"Cancelled"}[t]});priceBreakdownData=f(()=>{let t=this.orderService.pricing();return t?{pricing:t,couponCredit:0,totalPaid:this.orderService.totalPaid(),totalRefunded:this.orderService.totalRefunded(),amountDue:this.orderService.amountDue()}:null});showPaymentDeadline=f(()=>this.orderService.hasSubmittedItems()&&this.orderService.lockExpiresAt()!==null);daysRemaining=f(()=>{let t=this.orderService.lockExpiresAt();if(!t)return null;let e=new Date(this.configService.currentTime()),a=new Date(t).getTime()-e.getTime();return a<=0?null:Math.ceil(a/(1e3*60*60*24))});daysRemainingText=f(()=>{let t=this.daysRemaining();return t===null?"":t===1?"You have 1 day to complete payment":`You have ${t} days to complete payment`});lockedBatchDepositAmount=f(()=>{let t=this.orderService.lockedItems(),e=5e3,o=t.reduce((g,E)=>g+E.snapshot.priceSnapshot.itemTotal,0),a=t.length*e;return Math.min(a,o)});async onUploadFile(t){try{let e=this.authService.firebaseUser()?.uid;if(!e)throw new Error("Not authenticated");let o=await this.uploadService.uploadScreenshot(t,e);await this.orderService.placeOrder(o.storagePath)}catch(e){console.error("Upload failed:",e)}}setFilter(t){this.activeFilter.set(t)}goToCatalog(){this.router.navigate(["/catalog"])}formatDeadline(t){return t?new Date(t).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}):""}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=F({type:n,selectors:[["app-order-list"]],decls:22,vars:18,consts:[[1,"order-list-page"],[1,"page-header"],[1,"subtitle"],[3,"lockExpiresAt","depositAmount","uploading","uploadProgress"],[1,"payment-deadline-banner",3,"overdue"],[3,"screenshots"],[1,"filter-tabs"],[1,"tab",3,"click"],[1,"tab",3,"active"],[1,"loading-container"],[1,"error-container"],[1,"empty-container"],[1,"orders-grid"],[1,"orders-summary"],[3,"uploadFile","lockExpiresAt","depositAmount","uploading","uploadProgress"],[1,"payment-deadline-banner"],[1,"deadline-content"],[1,"deadline-icon"],[1,"deadline-text"],[1,"deadline-detail"],[1,"spinner"],[1,"error-icon"],[1,"btn-retry",3,"click"],[1,"empty-icon"],[1,"btn-primary",3,"click"],[3,"data","showGroupStatus","showStudentStatus"],[3,"data"]],template:function(e,o){e&1&&(c(0,"div",0)(1,"header",1)(2,"h1"),r(3,"My Orders"),s(),c(4,"p",2),r(5,"View and manage your orders"),s()(),p(6,Ue,1,4,"app-payment-upload",3),p(7,ze,3,3,"div",4),p(8,Ae,1,1,"app-payment-screenshot-gallery",5),c(9,"div",6)(10,"button",7),O("click",function(){return o.setFilter("all")}),r(11),s(),p(12,Re,2,3,"button",8),c(13,"button",7),O("click",function(){return o.setFilter("submitted")}),r(14),s(),c(15,"button",7),O("click",function(){return o.setFilter("paid")}),r(16),s()(),p(17,Ve,4,0,"div",9),p(18,Be,7,1,"div",10),p(19,je,3,1,"div",11),p(20,qe,3,0,"div",12),p(21,He,4,1,"div",13),s()),e&2&&(i(6),u(o.orderService.hasLockedItems()?6:-1),i(),u(o.showPaymentDeadline()&&!o.orderService.hasLockedItems()?7:-1),i(),u(o.orderService.paymentScreenshots().length>0?8:-1),i(2),P("active",o.activeFilter()==="all"),i(),y(" All (",o.groupedItemsCount(),") "),i(),u(o.orderService.lockedCount()>0?12:-1),i(),P("active",o.activeFilter()==="submitted"),i(),y(" Pending Payment (",o.orderService.submittedCount(),") "),i(),P("active",o.activeFilter()==="paid"),i(),y(" Paid (",o.orderService.paidCount(),") "),i(),u(o.orderService.loading()?17:-1),i(),u(o.orderService.error()?18:-1),i(),u(!o.orderService.loading()&&!o.orderService.error()&&o.filteredGroupedItems().length===0?19:-1),i(),u(o.filteredGroupedItems().length>0?20:-1),i(),u(o.priceBreakdownData()?21:-1))},dependencies:[U,de,z,se,le],styles:[".order-list-page[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.payment-deadline-banner[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;border-radius:12px;padding:1rem 1.25rem;margin-bottom:1.5rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);border-color:var(--sys-error, #c62828)}.deadline-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.deadline-icon[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1}.deadline-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#856404;font-size:1rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.deadline-detail[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-detail[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem;color:var(--sys-on-surface, #212121)}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);overflow-x:auto}.tab[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:1px solid var(--sys-outline, #e0e0e0);border-radius:20px;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;white-space:nowrap;transition:all .2s ease}.tab[_ngcontent-%COMP%]:hover{border-color:var(--sys-primary, #c62828);color:var(--sys-primary, #c62828)}.tab.active[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828);color:#fff}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--sys-on-surface-variant, #666)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c);margin-bottom:1rem}.btn-retry[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:var(--sys-error, #c62828);color:#fff;border:none;border-radius:6px;cursor:pointer}.empty-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--sys-on-surface, #212121)}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666);margin-bottom:1.5rem}.btn-primary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}.orders-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.orders-summary[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:var(--sys-surface-container, #fafafa);border-radius:12px;border:1px solid var(--sys-outline-variant, #e0e0e0)}.orders-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem;color:var(--sys-on-surface, #212121)}"]})};export{me as OrderListComponent};
