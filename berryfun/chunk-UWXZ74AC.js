import{Ca as z,Da as J}from"./chunk-ODOFH7NK.js";import{L as G,Q as A,Qb as C,a as w,b as R,ga as x}from"./chunk-C26OXKSD.js";var V=class S{functions=A(J);_loading=x(!1);_error=x(null);loading=this._loading.asReadonly();error=this._error.asReadonly();async createUser(o){return this.wrapCall("createUserAccount",o)}async updateUser(o){return this.wrapCall("updateUserProfile",o)}async createStudent(o){return this.wrapCall("createStudent",o)}async updateStudent(o){return this.wrapCall("updateStudent",o)}async deleteStudent(o){return this.wrapCall("deleteStudent",{studentId:o})}async getUserProfile(o){return this.wrapCall("getUserProfile",{uid:o})}async listAllUsers(o){return this.wrapCall("listAllUsers",{limit:o})}async searchUsers(o){return this.wrapCall("searchUsers",{query:o})}async getAdminUserDetails(o){return this.wrapCall("getAdminUserDetails",{uid:o})}async updateUserProfileAsAdmin(o,r){return this.wrapCall("updateUserProfile",{authId:o,updates:r})}clearError(){this._error.set(null)}async wrapCall(o,r){this._loading.set(!0),this._error.set(null);try{return await this.functions.call(o,r)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}static \u0275fac=function(r){return new(r||S)};static \u0275prov=G({token:S,factory:S.\u0275fac,providedIn:"root"})};var re=["43dfed9d3bb5faee2c59afaf60e2f0ca"];function te(S){function o(e,u){return e<<u|e>>>32-u}function r(e,u){let l=e&2147483648,m=u&2147483648,g=e&1073741824,_=u&1073741824,f=(e&1073741823)+(u&1073741823);return g&_?f^2147483648^l^m:g|_?f&1073741824?f^3221225472^l^m:f^1073741824^l^m:f^l^m}function d(e,u,l){return e&u|~e&l}function c(e,u,l){return e&l|u&~l}function U(e,u,l){return e^u^l}function $(e,u,l){return u^(e|~l)}function h(e,u,l,m,g,_,f){return e=r(e,r(r(d(u,l,m),g),f)),r(o(e,_),u)}function b(e,u,l,m,g,_,f){return e=r(e,r(r(c(u,l,m),g),f)),r(o(e,_),u)}function y(e,u,l,m,g,_,f){return e=r(e,r(r(U(u,l,m),g),f)),r(o(e,_),u)}function p(e,u,l,m,g,_,f){return e=r(e,r(r($(u,l,m),g),f)),r(o(e,_),u)}function Z(e){let u,l=e.length,m=l+8,_=((m-m%64)/64+1)*16,f=new Array(_-1),k=0,v=0;for(;v<l;)u=(v-v%4)/4,k=v%4*8,f[u]=f[u]|e.charCodeAt(v)<<k,v++;return u=(v-v%4)/4,k=v%4*8,f[u]=f[u]|128<<k,f[_-2]=l<<3,f[_-1]=l>>>29,f}function P(e){let u="",l="",m,g;for(g=0;g<=3;g++)m=e>>>g*8&255,l="0"+m.toString(16),u=u+l.substring(l.length-2);return u}let i=Z(S),t=1732584193,s=4023233417,n=2562383102,a=271733878,M=7,D=12,N=17,q=22,E=5,I=9,T=14,L=20,F=4,H=11,j=16,Q=23,W=6,B=10,O=15,Y=21;for(let e=0;e<i.length;e+=16){let u=t,l=s,m=n,g=a;t=h(t,s,n,a,i[e+0],M,3614090360),a=h(a,t,s,n,i[e+1],D,3905402710),n=h(n,a,t,s,i[e+2],N,606105819),s=h(s,n,a,t,i[e+3],q,3250441966),t=h(t,s,n,a,i[e+4],M,4118548399),a=h(a,t,s,n,i[e+5],D,1200080426),n=h(n,a,t,s,i[e+6],N,2821735955),s=h(s,n,a,t,i[e+7],q,4249261313),t=h(t,s,n,a,i[e+8],M,1770035416),a=h(a,t,s,n,i[e+9],D,2336552879),n=h(n,a,t,s,i[e+10],N,4294925233),s=h(s,n,a,t,i[e+11],q,2304563134),t=h(t,s,n,a,i[e+12],M,1804603682),a=h(a,t,s,n,i[e+13],D,4254626195),n=h(n,a,t,s,i[e+14],N,2792965006),s=h(s,n,a,t,i[e+15],q,1236535329),t=b(t,s,n,a,i[e+1],E,4129170786),a=b(a,t,s,n,i[e+6],I,3225465664),n=b(n,a,t,s,i[e+11],T,643717713),s=b(s,n,a,t,i[e+0],L,3921069994),t=b(t,s,n,a,i[e+5],E,3593408605),a=b(a,t,s,n,i[e+10],I,38016083),n=b(n,a,t,s,i[e+15],T,3634488961),s=b(s,n,a,t,i[e+4],L,3889429448),t=b(t,s,n,a,i[e+9],E,568446438),a=b(a,t,s,n,i[e+14],I,3275163606),n=b(n,a,t,s,i[e+3],T,4107603335),s=b(s,n,a,t,i[e+8],L,1163531501),t=b(t,s,n,a,i[e+13],E,2850285829),a=b(a,t,s,n,i[e+2],I,4243563512),n=b(n,a,t,s,i[e+7],T,1735328473),s=b(s,n,a,t,i[e+12],L,2368359562),t=y(t,s,n,a,i[e+5],F,4294588738),a=y(a,t,s,n,i[e+8],H,2272392833),n=y(n,a,t,s,i[e+11],j,1839030562),s=y(s,n,a,t,i[e+14],Q,4259657740),t=y(t,s,n,a,i[e+1],F,2763975236),a=y(a,t,s,n,i[e+4],H,1272893353),n=y(n,a,t,s,i[e+7],j,4139469664),s=y(s,n,a,t,i[e+10],Q,3200236656),t=y(t,s,n,a,i[e+13],F,681279174),a=y(a,t,s,n,i[e+0],H,3936430074),n=y(n,a,t,s,i[e+3],j,3572445317),s=y(s,n,a,t,i[e+6],Q,76029189),t=y(t,s,n,a,i[e+9],F,3654602809),a=y(a,t,s,n,i[e+12],H,3873151461),n=y(n,a,t,s,i[e+15],j,530742520),s=y(s,n,a,t,i[e+2],Q,3299628645),t=p(t,s,n,a,i[e+0],W,4096336452),a=p(a,t,s,n,i[e+7],B,1126891415),n=p(n,a,t,s,i[e+14],O,2878612391),s=p(s,n,a,t,i[e+5],Y,4237533241),t=p(t,s,n,a,i[e+12],W,1700485571),a=p(a,t,s,n,i[e+3],B,2399980690),n=p(n,a,t,s,i[e+10],O,4293915773),s=p(s,n,a,t,i[e+1],Y,2240044497),t=p(t,s,n,a,i[e+8],W,1873313359),a=p(a,t,s,n,i[e+15],B,4264355552),n=p(n,a,t,s,i[e+6],O,2734768916),s=p(s,n,a,t,i[e+13],Y,1309151649),t=p(t,s,n,a,i[e+4],W,4149444226),a=p(a,t,s,n,i[e+11],B,3174756917),n=p(n,a,t,s,i[e+2],O,718787259),s=p(s,n,a,t,i[e+9],Y,3951481745),t=r(t,u),s=r(s,l),n=r(n,m),a=r(a,g)}return(P(t)+P(s)+P(n)+P(a)).toLowerCase()}function K(S){if(!S)return!1;let o=te(S.toLowerCase().trim());return re.includes(o)}var X=class S{datastore=A(z);rpc=A(V);_currentUser=x(null);_loading=x(!1);_error=x(null);_isAdmin=x(!1);_users=x([]);_selectedUser=x(null);_searchQuery=x("");_actionLoading=x(!1);_actionError=x(null);currentUser=this._currentUser.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();users=this._users.asReadonly();selectedUser=this._selectedUser.asReadonly();searchQuery=this._searchQuery.asReadonly();actionLoading=this._actionLoading.asReadonly();actionError=this._actionError.asReadonly();isAuthenticated=C(()=>this._currentUser()!==null);userCount=C(()=>this._users().length);hasUsers=C(()=>this._users().length>0);students=C(()=>this._currentUser()?.students??[]);studentCount=C(()=>this.students().length);hasStudents=C(()=>this.students().length>0);isProfileComplete=C(()=>{let o=this._currentUser();if(!o)return!1;let r=o.contactInfo;if(!r)return!1;let d=!!r.phone,c=!!r.address?.street&&!!r.address?.city&&!!r.address?.state&&!!r.address?.zipCode,U=!!r.emergencyContact?.name&&!!r.emergencyContact?.phone&&!!r.emergencyContact?.relationship;return d&&c&&U});isAdmin=this._isAdmin.asReadonly();async createUser(o){this._loading.set(!0),this._error.set(null);try{return await this.rpc.createUser(o)}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}async updateProfile(o){this._loading.set(!0),this._error.set(null);try{let r=await this.rpc.updateUser({updates:o});this._currentUser.set(r)}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}setCurrentUser(o){this._currentUser.set(o),o===null?this._isAdmin.set(!1):this._isAdmin.set(K(o.email))}clearUser(){this._currentUser.set(null),this._isAdmin.set(!1)}clearError(){this._error.set(null)}getStudentById(o){return this.students().find(r=>r.id===o)}getEligibleStudents(o){let r=new Date(o,0,1);return this.students().filter(d=>{let c=new Date(d.dob),U=r.getFullYear()-c.getFullYear(),h=new Date(r.getFullYear(),c.getMonth(),c.getDate())>r?U-1:U;return h>=5&&h<=12})}async createStudent(o){let r=this._currentUser();if(!r)throw new Error("No current user");this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.createStudent(w({parentAuthId:r.uid},o));return this._currentUser.update(c=>c&&R(w({},c),{students:[...c.students??[],d]})),d}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async updateStudent(o,r){this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.updateStudent(w({studentId:o},r));this._currentUser.update(c=>c&&R(w({},c),{students:c.students?.map(U=>U.id===o?d:U)}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async deleteStudent(o){this._loading.set(!0),this._error.set(null);try{await this.rpc.deleteStudent(o),this._currentUser.update(r=>r&&R(w({},r),{students:r.students?.filter(d=>d.id!==o)}))}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}async loadAllUsers(o){this._loading.set(!0),this._error.set(null);try{let r=await this.datastore.listAllUsers(o);this._users.set(r)}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}async searchUsers(o){this._loading.set(!0),this._error.set(null),this._searchQuery.set(o);try{let r=await this.datastore.searchUsers(o);this._users.set(r)}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}async getUserDetails(o){this._loading.set(!0),this._error.set(null);try{let r=await this.datastore.getUserByAuthId(o);if(!r)throw new Error(`User not found: ${o}`);return this._selectedUser.set(r),r}catch(r){let d=r instanceof Error?r.message:String(r);throw this._error.set(d),r}finally{this._loading.set(!1)}}async updateUserProfile(o,r){this._actionLoading.set(!0),this._actionError.set(null);try{await this.rpc.updateUserProfileAsAdmin(o,r),this._users.update(c=>c.map(U=>U.uid===o?R(w({},U),{displayName:r.displayName??U.displayName,contactInfo:r.contactInfo??U.contactInfo}):U));let d=this._selectedUser();d&&d.uid===o&&this._selectedUser.set(R(w({},d),{displayName:r.displayName??d.displayName,contactInfo:r.contactInfo??d.contactInfo}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._actionError.set(c),d}finally{this._actionLoading.set(!1)}}setSearchQuery(o){this._searchQuery.set(o)}clearSelectedUser(){this._selectedUser.set(null)}static \u0275fac=function(r){return new(r||S)};static \u0275prov=G({token:S,factory:S.\u0275fac,providedIn:"root"})};export{V as a,X as b};
