import{a as d}from"./chunk-GZ2C2WLL.js";import{a as h}from"./chunk-6THQUTU6.js";import{a as g}from"./chunk-BV4MKCLK.js";import{a as b}from"./chunk-TZNWTF3S.js";import{na as n,oa as p}from"./chunk-UBU22GLA.js";import{M as o,R as r,Tb as c,aa as l,ha as a,ia as u}from"./chunk-UKFGIOHC.js";var m=class i{datastore=r(g);seasonService=r(h);configService=r(b);destroyRef=r(l);_registration=a(null);registration=this._registration.asReadonly();subscription=null;currentSeasonId=null;constructor(){u(()=>{let t=this.seasonService.selectedSeason();t&&t.id!==this.currentSeasonId&&this.subscribeToSeason(t.id)})}subscribeToSeason(t){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=t;let e=this.configService.currentActiveYear();this.subscription=this.datastore.subscribeToRegistration(e,t).pipe(d(this.destroyRef)).subscribe({next:s=>this._registration.set(s),error:s=>{console.error("Registration subscription error:",s),this._registration.set(null)}})}getClassEnrollment(t){return this.registration()?.classes[t]}getEnrolledCount(t){return this.getClassEnrollment(t)?.enrolledStudents?.length??0}getAvailableSpots(t){let e=this.getEnrolledCount(t.id);return Math.max(0,t.capacity-e)}classesWithEnrollment=c(()=>{let t=this.seasonService.classes(),e=this._registration();return p(t,e)});getClassWithEnrollment(t){let e=this.seasonService.classes().find(s=>s.id===t);return e?n(e,this.getClassEnrollment(t)):null}createViewType(t){return n(t,this.getClassEnrollment(t.id))}isFullForPublic(t){return this.getAvailableSpots(t)<=0}getEnrollmentStatus(t){let e=this.getAvailableSpots(t);return e===0?"waitlist-only":e<=3?"almost-full":"open"}getStatusMessage(t){let e=this.getEnrollmentStatus(t),s=this.getAvailableSpots(t);switch(e){case"open":return`${s} spots available`;case"almost-full":return`Only ${s} spots left!`;case"full":return"Full";case"waitlist-only":return"Full - Join Waitlist";default:return""}}unsubscribe(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=null,this._registration.set(null)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{m as a};
