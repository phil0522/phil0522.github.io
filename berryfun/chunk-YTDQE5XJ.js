import{a as ue,b as ge,c as fe,d as Ce,e as _e}from"./chunk-NF7I7DXH.js";import{a as be,b as xe}from"./chunk-SPS2R4NS.js";import"./chunk-4CC2DXAZ.js";import{a as j}from"./chunk-HBOBTVUD.js";import{b as ye,c as ve,f as he,r as B}from"./chunk-U4YJGQVE.js";import{a as pe}from"./chunk-N5ME23IC.js";import{g as le}from"./chunk-OD6KCV5K.js";import"./chunk-FYGYBRKK.js";import"./chunk-NR6WXTS5.js";import"./chunk-L5OFKJS2.js";import{a as ce}from"./chunk-EUESG25O.js";import{b as me}from"./chunk-3NM435RE.js";import{Ja as de,d as T,j as oe,k as ie,na as re,oa as ae,pa as se}from"./chunk-UIQMLXH2.js";import{Bb as r,Cb as S,Db as I,Eb as Q,Hb as Z,Ia as a,Ib as ee,Jb as te,Mb as ne,R as N,Sb as y,Ta as O,Ub as P,Vb as u,W as C,X as _,Y as v,Z as h,bb as g,cb as f,eb as F,fb as V,gb as b,ha as W,hb as d,ib as l,jb as x,kb as s,lb as c,mb as k,nb as D,ob as L,pb as E,qb as M,rb as m,zb as R}from"./chunk-6GAPJCXB.js";var we=()=>({tab:"students"});function ke(o,t){o&1&&(d(0,"div",0),v(),d(1,"svg",2),x(2,"path",3),l(),h(),d(3,"span"),r(4,"You haven't added any students yet."),l(),d(5,"a",4),r(6,"Add Student"),l()()),o&2&&(a(5),b("queryParams",ne(1,we)))}function Ie(o,t){if(o&1&&(d(0,"div",1),v(),d(1,"svg",2),x(2,"path",5),l(),h(),d(3,"span"),r(4),l()()),o&2){let e=m();a(4),I("",e.itemsMissingStudents()," item(s) need student selection")}}function Oe(o,t){o&1&&(d(0,"div",1),v(),d(1,"svg",2),x(2,"path",5),l(),h(),d(3,"span"),r(4,"Please "),d(5,"a",6),r(6,"complete your profile"),l(),r(7," before checkout (phone, WeChat, address, emergency contact required)"),l()())}var X=(o,t)=>t.id;function De(o,t){o&1&&(s(0,"span",14),r(1,"Required"),c())}function Te(o,t){if(o&1&&(s(0,"span",15),r(1),c()),o&2){let e=m();a(),I("",e.item().students.length," selected")}}function Ne(o,t){if(o&1&&(s(0,"span",36),r(1),c()),o&2){let e=m();R("at-capacity",e.isAtCapacity()),a(),I(" ",e.remainingSelectableSpots()," spot(s) left ")}}function ze(o,t){o&1&&(s(0,"div",17)(1,"span"),r(2,"No students found. Please add student information first."),c()())}function Fe(o,t){o&1&&(s(0,"span",46),r(1,"Enrolled"),c())}function Ve(o,t){o&1&&(s(0,"span",47),r(1,"Ineligible"),c())}function Re(o,t){o&1&&(s(0,"span",48),r(1,"Full"),c())}function Le(o,t){if(o&1){let e=D();s(0,"label",38)(1,"input",39),M("change",function(){let i=C(e).$implicit,p=m(2);return _(p.onStudentToggle(i))}),c(),s(2,"span",40),v(),s(3,"svg",5),k(4,"path",41),c()(),h(),s(5,"span",42),r(6,"\u{1F464}"),c(),s(7,"span",43)(8,"span",44),r(9),c(),s(10,"span",45),r(11),c()(),g(12,Fe,2,0,"span",46)(13,Ve,2,0,"span",47)(14,Re,2,0,"span",48),c()}if(o&2){let e=t.$implicit,n=m(2);R("selected",n.isStudentSelected(e.id))("ineligible",!n.isStudentEligible(e))("registered",n.isStudentRegistered(e.id))("capacity-blocked",n.isCapacityBlocked(e.id)),a(),L("checked",n.isStudentSelected(e.id))("disabled",!n.isStudentSelectable(e)),a(8),S(e.fullName),a(2),I("",n.calculateStudentAge(e.dob)," yrs"),a(),f(n.isStudentRegistered(e.id)?12:n.isStudentEligible(e)?n.isCapacityBlocked(e.id)?14:-1:13)}}function We(o,t){if(o&1&&(s(0,"div",18),F(1,Le,15,13,"label",37,X),c()),o&2){let e=m();a(),V(e.students())}}function je(o,t){o&1&&(s(0,"span",21),r(1,"Locked (existing registration)"),c())}function Be(o,t){o&1&&(s(0,"span",22),r(1,"Optional"),c())}function Ae(o,t){if(o&1&&r(0),o&2){let e=m();I(" Subtotal (",e.item().students.length," student(s)) ")}}function He(o,t){o&1&&r(0," Select students to see price ")}function Je(o,t){if(o&1&&(s(0,"span",35),r(1),c()),o&2){let e=m();a(),S(e.formatPrice(e.itemSubtotal()))}}function $e(o,t){o&1&&(d(0,"div",2),x(1,"div",7),d(2,"span"),r(3,"Calculating..."),l()())}function Ge(o,t){if(o&1&&(d(0,"div",3),v(),d(1,"svg",8),x(2,"path",9),l(),h(),d(3,"span"),r(4),l()()),o&2){let e=m();a(4),S(e.error())}}function qe(o,t){if(o&1&&x(0,"app-price-breakdown",4),o&2){let e=m();b("data",e.priceBreakdownData())}}function Ue(o,t){o&1&&(d(0,"div",5)(1,"span"),r(2,"Add classes to cart to see pricing"),l()())}function Ye(o,t){o&1&&(x(0,"div",11),d(1,"span"),r(2,"Submitting..."),l())}function Xe(o,t){o&1&&(d(0,"span"),r(1,"Checkout"),l(),v(),d(2,"svg",8),x(3,"path",12),l())}function Ke(o,t){if(o&1){let e=D();d(0,"button",10),E("click",function(){C(e);let i=m();return _(i.checkout.emit())}),g(1,Ye,3,0)(2,Xe,4,0),l()}if(o&2){let e=m();b("disabled",e.checkoutDisabled()),a(),f(e.checkoutLoading()?1:2)}}function Qe(o,t){o&1&&x(0,"span",8)}function Ze(o,t){o&1&&r(0," Add ")}function et(o,t){if(o&1&&(d(0,"div",9),r(1),l()),o&2){let e=m();a(),S(e.couponError())}}function tt(o,t){if(o&1&&(d(0,"div",10),r(1),l()),o&2){let e=m();a(),S(e.couponSuccess())}}function nt(o,t){o&1&&(d(0,"div",11),x(1,"div",12),d(2,"span"),r(3,"Loading coupons..."),l()())}function ot(o,t){if(o&1&&(d(0,"div",14)(1,"div",17)(2,"span",18),r(3,"\u2713"),l()(),d(4,"div",19)(5,"span",20),r(6),l(),d(7,"span",21),r(8),l()(),d(9,"div",22)(10,"span",23),r(11),l(),d(12,"span",24),r(13,"Auto-applied"),l()()()),o&2){let e=t.$implicit,n=m(2);a(6),S(e.name),a(2),S(e.description),a(3),S(n.formatPrice(e.maxCreditCents))}}function it(o,t){o&1&&(d(0,"span",27),r(1,"Per Student"),l())}function rt(o,t){o&1&&(d(0,"span",28),r(1,"\xD7 students"),l())}function at(o,t){if(o&1){let e=D();d(0,"label",25)(1,"input",26),E("change",function(){let i=C(e).$implicit,p=m(2);return _(p.toggleCoupon.emit(i.id))}),l(),d(2,"div",17)(3,"span",18),r(4,"\u2713"),l()(),d(5,"div",19)(6,"span",20),r(7),l(),d(8,"span",21),r(9),l(),g(10,it,2,0,"span",27),l(),d(11,"div",22)(12,"span",23),r(13),l(),g(14,rt,2,0,"span",28),l()()}if(o&2){let e=t.$implicit,n=m(2);R("selected",n.isCouponSelected(e.id)),a(),b("checked",n.isCouponSelected(e.id)),a(6),S(e.name),a(2),S(e.description),a(),f(e.coupon_type==="student_credit"?10:-1),a(3),S(n.formatPrice(e.maxCreditCents)),a(),f(e.coupon_type==="student_credit"?14:-1)}}function st(o,t){if(o&1&&(d(0,"div",16)(1,"span",29),r(2,"Total Coupon Credit"),l(),d(3,"span",30),r(4),l()()),o&2){let e=m(2);a(4),S(e.formatPrice(e.totalCredit()))}}function dt(o,t){if(o&1&&(d(0,"div",13),F(1,ot,14,3,"div",14,X),F(3,at,15,8,"label",15,X),l(),g(5,st,5,1,"div",16)),o&2){let e=m();a(),V(e.seasonCoupons()),a(2),V(e.userCoupons()),a(2),f(e.totalCredit()>0?5:-1)}}function ct(o,t){if(o&1&&(s(0,"div",4)(1,"span",5),r(2),c(),s(3,"span",6),r(4),c()()),o&2){let e=m();a(2),Q("",e.emailCount()," unique referral",e.emailCount()>1?"s":""),a(2),I("-",e.formatPrice(e.emailCount()*e.discountPerEmail))}}var lt=(o,t)=>t.sessionId+t.studentId;function mt(o,t){o&1&&(s(0,"span",15),r(1,"Already on waitlist"),c())}function pt(o,t){o&1&&k(0,"span",18)}function ut(o,t){o&1&&r(0," Join Waitlist ")}function gt(o,t){if(o&1){let e=D();s(0,"button",17),M("click",function(){C(e);let i=m().$implicit,p=m(2);return _(p.joinWaitlist.emit(i))}),g(1,pt,1,0,"span",18)(2,ut,1,0),c()}if(o&2){let e=m().$implicit,n=m(2);L("disabled",n.joiningWaitlist()),a(),f(n.isJoiningWaitlistFor(e)?1:2)}}function ft(o,t){if(o&1&&(s(0,"div",8)(1,"div",12)(2,"span",13),r(3),c(),s(4,"span",14),r(5),c()(),g(6,mt,2,0,"span",15)(7,gt,3,2,"button",16),c()),o&2){let e=t.$implicit,n=m(2);a(3),S(e.className),a(2),I("for ",e.studentName),a(),f(n.isAlreadyOnWaitlist(e.sessionId)?6:7)}}function Ct(o,t){if(o&1){let e=D();s(0,"button",19),M("click",function(){C(e);let i=m(2);return _(i.continueWithRemaining.emit())}),r(1," Continue with Available Classes "),c()}}function _t(o,t){if(o&1){let e=D();s(0,"div",1),M("click",function(){C(e);let i=m();return _(i.close.emit())}),s(1,"div",2),M("click",function(i){return C(e),_(i.stopPropagation())}),s(2,"div",3),v(),s(3,"svg",4),k(4,"path",5),c(),h(),s(5,"h2"),r(6,"Classes Full"),c()(),s(7,"p",6),r(8," The following class(es) are now full. This can happen when spots fill up while you were checking out. "),c(),s(9,"div",7),F(10,ft,8,3,"div",8,lt),c(),s(12,"div",9)(13,"button",10),M("click",function(){C(e);let i=m();return _(i.close.emit())}),r(14,"Cancel"),c(),g(15,Ct,2,0,"button",11),c()()()}if(o&2){let e=m();a(10),V(e.failedItems()),a(5),f(e.hasRemainingItems()?15:-1)}}var A=class o{itemCount=u.required();back=P();static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-header"]],inputs:{itemCount:[1,"itemCount"]},outputs:{back:"back"},decls:8,vars:1,consts:[[1,"cart-header"],[1,"btn-back",3,"click"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor"],["d","M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"],[1,"item-count"]],template:function(e,n){e&1&&(s(0,"header",0)(1,"button",1),M("click",function(){return n.back.emit()}),v(),s(2,"svg",2),k(3,"path",3),c()(),h(),s(4,"h1"),r(5,"Shopping Cart"),c(),s(6,"span",4),r(7),c()()),e&2&&(a(7),I("",n.itemCount()," item(s)"))},dependencies:[T],styles:[".cart-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.5rem;background:#fff;border-bottom:1px solid var(--sys-outline, #e0e0e0);position:sticky;top:0;z-index:10}.btn-back[_ngcontent-%COMP%]{background:none;border:none;padding:.5rem;cursor:pointer;color:var(--sys-on-surface, #212121);border-radius:50%;transition:background .2s ease}.btn-back[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}h1[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121);flex:1}.item-count[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}"]})},H=class o{browse=P();static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-empty"]],outputs:{browse:"browse"},decls:9,vars:0,consts:[[1,"empty-cart"],["width","64","height","64","viewBox","0 0 24 24","fill","currentColor",1,"empty-icon"],["d","M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"],[1,"btn-browse",3,"click"]],template:function(e,n){e&1&&(s(0,"div",0),v(),s(1,"svg",1),k(2,"path",2),c(),h(),s(3,"h2"),r(4,"Your cart is empty"),c(),s(5,"p"),r(6,"Browse the catalog and find the perfect summer camp for your child"),c(),s(7,"button",3),M("click",function(){return n.browse.emit()}),r(8,"Browse Classes"),c()())},dependencies:[T],styles:[".empty-cart[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.empty-icon[_ngcontent-%COMP%]{color:var(--sys-outline, #e0e0e0);margin-bottom:1rem}h2[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.5rem;color:var(--sys-on-surface, #212121)}p[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666)}.btn-browse[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:.875rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-browse[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})},J=class o{showNoStudents=u(!1);itemsMissingStudents=u(0);showProfileIncomplete=u(!1);static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-warning-banner"]],inputs:{showNoStudents:[1,"showNoStudents"],itemsMissingStudents:[1,"itemsMissingStudents"],showProfileIncomplete:[1,"showProfileIncomplete"]},decls:3,vars:3,consts:[[1,"warning-banner"],[1,"warning-banner","warning-info"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],["routerLink","/profile",1,"add-student-link",3,"queryParams"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"],["routerLink","/profile",1,"warning-link"]],template:function(e,n){e&1&&(g(0,ke,7,2,"div",0),g(1,Ie,5,1,"div",1),g(2,Oe,8,0,"div",1)),e&2&&(f(n.showNoStudents()?0:-1),a(),f(n.itemsMissingStudents()>0&&!n.showNoStudents()?1:-1),a(),f(n.showProfileIncomplete()?2:-1))},dependencies:[T,ie],styles:[".warning-banner[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:1rem;margin-bottom:1rem;background:var(--sys-error-container, #ffebee);border:1px solid var(--sys-error, #c62828);border-radius:8px;color:var(--sys-error, #c62828);font-size:.875rem}.warning-banner.warning-info[_ngcontent-%COMP%]{background:#fff3e0;border-color:#ff9800;color:#e65100}.add-student-link[_ngcontent-%COMP%]{color:var(--sys-error, #c62828);font-weight:600;text-decoration:underline}.warning-link[_ngcontent-%COMP%]{color:#e65100;font-weight:600;text-decoration:underline}.warning-link[_ngcontent-%COMP%]:hover{color:#bf360c}"]})},$=class o{configService=N(ce);Infinity=1/0;formatPrice=j;formatDateRange=ue;item=u.required();students=u.required();registeredStudentIds=u([]);availableSpots=u(1/0);selectedInOtherItems=u(0);addonsLocked=y(()=>this.registeredStudentIds().length>0);remove=P();optionsChange=P();studentToggle=P();serverTime=y(()=>{let t=this.configService.currentTime();return new Date(t)});selectedInThisItem=y(()=>this.item().students.length);remainingSelectableSpots=y(()=>{let t=this.availableSpots(),e=this.selectedInOtherItems(),n=this.selectedInThisItem();return Math.max(0,t-e-n)});isAtCapacity=y(()=>this.remainingSelectableSpots()===0);itemSubtotal=y(()=>{let t=this.item(),e=t.students.length;if(e===0)return 0;let n=t.class.basePrice;return t.options.lunch&&(n+=t.class.lunchPrice),t.options.extendedCare&&(n+=t.class.extendedCarePrice),n*e});isStudentSelected(t){return this.item().students.some(e=>e.id===t)}calculateStudentAge(t){let e=this.serverTime().toISOString().split("T")[0];return ae(t,e)}isStudentEligible(t){let e=this.configService.config();if(!e)return!1;let n=re(e.currentActiveYear);return se(t.dob,n)}isStudentRegistered(t){return this.registeredStudentIds().includes(t)}isCapacityBlocked(t){return this.isStudentSelected(t)?!1:this.remainingSelectableSpots()===0}isStudentSelectable(t){return this.isStudentEligible(t)&&!this.isStudentRegistered(t.id)&&!this.isCapacityBlocked(t.id)}onStudentToggle(t){this.studentToggle.emit({id:this.item().id,student:t})}toggleLunch(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{lunch:!this.item().options.lunch}})}toggleExtendedCare(){this.item().students.length!==0&&this.optionsChange.emit({id:this.item().id,options:{extendedCare:!this.item().options.extendedCare}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-item"]],inputs:{item:[1,"item"],students:[1,"students"],registeredStudentIds:[1,"registeredStudentIds"],availableSpots:[1,"availableSpots"],selectedInOtherItems:[1,"selectedInOtherItems"]},outputs:{remove:"remove",optionsChange:"optionsChange",studentToggle:"studentToggle"},decls:61,vars:22,consts:[[1,"cart-item"],[1,"section-header"],[1,"class-info"],[1,"class-name"],[1,"class-dates"],["width","14","height","14","viewBox","0 0 24 24","fill","currentColor"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"],["aria-label","Remove",1,"btn-remove",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"],[1,"section-student"],[1,"section-label"],["width","16","height","16","viewBox","0 0 24 24","fill","currentColor"],["d","M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"],[1,"required-badge"],[1,"selected-count"],[1,"spots-info",3,"at-capacity"],[1,"no-students-message"],[1,"student-checkboxes"],[1,"section-addons"],["d","M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"],[1,"locked-tag"],[1,"optional-tag"],[1,"addon-grid"],[1,"addon-card",3,"click","disabled"],[1,"addon-icon"],[1,"addon-info"],[1,"addon-name"],[1,"addon-price"],[1,"addon-toggle"],[1,"toggle-track"],[1,"toggle-thumb"],[1,"section-total"],[1,"total-row"],[1,"total-label"],[1,"total-value"],[1,"spots-info"],[1,"student-checkbox",3,"selected","ineligible","registered","capacity-blocked"],[1,"student-checkbox"],["type","checkbox",3,"change","checked","disabled"],[1,"checkbox-mark"],["d","M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"],[1,"chip-avatar"],[1,"chip-content"],[1,"chip-name"],[1,"chip-age"],[1,"chip-registered"],[1,"chip-ineligible"],[1,"chip-full"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"section",1)(2,"div",2)(3,"h4",3),r(4),c(),s(5,"div",4),v(),s(6,"svg",5),k(7,"path",6),c(),h(),s(8,"span"),r(9),c()()(),s(10,"button",7),M("click",function(){return n.remove.emit(n.item().id)}),v(),s(11,"svg",8),k(12,"path",9),c()()(),h(),s(13,"section",10)(14,"div",11),v(),s(15,"svg",12),k(16,"path",13),c(),h(),s(17,"span"),r(18,"Select Students"),c(),g(19,De,2,0,"span",14)(20,Te,2,1,"span",15),g(21,Ne,2,3,"span",16),c(),g(22,ze,3,0,"div",17)(23,We,3,0,"div",18),c(),s(24,"section",19)(25,"div",11),v(),s(26,"svg",12),k(27,"path",20),c(),h(),s(28,"span"),r(29,"Add-ons"),c(),g(30,je,2,0,"span",21)(31,Be,2,0,"span",22),c(),s(32,"div",23)(33,"button",24),M("click",function(){return n.toggleLunch()}),s(34,"div",25),r(35,"\u{1F371}"),c(),s(36,"div",26)(37,"span",27),r(38,"Lunch"),c(),s(39,"span",28),r(40),c()(),s(41,"div",29)(42,"span",30),k(43,"span",31),c()()(),s(44,"button",24),M("click",function(){return n.toggleExtendedCare()}),s(45,"div",25),r(46,"\u23F0"),c(),s(47,"div",26)(48,"span",27),r(49,"Extended Care"),c(),s(50,"span",28),r(51),c()(),s(52,"div",29)(53,"span",30),k(54,"span",31),c()()()()(),s(55,"section",32)(56,"div",33)(57,"span",34),g(58,Ae,1,1)(59,He,1,0),c(),g(60,Je,2,1,"span",35),c()()()),e&2&&(R("needs-student",n.item().students.length===0),a(4),S(n.item().class.name),a(5),S(n.formatDateRange(n.item().class.startDate,n.item().class.endDate)),a(10),f(n.item().students.length===0?19:20),a(2),f(n.availableSpots()<n.Infinity?21:-1),a(),f(n.students().length===0?22:23),a(2),R("disabled",n.item().students.length===0)("locked",n.addonsLocked()),a(6),f(n.addonsLocked()?30:31),a(3),R("active",n.item().options.lunch),L("disabled",n.item().students.length===0||n.addonsLocked()),a(7),I("+",n.formatPrice(n.item().class.lunchPrice),"/person"),a(4),R("active",n.item().options.extendedCare),L("disabled",n.item().students.length===0||n.addonsLocked()),a(7),I("+",n.formatPrice(n.item().class.extendedCarePrice),"/person"),a(7),f(n.item().students.length>0?58:59),a(2),f(n.item().students.length>0?60:-1))},dependencies:[T,B],styles:[".cart-item[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;overflow:hidden;display:flex;flex-direction:column}.cart-item.needs-student[_ngcontent-%COMP%]{border-color:var(--color-warning, #ff9800)}section[_ngcontent-%COMP%]{padding:1rem}section[_ngcontent-%COMP%] + section[_ngcontent-%COMP%]{border-top:1px solid var(--sys-outline-variant, #f0f0f0)}.section-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666);margin-bottom:.75rem}.section-label[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666)}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem;background:var(--sys-surface-variant, #f5f5f5)}.class-info[_ngcontent-%COMP%]{flex:1}.class-name[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1rem;font-weight:600;color:var(--sys-on-surface, #212121)}.class-dates[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-remove[_ngcontent-%COMP%]{background:none;border:none;padding:.375rem;cursor:pointer;color:var(--sys-on-surface-variant, #666);border-radius:50%;transition:all .2s ease}.btn-remove[_ngcontent-%COMP%]:hover{background-color:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.required-badge[_ngcontent-%COMP%]{background:var(--color-warning, #ff9800);color:#fff;font-size:.6875rem;padding:.125rem .5rem;border-radius:4px;font-weight:600}.selected-count[_ngcontent-%COMP%]{font-size:.75rem;padding:.125rem .5rem;background:var(--sys-primary-container, #ffebee);color:var(--sys-primary, #c62828);border-radius:4px;font-weight:600}.spots-info[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2);border-radius:4px;margin-left:auto}.spots-info.at-capacity[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828)}.no-students-message[_ngcontent-%COMP%]{padding:.75rem;text-align:center;color:var(--sys-on-surface-variant, #666);font-size:.875rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:8px}.student-checkboxes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.student-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:#fff;border:2px solid var(--sys-outline, #e0e0e0);border-radius:12px;cursor:pointer;transition:all .2s ease}.student-checkbox[_ngcontent-%COMP%]:hover:not(.ineligible):not(.registered):not(.capacity-blocked){border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.student-checkbox.selected[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffcdd2)}.student-checkbox.ineligible[_ngcontent-%COMP%], .student-checkbox.capacity-blocked[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.student-checkbox.registered[_ngcontent-%COMP%]{opacity:.7;cursor:not-allowed;background:var(--sys-tertiary-container, #e3f2fd);border-color:var(--sys-tertiary, #1976d2)}.student-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.checkbox-mark[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s ease;background:#fff}.checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:0;color:#fff;transition:opacity .2s ease}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828)}.student-checkbox.selected[_ngcontent-%COMP%]   .checkbox-mark[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{opacity:1}.chip-avatar[_ngcontent-%COMP%]{font-size:1.25rem}.chip-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;text-align:left;flex:1}.chip-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121);line-height:1.2}.chip-age[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.chip-ineligible[_ngcontent-%COMP%], .chip-full[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:4px;white-space:nowrap}.chip-full[_ngcontent-%COMP%]{background:var(--sys-outline, #9e9e9e);color:#fff;font-weight:600}.chip-registered[_ngcontent-%COMP%]{font-size:.6875rem;padding:.25rem .5rem;background:var(--sys-tertiary, #1976d2);color:#fff;border-radius:4px;white-space:nowrap;font-weight:600}.section-addons.disabled[_ngcontent-%COMP%]{opacity:.5}.section-addons.locked[_ngcontent-%COMP%]{opacity:.7}.optional-tag[_ngcontent-%COMP%], .locked-tag[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .5rem;background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666);border-radius:4px}.locked-tag[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.addon-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.75rem}.addon-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all .2s ease;font-family:inherit;text-align:left}.addon-card[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--sys-outline, #e0e0e0);background:#fff}.addon-card.active[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.addon-card[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.addon-icon[_ngcontent-%COMP%]{font-size:1.5rem;flex-shrink:0}.addon-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.addon-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121)}.addon-price[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.addon-toggle[_ngcontent-%COMP%]{flex-shrink:0}.toggle-track[_ngcontent-%COMP%]{display:block;width:36px;height:20px;background:var(--sys-outline, #e0e0e0);border-radius:10px;position:relative;transition:background .2s ease}.addon-card.active[_ngcontent-%COMP%]   .toggle-track[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828)}.toggle-thumb[_ngcontent-%COMP%]{display:block;width:16px;height:16px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:transform .2s ease;box-shadow:0 1px 3px #0003}.addon-card.active[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(16px)}.section-total[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5)}.total-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.total-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.total-value[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:var(--sys-primary, #c62828)}@media(max-width:480px){.addon-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})},G=class o{summary=u(null);loading=u(!1);error=u(null);checkoutLoading=u(!1);checkoutDisabled=u(!1);couponCredit=u(0);checkout=P();priceBreakdownData=y(()=>{let t=this.summary();return t?{pricing:t.pricing,couponCredit:this.couponCredit(),totalPaid:t.totalPaid,totalRefunded:t.totalRefunded,amountDue:t.amountDue}:null});static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-summary"]],inputs:{summary:[1,"summary"],loading:[1,"loading"],error:[1,"error"],checkoutLoading:[1,"checkoutLoading"],checkoutDisabled:[1,"checkoutDisabled"],couponCredit:[1,"couponCredit"]},outputs:{checkout:"checkout"},decls:8,vars:2,consts:[[1,"cart-summary"],[1,"summary-title"],[1,"loading-state"],[1,"error-state"],[3,"data"],[1,"empty-state"],[1,"btn-checkout",3,"disabled"],[1,"spinner"],["width","20","height","20","viewBox","0 0 24 24","fill","currentColor"],["d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"],[1,"btn-checkout",3,"click","disabled"],[1,"spinner-small"],["d","M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"h3",1),r(2,"Order Summary"),l(),g(3,$e,4,0,"div",2)(4,Ge,5,1,"div",3)(5,qe,1,1,"app-price-breakdown",4)(6,Ue,3,0,"div",5),g(7,Ke,3,2,"button",6),l()),e&2&&(a(3),f(n.loading()?3:n.error()?4:n.priceBreakdownData()?5:6),a(4),f(n.summary()&&!n.loading()?7:-1))},dependencies:[T,be],styles:[".cart-summary[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.summary-title[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--sys-on-surface, #212121)}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.error-state[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.spinner-small[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.btn-checkout[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:12px;padding:1rem 1.5rem;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease;margin-top:.5rem}.btn-checkout[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c);transform:translateY(-1px);box-shadow:0 4px 12px #c628284d}.btn-checkout[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);cursor:not-allowed}"]})},q=class o{formatPrice=j;seasonCoupons=u([]);userCoupons=u([]);selectedCouponIds=u([]);loading=u(!1);validating=u(!1);couponError=u(null);couponSuccess=u(null);toggleCoupon=P();addCoupon=P();couponCode="";isCouponSelected(t){return this.selectedCouponIds().includes(t)}totalCredit=y(()=>{let t=this.seasonCoupons().reduce((n,i)=>n+i.maxCreditCents,0),e=this.userCoupons().filter(n=>this.isCouponSelected(n.id)).reduce((n,i)=>n+i.maxCreditCents,0);return t+e});onAddCoupon(){let t=this.couponCode.trim();t&&(this.addCoupon.emit(t),this.couponCode="")}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-coupon-section"]],inputs:{seasonCoupons:[1,"seasonCoupons"],userCoupons:[1,"userCoupons"],selectedCouponIds:[1,"selectedCouponIds"],loading:[1,"loading"],validating:[1,"validating"],couponError:[1,"couponError"],couponSuccess:[1,"couponSuccess"]},outputs:{toggleCoupon:"toggleCoupon",addCoupon:"addCoupon"},decls:16,vars:7,consts:[[1,"coupon-section"],[1,"coupon-title"],["width","18","height","18","viewBox","0 0 24 24","fill","currentColor"],["d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"],[1,"coupon-input-section"],[1,"coupon-input-row"],["type","text","placeholder","Enter coupon code",1,"coupon-input",3,"ngModelChange","keydown.enter","ngModel","disabled"],[1,"btn-add-coupon",3,"click","disabled"],[1,"spinner-small"],[1,"coupon-error"],[1,"coupon-success"],[1,"loading-state"],[1,"spinner"],[1,"coupon-list"],[1,"coupon-item","season-coupon"],[1,"coupon-item","user-coupon",3,"selected"],[1,"total-credit"],[1,"coupon-checkbox"],[1,"check-icon"],[1,"coupon-details"],[1,"coupon-name"],[1,"coupon-description"],[1,"coupon-credit"],[1,"credit-value"],[1,"auto-applied"],[1,"coupon-item","user-coupon"],["type","checkbox",3,"change","checked"],[1,"coupon-type-badge","student-credit"],[1,"credit-note"],[1,"total-label"],[1,"total-value"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"h4",1),v(),d(2,"svg",2),x(3,"path",3),l(),h(),d(4,"span"),r(5,"Coupons & Credits"),l()(),d(6,"div",4)(7,"div",5)(8,"input",6),te("ngModelChange",function(p){return ee(n.couponCode,p)||(n.couponCode=p),p}),E("keydown.enter",function(){return n.onAddCoupon()}),l(),d(9,"button",7),E("click",function(){return n.onAddCoupon()}),g(10,Qe,1,0,"span",8)(11,Ze,1,0),l()(),g(12,et,2,1,"div",9),g(13,tt,2,1,"div",10),l(),g(14,nt,4,0,"div",11)(15,dt,6,1),l()),e&2&&(a(8),Z("ngModel",n.couponCode),b("disabled",n.validating()),a(),b("disabled",!n.couponCode.trim()||n.validating()),a(),f(n.validating()?10:11),a(2),f(n.couponError()?12:-1),a(),f(n.couponSuccess()?13:-1),a(),f(n.loading()?14:15))},dependencies:[T,B,ye,ve,he],styles:[".coupon-section[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1rem}.coupon-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0 0 1rem;font-size:.9375rem;font-weight:600;color:var(--sys-on-surface, #212121)}.coupon-title[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828)}.coupon-input-section[_ngcontent-%COMP%]{margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px dashed var(--sys-outline-variant, #e0e0e0)}.coupon-input-row[_ngcontent-%COMP%]{display:flex;gap:.5rem}.coupon-input[_ngcontent-%COMP%]{flex:1;padding:.625rem .875rem;border:2px solid var(--sys-outline, #e0e0e0);border-radius:8px;font-size:.875rem;font-family:inherit;transition:border-color .2s ease}.coupon-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--sys-primary, #c62828)}.coupon-input[_ngcontent-%COMP%]:disabled{background:var(--sys-surface-variant, #f5f5f5);cursor:not-allowed}.btn-add-coupon[_ngcontent-%COMP%]{padding:.625rem 1rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease;min-width:60px;display:flex;align-items:center;justify-content:center}.btn-add-coupon[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-add-coupon[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #e0e0e0);color:var(--sys-on-surface-variant, #666);cursor:not-allowed}.spinner-small[_ngcontent-%COMP%]{width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}.coupon-error[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem .75rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);font-size:.8125rem;border-radius:6px}.coupon-success[_ngcontent-%COMP%]{margin-top:.5rem;padding:.5rem .75rem;background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32);font-size:.8125rem;border-radius:6px}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;color:var(--sys-on-surface-variant, #666);font-size:.8125rem}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.coupon-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.coupon-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border:2px solid transparent;border-radius:10px;transition:all .2s ease}.coupon-item.season-coupon[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9)}.coupon-item.user-coupon[_ngcontent-%COMP%]{cursor:pointer}.coupon-item.user-coupon[_ngcontent-%COMP%]:hover{border-color:var(--sys-primary, #c62828)}.coupon-item.selected[_ngcontent-%COMP%]{border-color:var(--sys-primary, #c62828);background:var(--sys-primary-container, #ffebee)}.coupon-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.coupon-checkbox[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--sys-outline, #e0e0e0);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:#fff;transition:all .2s ease}.season-coupon[_ngcontent-%COMP%]   .coupon-checkbox[_ngcontent-%COMP%]{background:var(--sys-secondary, #2e7d32);border-color:var(--sys-secondary, #2e7d32)}.user-coupon.selected[_ngcontent-%COMP%]   .coupon-checkbox[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828)}.check-icon[_ngcontent-%COMP%]{color:#fff;font-size:.75rem;font-weight:700;opacity:0;transition:opacity .2s ease}.season-coupon[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%], .user-coupon.selected[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%]{opacity:1}.coupon-details[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.coupon-name[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:var(--sys-on-surface, #212121)}.coupon-description[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.coupon-credit[_ngcontent-%COMP%]{text-align:right;display:flex;flex-direction:column;align-items:flex-end;gap:.125rem}.credit-value[_ngcontent-%COMP%]{font-size:.9375rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}.auto-applied[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--sys-on-secondary-container, #1b5e20);background:var(--sys-secondary, #2e7d32);color:#fff;padding:.125rem .375rem;border-radius:4px}.coupon-type-badge[_ngcontent-%COMP%]{font-size:.6875rem;padding:.125rem .375rem;border-radius:4px;margin-top:.25rem;width:fit-content}.coupon-type-badge.student-credit[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.credit-note[_ngcontent-%COMP%]{font-size:.6875rem;color:var(--sys-on-surface-variant, #666)}.total-credit[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:.75rem;padding-top:.75rem;border-top:1px dashed var(--sys-outline-variant, #e0e0e0)}.total-label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666)}.total-value[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}"]})},U=class o{formatPrice=j;discountPerEmail=2e3;value=u("");emailCount=u(0);referralEmailsChange=P();onInput(t){let e=t.target.value;this.referralEmailsChange.emit(e)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["cart-referral-section"]],inputs:{value:[1,"value"],emailCount:[1,"emailCount"]},outputs:{referralEmailsChange:"referralEmailsChange"},decls:10,vars:3,consts:[[1,"referral-section"],[1,"referral-title"],[1,"referral-hint"],["placeholder",`friend1@example.com
friend2@example.com`,"rows","3",1,"referral-input",3,"input","value"],[1,"referral-summary"],[1,"referral-count"],[1,"referral-discount"]],template:function(e,n){e&1&&(s(0,"div",0)(1,"h4",1)(2,"span"),r(3,"\u{1F44B}"),c(),s(4,"span"),r(5,"Refer a Friend"),c()(),s(6,"p",2),r(7),c(),s(8,"textarea",3),M("input",function(p){return n.onInput(p)}),c(),g(9,ct,5,3,"div",4),c()),e&2&&(a(7),I(" Enter your friends' email addresses (one per line). Both you and your friend get a ",n.formatPrice(n.discountPerEmail)," discount \u2014 as long as both attend the camp! "),a(),L("value",n.value()),a(),f(n.emailCount()>0?9:-1))},dependencies:[T,B],styles:[".referral-section[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1rem}.referral-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0 0 .5rem;font-size:.9375rem;font-weight:600;color:var(--sys-on-surface, #212121)}.referral-hint[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.8125rem;color:var(--sys-on-surface-variant, #666);line-height:1.4}.referral-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .875rem;border:2px solid var(--sys-outline, #e0e0e0);border-radius:8px;font-size:.875rem;font-family:inherit;resize:vertical;transition:border-color .2s ease;box-sizing:border-box}.referral-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--sys-primary, #c62828)}.referral-input[_ngcontent-%COMP%]::placeholder{color:var(--sys-on-surface-variant, #999)}.referral-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:.75rem;padding-top:.75rem;border-top:1px dashed var(--sys-outline-variant, #e0e0e0)}.referral-count[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--sys-on-surface-variant, #666)}.referral-discount[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}"]})},Y=class o{show=u(!1);failedItems=u([]);joiningWaitlist=u(!1);currentJoiningItem=u(null);hasRemainingItems=u(!1);waitlistSessionIds=u(new Set);close=P();joinWaitlist=P();continueWithRemaining=P();isJoiningWaitlistFor(t){let e=this.currentJoiningItem();return e!==null&&e.sessionId===t.sessionId&&e.studentId===t.studentId}isAlreadyOnWaitlist(t){return this.waitlistSessionIds().has(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["capacity-error-dialog"]],inputs:{show:[1,"show"],failedItems:[1,"failedItems"],joiningWaitlist:[1,"joiningWaitlist"],currentJoiningItem:[1,"currentJoiningItem"],hasRemainingItems:[1,"hasRemainingItems"],waitlistSessionIds:[1,"waitlistSessionIds"]},outputs:{close:"close",joinWaitlist:"joinWaitlist",continueWithRemaining:"continueWithRemaining"},decls:1,vars:1,consts:[[1,"dialog-overlay"],[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],[1,"dialog-header"],["width","24","height","24","viewBox","0 0 24 24","fill","currentColor",1,"warning-icon"],["d","M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"],[1,"dialog-message"],[1,"failed-items"],[1,"failed-item"],[1,"dialog-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary"],[1,"failed-item-details"],[1,"class-name"],[1,"student-name"],[1,"already-on-waitlist"],[1,"btn-waitlist",3,"disabled"],[1,"btn-waitlist",3,"click","disabled"],[1,"spinner"],[1,"btn-primary",3,"click"]],template:function(e,n){e&1&&g(0,_t,16,1,"div",0),e&2&&f(n.show()?0:-1)},dependencies:[T],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.dialog-content[_ngcontent-%COMP%]{background:#fff;border-radius:16px;max-width:500px;width:100%;padding:1.5rem;box-shadow:0 8px 32px #0003}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem}.dialog-header[_ngcontent-%COMP%]   .warning-icon[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--sys-on-surface, #212121)}.dialog-message[_ngcontent-%COMP%]{margin:0 0 1.5rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem;line-height:1.5}.failed-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.failed-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;padding:.75rem 1rem;background:var(--sys-error-container, #ffebee);border-radius:8px}.failed-item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-on-surface, #212121)}.student-name[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-on-surface-variant, #666)}.btn-waitlist[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.5rem 1rem;font-size:.8125rem;font-weight:600;cursor:pointer;white-space:nowrap;min-width:100px;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.btn-waitlist[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-waitlist[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.already-on-waitlist[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-tertiary, #1976d2);font-weight:500;padding:.5rem 1rem;background:var(--sys-tertiary-container, #e3f2fd);border-radius:8px;white-space:nowrap}.spinner[_ngcontent-%COMP%]{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end}.btn-secondary[_ngcontent-%COMP%]{background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;padding:.75rem 1.5rem;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}"]})};var yt=(o,t)=>t.id,vt=(o,t)=>t.sessionId;function ht(o,t){if(o&1){let e=D();d(0,"cart-empty",4),E("browse",function(){C(e);let i=m();return _(i.browseCatalog())}),l()}}function bt(o,t){if(o&1&&x(0,"app-class-registration-card",20),o&2){let e=t.$implicit;b("data",e)("showGroupStatus",!0)("showStudentStatus",e.status==="mixed")}}function xt(o,t){if(o&1&&(d(0,"section",6)(1,"h2"),r(2,"Your Confirmed Registrations"),l(),d(3,"div",19),F(4,bt,1,3,"app-class-registration-card",20,vt),l()()),o&2){let e=m(2);a(4),V(e.confirmedRegistrations())}}function St(o,t){if(o&1){let e=D();d(0,"cart-item",21),E("remove",function(i){C(e);let p=m(2);return _(p.onRemove(i))})("optionsChange",function(i){C(e);let p=m(2);return _(p.onOptionsChange(i))})("studentToggle",function(i){C(e);let p=m(2);return _(p.onStudentToggle(i))}),l()}if(o&2){let e=t.$implicit,n=m(2);b("item",e)("students",n.students())("registeredStudentIds",n.getRegisteredStudentIds(e.class.id))("availableSpots",n.getAvailableSpots(e.class.id))("selectedInOtherItems",n.getSelectedInOtherItems(e.class.id,e.id))}}function Et(o,t){o&1&&(d(0,"div",17),r(1," Please select students for all classes before checkout "),l())}function Mt(o,t){if(o&1){let e=D();x(0,"cart-warning-banner",5),g(1,xt,6,0,"section",6),d(2,"div",7)(3,"div",8),F(4,St,1,5,"cart-item",9,yt),d(6,"button",10),E("click",function(){C(e);let i=m();return _(i.clearCart())}),v(),d(7,"svg",11),x(8,"path",12),l(),r(9," Clear Cart "),l()(),h(),d(10,"aside",13)(11,"cart-coupon-section",14),E("toggleCoupon",function(i){C(e);let p=m();return _(p.onToggleCoupon(i))})("addCoupon",function(i){C(e);let p=m();return _(p.onAddCoupon(i))}),l(),d(12,"cart-referral-section",15),E("referralEmailsChange",function(i){C(e);let p=m();return _(p.onReferralEmailsChange(i))}),l(),d(13,"cart-summary",16),E("checkout",function(){C(e);let i=m();return _(i.onCheckout())}),l(),g(14,Et,2,0,"div",17),d(15,"div",18)(16,"h4"),r(17,"Important Info"),l(),d(18,"ul")(19,"li"),r(20,"After submitting, your spots are reserved for 48 hours"),l(),d(21,"li"),r(22,"Please complete payment within 48 hours"),l(),d(23,"li"),r(24,"Spots are confirmed once payment is received"),l()()()()()}if(o&2){let e=m();b("showNoStudents",e.students().length===0)("itemsMissingStudents",e.store.itemsMissingStudentsCount())("showProfileIncomplete",!e.userService.isProfileComplete()),a(),f(e.hasConfirmedRegistrations()?1:-1),a(3),V(e.store.items()),a(7),b("seasonCoupons",e.store.seasonCoupons())("userCoupons",e.store.userCoupons())("selectedCouponIds",e.store.selectedCouponIds())("loading",e.store.couponsLoading())("validating",e.store.couponsValidating())("couponError",e.store.couponValidationError())("couponSuccess",e.store.couponValidationSuccess()),a(),b("value",e.store.referralEmailsRaw())("emailCount",e.store.referralEmailCount()),a(),b("summary",e.financialSummary())("loading",e.store.pricingLoading())("error",e.store.pricingError())("checkoutLoading",e.store.submitting())("checkoutDisabled",e.isCheckoutDisabled())("couponCredit",e.store.totalCouponCredit()),a(),f(e.store.allStudentsAssigned()?-1:14)}}var Se=class o{store=N(_e);router=N(oe);userService=N(me);orderService=N(le);registrationService=N(pe);impersonationService=N(de);students=this.userService.students;orderItems=this.orderService.items;_capacityFailedItems=W([]);_joiningWaitlist=W(!1);_currentJoiningItem=W(null);capacityFailedItems=this._capacityFailedItems.asReadonly();joiningWaitlist=this._joiningWaitlist.asReadonly();currentJoiningItem=this._currentJoiningItem.asReadonly();showCapacityErrorDialog=y(()=>this._capacityFailedItems().length>0);hasRemainingItems=y(()=>{let t=this._capacityFailedItems(),e=this.store.items();if(t.length===0||e.length===0)return!1;let n=new Set(t.map(p=>`${p.sessionId}:${p.studentId}`)),i=0;for(let p of e)for(let w of p.students)n.has(`${p.class.id}:${w.id}`)||i++;return i>0});waitlistSessionIds=y(()=>new Set(this.orderService.waitlistEntries().map(t=>t.sessionId)));registeredStudentsByClass=y(()=>{let t=this.orderItems(),e=new Map;for(let n of t)if(n.status==="submitted"||n.status==="paid"){let i=e.get(n.sessionId)||[];i.includes(n.studentId)||i.push(n.studentId),e.set(n.sessionId,i)}return e});getRegisteredStudentIds(t){return this.registeredStudentsByClass().get(t)||[]}confirmedRegistrations=y(()=>{let t=this.orderItems();if(t.length===0)return[];let e=new Map;for(let n of t){if(n.status!=="submitted"&&n.status!=="paid")continue;let i=e.get(n.sessionId);i||(i={sessionId:n.sessionId,className:n.snapshot.className,startDate:n.snapshot.startDate,endDate:n.snapshot.endDate,status:n.status,students:[]},e.set(n.sessionId,i)),i.status!==n.status&&i.status!=="mixed"&&(i.status="mixed"),i.students.push({studentId:n.studentId,studentName:this.userService.getStudentById(n.studentId)?.fullName??"Unknown",status:n.status,options:n.options})}return Array.from(e.values()).sort((n,i)=>n.startDate.localeCompare(i.startDate))});hasConfirmedRegistrations=y(()=>this.confirmedRegistrations().length>0);availableSpotsByClass=y(()=>{let t=new Map;for(let e of this.store.items()){let n=e.class;if(!t.has(n.id)){let i;e.isWaitlistClaim?i=this.orderService.waitlistEntriesWithEligibility().find(w=>w.sessionId===n.id)?.claimableSpots??0:i=this.registrationService.getPublicAvailableSpots(n),t.set(n.id,Math.max(0,i))}}return t});getAvailableSpots(t){return this.impersonationService.adminBypassEnabled()?1/0:this.availableSpotsByClass().get(t)??1/0}getSelectedInOtherItems(t,e){let n=0;for(let i of this.store.items())i.class.id===t&&i.id!==e&&(n+=i.students.length);return n}financialSummary=y(()=>{let t=this.store.pricing();if(!t)return null;let e=t.discounts.reduce((w,z)=>w+z.amount,0),n=Math.max(0,t.subtotal+e),i=this.store.totalCouponCredit(),p=Math.max(0,n-i);return{pricing:t,totalPaid:0,totalRefunded:0,amountDue:p}});isCheckoutDisabled=y(()=>this.store.pricingLoading()||this.store.submitting()||!this.store.pricing()||!this.store.allStudentsAssigned()||!this.userService.isProfileComplete());async ngOnInit(){if(!this.userService.currentUser()){this.router.navigate(["/login"]);return}this.store.hasItems()&&await this.store.loadCoupons()}goBack(){history.back()}browseCatalog(){this.router.navigate(["/"])}onRemove(t){this.store.removeFromCart(t)}onOptionsChange(t){this.store.updateItemOptions(t.id,t.options)}onStudentToggle(t){try{this.store.toggleStudent(t.id,t.student)}catch(e){console.error("Failed to toggle student:",e)}}clearCart(){confirm("Are you sure you want to clear the cart?")&&this.store.clearCart()}onToggleCoupon(t){this.store.toggleCoupon(t)}onAddCoupon(t){this.store.validateAndAddCoupon(t)}onReferralEmailsChange(t){this.store.setReferralEmails(t)}async onCheckout(){try{await this.store.submit(),this.router.navigate(["/orders"])}catch(t){if(ge(t)){let e=fe(t);e.length===0&&(e=this.buildFailedItemsFromError(t)),this._capacityFailedItems.set(e)}else console.error("Checkout failed:",t)}}buildFailedItemsFromError(t){let n=Ce(t).match(/Class\s+(CL-\d+)\s+is full/i);if(!n){let w=[];for(let z of this.store.items())for(let K of z.students)w.push({sessionId:z.class.id,studentId:K.id,className:z.class.name,studentName:K.fullName});return w}let i=n[1],p=[];for(let w of this.store.items())if(w.class.id===i)for(let z of w.students)p.push({sessionId:i,studentId:z.id,className:w.class.name,studentName:z.fullName});return p}closeCapacityDialog(){this._capacityFailedItems.set([])}async joinWaitlistForItem(t){this._joiningWaitlist.set(!0),this._currentJoiningItem.set(t);try{await this.orderService.joinWaitlist(t.sessionId),this.handleWaitlistJoinSuccess(t.sessionId)}catch(e){this.isAlreadyOnWaitlistError(e)?this.handleWaitlistJoinSuccess(t.sessionId):console.error("Failed to join waitlist:",e)}finally{this._joiningWaitlist.set(!1),this._currentJoiningItem.set(null)}}isAlreadyOnWaitlistError(t){return!t||typeof t!="object"?!1:t.error?.status==="ALREADY_EXISTS"}handleWaitlistJoinSuccess(t){let e=this._capacityFailedItems().filter(n=>n.sessionId!==t);this._capacityFailedItems.set(e);for(let n of this.store.items())if(n.class.id===t)for(let i of[...n.students])try{this.store.toggleStudent(n.id,i)}catch{}this.store.refreshPricing()}continueWithRemainingItems(){let t=this._capacityFailedItems(),e=new Set(t.map(n=>`${n.sessionId}:${n.studentId}`));for(let n of this.store.items())for(let i of n.students)if(e.has(`${n.class.id}:${i.id}`))try{this.store.toggleStudent(n.id,i)}catch{}this._capacityFailedItems.set([]),this.store.refreshPricing()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["app-cart-page"]],decls:6,vars:8,consts:[[1,"cart-page"],[3,"back","itemCount"],[1,"cart-content"],[3,"close","joinWaitlist","continueWithRemaining","show","failedItems","joiningWaitlist","currentJoiningItem","hasRemainingItems","waitlistSessionIds"],[3,"browse"],[3,"showNoStudents","itemsMissingStudents","showProfileIncomplete"],[1,"confirmed-section"],[1,"cart-layout"],[1,"cart-items"],[3,"item","students","registeredStudentIds","availableSpots","selectedInOtherItems"],[1,"btn-clear",3,"click"],["width","18","height","18","viewBox","0 0 24 24","fill","currentColor"],["d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"],[1,"cart-sidebar"],[3,"toggleCoupon","addCoupon","seasonCoupons","userCoupons","selectedCouponIds","loading","validating","couponError","couponSuccess"],[3,"referralEmailsChange","value","emailCount"],[3,"checkout","summary","loading","error","checkoutLoading","checkoutDisabled","couponCredit"],[1,"checkout-warning"],[1,"info-card"],[1,"confirmed-groups"],[3,"data","showGroupStatus","showStudentStatus"],[3,"remove","optionsChange","studentToggle","item","students","registeredStudentIds","availableSpots","selectedInOtherItems"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"cart-header",1),E("back",function(){return n.goBack()}),l(),d(2,"div",2),g(3,ht,1,0,"cart-empty")(4,Mt,25,20),l(),d(5,"capacity-error-dialog",3),E("close",function(){return n.closeCapacityDialog()})("joinWaitlist",function(p){return n.joinWaitlistForItem(p)})("continueWithRemaining",function(){return n.continueWithRemainingItems()}),l()()),e&2&&(a(),b("itemCount",n.store.itemCount()),a(2),f(n.store.isEmpty()?3:4),a(2),b("show",n.showCapacityErrorDialog())("failedItems",n.capacityFailedItems())("joiningWaitlist",n.joiningWaitlist())("currentJoiningItem",n.currentJoiningItem())("hasRemainingItems",n.hasRemainingItems())("waitlistSessionIds",n.waitlistSessionIds()))},dependencies:[T,A,H,J,$,G,Y,q,U,xe],styles:[".cart-page[_ngcontent-%COMP%]{min-height:100vh;background:var(--sys-surface, #fafafa)}.cart-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.cart-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 400px;gap:1.5rem;align-items:start}@media(max-width:768px){.cart-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.cart-sidebar[_ngcontent-%COMP%]{position:sticky;bottom:0;left:0;right:0;padding:1rem;background:#fff;border-top:1px solid var(--sys-outline, #e0e0e0);box-shadow:0 -4px 12px #0000001a}}.cart-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.btn-clear[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;background:none;border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;padding:.75rem 1rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;transition:all .2s ease}.btn-clear[_ngcontent-%COMP%]:hover{border-color:var(--sys-error, #c62828);color:var(--sys-error, #c62828);background:var(--sys-error-container, #ffebee)}.cart-sidebar[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;position:sticky;top:80px}.info-card[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);border-radius:12px;padding:1rem}.info-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;font-weight:600;color:var(--sys-on-tertiary-container, #01579b)}.info-card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 1.25rem;font-size:.8125rem;color:var(--sys-on-tertiary-container, #01579b);line-height:1.6}.info-card[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}.checkout-warning[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fff3e0;border:1px solid #ff9800;border-radius:8px;color:#e65100;font-size:.8125rem;text-align:center}.checkout-warning[_ngcontent-%COMP%]   .warning-link[_ngcontent-%COMP%]{color:#e65100;font-weight:600;text-decoration:underline}.checkout-warning[_ngcontent-%COMP%]   .warning-link[_ngcontent-%COMP%]:hover{color:#bf360c}.confirmed-section[_ngcontent-%COMP%]{margin-bottom:1.5rem;background:var(--sys-secondary-container, #e8f5e9);border-radius:12px;padding:1rem 1.25rem}.confirmed-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;font-weight:600;color:var(--sys-secondary, #2e7d32)}.confirmed-groups[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}"]})};export{Se as CartPageComponent};
