import{a as D,b as R}from"./chunk-RDKP2ZJK.js";import{b as A}from"./chunk-YUXLOB7R.js";import{a as L}from"./chunk-6B5SPXH3.js";import{d as W,k as I}from"./chunk-B4PSB7QN.js";import{Eb as n,Fb as c,Gb as C,Ia as s,R as y,Ta as O,W as g,X as p,a as P,b as E,bb as u,cb as v,fb as w,gb as S,ha as _,hb as M,ib as t,jb as i,kb as k,ob as x,qb as f,sb as d}from"./chunk-VKJSCVXY.js";var N=(l,r)=>r.userId+r.sessionId;function j(l,r){if(l&1){let e=x();t(0,"div",4),n(1),t(2,"button",8),f("click",function(){g(e);let a=d();return p(a.loadWaitlistEntries())}),n(3,"Retry"),i()()}if(l&2){let e=d();s(),C(" ",e.error()," ")}}function F(l,r){l&1&&(t(0,"div",5),k(1,"div",9),t(2,"p"),n(3,"Loading..."),i()())}function B(l,r){l&1&&(t(0,"div",6)(1,"div",10),n(2,"\u{1F4CB}"),i(),t(3,"h2"),n(4,"No Waitlist Entries"),i(),t(5,"p"),n(6,"No one is currently on any waitlist"),i()())}function U(l,r){if(l&1){let e=x();t(0,"tr",13)(1,"td",14),n(2),i(),t(3,"td",15)(4,"span",16),n(5),i(),t(6,"span",17),n(7),i()(),t(8,"td",18)(9,"span",19),n(10),i(),t(11,"span",20),n(12),i()(),t(13,"td",21),n(14),i(),t(15,"td",22)(16,"span",23),n(17,"On Waitlist"),i()(),t(18,"td",24)(19,"button",25),f("click",function(){let a=g(e).$implicit,h=d(2);return p(h.removeEntry(a))}),n(20," Remove "),i()()()}if(l&2){let e=r.$implicit,o=d(2);s(2),c(e.position),s(3),c(e.userName),s(2),c(e.userId),s(3),c(e.className),s(2),c(e.sessionId),s(2),C(" ",o.formatDate(e.joinedAt)," "),s(5),M("disabled",o.actionLoading())}}function Y(l,r){if(l&1&&(t(0,"div",11),n(1),i(),t(2,"div",12)(3,"table")(4,"thead")(5,"tr")(6,"th"),n(7,"#"),i(),t(8,"th"),n(9,"User"),i(),t(10,"th"),n(11,"Class"),i(),t(12,"th"),n(13,"Joined"),i(),t(14,"th"),n(15,"Status"),i(),t(16,"th"),n(17,"Actions"),i()()(),t(18,"tbody"),w(19,U,21,7,"tr",13,N),i()()()),l&2){let e=d();s(),C("Total ",e.entries().length," waitlist entries"),s(18),S(e.entries())}}function $(l,r){if(l&1){let e=x();t(0,"div",26),f("click",function(){g(e);let a=d();return p(a.closeRemoveDialog())}),t(1,"div",27),f("click",function(a){return g(e),p(a.stopPropagation())}),t(2,"h3"),n(3,"Remove Waitlist Entry"),i(),t(4,"p"),n(5," Remove "),t(6,"strong"),n(7),i(),n(8," from the waitlist for "),t(9,"strong"),n(10),i(),n(11,"? "),i(),t(12,"p",28),n(13," This will remove the user from the waitlist for this class. "),i(),t(14,"div",29)(15,"button",30),f("click",function(){g(e);let a=d();return p(a.closeRemoveDialog())}),n(16,"Cancel"),i(),t(17,"button",31),f("click",function(){g(e);let a=d();return p(a.confirmRemove())}),n(18),i()()()()}if(l&2){let e,o,a=d();s(7),c((e=a.selectedEntry())==null?null:e.userId),s(3),c((o=a.selectedEntry())==null?null:o.className),s(7),M("disabled",a.actionLoading()),s(),C(" ",a.actionLoading()?"Removing...":"Confirm Remove"," ")}}var z=class l{orderDatastore=y(D);orderRpc=y(R);configService=y(L);seasonService=y(A);_entries=_([]);_loading=_(!1);_error=_(null);_actionLoading=_(!1);_showRemoveDialog=_(!1);_selectedEntry=_(null);entries=this._entries.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();actionLoading=this._actionLoading.asReadonly();showRemoveDialog=this._showRemoveDialog.asReadonly();selectedEntry=this._selectedEntry.asReadonly();async ngOnInit(){await this.loadWaitlistEntries()}async loadWaitlistEntries(){this._loading.set(!0),this._error.set(null);try{let r=this.configService.currentActiveYear(),e=this.seasonService.selectedSeason();if(!e){this._entries.set([]),this._loading.set(!1);return}let o=await this.orderDatastore.listAllWaitlistEntries(r,e.id),a=new Map;for(let m of o){let b=a.get(m.sessionId)??[];b.push(m),a.set(m.sessionId,b)}let h=o.map(m=>{let T=(a.get(m.sessionId)??[]).findIndex(V=>V.userId===m.userId)+1;return E(P({},m),{position:T})});this._entries.set(h)}catch(r){let e=r instanceof Error?r.message:"Failed to load waitlist entries";this._error.set(e)}finally{this._loading.set(!1)}}removeEntry(r){this._selectedEntry.set(r),this._showRemoveDialog.set(!0)}closeRemoveDialog(){this._showRemoveDialog.set(!1),this._selectedEntry.set(null)}async confirmRemove(){let r=this._selectedEntry();if(r){this._actionLoading.set(!0);try{let e=this.configService.currentActiveYear(),o=this.seasonService.selectedSeason();if(!o)throw new Error("No season selected");await this.orderRpc.removeWaitlistEntry({year:e,seasonId:o.id,userAuthId:r.userId,sessionId:r.sessionId}),this.closeRemoveDialog(),await this.loadWaitlistEntries()}catch(e){let o=e instanceof Error?e.message:"Failed to remove entry";this._error.set(o)}finally{this._actionLoading.set(!1)}}}formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=O({type:l,selectors:[["app-admin-waitlist-list"]],decls:13,vars:5,consts:[[1,"admin-waitlist"],[1,"page-header"],["routerLink","/admin",1,"back-link"],[1,"subtitle"],[1,"error"],[1,"loading"],[1,"empty"],[1,"dialog-overlay"],[1,"btn","btn-sm",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"results-count"],[1,"entries-table"],[1,"waitlist-entry"],[1,"position"],[1,"user-info"],[1,"user-name"],[1,"user-id"],[1,"class-info"],[1,"class-name"],[1,"session-id"],[1,"join-date"],[1,"status"],[1,"badge","badge-pending"],[1,"actions"],[1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"dialog-overlay",3,"click"],[1,"dialog",3,"click"],[1,"dialog-note"],[1,"dialog-actions"],[1,"btn","btn-outline",3,"click"],[1,"btn","btn-danger",3,"click","disabled"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"header",1)(2,"a",2),n(3,"\u2190 Back to Console"),i(),t(4,"h1"),n(5,"Waitlist Management"),i(),t(6,"p",3),n(7,"View and manage waitlist entries"),i()(),u(8,j,4,1,"div",4),u(9,F,4,0,"div",5),u(10,B,7,0,"div",6),u(11,Y,21,1),u(12,$,19,4,"div",7),i()),e&2&&(s(8),v(o.error()?8:-1),s(),v(o.loading()?9:-1),s(),v(!o.loading()&&!o.error()&&o.entries().length===0?10:-1),s(),v(!o.loading()&&o.entries().length>0?11:-1),s(),v(o.showRemoveDialog()?12:-1))},dependencies:[W,I],styles:[".admin-waitlist[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-link[_ngcontent-%COMP%]{display:inline-block;color:var(--sys-primary, #c62828);text-decoration:none;font-size:.875rem;margin-bottom:.5rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.results-count[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{padding:1.5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.empty[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:var(--sys-on-surface-variant, #666)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.entries-table[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid var(--sys-outline-variant, #e0e0e0)}th[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);font-weight:600;font-size:.875rem;color:var(--sys-on-surface-variant, #666)}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.position[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-primary, #c62828)}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.user-name[_ngcontent-%COMP%]{font-weight:500}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.class-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:500}.session-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.join-date[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge-promoted[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32)}.badge-eligible[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.badge-pending[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666)}.promoted-text[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-secondary, #2e7d32)}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-outline[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);color:var(--sys-on-surface, #212121)}.btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5)}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.8125rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem}.dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--sys-on-surface-variant, #666)}.dialog-note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-tertiary, #1976d2)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--sys-outline-variant, #e0e0e0)}@media(max-width:768px){th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.6875rem}}"]})};export{z as AdminWaitlistListComponent};
