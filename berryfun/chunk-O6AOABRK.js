import{m as J}from"./chunk-AAZ7ILIH.js";import{S as K,T as X}from"./chunk-RLRP2YP4.js";import{I as V,N as R,Rb as v,da as x}from"./chunk-WXZFQYIJ.js";import{a as A,b as C}from"./chunk-Q7L6LLAK.js";var $=class S{functions=R(X);_loading=x(!1);_error=x(null);loading=this._loading.asReadonly();error=this._error.asReadonly();async createUser(i){return this.wrapApiCall("createUser",i)}async updateUser(i){return this.wrapApiCall("updateUser",i)}async createStudent(i){return this.wrapApiCall("addStudent",i)}async updateStudent(i){return this.wrapApiCall("updateStudent",i)}async deleteStudent(i){return this.wrapApiCall("deleteStudent",{studentId:i})}async getUserProfile(i){return this.wrapCall("getUserProfile",{uid:i})}async listAllUsers(i){return this.wrapCall("listAllUsers",{limit:i})}async searchUsers(i){return this.wrapCall("searchUsers",{query:i})}async getAdminUserDetails(i){return this.wrapCall("getAdminUserDetails",{uid:i})}async updateUserProfileAsAdmin(i,e){return this.wrapCall("updateUserProfile",{authId:i,updates:e})}clearError(){this._error.set(null)}async wrapCall(i,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.call(i,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async wrapApiCall(i,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.callApi(i,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}static \u0275fac=function(e){return new(e||S)};static \u0275prov=V({token:S,factory:S.\u0275fac,providedIn:"root"})};var te=["43dfed9d3bb5faee2c59afaf60e2f0ca","de4e8cbf34b00cba9a1122ee97ea3b00","57cef514bb4351a206f20053503648c9","33ccd328349ed0605d8ca291609c15da"];function se(S){function i(r,u){return r<<u|r>>>32-u}function e(r,u){let l=r&2147483648,f=u&2147483648,h=r&1073741824,U=u&1073741824,m=(r&1073741823)+(u&1073741823);return h&U?m^2147483648^l^f:h|U?m&1073741824?m^3221225472^l^f:m^1073741824^l^f:m^l^f}function d(r,u,l){return r&u|~r&l}function c(r,u,l){return r&l|u&~l}function _(r,u,l){return r^u^l}function z(r,u,l){return u^(r|~l)}function g(r,u,l,f,h,U,m){return r=e(r,e(e(d(u,l,f),h),m)),e(i(r,U),u)}function y(r,u,l,f,h,U,m){return r=e(r,e(e(c(u,l,f),h),m)),e(i(r,U),u)}function b(r,u,l,f,h,U,m){return r=e(r,e(e(_(u,l,f),h),m)),e(i(r,U),u)}function p(r,u,l,f,h,U,m){return r=e(r,e(e(z(u,l,f),h),m)),e(i(r,U),u)}function ee(r){let u,l=r.length,f=l+8,U=((f-f%64)/64+1)*16,m=new Array(U-1),k=0,w=0;for(;w<l;)u=(w-w%4)/4,k=w%4*8,m[u]=m[u]|r.charCodeAt(w)<<k,w++;return u=(w-w%4)/4,k=w%4*8,m[u]=m[u]|128<<k,m[U-2]=l<<3,m[U-1]=l>>>29,m}function P(r){let u="",l="",f,h;for(h=0;h<=3;h++)f=r>>>h*8&255,l="0"+f.toString(16),u=u+l.substring(l.length-2);return u}let o=ee(S),t=1732584193,s=4023233417,n=2562383102,a=271733878,M=7,D=12,E=17,q=22,N=5,T=9,G=14,I=20,L=4,B=11,H=16,W=23,F=6,Q=10,j=15,O=21;for(let r=0;r<o.length;r+=16){let u=t,l=s,f=n,h=a;t=g(t,s,n,a,o[r+0],M,3614090360),a=g(a,t,s,n,o[r+1],D,3905402710),n=g(n,a,t,s,o[r+2],E,606105819),s=g(s,n,a,t,o[r+3],q,3250441966),t=g(t,s,n,a,o[r+4],M,4118548399),a=g(a,t,s,n,o[r+5],D,1200080426),n=g(n,a,t,s,o[r+6],E,2821735955),s=g(s,n,a,t,o[r+7],q,4249261313),t=g(t,s,n,a,o[r+8],M,1770035416),a=g(a,t,s,n,o[r+9],D,2336552879),n=g(n,a,t,s,o[r+10],E,4294925233),s=g(s,n,a,t,o[r+11],q,2304563134),t=g(t,s,n,a,o[r+12],M,1804603682),a=g(a,t,s,n,o[r+13],D,4254626195),n=g(n,a,t,s,o[r+14],E,2792965006),s=g(s,n,a,t,o[r+15],q,1236535329),t=y(t,s,n,a,o[r+1],N,4129170786),a=y(a,t,s,n,o[r+6],T,3225465664),n=y(n,a,t,s,o[r+11],G,643717713),s=y(s,n,a,t,o[r+0],I,3921069994),t=y(t,s,n,a,o[r+5],N,3593408605),a=y(a,t,s,n,o[r+10],T,38016083),n=y(n,a,t,s,o[r+15],G,3634488961),s=y(s,n,a,t,o[r+4],I,3889429448),t=y(t,s,n,a,o[r+9],N,568446438),a=y(a,t,s,n,o[r+14],T,3275163606),n=y(n,a,t,s,o[r+3],G,4107603335),s=y(s,n,a,t,o[r+8],I,1163531501),t=y(t,s,n,a,o[r+13],N,2850285829),a=y(a,t,s,n,o[r+2],T,4243563512),n=y(n,a,t,s,o[r+7],G,1735328473),s=y(s,n,a,t,o[r+12],I,2368359562),t=b(t,s,n,a,o[r+5],L,4294588738),a=b(a,t,s,n,o[r+8],B,2272392833),n=b(n,a,t,s,o[r+11],H,1839030562),s=b(s,n,a,t,o[r+14],W,4259657740),t=b(t,s,n,a,o[r+1],L,2763975236),a=b(a,t,s,n,o[r+4],B,1272893353),n=b(n,a,t,s,o[r+7],H,4139469664),s=b(s,n,a,t,o[r+10],W,3200236656),t=b(t,s,n,a,o[r+13],L,681279174),a=b(a,t,s,n,o[r+0],B,3936430074),n=b(n,a,t,s,o[r+3],H,3572445317),s=b(s,n,a,t,o[r+6],W,76029189),t=b(t,s,n,a,o[r+9],L,3654602809),a=b(a,t,s,n,o[r+12],B,3873151461),n=b(n,a,t,s,o[r+15],H,530742520),s=b(s,n,a,t,o[r+2],W,3299628645),t=p(t,s,n,a,o[r+0],F,4096336452),a=p(a,t,s,n,o[r+7],Q,1126891415),n=p(n,a,t,s,o[r+14],j,2878612391),s=p(s,n,a,t,o[r+5],O,4237533241),t=p(t,s,n,a,o[r+12],F,1700485571),a=p(a,t,s,n,o[r+3],Q,2399980690),n=p(n,a,t,s,o[r+10],j,4293915773),s=p(s,n,a,t,o[r+1],O,2240044497),t=p(t,s,n,a,o[r+8],F,1873313359),a=p(a,t,s,n,o[r+15],Q,4264355552),n=p(n,a,t,s,o[r+6],j,2734768916),s=p(s,n,a,t,o[r+13],O,1309151649),t=p(t,s,n,a,o[r+4],F,4149444226),a=p(a,t,s,n,o[r+11],Q,3174756917),n=p(n,a,t,s,o[r+2],j,718787259),s=p(s,n,a,t,o[r+9],O,3951481745),t=e(t,u),s=e(s,l),n=e(n,f),a=e(a,h)}return(P(t)+P(s)+P(n)+P(a)).toLowerCase()}function Y(S){if(!S)return!1;let i=se(S.toLowerCase().trim());return te.includes(i)}var Z=class S{datastore=R(J);rpc=R($);impersonationService=R(K);_currentUser=x(null);_loading=x(!1);_error=x(null);_isAdmin=x(!1);_users=x([]);_selectedUser=x(null);_searchQuery=x("");_actionLoading=x(!1);_actionError=x(null);currentUser=v(()=>this.impersonationService.impersonatedUser()??this._currentUser());loading=this._loading.asReadonly();error=this._error.asReadonly();actualUser=this._currentUser.asReadonly();users=this._users.asReadonly();selectedUser=this._selectedUser.asReadonly();searchQuery=this._searchQuery.asReadonly();actionLoading=this._actionLoading.asReadonly();actionError=this._actionError.asReadonly();isAuthenticated=v(()=>this._currentUser()!==null);userCount=v(()=>this._users().length);hasUsers=v(()=>this._users().length>0);students=v(()=>this.currentUser()?.students??[]);studentCount=v(()=>this.students().length);hasStudents=v(()=>this.students().length>0);isProfileComplete=v(()=>{let i=this.currentUser();if(!i)return!1;let e=i.primaryGuardian;if(!e)return!1;let d=!!e.phone,c=!!e.wechatId,_=!!e.address?.street&&!!e.address?.city&&!!e.address?.state&&!!e.address?.zipCode,z=!!i.emergencyContact?.name&&!!i.emergencyContact?.phone&&!!i.emergencyContact?.relationship;return d&&c&&_&&z});isAdmin=v(()=>this._isAdmin()&&!this.impersonationService.isImpersonating());async createUser(i){this._loading.set(!0),this._error.set(null);try{return await this.rpc.createUser(i)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateProfile(i){this._loading.set(!0),this._error.set(null);try{let e=await this.rpc.updateUser({updates:i});this._currentUser.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}setCurrentUser(i){this._currentUser.set(i),i===null?this._isAdmin.set(!1):this._isAdmin.set(Y(i.email))}clearUser(){this._currentUser.set(null),this._isAdmin.set(!1)}clearError(){this._error.set(null)}getStudentById(i){return this.students().find(e=>e.id===i)}async createStudent(i){if(!this._currentUser())throw new Error("No current user");this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.createStudent(i);return this._currentUser.update(c=>c&&C(A({},c),{students:[...c.students??[],d]})),d}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async updateStudent(i,e){this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.updateStudent(A({studentId:i},e));this._currentUser.update(c=>c&&C(A({},c),{students:c.students?.map(_=>_.id===i?d:_)}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async deleteStudent(i){this._loading.set(!0),this._error.set(null);try{await this.rpc.deleteStudent(i),this._currentUser.update(e=>e&&C(A({},e),{students:e.students?.filter(d=>d.id!==i)}))}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async loadAllUsers(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.listAllUsers(i);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async searchUsers(i){this._loading.set(!0),this._error.set(null),this._searchQuery.set(i);try{let e=await this.datastore.searchUsers(i);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async getUserDetails(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.getUserByAuthId(i);if(!e)throw new Error(`User not found: ${i}`);return this._selectedUser.set(e),e}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async getUserByDisplayId(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.getUserByDisplayId(i);return e&&this._selectedUser.set(e),e}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateUserProfile(i,e){this._actionLoading.set(!0),this._actionError.set(null);try{await this.rpc.updateUserProfileAsAdmin(i,e),this._users.update(c=>c.map(_=>_.uid===i?C(A({},_),{primaryGuardian:e.primaryGuardian??_.primaryGuardian,secondaryGuardian:e.secondaryGuardian!==void 0?e.secondaryGuardian??void 0:_.secondaryGuardian,emergencyContact:e.emergencyContact??_.emergencyContact}):_));let d=this._selectedUser();d&&d.uid===i&&this._selectedUser.set(C(A({},d),{primaryGuardian:e.primaryGuardian??d.primaryGuardian,secondaryGuardian:e.secondaryGuardian!==void 0?e.secondaryGuardian??void 0:d.secondaryGuardian,emergencyContact:e.emergencyContact??d.emergencyContact}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._actionError.set(c),d}finally{this._actionLoading.set(!1)}}setSearchQuery(i){this._searchQuery.set(i)}clearSelectedUser(){this._selectedUser.set(null)}static \u0275fac=function(e){return new(e||S)};static \u0275prov=V({token:S,factory:S.\u0275fac,providedIn:"root"})};export{$ as a,Z as b};
