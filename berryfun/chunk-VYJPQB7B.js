import{Ba as H,S as m,V as D,W as g,X as p,Y as w,Z as v,_ as y,ca as l,da as u,ka as b}from"./chunk-Z3TSPNBE.js";import{M as h,g as f}from"./chunk-EVJ2WVWM.js";var A=class S{db=new H(p(m()));async getSeason(r,e){let o=`years/${r}/seasons`,s=await this.db.getDocument(o,e);return s?u(l.parse(s)):null}async listActiveSeasons(r){let e=`years/${r}/seasons`;return(await this.db.getDocuments(e,[{field:"isActive",op:"==",value:!0}])).map(s=>u(l.parse(s))).sort((s,t)=>s.startDate.localeCompare(t.startDate))}async listAllSeasons(r){let e=`years/${r}/seasons`;return(await this.db.getDocuments(e)).map(s=>u(l.parse(s))).sort((s,t)=>s.startDate.localeCompare(t.startDate))}async getRegistration(r,e){let o=`years/${r}/registrations`,s=await this.db.getDocument(o,e);return s?b.parse(s):null}subscribeToRegistration(r,e){let o=p(m());return new f(s=>{let t=g(o,`years/${r}/registrations`,e),a=y(t,n=>{if(!n.exists()){s.next(null);return}try{let i=n.data(),c=b.parse(i);s.next(c)}catch(i){console.error("Failed to parse registration:",i),s.error(i)}},n=>{console.error("Registration subscription error:",n),s.error(n)});return()=>a()})}subscribeToSeason(r,e){let o=p(m());return new f(s=>{let t=g(o,`years/${r}/seasons`,e),a=y(t,n=>{if(!n.exists()){s.next(null);return}try{let i=n.data(),c=u(l.parse(i));s.next(c)}catch(i){console.error("Failed to parse season:",i),s.error(i)}},n=>{console.error("Season subscription error:",n),s.error(n)});return()=>a()})}subscribeToActiveSeasons(r){let e=p(m());return new f(o=>{let s=D(e,`years/${r}/seasons`),t=w(s,v("isActive","==",!0)),a=y(t,n=>{try{let i=[];n.docs.forEach(c=>{try{let d=u(l.parse(c.data()));i.push(d)}catch(d){console.error("Failed to parse season document:",d)}}),i.sort((c,d)=>c.startDate.localeCompare(d.startDate)),o.next(i)}catch(i){console.error("Failed to process seasons snapshot:",i),o.error(i)}},n=>{console.error("Active seasons subscription error:",n),o.error(n)});return()=>a()})}async getClass(r,e){let o=await this.listAllSeasons(r);for(let s of o){let t=s.sessions?.find(a=>a.id===e);if(t)return t}return null}async listClassesBySeason(r,e,o=!0){let s=await this.getSeason(r,e);if(!s||!s.sessions)return[];let t=s.sessions;return o&&(t=t.filter(a=>a.isActive)),t.sort((a,n)=>a.startDate.localeCompare(n.startDate))}async listClassesByYear(r,e=!0){let o=await this.listAllSeasons(r),s=[];for(let t of o)if(t.sessions)for(let a of t.sessions)(!e||a.isActive)&&s.push(a);return s.sort((t,a)=>t.startDate.localeCompare(a.startDate))}static \u0275fac=function(e){return new(e||S)};static \u0275prov=h({token:S,factory:S.\u0275fac,providedIn:"root"})};export{A as a};
