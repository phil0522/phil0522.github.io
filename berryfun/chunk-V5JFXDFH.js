import{a as d}from"./chunk-ASE5O5EB.js";import{a as h}from"./chunk-2CFNH2LG.js";import{a as m}from"./chunk-SLD5GHTQ.js";import{a as b}from"./chunk-JXJ4MRT4.js";import{ea as i,fa as g}from"./chunk-ODOFH7NK.js";import{$ as o,L as l,Q as n,Qb as u,ga as a,ha as c}from"./chunk-C26OXKSD.js";var p=class r{datastore=n(m);seasonService=n(h);configService=n(b);destroyRef=n(o);_registration=a(null);registration=this._registration.asReadonly();subscription=null;currentSeasonId=null;constructor(){c(()=>{let t=this.seasonService.selectedSeason();t&&t.id!==this.currentSeasonId&&this.subscribeToSeason(t.id)})}subscribeToSeason(t){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=t;let e=this.configService.currentActiveYear();this.subscription=this.datastore.subscribeToRegistration(e,t).pipe(d(this.destroyRef)).subscribe({next:s=>this._registration.set(s),error:s=>{console.error("Registration subscription error:",s),this._registration.set(null)}})}getClassEnrollment(t){return this.registration()?.classes[t]}getEnrolledCount(t){return this.getClassEnrollment(t)?.enrolledStudents?.length??0}getVacancyHoldsCount(t){return this.getClassEnrollment(t)?.vacancyHolds?.length??0}classesWithEnrollment=u(()=>{let t=this.seasonService.classes(),e=this._registration();return g(t,e)});getClassWithEnrollment(t){let e=this.seasonService.classes().find(s=>s.id===t);return e?i(e,this.getClassEnrollment(t)):null}createViewType(t){return i(t,this.getClassEnrollment(t.id))}getPublicAvailableSpots(t){let e=this.getClassEnrollment(t.id),s=e?.enrolledStudents?.length??0,S=e?.vacancyHolds?.length??0;return Math.max(0,t.capacity-s-S)}getWaitlistAvailableSpots(t){let s=this.getClassEnrollment(t.id)?.enrolledStudents?.length??0;return Math.max(0,t.capacity-s)}isFullForPublic(t){return this.getPublicAvailableSpots(t)<=0}getEnrollmentStatus(t){let e=this.getPublicAvailableSpots(t);return e===0?"waitlist-only":e<=3?"almost-full":"open"}getStatusMessage(t){let e=this.getEnrollmentStatus(t),s=this.getPublicAvailableSpots(t);switch(e){case"open":return`${s} spots available`;case"almost-full":return`Only ${s} spots left!`;case"full":return"Full";case"waitlist-only":return"Full - Join Waitlist";default:return""}}unsubscribe(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.currentSeasonId=null,this._registration.set(null)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{p as a};
