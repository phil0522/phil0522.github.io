import{a as he}from"./chunk-RHNOJD4P.js";import{a as be}from"./chunk-ECXYBQBD.js";import{a as ve}from"./chunk-2JHW6PUI.js";import{a as fe}from"./chunk-WGO2IC7V.js";import{a as Ce}from"./chunk-4AJYHGM2.js";import{b as re,c as de,d as le,e as se,f as ce,g as me,i as pe,j as ue,k as _e,m as ge,q as xe}from"./chunk-WS3V7OL7.js";import"./chunk-DLJK6BWM.js";import{E as J,F as Z,G as K,P as Q,Q as F,R as X,S as ee,T as te,Y as ne,Z as ie,_ as oe,aa as ae,b as U,d as G,j as H,k as Y}from"./chunk-7OLI4QWT.js";import"./chunk-UYHN5VVP.js";import{$a as I,Ab as a,Bb as x,Cb as f,Db as L,Ea as r,Gb as y,Hb as O,Ib as S,N as D,Nb as z,Pa as B,Rb as h,S as m,T as p,Ub as $,Za as u,_a as _,bb as w,cb as M,da as P,db as C,eb as t,fb as o,gb as v,kb as b,mb as g,ob as s}from"./chunk-WXZFQYIJ.js";import"./chunk-Q7L6LLAK.js";function ye(n){switch(n){case"locked":return"status-badge status-locked";case"submitted":return"status-badge status-submitted";case"paid":return"status-badge status-paid";case"cancelled":return"status-badge status-cancelled";case"change_requested":return"status-badge status-change-requested";case"refunded":return"status-badge status-refunded";case"partial":return"status-badge status-partial";case"empty":return"status-badge status-empty";default:return"status-badge"}}function Oe(n){switch(n){case"locked":return"Awaiting Screenshot";case"submitted":return"Pending Payment";case"paid":return"Paid";case"cancelled":return"Cancelled";case"change_requested":return"Change Requested";case"refunded":return"Refunded";case"partial":return"Partially Paid";case"empty":return"Empty";default:return n}}function Se(n){switch(n){case"locked":return"item-status-badge item-status-locked";case"submitted":return"item-status-badge item-status-submitted";case"paid":return"item-status-badge item-status-paid";case"cancelled":return"item-status-badge item-status-cancelled";case"refunded":return"item-status-badge item-status-refunded";default:return"item-status-badge"}}function we(n){switch(n){case"locked":return"Awaiting Screenshot";case"submitted":return"Pending";case"paid":return"Paid";case"cancelled":return"Cancelled";case"refunded":return"Refunded";default:return n}}function Me(n){return`$${(n/100).toFixed(2)}`}function V(n){let i=n.replace(/[^0-9.]/g,""),e=parseFloat(i)||0;return Math.round(e*100)}function k(n){return(n/100).toFixed(2)}function De(n){return new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function Pe(n){return new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}var qe=(n,i)=>({"text-danger":n,"text-warning":i}),R=(n,i)=>i.sessionId+"-"+i.studentId,Ve=(n,i)=>i.sessionId,Re=(n,i)=>i.id;function je(n,i){n&1&&(t(0,"div",1),v(1,"div",5),t(2,"p"),a(3,"Loading order details..."),o()())}function Ne(n,i){if(n&1){let e=b();t(0,"div",2)(1,"strong"),a(2,"Error:"),o(),a(3),t(4,"button",6),g("click",function(){m(e);let d=s();return p(d.clearError())}),a(5,"\xD7"),o()()}if(n&2){let e=s();r(3),f(" ",e.error()," ")}}function Le(n,i){if(n&1&&(t(0,"div",19)(1,"span",20),a(2,"Phone:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s(3);r(4),x(e.userData().phone)}}function Fe(n,i){if(n&1&&(t(0,"div",19)(1,"span",20),a(2,"Address:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s(3);r(4),x(e.userData().address)}}function We(n,i){if(n&1&&(t(0,"div",16)(1,"h2"),a(2,"User Information"),o(),t(3,"div",35)(4,"div",19)(5,"span",20),a(6,"Name:"),o(),t(7,"span",22),a(8),o()(),t(9,"div",19)(10,"span",20),a(11,"Email:"),o(),t(12,"span",22),a(13),o()(),u(14,Le,5,1,"div",19),u(15,Fe,5,1,"div",19),o()()),n&2){let e=s(2);r(8),x(e.userData().displayName),r(5),x(e.userData().email),r(),_(e.userData().phone?14:-1),r(),_(e.userData().address?15:-1)}}function Be(n,i){if(n&1&&(t(0,"span",37),a(1),o()),n&2){let e=s(3);r(),L(" (",e.remainingLockTime().hours,"h ",e.remainingLockTime().minutes,"m remaining) ")}}function ze(n,i){if(n&1&&(t(0,"div",19)(1,"span",20),a(2,"Lock Expires:"),o(),t(3,"span",36),a(4),u(5,Be,2,2,"span",37),o()()),n&2){let e=s(2);r(3),C("ngClass",z(3,qe,e.isOverdue(),e.isExpiringSoon())),r(),f(" ",e.formatDateTime(e.order().lockExpiresAt)," "),r(),_(e.remainingLockTime()?5:-1)}}function $e(n,i){n&1&&(t(0,"div",23)(1,"strong"),a(2,"\u26A0\uFE0F Overdue:"),o(),a(3," This order's payment lock has expired. Items may be released. "),o())}function Ue(n,i){if(n&1){let e=b();t(0,"button",38),g("click",function(){m(e);let d=s(2);return p(d.openCancelItemsDialog())}),a(1," Cancel Items "),o()}}function Ge(n,i){if(n&1&&(t(0,"div",42)(1,"div",43)(2,"span",44),a(3),o(),t(4,"span",45),a(5),o()(),t(6,"div",46)(7,"div",47)(8,"span",20),a(9,"Student:"),o(),t(10,"span",22),a(11),o()(),t(12,"div",47)(13,"span",20),a(14,"Options:"),o(),t(15,"span",22),v(16,"app-option-badges",48),o()()()()),n&2){let e=i.$implicit,l=s(3);r(3),x(l.getClassName(e.sessionId)),r(),C("ngClass",l.getItemStatusBadgeClass(e.status)),r(),f(" ",l.getItemStatusLabel(e.status)," "),r(6),x(l.getStudentName(e.studentId)),r(5),C("options",e.options)("showEmpty",!0)}}function He(n,i){if(n&1&&(t(0,"div",27)(1,"h3",39),a(2," Locked Items "),t(3,"span",40),a(4),o()(),t(5,"div",41),w(6,Ge,17,6,"div",42,R),o()()),n&2){let e=s(2);r(4),f("(",e.lockedItems().length,")"),r(2),M(e.lockedItems())}}function Ye(n,i){if(n&1&&(t(0,"div",49)(1,"div",43)(2,"span",44),a(3),o(),t(4,"span",45),a(5),o()(),t(6,"div",46)(7,"div",47)(8,"span",20),a(9,"Student:"),o(),t(10,"span",22),a(11),o()(),t(12,"div",47)(13,"span",20),a(14,"Options:"),o(),t(15,"span",22),v(16,"app-option-badges",48),o()()()()),n&2){let e=i.$implicit,l=s(3);r(3),x(l.getClassName(e.sessionId)),r(),C("ngClass",l.getItemStatusBadgeClass(e.status)),r(),f(" ",l.getItemStatusLabel(e.status)," "),r(6),x(l.getStudentName(e.studentId)),r(5),C("options",e.options)("showEmpty",!0)}}function Je(n,i){if(n&1&&(t(0,"div",27)(1,"h3",39),a(2," Paid Items "),t(3,"span",40),a(4),o()(),t(5,"div",41),w(6,Ye,17,6,"div",49,R),o()()),n&2){let e=s(2);r(4),f("(",e.paidItems().length,")"),r(2),M(e.paidItems())}}function Ze(n,i){if(n&1&&(t(0,"div",50)(1,"div",43)(2,"span",44),a(3),o(),t(4,"span",45),a(5),o()(),t(6,"div",46)(7,"div",47)(8,"span",20),a(9,"Student:"),o(),t(10,"span",22),a(11),o()(),t(12,"div",47)(13,"span",20),a(14,"Options:"),o(),t(15,"span",22),v(16,"app-option-badges",48),o()()()()),n&2){let e=i.$implicit,l=s(3);r(3),x(l.getClassName(e.sessionId)),r(),C("ngClass",l.getItemStatusBadgeClass(e.status)),r(),f(" ",l.getItemStatusLabel(e.status)," "),r(6),x(l.getStudentName(e.studentId)),r(5),C("options",e.options)("showEmpty",!0)}}function Ke(n,i){if(n&1&&(t(0,"div",27)(1,"h3",39),a(2," Pending Payment "),t(3,"span",40),a(4),o()(),t(5,"div",41),w(6,Ze,17,6,"div",50,R),o()()),n&2){let e=s(2);r(4),f("(",e.submittedItems().length,")"),r(2),M(e.submittedItems())}}function Qe(n,i){n&1&&(t(0,"div",28)(1,"p"),a(2,"No items in this order."),o()())}function Xe(n,i){if(n&1&&(t(0,"div",29),v(1,"app-payment-screenshot-gallery",51),o()),n&2){let e=s(2);r(),C("screenshots",e.order().paymentScreenshots)}}function et(n,i){if(n&1&&(t(0,"div",30)(1,"h2"),a(2,"Pricing Summary"),o(),v(3,"app-price-breakdown",52),o()),n&2){let e=s(2);r(3),C("data",e.priceBreakdownData())}}function tt(n,i){if(n&1&&(t(0,"tr")(1,"td"),a(2),o(),t(3,"td",54),a(4),o(),t(5,"td")(6,"span",55),a(7),o()(),t(8,"td"),a(9),o(),t(10,"td"),a(11),o()()),n&2){let e=i.$implicit,l=s(3);r(2),x(l.formatDateTime(e.recordedAt)),r(2),x(l.formatCurrency(e.amount)),r(3),x(e.method),r(2),x(e.reference),r(2),x(e.notes||"-")}}function nt(n,i){if(n&1&&(t(0,"div",31)(1,"h2"),a(2,"Payment History"),o(),t(3,"table",53)(4,"thead")(5,"tr")(6,"th"),a(7,"Date"),o(),t(8,"th"),a(9,"Amount"),o(),t(10,"th"),a(11,"Method"),o(),t(12,"th"),a(13,"Reference"),o(),t(14,"th"),a(15,"Notes"),o()()(),t(16,"tbody"),w(17,tt,12,5,"tr",null,I),o()()()),n&2){let e=s(2);r(17),M(e.payments())}}function it(n,i){if(n&1){let e=b();t(0,"div",57)(1,"div",58)(2,"span",44),a(3),o()(),t(4,"div",59)(5,"div",47)(6,"span",20),a(7,"Joined:"),o(),t(8,"span",22),a(9),o()()(),t(10,"button",38),g("click",function(){let d=m(e).$implicit,c=s(3);return p(c.openRemoveWaitlistDialog(d.sessionId))}),a(11," Remove Entry "),o()()}if(n&2){let e=i.$implicit,l=s(3);r(3),x(l.getClassName(e.sessionId)),r(6),x(l.formatDateTime(e.joinedAt))}}function ot(n,i){if(n&1&&(t(0,"div",32)(1,"h2"),a(2,"Waitlist Entries"),o(),t(3,"div",56),w(4,it,12,2,"div",57,Ve),o()()),n&2){let e=s(2);r(4),M(e.waitlistEntries())}}function at(n,i){if(n&1&&(t(0,"div",68),a(1),o()),n&2){let e=i.$implicit,l=s(4);r(),f(" ",l.getActionDescription(e)," ")}}function rt(n,i){if(n&1&&(t(0,"div",70)(1,"span",20),a(2,"Reason:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s().$implicit;r(4),x(e.reason)}}function dt(n,i){if(n&1&&(t(0,"div",70)(1,"span",20),a(2,"Admin Adjustment:"),o(),t(3,"span",36),a(4),o()()),n&2){let e=s().$implicit,l=s(3);r(3),C("ngClass",e.adminAdjustment<0?"text-success":"text-danger"),r(),L(" ",e.adminAdjustment<0?"-":"+","",l.formatCurrency(l.Math.abs(e.adminAdjustment))," ")}}function lt(n,i){if(n&1&&(t(0,"div",70)(1,"span",20),a(2,"Adjustment Reason:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s().$implicit;r(4),x(e.adminAdjustmentReason)}}function st(n,i){if(n&1&&(t(0,"div",70)(1,"span",20),a(2,"Processed:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s().$implicit,l=s(3);r(4),x(l.formatDateTime(e.processedAt))}}function ct(n,i){if(n&1&&(t(0,"div",70)(1,"span",20),a(2,"Admin Notes:"),o(),t(3,"span",22),a(4),o()()),n&2){let e=s().$implicit;r(4),x(e.adminNotes)}}function mt(n,i){if(n&1){let e=b();t(0,"button",72),g("click",function(){m(e);let d=s().$implicit,c=s(3);return p(c.openUpdateAdjustmentDialog(d))}),a(1," Edit Adjustment "),o(),t(2,"button",73),g("click",function(){m(e);let d=s().$implicit,c=s(3);return p(c.openApproveChangeDialog(d))}),a(3," Approve "),o(),t(4,"button",38),g("click",function(){m(e);let d=s().$implicit,c=s(3);return p(c.openDenyChangeDialog(d))}),a(5," Deny "),o()}}function pt(n,i){if(n&1&&(t(0,"div",61)(1,"div",62)(2,"div",63)(3,"span",64),a(4),o(),t(5,"span",65),a(6),o()()(),t(7,"div",66)(8,"div",67)(9,"strong"),a(10,"Actions:"),o(),w(11,at,2,1,"div",68,I),o(),t(13,"div",69)(14,"div",70)(15,"span",20),a(16,"Requested:"),o(),t(17,"span",22),a(18),o()(),u(19,rt,5,1,"div",70),u(20,dt,5,3,"div",70),u(21,lt,5,1,"div",70),u(22,st,5,1,"div",70),u(23,ct,5,1,"div",70),o()(),t(24,"div",71),u(25,mt,6,0),o()()),n&2){let e=i.$implicit,l=s(3);C("ngClass","status-"+e.status),r(4),x(e.id),r(),C("ngClass","status-"+e.status),r(),f(" ",l.getChangeStatusLabel(e.status)," "),r(5),M(e.actions),r(7),x(l.formatDateTime(e.requestedAt)),r(),_(e.reason?19:-1),r(),_(e.adminAdjustment!==0?20:-1),r(),_(e.adminAdjustmentReason?21:-1),r(),_(e.processedAt?22:-1),r(),_(e.adminNotes?23:-1),r(2),_(e.status==="pending"?25:-1)}}function ut(n,i){if(n&1&&(t(0,"div",33)(1,"h2"),a(2,"Change Requests"),o(),t(3,"div",60),w(4,pt,26,11,"div",61,Re),o()()),n&2){let e=s(2);r(4),M(e.changeRequests())}}function _t(n,i){if(n&1&&(t(0,"div",79),a(1),o()),n&2){let e=s().$implicit;r(),x(e.details)}}function gt(n,i){n&1&&(t(0,"span",85),a(1,"Lunch"),o())}function xt(n,i){n&1&&(t(0,"span",85),a(1,"Extended Care"),o())}function Ct(n,i){if(n&1&&(t(0,"span",84),u(1,gt,2,0,"span",85),u(2,xt,2,0,"span",85),o()),n&2){let e=s().$implicit;r(),_(e.options.lunch?1:-1),r(),_(e.options.extendedCare?2:-1)}}function ft(n,i){if(n&1&&(t(0,"div",81)(1,"span",82),a(2),o(),t(3,"span",83),a(4),o(),u(5,Ct,3,2,"span",84),o()),n&2){let e=i.$implicit,l=s(5);r(2),x(e.className),r(2),x(l.getStudentName(e.studentId)),r(),_(e.options?5:-1)}}function ht(n,i){if(n&1&&(t(0,"div",80),w(1,ft,6,3,"div",81,I),o()),n&2){let e=s().$implicit;r(),M(e.affectedItems)}}function vt(n,i){if(n&1&&(t(0,"div",75)(1,"div",76),a(2),o(),t(3,"div",77)(4,"div",78),a(5),o(),u(6,_t,2,1,"div",79),u(7,ht,3,0,"div",80),o()()),n&2){let e=i.$implicit,l=s(3);r(2),x(l.formatDateTime(e.timestamp)),r(3),x(e.action),r(),_(e.details?6:-1),r(),_(e.affectedItems&&e.affectedItems.length>0?7:-1)}}function bt(n,i){if(n&1&&(t(0,"div",34)(1,"h2"),a(2,"Order History"),o(),t(3,"div",74),w(4,vt,8,4,"div",75,I),o()()),n&2){let e=s(2);r(4),M(e.order().history)}}function yt(n,i){if(n&1){let e=b();t(0,"div",3)(1,"div",7)(2,"div",8)(3,"a",9),a(4,"\u2190 Back to Orders"),o(),t(5,"h1"),a(6,"Order Details"),o(),t(7,"div",10)(8,"span",11),a(9),o(),t(10,"span",12),a(11),o()()(),t(12,"div",13)(13,"button",14),g("click",function(){m(e);let d=s();return p(d.openAddAdjustmentDialog())}),a(14," Add Credit/Fee "),o(),t(15,"button",15),g("click",function(){m(e);let d=s();return p(d.openRecordPaymentDialog())}),a(16," Record Payment "),o()()(),u(17,We,16,4,"div",16),t(18,"div",17)(19,"h2"),a(20,"Order Status"),o(),t(21,"div",18)(22,"div",19)(23,"span",20),a(24,"Status:"),o(),t(25,"span",21),a(26),o()(),u(27,ze,6,6,"div",19),t(28,"div",19)(29,"span",20),a(30,"Created:"),o(),t(31,"span",22),a(32),o()(),t(33,"div",19)(34,"span",20),a(35,"Last Updated:"),o(),t(36,"span",22),a(37),o()()(),u(38,$e,4,0,"div",23),o(),t(39,"div",24)(40,"div",25)(41,"h2"),a(42,"Order Items"),o(),u(43,Ue,2,0,"button",26),o(),u(44,He,8,1,"div",27),u(45,Je,8,1,"div",27),u(46,Ke,8,1,"div",27),u(47,Qe,3,0,"div",28),o(),u(48,Xe,2,1,"div",29),u(49,et,4,1,"div",30),u(50,nt,19,0,"div",31),u(51,ot,6,0,"div",32),u(52,ut,6,0,"div",33),u(53,bt,6,0,"div",34),o()}if(n&2){let e=s();r(9),f("User: ",e.order().userDisplayId),r(),C("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),r(),f(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),r(4),C("disabled",!e.canRecordPayment()),r(2),_(e.userData()?17:-1),r(8),C("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),r(),f(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),r(),_(e.order().lockExpiresAt?27:-1),r(5),x(e.formatDateTime(e.order().createdAt)),r(5),x(e.formatDateTime(e.order().updatedAt)),r(),_(e.isOverdue()?38:-1),r(5),_(e.cancellableItems().length>0?43:-1),r(),_(e.lockedItems().length>0?44:-1),r(),_(e.paidItems().length>0?45:-1),r(),_(e.submittedItems().length>0?46:-1),r(),_(e.allItems().length===0?47:-1),r(),_(e.order().paymentScreenshots.length>0?48:-1),r(),_(e.priceBreakdownData()?49:-1),r(),_(e.payments().length>0?50:-1),r(),_(e.waitlistEntries().length>0?51:-1),r(),_(e.changeRequests().length>0?52:-1),r(),_(e.order().history&&e.order().history.length>0?53:-1)}}function Ot(n,i){if(n&1&&(t(0,"div",101)(1,"div",109)(2,"span"),a(3,"Original Amount Due:"),o(),t(4,"span"),a(5),o()(),t(6,"div",110)(7,"span"),a(8,"Cash Discount (3%):"),o(),t(9,"span"),a(10),o()(),t(11,"div",111)(12,"span"),a(13,"Cash Amount Due:"),o(),t(14,"span"),a(15),o()(),t(16,"small",94),a(17),o()()),n&2){let e=s(2);r(5),x(e.formatCurrency(e.amountDue())),r(5),f("-",e.formatCurrency(e.cashDiscount())),r(5),x(e.formatCurrency(e.cashAmountDue())),r(2),f(" A credit of ",e.formatCurrency(e.cashDiscount())," will be automatically applied. ")}}function St(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function wt(n,i){n&1&&(v(0,"span",112),a(1," Recording... "))}function Mt(n,i){n&1&&a(0," Record Payment ")}function Dt(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Record Payment"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.recordPayment())}),t(9,"div",91)(10,"label",92),a(11,"Amount *"),o(),t(12,"input",93),S("ngModelChange",function(d){m(e);let c=s();return O(c.formPayment.amountInput,d)||(c.formPayment.amountInput=d),p(d)}),o(),t(13,"small",94),a(14),o()(),t(15,"div",91)(16,"label",95),a(17,"Payment Method *"),o(),t(18,"select",96),S("ngModelChange",function(d){m(e);let c=s();return O(c.formPayment.method,d)||(c.formPayment.method=d),p(d)}),g("ngModelChange",function(d){m(e);let c=s();return p(c.onPaymentMethodChange(d))}),t(19,"option",97),a(20,"Zelle"),o(),t(21,"option",98),a(22,"Check"),o(),t(23,"option",99),a(24,"Cash (3% off)"),o(),t(25,"option",100),a(26,"Other"),o()()(),u(27,Ot,18,4,"div",101),t(28,"div",91)(29,"label",102),a(30," Reference (optional) "),o(),t(31,"input",103),S("ngModelChange",function(d){m(e);let c=s();return O(c.formPayment.reference,d)||(c.formPayment.reference=d),p(d)}),o()(),t(32,"div",91)(33,"label",104),a(34,"Notes"),o(),t(35,"textarea",105),S("ngModelChange",function(d){m(e);let c=s();return O(c.formPayment.notes,d)||(c.formPayment.notes=d),p(d)}),o()(),u(36,St,2,1,"div",23),t(37,"div",106)(38,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(39," Cancel "),o(),t(40,"button",108),u(41,wt,2,0)(42,Mt,1,0),o()()()()()()}if(n&2){let e=s();r(12),y("ngModel",e.formPayment.amountInput),r(2),f(" Amount due: ",e.formatCurrency(e.amountDue())," "),r(4),y("ngModel",e.formPayment.method),r(9),_(e.formPayment.method==="cash"&&e.cashDiscount()>0?27:-1),r(4),y("ngModel",e.formPayment.reference),r(4),y("ngModel",e.formPayment.notes),r(),_(e.actionError()?36:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()),r(),_(e.actionLoading()?41:42)}}function Pt(n,i){if(n&1){let e=b();t(0,"label",114)(1,"input",118),g("change",function(){let d=m(e).$implicit,c=s(2);return p(c.toggleItemSelection(d))}),o(),t(2,"span",119)(3,"span",44),a(4),o(),a(5," - "),t(6,"span",120),a(7),o(),t(8,"span",45),a(9),o()()()}if(n&2){let e=i.$implicit,l=s(2);r(),C("checked",l.isItemSelected(e)),r(3),x(l.getClassName(e.sessionId)),r(3),x(l.getStudentName(e.studentId)),r(),C("ngClass",l.getItemStatusBadgeClass(e.status)),r(),f(" ",l.getItemStatusLabel(e.status)," ")}}function Et(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function At(n,i){n&1&&(v(0,"span",112),a(1," Cancelling... "))}function It(n,i){if(n&1&&a(0),n&2){let e=s(2);f(" Cancel ",e.selectedItems().size," Item(s) ")}}function kt(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Cancel Order Items"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.cancelItems())}),t(9,"div",91)(10,"label"),a(11,"Select items to cancel:"),o(),t(12,"div",113),w(13,Pt,10,5,"label",114,R),o()(),t(15,"div",91)(16,"label",115),a(17,"Cancellation Reason *"),o(),t(18,"textarea",116),S("ngModelChange",function(d){m(e);let c=s();return O(c.formCancel.reason,d)||(c.formCancel.reason=d),p(d)}),o()(),u(19,Et,2,1,"div",23),t(20,"div",106)(21,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(22," Cancel "),o(),t(23,"button",117),u(24,At,2,0)(25,It,1,1),o()()()()()()}if(n&2){let e=s();r(13),M(e.cancellableItems()),r(5),y("ngModel",e.formCancel.reason),r(),_(e.actionError()?19:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()||e.selectedItems().size===0),r(),_(e.actionLoading()?24:25)}}function Tt(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function qt(n,i){n&1&&(v(0,"span",112),a(1," Removing... "))}function Vt(n,i){n&1&&a(0," Remove Entry ")}function Rt(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Remove Waitlist Entry"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.removeWaitlist())}),t(9,"div",91)(10,"label"),a(11,"Class:"),o(),t(12,"div",121),a(13),o()(),t(14,"div",122),a(15," This will remove the user from the waitlist for this class. "),o(),u(16,Tt,2,1,"div",23),t(17,"div",106)(18,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(19," Cancel "),o(),t(20,"button",117),u(21,qt,2,0)(22,Vt,1,0),o()()()()()()}if(n&2){let e=s();r(13),f(" ",e.getClassName(e.formRemoveWaitlist.sessionId)," "),r(3),_(e.actionError()?16:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()),r(),_(e.actionLoading()?21:22)}}function jt(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function Nt(n,i){n&1&&(v(0,"span",112),a(1," Saving... "))}function Lt(n,i){n&1&&a(0," Save Adjustment ")}function Ft(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Update Adjustment"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.updateAdjustment())}),t(9,"div",91)(10,"label"),a(11,"Request ID:"),o(),t(12,"div",121),a(13),o()(),t(14,"div",91)(15,"label",123),a(16,"Extra Fee (+) or Credit (-)"),o(),t(17,"input",124),S("ngModelChange",function(d){m(e);let c=s();return O(c.formChangeRequest.adjustmentInput,d)||(c.formChangeRequest.adjustmentInput=d),p(d)}),o(),t(18,"small",94),a(19,"Positive values add a fee, negative values give a credit"),o()(),t(20,"div",91)(21,"label",125),a(22,"Reason"),o(),t(23,"textarea",126),S("ngModelChange",function(d){m(e);let c=s();return O(c.formChangeRequest.adjustmentReason,d)||(c.formChangeRequest.adjustmentReason=d),p(d)}),o()(),t(24,"div",91)(25,"label",127),a(26,"Admin Notes"),o(),t(27,"textarea",128),S("ngModelChange",function(d){m(e);let c=s();return O(c.formChangeRequest.adminNotes,d)||(c.formChangeRequest.adminNotes=d),p(d)}),o()(),t(28,"div",129),a(29," The user will see this adjustment. You can update it multiple times before approving. "),o(),u(30,jt,2,1,"div",23),t(31,"div",106)(32,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(33," Cancel "),o(),t(34,"button",108),u(35,Nt,2,0)(36,Lt,1,0),o()()()()()()}if(n&2){let e=s();r(13),x(e.formChangeRequest.requestId),r(4),y("ngModel",e.formChangeRequest.adjustmentInput),r(6),y("ngModel",e.formChangeRequest.adjustmentReason),r(4),y("ngModel",e.formChangeRequest.adminNotes),r(3),_(e.actionError()?30:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()),r(),_(e.actionLoading()?35:36)}}function Wt(n,i){if(n&1&&(t(0,"div",131),a(1),o()),n&2){let e=i.$implicit,l=s(2);r(),x(l.getActionDescription(e))}}function Bt(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function zt(n,i){n&1&&(v(0,"span",112),a(1," Approving... "))}function $t(n,i){n&1&&a(0," Approve Changes ")}function Ut(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Approve Change Request"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.approveChange())}),t(9,"div",91)(10,"label"),a(11,"Request ID:"),o(),t(12,"div",121),a(13),o()(),t(14,"div",91)(15,"label"),a(16,"Actions to apply:"),o(),t(17,"div",130),w(18,Wt,2,1,"div",131,I),o()(),t(20,"div",91)(21,"label",132),a(22,"Admin Notes"),o(),t(23,"textarea",133),S("ngModelChange",function(d){m(e);let c=s();return O(c.formChangeRequest.adminNotes,d)||(c.formChangeRequest.adminNotes=d),p(d)}),o()(),t(24,"div",122),a(25," Approving will apply all changes to the order. Class removals will create vacancy holds for waitlist members. The order pricing will be recalculated. "),o(),u(26,Bt,2,1,"div",23),t(27,"div",106)(28,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(29," Cancel "),o(),t(30,"button",108),u(31,zt,2,0)(32,$t,1,0),o()()()()()()}if(n&2){let e=s();r(13),x(e.formChangeRequest.requestId),r(5),M(e.formChangeRequest.actions),r(5),y("ngModel",e.formChangeRequest.adminNotes),r(3),_(e.actionError()?26:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()),r(),_(e.actionLoading()?31:32)}}function Gt(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function Ht(n,i){n&1&&(v(0,"span",112),a(1," Denying... "))}function Yt(n,i){n&1&&a(0," Deny Request ")}function Jt(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Deny Change Request"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.denyChange())}),t(9,"div",91)(10,"label"),a(11,"Request ID:"),o(),t(12,"div",121),a(13),o()(),t(14,"div",91)(15,"label",134),a(16,"Reason for Denial *"),o(),t(17,"textarea",135),S("ngModelChange",function(d){m(e);let c=s();return O(c.formChangeRequest.adminNotes,d)||(c.formChangeRequest.adminNotes=d),p(d)}),o()(),t(18,"div",129),a(19," The user will be notified that their change request was denied. No changes will be applied to their order. "),o(),u(20,Gt,2,1,"div",23),t(21,"div",106)(22,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(23," Cancel "),o(),t(24,"button",117),u(25,Ht,2,0)(26,Yt,1,0),o()()()()()()}if(n&2){let e=s();r(13),x(e.formChangeRequest.requestId),r(4),y("ngModel",e.formChangeRequest.adminNotes),r(3),_(e.actionError()?20:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()||!e.formChangeRequest.adminNotes.trim()),r(),_(e.actionLoading()?25:26)}}function Zt(n,i){if(n&1&&(t(0,"div",23),a(1),o()),n&2){let e=s(2);r(),x(e.actionError())}}function Kt(n,i){n&1&&(v(0,"span",112),a(1," Adding... "))}function Qt(n,i){if(n&1&&a(0),n&2){let e=s(2);f(" Add ",e.formAdjustment.type==="credit"?"Credit":"Fee"," ")}}function Xt(n,i){if(n&1){let e=b();t(0,"div",86),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),t(1,"div",87),g("click",function(d){return m(e),p(d.stopPropagation())}),t(2,"div",88)(3,"h3"),a(4,"Add Credit or Fee"),o(),t(5,"button",6),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(6,"\xD7"),o()(),t(7,"div",89)(8,"form",90),g("ngSubmit",function(){m(e);let d=s();return p(d.addAdjustment())}),t(9,"div",91)(10,"label",136),a(11,"Type *"),o(),t(12,"select",137),S("ngModelChange",function(d){m(e);let c=s();return O(c.formAdjustment.type,d)||(c.formAdjustment.type=d),p(d)}),t(13,"option",138),a(14,"Credit (reduce amount due)"),o(),t(15,"option",139),a(16,"Fee (increase amount due)"),o()()(),t(17,"div",91)(18,"label",123),a(19,"Amount *"),o(),t(20,"input",140),S("ngModelChange",function(d){m(e);let c=s();return O(c.formAdjustment.amountInput,d)||(c.formAdjustment.amountInput=d),p(d)}),o(),t(21,"small",94),a(22," Enter the amount in dollars (e.g., 25.00) "),o()(),t(23,"div",91)(24,"label",125),a(25,"Reason *"),o(),t(26,"textarea",141),S("ngModelChange",function(d){m(e);let c=s();return O(c.formAdjustment.reason,d)||(c.formAdjustment.reason=d),p(d)}),o()(),t(27,"div",129),a(28),o(),u(29,Zt,2,1,"div",23),t(30,"div",106)(31,"button",107),g("click",function(){m(e);let d=s();return p(d.closeDialog())}),a(32," Cancel "),o(),t(33,"button",108),u(34,Kt,2,0)(35,Qt,1,1),o()()()()()()}if(n&2){let e=s();r(12),y("ngModel",e.formAdjustment.type),r(8),y("ngModel",e.formAdjustment.amountInput),r(6),y("ngModel",e.formAdjustment.reason),r(2),f(" ",e.formAdjustment.type==="credit"?"A credit will reduce the amount the user owes.":"A fee will increase the amount the user owes."," "),r(),_(e.actionError()?29:-1),r(2),C("disabled",e.actionLoading()),r(2),C("disabled",e.actionLoading()||!e.formAdjustment.amountInput||!e.formAdjustment.reason.trim()),r(),_(e.actionLoading()?34:35)}}var Ee=class n{orderId=$.required();adminOrdersStore=D(be);orderRpc=D(ne);userService=D(ae);seasonService=D(oe);configService=D(ie);router=D(H);notificationService=D(ve);order=P(null);loading=P(!1);error=P(null);userData=P(null);studentMap=P(new Map);actionLoading=this.orderRpc.loading;actionError=this.orderRpc.error;dialogMode=P(null);formPayment={amountInput:"",method:"zelle",reference:"",notes:""};formCancel={reason:""};selectedItems=P(new Set);formRemoveWaitlist={sessionId:""};formChangeRequest={requestId:"",actions:[],adjustmentInput:"",adjustmentReason:"",adminNotes:""};formAdjustment={type:"credit",amountInput:"",reason:""};Math=Math;allItems=h(()=>this.order()?.items??[]);paidItems=h(()=>{let i=this.order();return i?Z(i):[]});submittedItems=h(()=>{let i=this.order();return i?J(i):[]});lockedItems=h(()=>this.allItems().filter(i=>i.status==="locked"));cancellableItems=h(()=>[...this.lockedItems(),...this.paidItems(),...this.submittedItems()]);waitlistEntries=h(()=>this.order()?.waitlist??[]);payments=h(()=>this.order()?.payments??[]);changeRequests=h(()=>this.order()?.changeRequests??[]);totalDue=h(()=>{let i=this.order();return i?F(i):0});amountDue=h(()=>{let i=this.order();return i?K(i):0});cashDiscount=h(()=>{let i=this.amountDue();return i<=0?0:ee(i)});cashAmountDue=h(()=>{let i=this.amountDue();return i<=0?0:te(i)});priceBreakdownData=h(()=>{let i=this.order();if(!i)return null;let e=(i.payments?.length??0)>0;if(!i.pricing&&!e)return null;let l=(i.processingFees??[]).map(A=>({description:A.description,amount:A.amount})),d=i.pricing??{subtotal:0,discounts:[],sessionBreakdowns:[],globalDiscounts:[]},c=F(i),j=(i.processingFees??[]).reduce((A,N)=>A+N.amount,0),T=Q(i),Ae=i.totalPaid??0,Ie=(i.adjustments??[]).reduce((A,N)=>A+N.amount,0),ke=i.couponDiscount??0,Te=c+j+Ie-ke,W=Ae-T,q=Te-W;return q<0&&(q=Math.max(q,-W)),{pricing:d,couponCredit:i.couponDiscount??0,totalPaid:i.totalPaid,totalRefunded:T,processingFees:l,amountDue:q}});isOverdue=h(()=>{let i=this.order();if(!i||!i.lockExpiresAt)return!1;let e=this.configService.currentTime();return new Date(i.lockExpiresAt)<new Date(e)});isExpiringSoon=h(()=>{let i=this.order();if(!i||!i.lockExpiresAt)return!1;let e=this.configService.currentTime(),l=new Date(i.lockExpiresAt),d=new Date(e),c=(l.getTime()-d.getTime())/(1e3*60*60);return c>0&&c<=12});remainingLockTime=h(()=>{let i=this.order();if(!i||!i.lockExpiresAt)return null;let e=this.configService.currentTime(),l=new Date(i.lockExpiresAt),d=new Date(e),c=l.getTime()-d.getTime();if(c<=0)return null;let j=Math.floor(c/(1e3*60*60)),T=Math.floor(c%(1e3*60*60)/(1e3*60));return{hours:j,minutes:T}});canRecordPayment=h(()=>this.amountDue()>0);formatCurrency=Me;formatDate=De;formatDateTime=Pe;getOrderStatus=X;getStatusBadgeClass=ye;getStatusLabel=Oe;getItemStatusBadgeClass=Se;getItemStatusLabel=we;async ngOnInit(){if(!this.userService.isAuthenticated()){await this.router.navigate(["/login"]);return}await this.loadOrder()}async loadOrder(){this.loading.set(!0),this.error.set(null);try{let i=await this.adminOrdersStore.getOrder(this.orderId(),!0);this.order.set(i),await this.loadUserData(i.userDisplayId)}catch(i){let e=i instanceof Error?i.message:String(i);this.error.set(e)}finally{this.loading.set(!1)}}async loadUserData(i){try{let e=await this.userService.getUserByDisplayId(i);if(e){this.userData.set({displayName:e.displayName,email:e.email,phone:e.primaryGuardian?.phone,address:e.primaryGuardian?.address?`${e.primaryGuardian.address.street}, ${e.primaryGuardian.address.city}, ${e.primaryGuardian.address.state} ${e.primaryGuardian.address.zipCode}`:void 0});let l=new Map;for(let d of e.students??[])l.set(d.id,`${d.firstName} ${d.lastName}`);this.studentMap.set(l)}}catch(e){console.error("Failed to load user data:",e)}}getClassName(i){return this.seasonService.classes().find(l=>l.id===i)?.name??i}getStudentName(i){return this.studentMap().get(i)??i}openRecordPaymentDialog(){this.formPayment.amountInput=k(this.amountDue()),this.formPayment.method="zelle",this.formPayment.reference="",this.formPayment.notes="",this.dialogMode.set("record-payment")}openCancelItemsDialog(){this.selectedItems.set(new Set),this.formCancel.reason="",this.dialogMode.set("cancel-items")}openRemoveWaitlistDialog(i){this.formRemoveWaitlist.sessionId=i,this.dialogMode.set("remove-waitlist")}openAddAdjustmentDialog(){this.formAdjustment.type="credit",this.formAdjustment.amountInput="",this.formAdjustment.reason="",this.dialogMode.set("add-adjustment")}closeDialog(){this.dialogMode.set(null),this.orderRpc.clearError()}onPaymentMethodChange(i){i==="cash"?this.formPayment.amountInput=k(this.cashAmountDue()):this.formPayment.amountInput=k(this.amountDue())}isItemSelected(i){let e=`${i.sessionId}::${i.studentId}`;return this.selectedItems().has(e)}toggleItemSelection(i){let e=`${i.sessionId}::${i.studentId}`,l=new Set(this.selectedItems());l.has(e)?l.delete(e):l.add(e),this.selectedItems.set(l)}async recordPayment(){let i=this.order();if(!i)return;let e=V(this.formPayment.amountInput);if(e<=0){this.notificationService.warning("Please enter a valid payment amount.");return}try{this.formPayment.method==="cash"&&this.cashDiscount()>0&&await this.orderRpc.addAdjustment({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,amount:-this.cashDiscount(),reason:"Cash payment discount (3%)"}),await this.orderRpc.recordPayment({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,amount:e,reference:this.formPayment.reference||null,method:this.formPayment.method,notes:this.formPayment.notes||null}),await this.loadOrder(),this.closeDialog()}catch(l){console.error("Failed to record payment:",l)}}async cancelItems(){let i=this.order();if(i){if(this.selectedItems().size===0){this.notificationService.warning("Please select at least one item to cancel.");return}if(!this.formCancel.reason.trim()){this.notificationService.warning("Please enter a cancellation reason.");return}try{let e=Array.from(this.selectedItems()).map(l=>{let[d,c]=l.split("::");return{sessionId:d,studentId:c}});await this.orderRpc.cancelItems({year:2026,seasonId:i.seasonId,items:e,reason:this.formCancel.reason,userAuthId:i.userAuthId}),await this.loadOrder(),this.closeDialog()}catch(e){console.error("Failed to cancel items:",e)}}}async removeWaitlist(){let i=this.order();if(i)try{await this.orderRpc.removeWaitlistEntry({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,sessionId:this.formRemoveWaitlist.sessionId}),await this.loadOrder(),this.closeDialog()}catch(e){console.error("Failed to remove waitlist entry:",e)}}async addAdjustment(){let i=this.order();if(!i)return;let e=V(this.formAdjustment.amountInput);if(e<=0){this.notificationService.warning("Please enter a valid amount.");return}if(!this.formAdjustment.reason.trim()){this.notificationService.warning("Please enter a reason for the adjustment.");return}let l=this.formAdjustment.type==="credit"?-e:e;try{await this.orderRpc.addAdjustment({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,amount:l,reason:this.formAdjustment.reason}),await this.loadOrder(),this.closeDialog(),this.notificationService.success(this.formAdjustment.type==="credit"?"Credit added successfully.":"Fee added successfully.")}catch(d){console.error("Failed to add adjustment:",d)}}getChangeStatusLabel(i){switch(i){case"pending":return"Pending";case"approved":return"Approved";case"denied":return"Denied";default:return i}}getActionDescription(i){let e=this.getClassName(i.target.sessionId),l=this.getStudentName(i.target.studentId);switch(i.type){case"remove_class":return`Remove from class: ${e} - ${l}`;case"add_addon":return`Add ${i.addon==="lunch"?"Lunch":"Extended Care"}: ${e} - ${l}`;case"remove_addon":return`Remove ${i.addon==="lunch"?"Lunch":"Extended Care"}: ${e} - ${l}`}}openUpdateAdjustmentDialog(i){this.formChangeRequest.requestId=i.id,this.formChangeRequest.actions=[...i.actions],this.formChangeRequest.adjustmentInput=i.adminAdjustment!==0?k(i.adminAdjustment):"",this.formChangeRequest.adjustmentReason=i.adminAdjustmentReason??"",this.formChangeRequest.adminNotes=i.adminNotes??"",this.dialogMode.set("update-adjustment")}openApproveChangeDialog(i){this.formChangeRequest.requestId=i.id,this.formChangeRequest.actions=[...i.actions],this.formChangeRequest.adminNotes=i.adminNotes??"",this.dialogMode.set("approve-change")}openDenyChangeDialog(i){this.formChangeRequest.requestId=i.id,this.formChangeRequest.actions=[...i.actions],this.formChangeRequest.adminNotes="",this.dialogMode.set("deny-change")}async updateAdjustment(){let i=this.order();if(i)try{let e=this.formChangeRequest.adjustmentInput.trim()?V(this.formChangeRequest.adjustmentInput):0;await this.orderRpc.updateChangeRequest({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,changeRequestId:this.formChangeRequest.requestId,adminAdjustment:e,adminAdjustmentReason:this.formChangeRequest.adjustmentReason||null,adminNotes:this.formChangeRequest.adminNotes||null}),await this.loadOrder(),this.closeDialog()}catch(e){console.error("Failed to update adjustment:",e)}}async approveChange(){let i=this.order();if(i)try{await this.orderRpc.approveChangeRequest({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,changeRequestId:this.formChangeRequest.requestId,adminNotes:this.formChangeRequest.adminNotes||null}),await this.loadOrder(),this.closeDialog()}catch(e){console.error("Failed to approve change request:",e)}}async denyChange(){let i=this.order();if(i&&this.formChangeRequest.adminNotes.trim())try{await this.orderRpc.denyChangeRequest({year:2026,seasonId:i.seasonId,userAuthId:i.userAuthId,changeRequestId:this.formChangeRequest.requestId,adminNotes:this.formChangeRequest.adminNotes}),await this.loadOrder(),this.closeDialog()}catch(e){console.error("Failed to deny change request:",e)}}clearError(){this.error.set(null)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-admin-order-detail"]],inputs:{orderId:[1,"orderId"]},decls:11,vars:10,consts:[[1,"admin-order-detail-container"],[1,"loading-state"],[1,"error-banner"],[1,"order-content"],[1,"modal-overlay"],[1,"spinner"],["type","button",1,"btn-close",3,"click"],[1,"order-header"],[1,"header-left"],["routerLink","/admin/orders",1,"back-link"],[1,"order-meta"],[1,"user-id"],[1,"status-badge",3,"ngClass"],[1,"header-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"info-card","user-info-card"],[1,"info-card","status-card"],[1,"status-details"],[1,"detail-row"],[1,"label"],[1,"value","status-badge",3,"ngClass"],[1,"value"],[1,"alert","alert-danger"],[1,"info-card","items-card"],[1,"card-header"],["type","button",1,"btn","btn-danger-outline","btn-sm"],[1,"items-section"],[1,"empty-state"],[1,"info-card"],[1,"info-card","pricing-card"],[1,"info-card","payments-card"],[1,"info-card","waitlist-card"],[1,"info-card","change-requests-card"],[1,"info-card","history-card"],[1,"user-details"],[1,"value",3,"ngClass"],[1,"remaining-time"],["type","button",1,"btn","btn-danger-outline","btn-sm",3,"click"],[1,"section-title"],[1,"item-count"],[1,"items-list"],[1,"item-card","locked"],[1,"item-header"],[1,"class-name"],[1,"item-status-badge",3,"ngClass"],[1,"item-details"],[1,"detail-item"],[3,"options","showEmpty"],[1,"item-card"],[1,"item-card","pending"],[3,"screenshots"],[3,"data"],[1,"payments-table"],[1,"amount"],[1,"method-badge"],[1,"waitlist-list"],[1,"waitlist-item"],[1,"waitlist-header"],[1,"waitlist-details"],[1,"change-requests-list"],[1,"change-request-item",3,"ngClass"],[1,"request-header"],[1,"request-info"],[1,"request-id"],[1,"request-status-badge",3,"ngClass"],[1,"request-details"],[1,"request-actions-list"],[1,"request-action-row"],[1,"request-meta"],[1,"meta-item"],[1,"request-actions"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],[1,"history-timeline"],[1,"history-event"],[1,"event-time"],[1,"event-details"],[1,"event-action"],[1,"event-metadata"],[1,"affected-items"],[1,"affected-item"],[1,"item-class"],[1,"item-student"],[1,"item-options"],[1,"option-tag"],[1,"modal-overlay",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"modal-body"],[3,"ngSubmit"],[1,"form-group"],["for","payment-amount"],["type","text","id","payment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text"],["for","payment-method"],["id","payment-method","name","method","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","zelle"],["value","check"],["value","cash"],["value","other"],[1,"cash-discount-info"],["for","payment-reference"],["type","text","id","payment-reference","name","reference","placeholder","Confirmation number, check number, etc.",1,"form-control",3,"ngModelChange","ngModel"],["for","payment-notes"],["id","payment-notes","name","notes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"cash-info-row"],[1,"cash-info-row","discount"],[1,"cash-info-row","total"],[1,"spinner-small"],[1,"items-checklist"],[1,"checkbox-item"],["for","cancel-reason"],["id","cancel-reason","name","reason","rows","3","placeholder","Enter reason for cancellation...","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-danger",3,"disabled"],["type","checkbox",3,"change","checked"],[1,"item-info"],[1,"student-name"],[1,"read-only-value"],[1,"alert","alert-warning"],["for","adjustment-amount"],["type","text","id","adjustment-amount","name","adjustment","placeholder","0.00 (positive = fee, negative = credit)",1,"form-control",3,"ngModelChange","ngModel"],["for","adjustment-reason"],["id","adjustment-reason","name","adjustmentReason","rows","2","placeholder","Explain the adjustment...",1,"form-control",3,"ngModelChange","ngModel"],["for","adjustment-notes"],["id","adjustment-notes","name","notes","rows","2","placeholder","Optional notes (visible to user)...",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-info"],[1,"items-list-readonly"],[1,"item-row"],["for","approve-notes"],["id","approve-notes","name","notes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],["for","deny-notes"],["id","deny-notes","name","notes","rows","3","placeholder","Please provide a reason for denying this request...","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","adjustment-type"],["id","adjustment-type","name","type","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","credit"],["value","fee"],["type","text","id","adjustment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],["id","adjustment-reason","name","reason","rows","3","placeholder","Explain the reason for this adjustment...","required","",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,l){e&1&&(t(0,"div",0),u(1,je,4,0,"div",1),u(2,Ne,6,1,"div",2),u(3,yt,54,22,"div",3),u(4,Dt,43,10,"div",4),u(5,kt,26,5,"div",4),u(6,Rt,23,5,"div",4),u(7,Ft,37,8,"div",4),u(8,Ut,33,6,"div",4),u(9,Jt,27,6,"div",4),u(10,Xt,36,8,"div",4),o()),e&2&&(r(),_(l.loading()?1:-1),r(),_(l.error()&&!l.loading()?2:-1),r(),_(l.order()&&!l.loading()?3:-1),r(),_(l.dialogMode()==="record-payment"?4:-1),r(),_(l.dialogMode()==="cancel-items"?5:-1),r(),_(l.dialogMode()==="remove-waitlist"?6:-1),r(),_(l.dialogMode()==="update-adjustment"?7:-1),r(),_(l.dialogMode()==="approve-change"?8:-1),r(),_(l.dialogMode()==="deny-change"?9:-1),r(),_(l.dialogMode()==="add-adjustment"?10:-1))},dependencies:[G,U,xe,me,ue,_e,re,pe,de,le,ge,ce,se,Y,fe,he,Ce],styles:[".admin-order-detail-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:15px;border-radius:4px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.btn-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;cursor:pointer;color:inherit}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e0e0e0}.header-left[_ngcontent-%COMP%]{flex:1}.back-link[_ngcontent-%COMP%]{color:#3498db;text-decoration:none;margin-bottom:10px;display:inline-block}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.order-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:10px 0;font-size:28px}.order-meta[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center;margin-top:10px}.user-id[_ngcontent-%COMP%]{color:#666;font-size:14px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.info-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:20px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;color:#333}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.user-details[_ngcontent-%COMP%], .status-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.status-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:4px;font-size:12px;font-weight:600;text-transform:uppercase;display:inline-block}.status-submitted[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-paid[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-cancelled[_ngcontent-%COMP%], .status-refunded[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-partial[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460}.status-empty[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.remaining-time[_ngcontent-%COMP%]{font-size:12px;color:#666}.alert[_ngcontent-%COMP%]{padding:12px 16px;border-radius:4px;margin-top:15px}.alert-danger[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.alert-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}.alert-info[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}.items-section[_ngcontent-%COMP%]{margin-bottom:30px}.items-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:15px;color:#333}.item-count[_ngcontent-%COMP%]{color:#666;font-weight:400;font-size:14px}.items-list[_ngcontent-%COMP%]{display:grid;gap:12px}.item-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.item-card.locked[_ngcontent-%COMP%]{background:#f3e5f5;border-color:#ce93d8}.item-card.pending[_ngcontent-%COMP%]{background:#fff3cd;border-color:#ffeaa7}.item-card.cancelled[_ngcontent-%COMP%]{background:#f8d7da;border-color:#f5c6cb;opacity:.7}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.class-name[_ngcontent-%COMP%]{font-weight:600;color:#333}.item-status-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:3px;font-size:11px;font-weight:600;text-transform:uppercase}.item-status-locked[_ngcontent-%COMP%]{background:#7b1fa2;color:#fff}.item-status-submitted[_ngcontent-%COMP%]{background:#ffc107;color:#000}.item-status-paid[_ngcontent-%COMP%]{background:#28a745;color:#fff}.item-status-cancelled[_ngcontent-%COMP%], .item-status-refunded[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.detail-item[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:14px}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.option-badge[_ngcontent-%COMP%]{background:#007bff;color:#fff;padding:2px 8px;border-radius:3px;font-size:11px;margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px;background:#f8f9fa;border-bottom:2px solid #dee2e6;font-weight:600}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #dee2e6}.payments-table[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-weight:600}.method-badge[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;text-transform:uppercase}.waitlist-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.waitlist-item[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.waitlist-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.promoted-badge[_ngcontent-%COMP%]{background:#28a745;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;font-weight:600}.waitlist-details[_ngcontent-%COMP%]{margin-bottom:10px}.history-timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.history-event[_ngcontent-%COMP%]{display:flex;gap:15px;padding:12px;background:#f8f9fa;border-radius:6px}.event-time[_ngcontent-%COMP%]{color:#666;font-size:12px;white-space:nowrap;min-width:150px}.event-details[_ngcontent-%COMP%]{flex:1}.event-action[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.event-metadata[_ngcontent-%COMP%]{color:#666;font-size:14px}.affected-items[_ngcontent-%COMP%]{margin-top:8px;padding:8px;background:#e9ecef;border-radius:4px}.affected-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:13px;border-bottom:1px solid #dee2e6}.affected-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.affected-item[_ngcontent-%COMP%]   .item-class[_ngcontent-%COMP%]{font-weight:500;color:#333}.affected-item[_ngcontent-%COMP%]   .item-student[_ngcontent-%COMP%]{color:#666}.affected-item[_ngcontent-%COMP%]   .item-options[_ngcontent-%COMP%]{display:flex;gap:4px;margin-left:auto}.affected-item[_ngcontent-%COMP%]   .option-tag[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:2px 6px;border-radius:3px;font-size:10px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-primary-outline[_ngcontent-%COMP%]{background:#fff;color:#007bff;border:1px solid #007bff}.btn-primary-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#007bff;color:#fff}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-danger-outline[_ngcontent-%COMP%]{background:#fff;color:#dc3545;border:1px solid #dc3545}.btn-danger-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc3545;color:#fff}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.modal-body[_ngcontent-%COMP%]{padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:8px;color:#333}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:14px}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.form-text[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:12px;color:#6c757d}.items-checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow-y:auto;padding:8px;background:#f8f9fa;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:8px;cursor:pointer}.checkbox-item[_ngcontent-%COMP%]:hover{background:#e9ecef;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.item-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.read-only-value[_ngcontent-%COMP%]{padding:8px 12px;background:#f8f9fa;border-radius:4px;font-weight:500}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px;padding-top:20px;border-top:1px solid #dee2e6}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite;margin-right:8px}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.change-requests-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.change-request-item[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:8px;padding:16px;background:#f8f9fa}.change-request-item.status-pending[_ngcontent-%COMP%]{border-left:4px solid #ffc107}.change-request-item.status-approved[_ngcontent-%COMP%]{border-left:4px solid #28a745}.change-request-item.status-denied[_ngcontent-%COMP%]{border-left:4px solid #dc3545;opacity:.7}.change-request-item[_ngcontent-%COMP%]   .request-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.change-request-item[_ngcontent-%COMP%]   .request-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.change-request-item[_ngcontent-%COMP%]   .request-id[_ngcontent-%COMP%]{font-weight:600;color:#495057}.request-status-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}.request-status-badge.status-pending[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.request-status-badge.status-approved[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.request-status-badge.status-denied[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.change-request-item[_ngcontent-%COMP%]   .request-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.change-request-item[_ngcontent-%COMP%]   .request-actions-list[_ngcontent-%COMP%]{font-size:14px}.change-request-item[_ngcontent-%COMP%]   .request-action-row[_ngcontent-%COMP%]{margin-left:16px;color:#666;padding:4px 0}.change-request-item[_ngcontent-%COMP%]   .request-meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:13px}.change-request-item[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]{display:flex;gap:8px}.change-request-item[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666;min-width:130px}.change-request-item[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.change-request-item[_ngcontent-%COMP%]   .request-actions[_ngcontent-%COMP%]{display:flex;gap:10px;padding-top:12px;border-top:1px solid #dee2e6}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.items-list-readonly[_ngcontent-%COMP%]{background:#f8f9fa;padding:12px;border-radius:4px}.items-list-readonly[_ngcontent-%COMP%]   .item-row[_ngcontent-%COMP%]{padding:4px 0;color:#495057}.cash-discount-info[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #c8e6c9;border-radius:8px;padding:12px;margin-bottom:15px}.cash-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.cash-info-row.discount[_ngcontent-%COMP%]{color:#2e7d32}.cash-info-row.total[_ngcontent-%COMP%]{font-weight:600;font-size:16px;border-top:1px solid #c8e6c9;padding-top:8px;margin-top:4px}.cash-discount-info[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{margin-top:8px;color:#666;font-style:italic}"]})};export{Ee as AdminOrderDetailComponent};
