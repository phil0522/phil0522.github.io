import{a as N,b as R}from"./chunk-SPS2R4NS.js";import"./chunk-4CC2DXAZ.js";import"./chunk-HBOBTVUD.js";import{g as L}from"./chunk-OD6KCV5K.js";import"./chunk-FYGYBRKK.js";import"./chunk-NR6WXTS5.js";import"./chunk-L5OFKJS2.js";import{a as T}from"./chunk-EUESG25O.js";import{b as F}from"./chunk-3NM435RE.js";import{d as E,j as I}from"./chunk-UIQMLXH2.js";import{Bb as a,Cb as S,Db as u,Ia as d,R as _,Sb as c,Ta as D,W as y,X as x,a as h,b as P,bb as m,cb as p,eb as k,fb as w,gb as b,ha as M,hb as o,ib as i,jb as C,nb as O,pb as g,rb as l,zb as f}from"./chunk-6GAPJCXB.js";var z=(r,n)=>n.sessionId;function B(r,n){if(r&1&&(o(0,"div",12)(1,"span",13),a(2,"\u26A0\uFE0F"),i(),o(3,"div",14)(4,"strong"),a(5,"Payment deadline has passed"),i(),o(6,"span",15),a(7),i()()()),r&2){let t=l(2);d(7),u(" Deadline was: ",t.formatDeadline(t.orderService.lockExpiresAt())," ")}}function A(r,n){if(r&1&&(o(0,"div",12)(1,"span",13),a(2,"\u23F0"),i(),o(3,"div",14)(4,"strong"),a(5),i(),o(6,"span",15),a(7),i()()()),r&2){let t=l(2);d(5),S(t.daysRemainingText()),d(2),u(" Deadline: ",t.formatDeadline(t.orderService.lockExpiresAt())," ")}}function V(r,n){if(r&1&&(o(0,"div",11),m(1,B,8,1,"div",12)(2,A,8,2,"div",12),i()),r&2){let t=l();f("overdue",t.orderService.isOverdue()),d(),p(t.orderService.isOverdue()?1:2)}}function j(r,n){r&1&&(o(0,"div",6),C(1,"div",16),o(2,"p"),a(3,"Loading..."),i()())}function U(r,n){if(r&1){let t=O();o(0,"div",7)(1,"div",17),a(2,"!"),i(),o(3,"p"),a(4),i(),o(5,"button",18),g("click",function(){y(t);let s=l();return x(s.orderService.clearError())}),a(6,"Retry"),i()()}if(r&2){let t=l();d(4),S(t.orderService.error())}}function Y(r,n){if(r&1){let t=O();o(0,"div",19),a(1,"\u{1F4E6}"),i(),o(2,"h2"),a(3,"No Enrollments"),i(),o(4,"p"),a(5,"You don't have any enrollments yet"),i(),o(6,"button",20),g("click",function(){y(t);let s=l(2);return x(s.goToCatalog())}),a(7,"Browse Classes"),i()}}function $(r,n){if(r&1&&(o(0,"div",19),a(1,"\u{1F50D}"),i(),o(2,"h2"),a(3),i(),o(4,"p"),a(5,"Try a different filter"),i()),r&2){let t=l(2);d(3),u("No ",t.filterName()," enrollments")}}function q(r,n){if(r&1&&(o(0,"div",8),m(1,Y,8,0)(2,$,6,1),i()),r&2){let t=l();d(),p(t.activeFilter()==="all"?1:2)}}function H(r,n){if(r&1&&C(0,"app-class-registration-card",21),r&2){let t=n.$implicit;b("data",t)("showGroupStatus",!0)("showStudentStatus",t.status==="mixed")}}function J(r,n){if(r&1&&(o(0,"div",9),k(1,H,1,3,"app-class-registration-card",21,z),i()),r&2){let t=l();d(),w(t.filteredGroupedItems())}}function K(r,n){if(r&1&&(o(0,"div",10)(1,"h2"),a(2,"Summary"),i(),C(3,"app-price-breakdown",22),i()),r&2){let t=l();d(3),b("data",t.priceBreakdownData())}}var G=class r{orderService=_(L);configService=_(T);userService=_(F);router=_(I);activeFilter=M("all");cancelledCount=c(()=>this.orderService.cancelledItems().length);groupedItems=c(()=>{let n=this.orderService.items(),t=new Map;for(let e of n){let s={studentId:e.studentId,studentName:this.userService.getStudentById(e.studentId)?.fullName??"Unknown",options:e.options,status:e.status},v=t.get(e.sessionId);v?(v.students.push(s),v.status!==e.status&&v.status!=="mixed"&&(v.status="mixed")):t.set(e.sessionId,{sessionId:e.sessionId,className:e.snapshot.className,startDate:e.snapshot.startDate,endDate:e.snapshot.endDate,status:e.status,students:[s]})}return Array.from(t.values()).sort((e,s)=>e.className.localeCompare(s.className))});groupedItemsCount=c(()=>this.groupedItems().length);filteredGroupedItems=c(()=>{let n=this.activeFilter(),t=this.groupedItems();return n==="all"?t:t.map(e=>P(h({},e),{students:e.students.filter(s=>s.status===n)})).filter(e=>e.students.length>0)});filterName=c(()=>{let n=this.activeFilter();return{all:"All",submitted:"Pending Payment",paid:"Paid",cancelled:"Cancelled"}[n]});priceBreakdownData=c(()=>{let n=this.orderService.pricing();return n?{pricing:n,couponCredit:0,totalPaid:this.orderService.totalPaid(),totalRefunded:this.orderService.totalRefunded(),amountDue:this.orderService.amountDue()}:null});showPaymentDeadline=c(()=>this.orderService.hasSubmittedItems()&&this.orderService.lockExpiresAt()!==null);daysRemaining=c(()=>{let n=this.orderService.lockExpiresAt();if(!n)return null;let t=new Date(this.configService.currentTime()),s=new Date(n).getTime()-t.getTime();return s<=0?null:Math.ceil(s/(1e3*60*60*24))});daysRemainingText=c(()=>{let n=this.daysRemaining();return n===null?"":n===1?"You have 1 day to complete payment":`You have ${n} days to complete payment`});setFilter(n){this.activeFilter.set(n)}goToCatalog(){this.router.navigate(["/catalog"])}formatDeadline(n){return n?new Date(n).toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}):""}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=D({type:r,selectors:[["app-order-list"]],decls:21,vars:18,consts:[[1,"order-list-page"],[1,"page-header"],[1,"subtitle"],[1,"payment-deadline-banner",3,"overdue"],[1,"filter-tabs"],[1,"tab",3,"click"],[1,"loading-container"],[1,"error-container"],[1,"empty-container"],[1,"orders-grid"],[1,"orders-summary"],[1,"payment-deadline-banner"],[1,"deadline-content"],[1,"deadline-icon"],[1,"deadline-text"],[1,"deadline-detail"],[1,"spinner"],[1,"error-icon"],[1,"btn-retry",3,"click"],[1,"empty-icon"],[1,"btn-primary",3,"click"],[3,"data","showGroupStatus","showStudentStatus"],[3,"data"]],template:function(t,e){t&1&&(o(0,"div",0)(1,"header",1)(2,"h1"),a(3,"My Orders"),i(),o(4,"p",2),a(5,"View and manage your orders"),i()(),m(6,V,3,3,"div",3),o(7,"div",4)(8,"button",5),g("click",function(){return e.setFilter("all")}),a(9),i(),o(10,"button",5),g("click",function(){return e.setFilter("submitted")}),a(11),i(),o(12,"button",5),g("click",function(){return e.setFilter("paid")}),a(13),i(),o(14,"button",5),g("click",function(){return e.setFilter("cancelled")}),a(15),i()(),m(16,j,4,0,"div",6),m(17,U,7,1,"div",7),m(18,q,3,1,"div",8),m(19,J,3,0,"div",9),m(20,K,4,1,"div",10),i()),t&2&&(d(6),p(e.showPaymentDeadline()?6:-1),d(2),f("active",e.activeFilter()==="all"),d(),u(" All (",e.groupedItemsCount(),") "),d(),f("active",e.activeFilter()==="submitted"),d(),u(" Pending Payment (",e.orderService.submittedCount(),") "),d(),f("active",e.activeFilter()==="paid"),d(),u(" Paid (",e.orderService.paidCount(),") "),d(),f("active",e.activeFilter()==="cancelled"),d(),u(" Cancelled (",e.cancelledCount(),") "),d(),p(e.orderService.loading()?16:-1),d(),p(e.orderService.error()?17:-1),d(),p(!e.orderService.loading()&&!e.orderService.error()&&e.filteredGroupedItems().length===0?18:-1),d(),p(e.filteredGroupedItems().length>0?19:-1),d(),p(e.priceBreakdownData()?20:-1))},dependencies:[E,R,N],styles:[".order-list-page[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.payment-deadline-banner[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;border-radius:12px;padding:1rem 1.25rem;margin-bottom:1.5rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);border-color:var(--sys-error, #c62828)}.deadline-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.deadline-icon[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1}.deadline-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#856404;font-size:1rem}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--sys-error, #c62828)}.deadline-detail[_ngcontent-%COMP%]{font-size:.875rem;color:#6c757d}.payment-deadline-banner.overdue[_ngcontent-%COMP%]   .deadline-detail[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem;color:var(--sys-on-surface, #212121)}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);overflow-x:auto}.tab[_ngcontent-%COMP%]{padding:.5rem 1rem;background:transparent;border:1px solid var(--sys-outline, #e0e0e0);border-radius:20px;font-size:.875rem;color:var(--sys-on-surface-variant, #666);cursor:pointer;white-space:nowrap;transition:all .2s ease}.tab[_ngcontent-%COMP%]:hover{border-color:var(--sys-primary, #c62828);color:var(--sys-primary, #c62828)}.tab.active[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828);color:#fff}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--sys-on-surface-variant, #666)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c);margin-bottom:1rem}.btn-retry[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:var(--sys-error, #c62828);color:#fff;border:none;border-radius:6px;cursor:pointer}.empty-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--sys-on-surface, #212121)}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666);margin-bottom:1.5rem}.btn-primary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}.orders-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.orders-summary[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;background:var(--sys-surface-container, #fafafa);border-radius:12px;border:1px solid var(--sys-outline-variant, #e0e0e0)}.orders-summary[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem;color:var(--sys-on-surface, #212121)}"]})};export{G as OrderListComponent};
