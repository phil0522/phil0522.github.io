import{a as T,b as z}from"./chunk-2UR2POCV.js";import"./chunk-URCISTJ5.js";import{a as V}from"./chunk-WCUSQBFW.js";import{d as L,k as A,va as D}from"./chunk-TX2MCR52.js";import{Ab as i,Bb as p,Cb as C,Ha as s,R as v,Rb as I,Sa as w,W as _,X as u,a as M,ab as m,b as O,bb as g,db as S,eb as k,fb as E,gb as e,ha as f,hb as n,ib as W,mb as x,ob as y,qb as d}from"./chunk-EVJ2WVWM.js";var U=(o,r)=>r.userId+r.sessionId;function $(o,r){if(o&1){let t=x();e(0,"div",4),i(1),e(2,"button",8),y("click",function(){_(t);let l=d();return u(l.loadWaitlistEntries())}),i(3,"Retry"),n()()}if(o&2){let t=d();s(),C(" ",t.error()," ")}}function B(o,r){o&1&&(e(0,"div",5),W(1,"div",9),e(2,"p"),i(3,"Loading..."),n()())}function Y(o,r){o&1&&(e(0,"div",6)(1,"div",10),i(2,"\u{1F4CB}"),n(),e(3,"h2"),i(4,"No Waitlist Entries"),n(),e(5,"p"),i(6,"No one is currently on any waitlist"),n()())}function G(o,r){o&1&&(e(0,"span",23),i(1,"Promoted"),n())}function J(o,r){o&1&&(e(0,"span",24),i(1,"Eligible"),n())}function q(o,r){if(o&1&&(e(0,"span",25),i(1),n()),o&2){let t=d().$implicit;s(),C(" ",t.hoursUntilEligible,"h until eligible ")}}function H(o,r){if(o&1){let t=x();e(0,"button",29),y("click",function(){_(t);let l=d().$implicit,b=d(2);return u(b.promoteEntry(l))}),i(1," Promote "),n()}if(o&2){let t=d(3);E("disabled",t.actionLoading())}}function K(o,r){o&1&&(e(0,"span",28),i(1,"Already promoted"),n())}function Q(o,r){if(o&1&&(e(0,"tr",13)(1,"td",14),i(2),n(),e(3,"td",15)(4,"span",16),i(5),n(),e(6,"span",17),i(7),n()(),e(8,"td",18)(9,"span",19),i(10),n(),e(11,"span",20),i(12),n()(),e(13,"td",21),i(14),n(),e(15,"td",22),m(16,G,2,0,"span",23)(17,J,2,0,"span",24)(18,q,2,1,"span",25),n(),e(19,"td",26),m(20,H,2,1,"button",27)(21,K,2,0,"span",28),n()()),o&2){let t=r.$implicit,a=d(2);s(2),p(t.position),s(3),p(t.userName),s(2),p(t.userId),s(3),p(t.className),s(2),p(t.sessionId),s(2),C(" ",a.formatDate(t.joinedAt)," "),s(2),g(t.isPromoted?16:t.isEligible?17:18),s(4),g(t.isPromoted?21:20)}}function X(o,r){if(o&1&&(e(0,"div",11),i(1),n(),e(2,"div",12)(3,"table")(4,"thead")(5,"tr")(6,"th"),i(7,"#"),n(),e(8,"th"),i(9,"User"),n(),e(10,"th"),i(11,"Class"),n(),e(12,"th"),i(13,"Joined"),n(),e(14,"th"),i(15,"Status"),n(),e(16,"th"),i(17,"Actions"),n()()(),e(18,"tbody"),S(19,Q,22,8,"tr",13,U),n()()()),o&2){let t=d();s(),C("Total ",t.entries().length," waitlist entries"),s(18),k(t.entries())}}function Z(o,r){if(o&1){let t=x();e(0,"div",30),y("click",function(){_(t);let l=d();return u(l.closePromoteDialog())}),e(1,"div",31),y("click",function(l){return _(t),u(l.stopPropagation())}),e(2,"h3"),i(3,"Promote Waitlist Entry"),n(),e(4,"p"),i(5," Promote "),e(6,"strong"),i(7),n(),i(8," for "),e(9,"strong"),i(10),n(),i(11,"? "),n(),e(12,"p",32),i(13," This will allow the user to immediately claim the spot when a vacancy occurs, bypassing the maturity period. "),n(),e(14,"div",33)(15,"button",34),y("click",function(){_(t);let l=d();return u(l.closePromoteDialog())}),i(16,"Cancel"),n(),e(17,"button",35),y("click",function(){_(t);let l=d();return u(l.confirmPromote())}),i(18),n()()()()}if(o&2){let t,a,l=d();s(7),p((t=l.selectedEntry())==null?null:t.userId),s(3),p((a=l.selectedEntry())==null?null:a.className),s(7),E("disabled",l.actionLoading()),s(),C(" ",l.actionLoading()?"Promoting...":"Confirm Promote"," ")}}var N=class o{orderDatastore=v(T);orderRpc=v(z);configService=v(V);_entries=f([]);_loading=f(!1);_error=f(null);_actionLoading=f(!1);_showPromoteDialog=f(!1);_selectedEntry=f(null);entries=this._entries.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();actionLoading=this._actionLoading.asReadonly();showPromoteDialog=this._showPromoteDialog.asReadonly();selectedEntry=this._selectedEntry.asReadonly();currentTime=I(()=>this.configService.currentTime());async ngOnInit(){await this.loadWaitlistEntries()}async loadWaitlistEntries(){this._loading.set(!0),this._error.set(null);try{let r=this.configService.currentActiveYear(),t=await this.orderDatastore.listAllWaitlistEntries(r),a=this.currentTime(),l=new Map;for(let c of t){let h=l.get(c.sessionId)??[];h.push(c),l.set(c.sessionId,h)}let b=t.map(c=>{let R=(l.get(c.sessionId)??[]).findIndex(j=>j.userId===c.userId)+1,F={sessionId:c.sessionId,joinedAt:c.joinedAt,isPromoted:c.isPromoted},P=D(F,a);return O(M({},c),{position:R,isEligible:P.isEligible,hoursUntilEligible:P.hoursUntilEligible?Math.ceil(P.hoursUntilEligible):void 0})});this._entries.set(b)}catch(r){let t=r instanceof Error?r.message:"Failed to load waitlist entries";this._error.set(t)}finally{this._loading.set(!1)}}promoteEntry(r){this._selectedEntry.set(r),this._showPromoteDialog.set(!0)}closePromoteDialog(){this._showPromoteDialog.set(!1),this._selectedEntry.set(null)}async confirmPromote(){let r=this._selectedEntry();if(r){this._actionLoading.set(!0);try{let t=this.configService.currentActiveYear();await this.orderRpc.promoteWaitlistEntry({year:t,userAuthId:r.userId,sessionId:r.sessionId}),this.closePromoteDialog(),await this.loadWaitlistEntries()}catch(t){let a=t instanceof Error?t.message:"Failed to promote entry";this._error.set(a)}finally{this._actionLoading.set(!1)}}}formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=w({type:o,selectors:[["app-admin-waitlist-list"]],decls:13,vars:5,consts:[[1,"admin-waitlist"],[1,"page-header"],["routerLink","/admin",1,"back-link"],[1,"subtitle"],[1,"error"],[1,"loading"],[1,"empty"],[1,"dialog-overlay"],[1,"btn","btn-sm",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"results-count"],[1,"entries-table"],[1,"waitlist-entry"],[1,"position"],[1,"user-info"],[1,"user-name"],[1,"user-id"],[1,"class-info"],[1,"class-name"],[1,"session-id"],[1,"join-date"],[1,"status"],[1,"badge","badge-promoted"],[1,"badge","badge-eligible"],[1,"badge","badge-pending"],[1,"actions"],[1,"btn","btn-sm","btn-primary",3,"disabled"],[1,"promoted-text"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[1,"dialog-overlay",3,"click"],[1,"dialog",3,"click"],[1,"dialog-note"],[1,"dialog-actions"],[1,"btn","btn-outline",3,"click"],[1,"btn","btn-primary",3,"click","disabled"]],template:function(t,a){t&1&&(e(0,"div",0)(1,"header",1)(2,"a",2),i(3,"\u2190 Back to Console"),n(),e(4,"h1"),i(5,"Waitlist Management"),n(),e(6,"p",3),i(7,"View and manage waitlist entries"),n()(),m(8,$,4,1,"div",4),m(9,B,4,0,"div",5),m(10,Y,7,0,"div",6),m(11,X,21,1),m(12,Z,19,4,"div",7),n()),t&2&&(s(8),g(a.error()?8:-1),s(),g(a.loading()?9:-1),s(),g(!a.loading()&&!a.error()&&a.entries().length===0?10:-1),s(),g(!a.loading()&&a.entries().length>0?11:-1),s(),g(a.showPromoteDialog()?12:-1))},dependencies:[L,A],styles:[".admin-waitlist[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-link[_ngcontent-%COMP%]{display:inline-block;color:var(--sys-primary, #c62828);text-decoration:none;font-size:.875rem;margin-bottom:.5rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.results-count[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{padding:1.5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.empty[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:var(--sys-on-surface-variant, #666)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.entries-table[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid var(--sys-outline-variant, #e0e0e0)}th[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);font-weight:600;font-size:.875rem;color:var(--sys-on-surface-variant, #666)}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.position[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-primary, #c62828)}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.user-name[_ngcontent-%COMP%]{font-weight:500}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.class-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:500}.session-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.join-date[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge-promoted[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32)}.badge-eligible[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.badge-pending[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666)}.promoted-text[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-secondary, #2e7d32)}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-outline[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);color:var(--sys-on-surface, #212121)}.btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5)}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.8125rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem}.dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--sys-on-surface-variant, #666)}.dialog-note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-tertiary, #1976d2)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--sys-outline-variant, #e0e0e0)}@media(max-width:768px){th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.6875rem}}"]})};export{N as AdminWaitlistListComponent};
