import{g as j}from"./chunk-KWH3YEID.js";import{h as $}from"./chunk-OFYILGNH.js";import"./chunk-XQE4VKQH.js";import{a as F}from"./chunk-CFIO2EPB.js";import"./chunk-7VTHX3C4.js";import"./chunk-PVPSCU6Z.js";import{d as h,j as N}from"./chunk-2LEHUDM5.js";import{Ab as n,Bb as S,Cb as y,Ha as c,R as x,Rb as b,Sa as w,Tb as T,Ub as V,W as m,X as _,ab as p,bb as g,db as P,eb as O,fb as k,gb as r,ha as E,hb as a,ib as I,jb as u,kb as d,lb as R,mb as f,nb as W,ob as C,pb as D,qb as s,yb as z}from"./chunk-EVJ2WVWM.js";function q(e,i){e&1&&(R(0,"span",11),n(1," Spot Available "))}function U(e,i){e&1&&n(0," Eligible ")}function H(e,i){e&1&&n(0," Pending ")}function J(e,i){e&1&&(u(0,"div",12)(1,"span",14),n(2,"\u2B50"),d(),n(3," Spot Available (Promoted) "),d())}function G(e,i){if(e&1&&(u(0,"div",13)(1,"span",14),n(2,"\u2713"),d(),n(3),d()),e&2){let t=s(2);c(3),y(" Spot Available - ",t.entry().claimableSpots," spot(s) ")}}function K(e,i){if(e&1&&p(0,J,4,0,"div",12)(1,G,4,1,"div",13),e&2){let t=s();g(t.entry().eligibility.reason==="promoted"?0:1)}}function Q(e,i){e&1&&(u(0,"div",15)(1,"span",14),n(2,"\u23F3"),d(),n(3," Waiting for Cancellation "),d(),u(4,"div",16),n(5,"You're eligible to claim. Waiting for someone to cancel."),d())}function X(e,i){if(e&1&&(u(0,"div",7)(1,"div",17)(2,"span",14),n(3,"\u23F3"),d(),n(4," Pending "),d(),u(5,"div",18)(6,"span",19),n(7,"Eligible in:"),d(),u(8,"span",20),n(9),d()()()),e&2){let t=s();c(9),S(t.countdownText())}}function Z(e,i){if(e&1){let t=f();u(0,"button",21),D("click",function(){m(t);let l=s();return _(l.onClaimSpot())}),n(1," Claim Spot "),d()}if(e&2){let t=s();W("disabled",t.loading())}}var M=class e{entry=V.required();loading=V(!1);claimSpot=T();remove=T();isEligible=b(()=>this.entry().eligibility.isEligible);isClaimable=b(()=>this.entry().isClaimable);countdownText=b(()=>{let i=this.entry().eligibility.hoursUntilEligible;if(i===null||i<=0)return"Available soon";let t=Math.floor(i),o=Math.round((i-t)*60);return t>0?`${t}h ${o}m`:`${o} minutes`});onClaimSpot(){this.claimSpot.emit()}onRemove(){this.remove.emit()}formatDate(i){return new Date(i).toLocaleString("en-US",{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-waitlist-entry-card"]],inputs:{entry:[1,"entry"],loading:[1,"loading"]},outputs:{claimSpot:"claimSpot",remove:"remove"},decls:19,vars:10,consts:[[1,"waitlist-card"],[1,"card-header"],[1,"class-info"],[1,"class-name"],[1,"class-dates"],[1,"status-indicator"],[1,"eligibility-section"],[1,"countdown-section"],[1,"card-actions"],[1,"btn-primary",3,"disabled"],[1,"btn-secondary",3,"click","disabled"],[1,"indicator-dot"],[1,"status-badge","promoted"],[1,"status-badge","eligible"],[1,"icon"],[1,"status-badge","waiting-spot"],[1,"waiting-note"],[1,"status-badge","pending"],[1,"countdown"],[1,"countdown-label"],[1,"countdown-time"],[1,"btn-primary",3,"click","disabled"]],template:function(t,o){t&1&&(u(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),n(4),d(),u(5,"div",4),n(6),d()(),u(7,"div",5),p(8,q,2,0)(9,U,1,0)(10,H,1,0),d()(),u(11,"div",6),p(12,K,2,1)(13,Q,6,0)(14,X,10,1,"div",7),d(),u(15,"div",8),p(16,Z,2,1,"button",9),u(17,"button",10),D("click",function(){return o.onRemove()}),n(18," Leave Waitlist "),d()()()),t&2&&(c(4),y("Class ",o.entry().sessionId),c(2),y("Joined: ",o.formatDate(o.entry().joinedAt)),c(),z("eligible",o.isEligible())("claimable",o.isClaimable()),c(),g(o.isClaimable()?8:o.isEligible()?9:10),c(4),g(o.isClaimable()?12:o.isEligible()?13:14),c(4),g(o.isClaimable()?16:-1),c(),W("disabled",o.loading()))},dependencies:[h],styles:[".waitlist-card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline, #e0e0e0);border-radius:12px;padding:1.25rem;margin-bottom:1rem;transition:box-shadow .2s ease}.waitlist-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #00000014}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}.class-info[_ngcontent-%COMP%]{flex:1}.class-name[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:1.1rem;color:var(--sys-on-surface, #212121)}.class-dates[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.status-indicator[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666);padding:.375rem .75rem;border-radius:16px;font-size:.875rem;font-weight:500;display:flex;align-items:center;gap:.375rem}.status-indicator.eligible[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.status-indicator.claimable[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32)}.indicator-dot[_ngcontent-%COMP%]{width:8px;height:8px;background:var(--sys-secondary, #2e7d32);border-radius:50%;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.eligibility-section[_ngcontent-%COMP%]{margin-bottom:1rem}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.375rem;padding:.375rem .75rem;border-radius:16px;font-size:.875rem;font-weight:500}.status-badge[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:.9rem}.status-badge.eligible[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32)}.status-badge.promoted[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-badge.pending[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.status-badge.waiting-spot[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.waiting-note[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.8rem;color:var(--sys-on-surface-variant, #666);font-style:italic}.countdown-section[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.countdown[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.countdown-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.countdown-time[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--sys-tertiary, #1976d2)}.card-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.btn-primary[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:.95rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-primary[_ngcontent-%COMP%]:disabled{background:var(--sys-outline, #ccc);cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fff;color:var(--sys-on-surface-variant, #666);border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;font-size:.95rem;cursor:pointer;transition:all .2s ease}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5);border-color:var(--sys-on-surface-variant, #666)}.btn-secondary[_ngcontent-%COMP%]:disabled{color:var(--sys-outline, #ccc);cursor:not-allowed}"]})};var L=(e,i)=>i.sessionId;function tt(e,i){e&1&&(r(0,"div",3),I(1,"div",8),r(2,"p"),n(3,"Loading..."),a()())}function et(e,i){if(e&1){let t=f();r(0,"div",4)(1,"div",9),n(2,"!"),a(),r(3,"p"),n(4),a(),r(5,"button",10),C("click",function(){m(t);let l=s();return _(l.orderService.clearError())}),n(6,"Retry"),a()()}if(e&2){let t=s();c(4),S(t.orderService.error())}}function nt(e,i){if(e&1){let t=f();r(0,"div",5)(1,"div",11),n(2,"\u{1F4CB}"),a(),r(3,"h2"),n(4,"No Waitlist Entries"),a(),r(5,"p"),n(6,"You haven't joined the waitlist for any classes yet"),a(),r(7,"button",12),C("click",function(){m(t);let l=s();return _(l.goToCatalog())}),n(8,"Browse Classes"),a()()}}function it(e,i){if(e&1&&(r(0,"span",15),n(1),a()),e&2){let t=s(2);c(),y(" ",t.orderService.claimableCount()," spots available ")}}function ot(e,i){if(e&1){let t=f();r(0,"app-waitlist-entry-card",19),C("claimSpot",function(){let l=m(t).$implicit,v=s(3);return _(v.onClaimSpot(l))})("remove",function(){let l=m(t).$implicit,v=s(3);return _(v.onRemove(l))}),a()}if(e&2){let t=i.$implicit,o=s(3);k("entry",t)("loading",o.orderService.loading())}}function rt(e,i){if(e&1&&(r(0,"div",16)(1,"span",17),n(2,"\u2713"),a(),n(3," Ready to Claim "),a(),P(4,ot,1,2,"app-waitlist-entry-card",18,L)),e&2){let t=s(2);c(4),O(t.orderService.claimableWaitlistEntries())}}function at(e,i){if(e&1){let t=f();r(0,"app-waitlist-entry-card",19),C("claimSpot",function(){let l=m(t).$implicit,v=s(3);return _(v.onClaimSpot(l))})("remove",function(){let l=m(t).$implicit,v=s(3);return _(v.onRemove(l))}),a()}if(e&2){let t=i.$implicit,o=s(3);k("entry",t)("loading",o.orderService.loading())}}function lt(e,i){if(e&1&&(r(0,"div",20)(1,"span",17),n(2,"\u23F3"),a(),n(3," Waiting "),a(),P(4,at,1,2,"app-waitlist-entry-card",18,L)),e&2){let t=s(2);c(4),O(t.waitingEntries())}}function st(e,i){if(e&1&&(r(0,"div",6)(1,"div",13)(2,"span",14),n(3),a(),p(4,it,2,1,"span",15),a(),p(5,rt,6,0),p(6,lt,6,0),a()),e&2){let t=s();c(3),y(" ",t.orderService.waitlistCount()," on waitlist "),c(),g(t.orderService.claimableCount()>0?4:-1),c(),g(t.orderService.claimableCount()>0?5:-1),c(),g(t.waitingEntries().length>0?6:-1)}}function ct(e,i){if(e&1){let t=f();r(0,"div",21),C("click",function(){m(t);let l=s();return _(l.closeClaimDialog())}),r(1,"div",22),C("click",function(l){return m(t),_(l.stopPropagation())}),r(2,"h3"),n(3,"Claim Spot"),a(),r(4,"p"),n(5," Add "),r(6,"strong"),n(7),a(),n(8," to your cart? "),a(),r(9,"p",23),n(10," The class will be added to your cart where you can select students and complete checkout. "),a(),r(11,"div",24)(12,"button",25),C("click",function(){m(t);let l=s();return _(l.closeClaimDialog())}),n(13,"Cancel"),a(),r(14,"button",12),C("click",function(){m(t);let l=s();return _(l.confirmClaim())}),n(15,"Add to Cart"),a()()()()}if(e&2){let t,o=s();c(7),y("Class ",(t=o.selectedEntry())==null?null:t.sessionId)}}function dt(e,i){if(e&1){let t=f();r(0,"div",21),C("click",function(){m(t);let l=s();return _(l.closeRemoveDialog())}),r(1,"div",22),C("click",function(l){return m(t),_(l.stopPropagation())}),r(2,"h3"),n(3,"Leave Waitlist"),a(),r(4,"p"),n(5,"Are you sure you want to leave the waitlist?"),a(),r(6,"p",26),n(7,"You will lose your current position in the queue."),a(),r(8,"div",24)(9,"button",25),C("click",function(){m(t);let l=s();return _(l.closeRemoveDialog())}),n(10,"Cancel"),a(),r(11,"button",27),C("click",function(){m(t);let l=s();return _(l.confirmRemove())}),n(12,"Leave Waitlist"),a()()()()}}var A=class e{orderService=x($);router=x(N);cartStore=x(j);seasonService=x(F);_showClaimDialog=E(!1);_showRemoveDialog=E(!1);_selectedEntry=E(null);refreshInterval=null;showClaimDialog=this._showClaimDialog.asReadonly();showRemoveDialog=this._showRemoveDialog.asReadonly();selectedEntry=this._selectedEntry.asReadonly();waitingEntries=b(()=>this.orderService.waitlistEntriesWithEligibility().filter(i=>!i.isClaimable));ngOnInit(){this.refreshInterval=setInterval(()=>{},6e4)}ngOnDestroy(){this.refreshInterval&&clearInterval(this.refreshInterval)}goToCatalog(){this.router.navigate(["/catalog"])}onClaimSpot(i){this._selectedEntry.set(i),this._showClaimDialog.set(!0)}closeClaimDialog(){this._showClaimDialog.set(!1),this._selectedEntry.set(null)}async confirmClaim(){let i=this._selectedEntry();if(i){this.closeClaimDialog();try{let t=await this.seasonService.getClassById(i.sessionId);if(!t){console.error("Failed to load class for waitlist claim:",i.sessionId);return}this.cartStore.addToCart(t,[],{lunch:!0,extendedCare:!1},!0),this.router.navigate(["/cart"])}catch(t){console.error("Failed to claim waitlist spot:",t)}}}onRemove(i){this._selectedEntry.set(i),this._showRemoveDialog.set(!0)}closeRemoveDialog(){this._showRemoveDialog.set(!1),this._selectedEntry.set(null)}async confirmRemove(){let i=this._selectedEntry();if(i){this.closeRemoveDialog();try{await this.orderService.leaveWaitlist(i.sessionId)}catch{}}}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=w({type:e,selectors:[["app-waitlist-status"]],decls:12,vars:6,consts:[[1,"waitlist-page"],[1,"page-header"],[1,"subtitle"],[1,"loading-container"],[1,"error-container"],[1,"empty-container"],[1,"entries-section"],[1,"dialog-overlay"],[1,"spinner"],[1,"error-icon"],[1,"btn-retry",3,"click"],[1,"empty-icon"],[1,"btn-primary",3,"click"],[1,"summary-bar"],[1,"count"],[1,"eligible-count"],[1,"section-title","eligible-section"],[1,"icon"],[3,"entry","loading"],[3,"claimSpot","remove","entry","loading"],[1,"section-title","pending-section"],[1,"dialog-overlay",3,"click"],[1,"dialog",3,"click"],[1,"dialog-note"],[1,"dialog-actions"],[1,"btn-secondary",3,"click"],[1,"dialog-warning"],[1,"btn-danger",3,"click"]],template:function(t,o){t&1&&(r(0,"div",0)(1,"header",1)(2,"h1"),n(3,"Waitlist"),a(),r(4,"p",2),n(5,"View your waitlist status and claim available spots"),a()(),p(6,tt,4,0,"div",3),p(7,et,7,1,"div",4),p(8,nt,9,0,"div",5),p(9,st,7,4,"div",6),p(10,ct,16,1,"div",7),p(11,dt,13,0,"div",7),a()),t&2&&(c(6),g(o.orderService.loading()?6:-1),c(),g(o.orderService.error()?7:-1),c(),g(!o.orderService.loading()&&!o.orderService.error()&&o.orderService.waitlistCount()===0?8:-1),c(),g(o.orderService.waitlistCount()>0?9:-1),c(),g(o.showClaimDialog()?10:-1),c(),g(o.showRemoveDialog()?11:-1))},dependencies:[h,M],styles:[".waitlist-page[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem;color:var(--sys-on-surface, #212121)}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;color:var(--sys-on-surface-variant, #666)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{text-align:center;padding:3rem 2rem;background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin:0 auto 1rem}.error-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-error-container, #b71c1c);margin-bottom:1rem}.btn-retry[_ngcontent-%COMP%]{padding:.5rem 1.5rem;background:var(--sys-error, #c62828);color:#fff;border:none;border-radius:6px;cursor:pointer}.empty-container[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--sys-on-surface, #212121)}.empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666);margin-bottom:1.5rem}.entries-section[_ngcontent-%COMP%]{margin-top:1rem}.summary-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:8px;margin-bottom:1.5rem}.count[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666)}.eligible-count[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32);padding:.25rem .75rem;border-radius:12px;font-weight:500}.section-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 0;font-weight:600;color:var(--sys-on-surface, #212121);margin-top:1rem}.section-title[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:1.1rem}.section-title.eligible-section[_ngcontent-%COMP%]{color:var(--sys-secondary, #2e7d32)}.section-title.pending-section[_ngcontent-%COMP%]{color:var(--sys-tertiary, #1976d2)}.btn-primary[_ngcontent-%COMP%]{padding:.75rem 1.5rem;background:var(--sys-primary, #c62828);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:500;cursor:pointer;transition:background .2s ease}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--sys-primary-dark, #a51c1c)}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:400px;width:100%;box-shadow:0 8px 32px #0003}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--sys-on-surface, #212121)}.dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--sys-on-surface-variant, #666)}.dialog-note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-tertiary, #1976d2)}.dialog-warning[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-error, #c62828)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1.5rem}.btn-secondary[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:#fff;color:var(--sys-on-surface-variant, #666);border:1px solid var(--sys-outline, #e0e0e0);border-radius:8px;font-size:.95rem;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5)}.btn-danger[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;background:var(--sys-error, #c62828);color:#fff;border:none;border-radius:8px;font-size:.95rem;cursor:pointer}.btn-danger[_ngcontent-%COMP%]:hover{background:#a51c1c}"]})};export{A as WaitlistStatusComponent};
