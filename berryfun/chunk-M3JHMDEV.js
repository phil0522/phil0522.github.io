import{V as I,Y as D,Z as R,_ as L,d as k,k as W}from"./chunk-F6WTWIJG.js";import"./chunk-UYHN5VVP.js";import{Ab as C,Ea as a,N as y,Pa as E,S as g,T as p,Za as u,_a as v,bb as O,cb as w,da as _,db as b,eb as t,fb as i,gb as S,kb as x,mb as f,ob as d,yb as n,zb as m}from"./chunk-DU5POHF6.js";import{a as M,b as P}from"./chunk-Q7L6LLAK.js";var V=(s,r)=>r.userId+r.sessionId;function N(s,r){if(s&1){let e=x();t(0,"div",4),n(1),t(2,"button",8),f("click",function(){g(e);let l=d();return p(l.loadWaitlistEntries())}),n(3,"Retry"),i()()}if(s&2){let e=d();a(),C(" ",e.error()," ")}}function j(s,r){s&1&&(t(0,"div",5),S(1,"div",9),t(2,"p"),n(3,"Loading..."),i()())}function F(s,r){s&1&&(t(0,"div",6)(1,"div",10),n(2,"\u{1F4CB}"),i(),t(3,"h2"),n(4,"No Waitlist Entries"),i(),t(5,"p"),n(6,"No one is currently on any waitlist"),i()())}function B(s,r){if(s&1){let e=x();t(0,"tr",13)(1,"td",14),n(2),i(),t(3,"td",15)(4,"span",16),n(5),i(),t(6,"span",17),n(7),i()(),t(8,"td",18)(9,"span",19),n(10),i(),t(11,"span",20),n(12),i()(),t(13,"td",21),n(14),i(),t(15,"td",22)(16,"span",23),n(17,"On Waitlist"),i()(),t(18,"td",24)(19,"button",25),f("click",function(){let l=g(e).$implicit,c=d(2);return p(c.removeEntry(l))}),n(20," Remove "),i()()()}if(s&2){let e=r.$implicit,o=d(2);a(2),m(e.position),a(3),m(e.userName),a(2),m(e.userId),a(3),m(e.className),a(2),m(e.sessionId),a(2),C(" ",o.formatDate(e.joinedAt)," "),a(5),b("disabled",o.actionLoading())}}function U(s,r){if(s&1&&(t(0,"div",11),n(1),i(),t(2,"div",12)(3,"table")(4,"thead")(5,"tr")(6,"th"),n(7,"#"),i(),t(8,"th"),n(9,"User"),i(),t(10,"th"),n(11,"Class"),i(),t(12,"th"),n(13,"Joined"),i(),t(14,"th"),n(15,"Status"),i(),t(16,"th"),n(17,"Actions"),i()()(),t(18,"tbody"),O(19,B,21,7,"tr",13,V),i()()()),s&2){let e=d();a(),C("Total ",e.entries().length," waitlist entries"),a(18),w(e.entries())}}function $(s,r){if(s&1){let e=x();t(0,"div",26),f("click",function(){g(e);let l=d();return p(l.closeRemoveDialog())}),t(1,"div",27),f("click",function(l){return g(e),p(l.stopPropagation())}),t(2,"h3"),n(3,"Remove Waitlist Entry"),i(),t(4,"p"),n(5," Remove "),t(6,"strong"),n(7),i(),n(8," from the waitlist for "),t(9,"strong"),n(10),i(),n(11,"? "),i(),t(12,"p",28),n(13," This will remove the user from the waitlist for this class. "),i(),t(14,"div",29)(15,"button",30),f("click",function(){g(e);let l=d();return p(l.closeRemoveDialog())}),n(16,"Cancel"),i(),t(17,"button",31),f("click",function(){g(e);let l=d();return p(l.confirmRemove())}),n(18),i()()()()}if(s&2){let e,o,l=d();a(7),m((e=l.selectedEntry())==null?null:e.userId),a(3),m((o=l.selectedEntry())==null?null:o.className),a(7),b("disabled",l.actionLoading()),a(),C(" ",l.actionLoading()?"Removing...":"Confirm Remove"," ")}}var A=class s{orderDatastore=y(I);orderRpc=y(D);configService=y(R);seasonService=y(L);_entries=_([]);_loading=_(!1);_error=_(null);_actionLoading=_(!1);_showRemoveDialog=_(!1);_selectedEntry=_(null);entries=this._entries.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();actionLoading=this._actionLoading.asReadonly();showRemoveDialog=this._showRemoveDialog.asReadonly();selectedEntry=this._selectedEntry.asReadonly();async ngOnInit(){await this.loadWaitlistEntries()}async loadWaitlistEntries(){this._loading.set(!0),this._error.set(null);try{let r=this.seasonService.selectedSeason();if(!r){this._entries.set([]),this._loading.set(!1);return}let e=await this.orderDatastore.listAllWaitlistEntries(r.id),o=new Map;for(let c of e){let h=o.get(c.sessionId)??[];h.push(c),o.set(c.sessionId,h)}let l=e.map(c=>{let z=(o.get(c.sessionId)??[]).findIndex(T=>T.userId===c.userId)+1;return P(M({},c),{position:z})});this._entries.set(l)}catch(r){let e=r instanceof Error?r.message:"Failed to load waitlist entries";this._error.set(e)}finally{this._loading.set(!1)}}removeEntry(r){this._selectedEntry.set(r),this._showRemoveDialog.set(!0)}closeRemoveDialog(){this._showRemoveDialog.set(!1),this._selectedEntry.set(null)}async confirmRemove(){let r=this._selectedEntry();if(r){this._actionLoading.set(!0);try{let e=this.configService.activeYear(),o=this.seasonService.selectedSeason();if(!o)throw new Error("No season selected");await this.orderRpc.removeWaitlistEntry({year:e,seasonId:o.id,userAuthId:r.userId,sessionId:r.sessionId}),this.closeRemoveDialog(),await this.loadWaitlistEntries()}catch(e){let o=e instanceof Error?e.message:"Failed to remove entry";this._error.set(o)}finally{this._actionLoading.set(!1)}}}formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=E({type:s,selectors:[["app-admin-waitlist-list"]],decls:13,vars:5,consts:[[1,"admin-waitlist"],[1,"page-header"],["routerLink","/admin",1,"back-link"],[1,"subtitle"],[1,"error"],[1,"loading"],[1,"empty"],[1,"dialog-overlay"],[1,"btn","btn-sm",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"results-count"],[1,"entries-table"],[1,"waitlist-entry"],[1,"position"],[1,"user-info"],[1,"user-name"],[1,"user-id"],[1,"class-info"],[1,"class-name"],[1,"session-id"],[1,"join-date"],[1,"status"],[1,"badge","badge-pending"],[1,"actions"],[1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"dialog-overlay",3,"click"],[1,"dialog",3,"click"],[1,"dialog-note"],[1,"dialog-actions"],[1,"btn","btn-outline",3,"click"],[1,"btn","btn-danger",3,"click","disabled"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"header",1)(2,"a",2),n(3,"\u2190 Back to Console"),i(),t(4,"h1"),n(5,"Waitlist Management"),i(),t(6,"p",3),n(7,"View and manage waitlist entries"),i()(),u(8,N,4,1,"div",4),u(9,j,4,0,"div",5),u(10,F,7,0,"div",6),u(11,U,21,1),u(12,$,19,4,"div",7),i()),e&2&&(a(8),v(o.error()?8:-1),a(),v(o.loading()?9:-1),a(),v(!o.loading()&&!o.error()&&o.entries().length===0?10:-1),a(),v(!o.loading()&&o.entries().length>0?11:-1),a(),v(o.showRemoveDialog()?12:-1))},dependencies:[k,W],styles:[".admin-waitlist[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-link[_ngcontent-%COMP%]{display:inline-block;color:var(--sys-primary, #c62828);text-decoration:none;font-size:.875rem;margin-bottom:.5rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.results-count[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{padding:1.5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.empty[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:var(--sys-on-surface-variant, #666)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.entries-table[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;overflow:hidden}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid var(--sys-outline-variant, #e0e0e0)}th[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);font-weight:600;font-size:.875rem;color:var(--sys-on-surface-variant, #666)}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.position[_ngcontent-%COMP%]{font-weight:600;color:var(--sys-primary, #c62828)}.user-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.user-name[_ngcontent-%COMP%]{font-weight:500}.user-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.class-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:500}.session-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.join-date[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;font-weight:500}.badge-promoted[_ngcontent-%COMP%]{background:var(--sys-secondary-container, #e8f5e9);color:var(--sys-secondary, #2e7d32)}.badge-eligible[_ngcontent-%COMP%]{background:var(--sys-tertiary-container, #e3f2fd);color:var(--sys-tertiary, #1976d2)}.badge-pending[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);color:var(--sys-on-surface-variant, #666)}.promoted-text[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--sys-secondary, #2e7d32)}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-outline[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);color:var(--sys-on-surface, #212121)}.btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5)}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.8125rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem}.dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--sys-on-surface-variant, #666)}.dialog-note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-tertiary, #1976d2)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--sys-outline-variant, #e0e0e0)}@media(max-width:768px){th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.875rem}.badge[_ngcontent-%COMP%]{font-size:.6875rem}}"]})};export{A as AdminWaitlistListComponent};
