import{b as ne,c as ie,f as oe,r as ae}from"./chunk-QEQOTM22.js";import{a as te}from"./chunk-IMTCYCFU.js";import{d as H,e as Q,f as X,g as $,h as Z}from"./chunk-VAP7UJLN.js";import{b as K}from"./chunk-2UR2POCV.js";import{a as G}from"./chunk-D3KXLHLP.js";import"./chunk-URCISTJ5.js";import{a as U}from"./chunk-WCUSQBFW.js";import{b as ee}from"./chunk-DS6FZ4JQ.js";import{d as Y,j as B,k as J}from"./chunk-TX2MCR52.js";import{Ab as r,Bb as O,Cb as x,Db as k,Eb as N,Gb as W,Ha as s,Hb as F,Ib as z,Jb as j,R as y,Rb as h,Sa as L,W as _,X as u,a as T,ab as p,b as q,bb as m,cb as R,db as M,eb as P,fb as f,gb as a,ha as v,hb as o,ib as E,mb as b,ob as C,qb as l,yb as I,zb as D}from"./chunk-EVJ2WVWM.js";var ge=(i,t)=>t.sessionId+"-"+t.studentId,se=(i,t)=>t.id,pe=(i,t)=>t.sessionId;function me(i,t){i&1&&(a(0,"div",4),E(1,"div",11),a(2,"p"),r(3,"Loading order..."),o()())}function _e(i,t){if(i&1){let e=b();a(0,"div",5)(1,"div",12),r(2,"!"),o(),a(3,"p"),r(4),o(),a(5,"button",13),C("click",function(){_(e);let d=l();return u(d.loadOrder())}),r(6,"Retry"),o()()}if(i&2){let e=l();s(4),O(e.orderService.error())}}function ue(i,t){i&1&&(a(0,"div",6)(1,"div",14),r(2,"\u{1F4CB}"),o(),a(3,"h2"),r(4,"No order found"),o(),a(5,"p"),r(6,"You don't have any items in your order yet."),o(),a(7,"a",15),r(8,"Browse Classes"),o()())}function Ce(i,t){i&1&&(a(0,"div",19)(1,"p"),r(2,"You have no active enrollments to modify."),o()())}function xe(i,t){i&1&&r(0," Marked for Removal ")}function fe(i,t){i&1&&r(0," Remove from Class ")}function he(i,t){i&1&&(a(0,"span",36),r(1,"Change Pending"),o())}function be(i,t){if(i&1){let e=b();a(0,"div",24)(1,"div",25)(2,"div",26)(3,"span",27),r(4),o(),a(5,"span",28),r(6),o()(),a(7,"div",29),r(8),o()(),a(9,"div",30)(10,"label",31)(11,"input",32),C("change",function(){let d=_(e).$implicit,c=l(3);return u(c.toggleAddon(d,"lunch"))}),o(),a(12,"span",33),r(13),o()(),a(14,"label",31)(15,"input",32),C("change",function(){let d=_(e).$implicit,c=l(3);return u(c.toggleAddon(d,"extendedCare"))}),o(),a(16,"span",33),r(17),o()()(),a(18,"div",34)(19,"button",35),C("click",function(){let d=_(e).$implicit,c=l(3);return u(c.markForRemoval(d))}),p(20,xe,1,0)(21,fe,1,0),o(),p(22,he,2,0,"span",36),o()()}if(i&2){let e=t.$implicit,n=l(3);I("is-paid",e.status==="paid"),s(4),O(n.getClassName(e.sessionId)),s(),D("status-"+e.status),s(),x(" ",e.status==="paid"?"PAID":"SUBMITTED"," "),s(2),k(" ",n.getStudentName(e.studentId)," \u2022 ",n.getDateRange(e.sessionId)," "),s(3),f("checked",n.getItemOptionState(e,"lunch"))("disabled",n.isItemInPendingChange(e)),s(2),x(" Lunch (",n.formatCurrency(n.getLunchPrice(e.sessionId)),") "),s(2),f("checked",n.getItemOptionState(e,"extendedCare"))("disabled",n.isItemInPendingChange(e)),s(2),x(" Extended Care (",n.formatCurrency(n.getExtendedCarePrice(e.sessionId)),") "),s(2),f("disabled",n.isItemInPendingChange(e)||n.isMarkedForRemoval(e)),s(),m(n.isMarkedForRemoval(e)?20:21),s(2),m(n.isItemInPendingChange(e)?22:-1)}}function ve(i,t){if(i&1){let e=b();a(0,"div",38)(1,"span",47),r(2),o(),a(3,"span",48),r(4),o(),a(5,"button",49),C("click",function(){let d=_(e).$index,c=l(4);return u(c.removePendingChange(d))}),r(6,"\xD7"),o()()}if(i&2){let e=t.$implicit,n=l(4);s(2),O(e.description),s(),I("credit",e.priceChange<0),s(),k(" ",e.priceChange<0?"-":"+","",n.formatCurrency(n.Math.abs(e.priceChange))," ")}}function Oe(i,t){i&1&&(a(0,"div",42),r(1," Note: A processing fee may apply for class removals. "),o())}function ye(i,t){i&1&&(E(0,"span",51),r(1," Applying... "))}function Me(i,t){i&1&&r(0," Apply Changes ")}function Pe(i,t){if(i&1){let e=b();a(0,"button",50),C("click",function(){_(e);let d=l(4);return u(d.applySubmittedChanges())}),p(1,ye,2,0)(2,Me,1,0),o()}if(i&2){let e=l(4);f("disabled",e.actionLoading()),s(),m(e.actionLoading()?1:2)}}function we(i,t){if(i&1){let e=b();a(0,"button",52),C("click",function(){_(e);let d=l(4);return u(d.openRequestChangeDialog())}),r(1," Request Changes (Needs Approval) "),o()}if(i&2){let e=l(4);f("disabled",e.actionLoading())}}function Ee(i,t){if(i&1){let e=b();a(0,"button",50),C("click",function(){_(e);let d=l(4);return u(d.applySubmittedChanges())}),r(1," Apply Submitted Changes "),o(),a(2,"button",52),C("click",function(){_(e);let d=l(4);return u(d.openRequestChangeDialog())}),r(3," Request Paid Changes "),o()}if(i&2){let e=l(4);f("disabled",e.actionLoading()),s(2),f("disabled",e.actionLoading())}}function Se(i,t){if(i&1){let e=b();a(0,"div",23)(1,"h3"),r(2,"Pending Changes"),o(),a(3,"div",37),M(4,ve,7,5,"div",38,R),o(),a(6,"div",39)(7,"div",40)(8,"span"),r(9,"Total estimated change:"),o(),a(10,"span",41),r(11),o()(),p(12,Oe,2,0,"div",42),o(),a(13,"div",43)(14,"button",44),C("click",function(){_(e);let d=l(3);return u(d.clearPendingChanges())}),r(15," Clear All "),o(),p(16,Pe,3,2,"button",45)(17,we,2,1,"button",46)(18,Ee,4,2),o()()}if(i&2){let e=l(3);s(4),P(e.pendingChanges()),s(6),I("credit",e.totalPriceChange()<0),s(),N(" ",e.totalPriceChange()<0?"-":"+","",e.formatCurrency(e.Math.abs(e.totalPriceChange()))," ",e.totalPriceChange()<0?"(credit)":""," "),s(),m(e.hasRemovalChanges()&&e.hasPaidChanges()?12:-1),s(4),m(e.hasSubmittedChanges()&&!e.hasPaidChanges()?16:e.hasPaidChanges()&&!e.hasSubmittedChanges()?17:e.hasPaidChanges()&&e.hasSubmittedChanges()?18:-1)}}function Ie(i,t){if(i&1&&(a(0,"div",19)(1,"p")(2,"strong"),r(3,"Submitted (unpaid) items:"),o(),r(4," Changes apply immediately."),E(5,"br"),a(6,"strong"),r(7,"Paid items:"),o(),r(8," Changes require admin approval. "),o()(),a(9,"div",21),M(10,be,23,17,"div",22,ge),o(),p(12,Se,19,7,"div",23)),i&2){let e=l(2);s(10),P(e.allActiveItems()),s(2),m(e.pendingChanges().length>0?12:-1)}}function ke(i,t){if(i&1&&(a(0,"div",59),r(1),o()),i&2){let e=t.$implicit,n=l(4);s(),x(" ",n.getActionDescriptionText(e)," ")}}function Te(i,t){if(i&1&&(a(0,"span"),r(1),o()),i&2){let e=l().$implicit,n=l(3);s(),x("Admin Adjustment: ",n.formatCurrency(e.adminAdjustment))}}function Re(i,t){if(i&1&&(a(0,"div",61)(1,"strong"),r(2,"Reason:"),o(),r(3),o()),i&2){let e=l().$implicit;s(3),x(" ",e.reason," ")}}function qe(i,t){if(i&1&&(a(0,"div",62)(1,"strong"),r(2,"Admin Notes:"),o(),r(3),o()),i&2){let e=l().$implicit;s(3),x(" ",e.adminNotes," ")}}function De(i,t){if(i&1&&(a(0,"div",54)(1,"div",55)(2,"span",56),r(3),o(),a(4,"span"),r(5),o()(),a(6,"div",57)(7,"div",58)(8,"strong"),r(9,"Changes:"),o(),M(10,ke,2,1,"div",59,R),o(),a(12,"div",60)(13,"span"),r(14),o(),p(15,Te,2,1,"span"),o(),p(16,Re,4,1,"div",61),p(17,qe,4,1,"div",62),o()()),i&2){let e=t.$implicit,n=l(3);s(3),O(e.id),s(),D(j("request-status status-",e.status)),s(),x(" ",n.getChangeRequestStatusLabel(e.status)," "),s(5),P(e.actions),s(4),x("Requested: ",n.formatDateTime(e.requestedAt)),s(),m(e.adminAdjustment!==0?15:-1),s(),m(e.reason?16:-1),s(),m(e.adminNotes?17:-1)}}function $e(i,t){if(i&1&&(a(0,"section",16)(1,"div",17)(2,"h2"),r(3,"Pending Change Requests"),o(),a(4,"p",18),r(5,"Your change requests awaiting admin approval"),o()(),a(6,"div",53),M(7,De,18,9,"div",54,se),o()()),i&2){let e=l(2);s(7),P(e.pendingChangeRequests())}}function Ve(i,t){i&1&&(a(0,"span",69),r(1,"Promoted"),o())}function Ae(i,t){if(i&1){let e=b();a(0,"div",64)(1,"div",65)(2,"div",66),r(3),o(),a(4,"div",67),r(5),o(),a(6,"div",68),r(7),p(8,Ve,2,0,"span",69),o()(),a(9,"button",70),C("click",function(){let d=_(e).$implicit,c=l(3);return u(c.confirmLeaveWaitlist(d))}),r(10," Leave "),o()()}if(i&2){let e=t.$implicit,n=l(3);s(3),O(n.getClassName(e.sessionId)),s(2),x(" ",n.getDateRange(e.sessionId)," "),s(2),x(" Joined ",n.formatDateTime(e.joinedAt)," "),s(),m(e.isPromoted?8:-1),s(),f("disabled",n.actionLoading())}}function Le(i,t){if(i&1&&(a(0,"div",20)(1,"h3"),r(2,"Your Waitlists"),o(),a(3,"div",63),M(4,Ae,11,5,"div",64,pe),o()()),i&2){let e=l(2);s(4),P(e.currentWaitlists())}}function Ne(i,t){if(i&1){let e=b();a(0,"div",73)(1,"div",74)(2,"div",27),r(3),o(),a(4,"div",75),r(5),o(),a(6,"div",76),r(7),o()(),a(8,"button",77),C("click",function(){let d=_(e).$implicit,c=l(3);return u(c.confirmJoinWaitlist(d.id))}),r(9," Join Waitlist "),o()()}if(i&2){let e=t.$implicit,n=l(3);s(3),O(e.name),s(2),x(" ",n.formatDateRange(e.startDate,e.endDate)," "),s(2),k(" ",n.registrationService.getEnrolledCount(e.id),"/",e.capacity," enrolled "),s(),f("disabled",n.actionLoading())}}function We(i,t){if(i&1&&(a(0,"div",20)(1,"h3"),r(2,"Join Waitlist"),o(),a(3,"p",71),r(4,"Full classes you can join the waitlist for:"),o(),a(5,"div",72),M(6,Ne,10,5,"div",73,se),o()()),i&2){let e=l(2);s(6),P(e.availableClassesForWaitlist())}}function Fe(i,t){i&1&&(a(0,"div",19)(1,"p"),r(2,"No full classes available for waitlist at this time."),o()())}function ze(i,t){if(i&1&&(a(0,"div",7)(1,"section",16)(2,"div",17)(3,"h2"),r(4,"Modify Enrollments"),o(),a(5,"p",18),r(6,"Update options or remove classes"),o()(),p(7,Ce,3,0,"div",19)(8,Ie,13,1),o(),p(9,$e,9,0,"section",16),a(10,"section",16)(11,"div",17)(12,"h2"),r(13,"Waitlist Management"),o(),a(14,"p",18),r(15,"Join or leave waitlists for full classes"),o()(),p(16,Le,6,0,"div",20),p(17,We,8,0,"div",20)(18,Fe,3,0,"div",19),o()()),i&2){let e=l();s(7),m(e.allActiveItems().length===0?7:8),s(2),m(e.pendingChangeRequests().length>0?9:-1),s(7),m(e.currentWaitlists().length>0?16:-1),s(),m(e.availableClassesForWaitlist().length>0?17:e.currentWaitlists().length===0?18:-1)}}function je(i,t){if(i&1&&(a(0,"li"),r(1),o()),i&2){let e=t.$implicit;s(),O(e.description)}}function Ye(i,t){i&1&&(a(0,"div",83)(1,"div",89),r(2,"\u26A0\uFE0F"),o(),a(3,"div",90)(4,"strong"),r(5,"Processing Fee"),o(),a(6,"p"),r(7,"A processing fee may apply for class removals."),o()()())}function Be(i,t){i&1&&(E(0,"span",51),r(1," Submitting... "))}function Je(i,t){i&1&&r(0," Submit Request ")}function Ke(i,t){if(i&1){let e=b();a(0,"div",78),C("click",function(){_(e);let d=l();return u(d.closeRequestChangeDialog())}),a(1,"div",79),C("click",function(d){return _(e),u(d.stopPropagation())}),a(2,"h3"),r(3,"Request Order Changes"),o(),a(4,"div",80)(5,"p"),r(6,"You are requesting the following changes for paid items:"),o(),a(7,"ul",81),M(8,je,2,1,"li",null,R),o(),a(10,"div",82)(11,"strong"),r(12,"Estimated Price Change:"),o(),a(13,"span"),r(14),o()(),p(15,Ye,8,0,"div",83),a(16,"div",84)(17,"label",85),r(18,"Reason (optional)"),o(),a(19,"textarea",86),z("ngModelChange",function(d){_(e);let c=l();return F(c.changeRequestReason,d)||(c.changeRequestReason=d),u(d)}),o()()(),a(20,"div",87)(21,"button",88),C("click",function(){_(e);let d=l();return u(d.closeRequestChangeDialog())}),r(22," Cancel "),o(),a(23,"button",52),C("click",function(){_(e);let d=l();return u(d.submitChangeRequest())}),p(24,Be,2,0)(25,Je,1,0),o()()()()}if(i&2){let e=l();s(8),P(e.paidPendingChanges()),s(5),I("credit",e.paidTotalPriceChange()<0),s(),k(" ",e.paidTotalPriceChange()<0?"-":"+","",e.formatCurrency(e.Math.abs(e.paidTotalPriceChange()))," "),s(),m(e.hasRemovalChanges()?15:-1),s(4),W("ngModel",e.changeRequestReason),s(2),f("disabled",e.actionLoading()),s(2),f("disabled",e.actionLoading()),s(),m(e.actionLoading()?24:25)}}function Ue(i,t){i&1&&(E(0,"span",51),r(1," Processing... "))}function Ge(i,t){i&1&&r(0," Confirm ")}function He(i,t){if(i&1){let e=b();a(0,"div",78),C("click",function(){_(e);let d=l();return u(d.closeWaitlistDialog())}),a(1,"div",79),C("click",function(d){return _(e),u(d.stopPropagation())}),a(2,"h3"),r(3),o(),a(4,"p"),r(5),o(),a(6,"div",87)(7,"button",88),C("click",function(){_(e);let d=l();return u(d.closeWaitlistDialog())}),r(8," Cancel "),o(),a(9,"button",50),C("click",function(){_(e);let d=l();return u(d.confirmWaitlistAction())}),p(10,Ue,2,0)(11,Ge,1,0),o()()()()}if(i&2){let e=l();s(3),O(e.waitlistDialogTitle()),s(2),O(e.waitlistDialogMessage()),s(2),f("disabled",e.actionLoading()),s(2),f("disabled",e.actionLoading()),s(),m(e.actionLoading()?10:11)}}function Qe(i,t){if(i&1&&(a(0,"div",9),r(1),o()),i&2){let e=l();s(),x(" ",e.successMessage()," ")}}function Xe(i,t){if(i&1&&(a(0,"div",10),r(1),o()),i&2){let e=l();s(),x(" ",e.actionError()," ")}}var re=class i{orderService=y(Z);seasonService=y(G);userService=y(ee);configService=y(U);registrationService=y(te);orderRpc=y(K);router=y(B);formatCurrency=Q;formatDateTime=X;formatDateRange=$;getItemStatusLabel=H;Math=Math;_actionLoading=v(!1);_actionError=v(null);_successMessage=v(null);_pendingChanges=v([]);_modifiedOptions=v(new Map);_showRequestChangeDialog=v(!1);changeRequestReason="";_showWaitlistDialog=v(!1);_waitlistAction=v(null);_waitlistSessionId=v(null);actionLoading=this._actionLoading.asReadonly();actionError=this._actionError.asReadonly();successMessage=this._successMessage.asReadonly();pendingChanges=this._pendingChanges.asReadonly();showRequestChangeDialog=this._showRequestChangeDialog.asReadonly();showWaitlistDialog=this._showWaitlistDialog.asReadonly();allActiveItems=h(()=>[...this.orderService.submittedItems(),...this.orderService.paidItems()]);pendingChangeRequests=h(()=>{let t=this.orderService.order();return t?.changeRequests?t.changeRequests.filter(e=>e.status==="pending"):[]});totalPriceChange=h(()=>this._pendingChanges().reduce((t,e)=>t+e.priceChange,0));hasSubmittedChanges=h(()=>{let t=new Set(this.orderService.submittedItems().map(e=>`${e.sessionId}-${e.studentId}`));return this._pendingChanges().some(e=>{let n=`${e.action.target.sessionId}-${e.action.target.studentId}`;return t.has(n)})});hasPaidChanges=h(()=>{let t=new Set(this.orderService.paidItems().map(e=>`${e.sessionId}-${e.studentId}`));return this._pendingChanges().some(e=>{let n=`${e.action.target.sessionId}-${e.action.target.studentId}`;return t.has(n)})});hasRemovalChanges=h(()=>this._pendingChanges().some(t=>t.action.type==="remove_class"));paidPendingChanges=h(()=>{let t=new Set(this.orderService.paidItems().map(e=>`${e.sessionId}-${e.studentId}`));return this._pendingChanges().filter(e=>{let n=`${e.action.target.sessionId}-${e.action.target.studentId}`;return t.has(n)})});submittedPendingChanges=h(()=>{let t=new Set(this.orderService.submittedItems().map(e=>`${e.sessionId}-${e.studentId}`));return this._pendingChanges().filter(e=>{let n=`${e.action.target.sessionId}-${e.action.target.studentId}`;return t.has(n)})});paidTotalPriceChange=h(()=>this.paidPendingChanges().reduce((t,e)=>t+e.priceChange,0));currentWaitlists=h(()=>this.orderService.waitlistEntries());availableClassesForWaitlist=h(()=>{let t=this.seasonService.classes(),e=new Set(this.currentWaitlists().map(d=>d.sessionId)),n=new Set([...this.orderService.submittedItems(),...this.orderService.paidItems()].map(d=>d.sessionId));return t.filter(d=>this.registrationService.getEnrolledCount(d.id)>=d.capacity&&!e.has(d.id)&&!n.has(d.id))});waitlistDialogTitle=h(()=>{let t=this._waitlistAction();return t==="join"?"Join Waitlist":t==="leave"?"Leave Waitlist":""});waitlistDialogMessage=h(()=>{let t=this._waitlistAction(),e=this._waitlistSessionId();if(!e)return"";let n=this.getClassName(e);return t==="join"?`Are you sure you want to join the waitlist for ${n}? You'll be notified if a spot opens up.`:t==="leave"?`Are you sure you want to leave the waitlist for ${n}? You'll lose your position in the queue.`:""});async ngOnInit(){if(!this.userService.isAuthenticated()){this.router.navigate(["/login"]);return}await this.loadOrder()}async loadOrder(){try{let t=this.configService.currentActiveYear();await this.seasonService.loadClassesByYear(t)}catch(t){console.error("Failed to load classes:",t)}}getItemOptionState(t,e){let n=`${t.sessionId}-${t.studentId}`,d=this._modifiedOptions().get(n);return d?d[e]:t.options[e]}toggleAddon(t,e){let n=`${t.sessionId}-${t.studentId}`,d=this._modifiedOptions().get(n)??T({},t.options),c=t.options[e],g=!d[e],S=new Map(this._modifiedOptions());S.set(n,q(T({},d),{[e]:g})),this._modifiedOptions.set(S);let V=e==="lunch"?this.getLunchPrice(t.sessionId):this.getExtendedCarePrice(t.sessionId),A=this._pendingChanges().filter(w=>!(w.action.target.sessionId===t.sessionId&&w.action.target.studentId===t.studentId&&w.action.type!=="remove_class"&&"addon"in w.action&&w.action.addon===e));if(g!==c){let de={type:g?"add_addon":"remove_addon",target:{sessionId:t.sessionId,studentId:t.studentId},addon:e},le=g?V:-V,ce=`${g?"Add":"Remove"} ${e==="lunch"?"Lunch":"Extended Care"}: ${this.getClassName(t.sessionId)} - ${this.getStudentName(t.studentId)}`;A.push({action:de,description:ce,priceChange:le})}this._pendingChanges.set(A)}markForRemoval(t){if(this.isMarkedForRemoval(t))return;let e={type:"remove_class",target:{sessionId:t.sessionId,studentId:t.studentId}},n=t.snapshot,d=n?-n.priceSnapshot.itemTotal:0,c=`Remove from class: ${this.getClassName(t.sessionId)} - ${this.getStudentName(t.studentId)}`;this._pendingChanges.update(g=>[...g,{action:e,description:c,priceChange:d}])}isMarkedForRemoval(t){return this._pendingChanges().some(e=>e.action.type==="remove_class"&&e.action.target.sessionId===t.sessionId&&e.action.target.studentId===t.studentId)}isItemInPendingChange(t){let e=this.orderService.order();return e?.changeRequests?e.changeRequests.some(n=>n.status==="pending"&&n.actions.some(d=>d.target.sessionId===t.sessionId&&d.target.studentId===t.studentId)):!1}removePendingChange(t){let e=[...this._pendingChanges()],n=e.splice(t,1)[0];if(this._pendingChanges.set(e),n&&n.action.type!=="remove_class"){let d=`${n.action.target.sessionId}-${n.action.target.studentId}`,c=this.allActiveItems().find(g=>g.sessionId===n.action.target.sessionId&&g.studentId===n.action.target.studentId);if(c){let g=this._modifiedOptions().get(d);if(g&&"addon"in n.action){let S=new Map(this._modifiedOptions());S.set(d,q(T({},g),{[n.action.addon]:c.options[n.action.addon]})),this._modifiedOptions.set(S)}}}}clearPendingChanges(){this._pendingChanges.set([]),this._modifiedOptions.set(new Map)}async applySubmittedChanges(){let t=this.submittedPendingChanges();if(t.length!==0){this._actionLoading.set(!0),this._actionError.set(null);try{let e=t.map(g=>g.action);await this.orderRpc.applySubmittedChanges({year:this.configService.currentActiveYear(),actions:e});let n=this.paidPendingChanges();this._pendingChanges.set(n);let d=new Set(this.orderService.submittedItems().map(g=>`${g.sessionId}-${g.studentId}`)),c=new Map(this._modifiedOptions());for(let g of c.keys())d.has(g)&&c.delete(g);this._modifiedOptions.set(c),this._successMessage.set(`Successfully applied ${t.length} change(s)`),setTimeout(()=>this._successMessage.set(null),5e3)}catch(e){let n=e instanceof Error?e.message:"Failed to apply changes";this._actionError.set(n),setTimeout(()=>this._actionError.set(null),5e3)}finally{this._actionLoading.set(!1)}}}openRequestChangeDialog(){this.paidPendingChanges().length!==0&&(this.changeRequestReason="",this._showRequestChangeDialog.set(!0))}closeRequestChangeDialog(){this._showRequestChangeDialog.set(!1),this.changeRequestReason=""}async submitChangeRequest(){let t=this.paidPendingChanges();if(t.length!==0){this._actionLoading.set(!0),this._actionError.set(null);try{let e=t.map(g=>g.action);await this.orderRpc.requestOrderChange({year:this.configService.currentActiveYear(),actions:e,reason:this.changeRequestReason.trim()||void 0});let n=this.submittedPendingChanges();this._pendingChanges.set(n);let d=new Set(this.orderService.paidItems().map(g=>`${g.sessionId}-${g.studentId}`)),c=new Map(this._modifiedOptions());for(let g of c.keys())d.has(g)&&c.delete(g);this._modifiedOptions.set(c),this.closeRequestChangeDialog(),this._successMessage.set("Change request submitted. An admin will review your request."),setTimeout(()=>this._successMessage.set(null),5e3)}catch(e){let n=e instanceof Error?e.message:"Failed to submit change request";this._actionError.set(n),setTimeout(()=>this._actionError.set(null),5e3)}finally{this._actionLoading.set(!1)}}}confirmJoinWaitlist(t){this._waitlistAction.set("join"),this._waitlistSessionId.set(t),this._showWaitlistDialog.set(!0)}confirmLeaveWaitlist(t){this._waitlistAction.set("leave"),this._waitlistSessionId.set(t.sessionId),this._showWaitlistDialog.set(!0)}closeWaitlistDialog(){this._showWaitlistDialog.set(!1),this._waitlistAction.set(null),this._waitlistSessionId.set(null)}async confirmWaitlistAction(){let t=this._waitlistAction(),e=this._waitlistSessionId();if(!(!t||!e)){this._actionLoading.set(!0),this._actionError.set(null);try{t==="join"?(await this.orderService.joinWaitlist(e),this._successMessage.set("Successfully joined waitlist")):t==="leave"&&(await this.orderService.leaveWaitlist(e),this._successMessage.set("Successfully left waitlist")),this.closeWaitlistDialog(),setTimeout(()=>this._successMessage.set(null),5e3)}catch(n){let d=n instanceof Error?n.message:"Failed to update waitlist";this._actionError.set(d),setTimeout(()=>this._actionError.set(null),5e3)}finally{this._actionLoading.set(!1)}}}getClassName(t){return this.seasonService.classes().find(n=>n.id===t)?.name??"Unknown Class"}getDateRange(t){let e=this.seasonService.classes().find(n=>n.id===t);return e?$(e.startDate,e.endDate):""}getStudentName(t){return this.userService.students().find(n=>n.id===t)?.fullName??"Unknown Student"}getLunchPrice(t){return this.seasonService.classes().find(n=>n.id===t)?.lunchPrice??0}getExtendedCarePrice(t){return this.seasonService.classes().find(n=>n.id===t)?.extendedCarePrice??0}getChangeRequestStatusLabel(t){switch(t){case"pending":return"Pending Review";case"approved":return"Approved";case"denied":return"Denied";default:return t}}getActionDescriptionText(t){let e=this.getClassName(t.target.sessionId),n=this.getStudentName(t.target.studentId);switch(t.type){case"remove_class":return`Remove from class: ${e} - ${n}`;case"add_addon":return`Add ${t.addon==="lunch"?"Lunch":"Extended Care"}: ${e} - ${n}`;case"remove_addon":return`Remove ${t.addon==="lunch"?"Lunch":"Extended Care"}: ${e} - ${n}`}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=L({type:i,selectors:[["app-order-edit"]],decls:16,vars:8,consts:[[1,"order-edit"],[1,"page-header"],["routerLink","/orders",1,"back-link"],[1,"subtitle"],[1,"loading-container"],[1,"error-container"],[1,"empty-container"],[1,"edit-sections"],[1,"dialog-overlay"],[1,"toast","toast-success"],[1,"toast","toast-error"],[1,"spinner"],[1,"error-icon"],[1,"btn-retry",3,"click"],[1,"empty-icon"],["routerLink","/classes",1,"btn-primary"],[1,"edit-section"],[1,"section-header"],[1,"section-subtitle"],[1,"info-message"],[1,"subsection"],[1,"enrollment-list"],[1,"enrollment-card",3,"is-paid"],[1,"pending-changes-section"],[1,"enrollment-card"],[1,"enrollment-header"],[1,"enrollment-info"],[1,"class-name"],[1,"item-status"],[1,"enrollment-meta"],[1,"enrollment-options"],[1,"option-toggle"],["type","checkbox",3,"change","checked","disabled"],[1,"option-label"],[1,"enrollment-actions"],[1,"btn-danger-outline","btn-small",3,"click","disabled"],[1,"pending-badge"],[1,"pending-changes-list"],[1,"pending-change-item"],[1,"changes-summary"],[1,"summary-row"],[1,"summary-amount"],[1,"summary-note"],[1,"changes-actions"],[1,"btn-secondary",3,"click"],[1,"btn-primary",3,"disabled"],[1,"btn-warning",3,"disabled"],[1,"change-description"],[1,"change-price"],[1,"btn-icon",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"spinner-small"],[1,"btn-warning",3,"click","disabled"],[1,"change-requests-list"],[1,"change-request-card"],[1,"request-header"],[1,"request-id"],[1,"request-details"],[1,"request-actions-list"],[1,"request-action"],[1,"request-meta"],[1,"request-reason"],[1,"request-admin-notes"],[1,"waitlist-items"],[1,"waitlist-item"],[1,"waitlist-details"],[1,"waitlist-name"],[1,"waitlist-meta"],[1,"waitlist-status"],[1,"badge","badge-success"],[1,"btn-secondary","btn-small",3,"click","disabled"],[1,"help-text"],[1,"available-classes"],[1,"available-class"],[1,"class-details"],[1,"class-meta"],[1,"class-capacity"],[1,"btn-primary","btn-small",3,"click","disabled"],[1,"dialog-overlay",3,"click"],[1,"dialog",3,"click"],[1,"dialog-content"],[1,"changes-list"],[1,"change-info"],[1,"warning-message"],[1,"form-group"],["for","changeReason"],["id","changeReason","rows","3","placeholder","Provide a reason for your change request...",3,"ngModelChange","ngModel"],[1,"dialog-actions"],[1,"btn-secondary",3,"click","disabled"],[1,"warning-icon"],[1,"warning-content"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"header",1)(2,"a",2),r(3,"\u2190 Back to Orders"),o(),a(4,"h1"),r(5,"Edit Order"),o(),a(6,"p",3),r(7,"Manage your enrollments and waitlists"),o()(),p(8,me,4,0,"div",4),p(9,_e,7,1,"div",5),p(10,ue,9,0,"div",6),p(11,ze,19,4,"div",7),p(12,Ke,26,9,"div",8),p(13,He,12,5,"div",8),p(14,Qe,2,1,"div",9),p(15,Xe,2,1,"div",10),o()),e&2&&(s(8),m(n.orderService.loading()||n.seasonService.loading()?8:-1),s(),m(n.orderService.error()?9:-1),s(),m(!n.orderService.loading()&&!n.orderService.order()?10:-1),s(),m(!n.orderService.loading()&&n.orderService.order()?11:-1),s(),m(n.showRequestChangeDialog()?12:-1),s(),m(n.showWaitlistDialog()?13:-1),s(),m(n.successMessage()?14:-1),s(),m(n.actionError()?15:-1))},dependencies:[Y,ae,ne,ie,oe,J],styles:[".order-edit[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;padding:20px}.page-header[_ngcontent-%COMP%]{margin-bottom:30px}.back-link[_ngcontent-%COMP%]{display:inline-block;color:#666;text-decoration:none;margin-bottom:10px;font-size:14px}.back-link[_ngcontent-%COMP%]:hover{color:#333}h1[_ngcontent-%COMP%]{margin:0 0 5px;font-size:28px}.subtitle[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.edit-sections[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:30px}.edit-section[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:24px}.section-header[_ngcontent-%COMP%]{margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 5px;font-size:20px}.section-subtitle[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.info-message[_ngcontent-%COMP%]{padding:16px;background:#e3f2fd;border-left:4px solid #2196f3;border-radius:4px;color:#1976d2;margin-bottom:16px}.info-message.info-success[_ngcontent-%COMP%]{background:#e8f5e9;border-left-color:#4caf50;color:#2e7d32}.warning-message[_ngcontent-%COMP%]{display:flex;gap:12px;padding:16px;background:#fff3e0;border-left:4px solid #ff9800;border-radius:4px;margin-bottom:20px}.warning-icon[_ngcontent-%COMP%]{font-size:24px;flex-shrink:0}.warning-content[_ngcontent-%COMP%]{flex:1}.warning-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:5px;color:#e65100}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#ef6c00;font-size:14px}.item-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:20px}.item-checkbox[_ngcontent-%COMP%]{display:flex;align-items:start;gap:12px;padding:16px;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .2s}.item-checkbox[_ngcontent-%COMP%]:hover{border-color:#2196f3;background:#f5f5f5}.item-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-top:4px;width:18px;height:18px;cursor:pointer}.item-details[_ngcontent-%COMP%]{flex:1}.item-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.item-meta[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:4px}.item-price[_ngcontent-%COMP%]{font-weight:600;color:#2196f3}.item-status[_ngcontent-%COMP%]{font-size:12px;font-weight:600;padding:4px 8px;border-radius:4px;display:inline-block}.item-status.status-submitted[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.item-status.status-paid[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.item-status.status-pending-refund[_ngcontent-%COMP%]{background:#fce4ec;color:#c2185b}.enrollment-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin-bottom:24px}.enrollment-card[_ngcontent-%COMP%]{border:2px solid #e0e0e0;border-radius:8px;padding:16px;background:#fff}.enrollment-card.is-paid[_ngcontent-%COMP%]{border-color:#4caf50;background:#f8fff8}.enrollment-header[_ngcontent-%COMP%]{margin-bottom:12px}.enrollment-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.enrollment-info[_ngcontent-%COMP%]   .class-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.enrollment-meta[_ngcontent-%COMP%]{font-size:14px;color:#666}.enrollment-options[_ngcontent-%COMP%]{display:flex;gap:24px;margin-bottom:12px;padding:12px;background:#f5f5f5;border-radius:6px}.option-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer}.option-toggle[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.option-toggle[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.option-label[_ngcontent-%COMP%]{font-size:14px}.enrollment-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.pending-badge[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#ff9800;background:#fff3e0;padding:4px 8px;border-radius:4px}.pending-changes-section[_ngcontent-%COMP%]{margin-top:24px;padding:20px;background:#e3f2fd;border-radius:8px;border:1px solid #2196f3}.pending-changes-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;font-size:18px;color:#1565c0}.pending-changes-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}.pending-change-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:8px 12px;background:#fff;border-radius:4px}.change-description[_ngcontent-%COMP%]{flex:1;font-size:14px}.change-price[_ngcontent-%COMP%]{font-weight:600;color:#f44336}.change-price.credit[_ngcontent-%COMP%]{color:#4caf50}.btn-icon[_ngcontent-%COMP%]{width:24px;height:24px;border:none;background:#f5f5f5;border-radius:50%;cursor:pointer;font-size:16px;color:#666;display:flex;align-items:center;justify-content:center}.btn-icon[_ngcontent-%COMP%]:hover{background:#e0e0e0;color:#333}.changes-summary[_ngcontent-%COMP%]{padding:12px;background:#fff;border-radius:4px;margin-bottom:16px}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:16px}.summary-amount[_ngcontent-%COMP%]{font-weight:600}.summary-amount.credit[_ngcontent-%COMP%]{color:#4caf50}.summary-note[_ngcontent-%COMP%]{font-size:13px;color:#666;margin-top:8px}.changes-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}.change-requests-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.change-request-card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:16px;background:#fafafa}.request-actions-list[_ngcontent-%COMP%]{color:#333}.request-action[_ngcontent-%COMP%]{margin-left:16px;color:#666;padding:4px 0}.request-admin-notes[_ngcontent-%COMP%]{color:#1565c0;font-style:italic;margin-top:8px}.changes-list[_ngcontent-%COMP%]{margin:12px 0;padding-left:20px}.changes-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px}.change-info[_ngcontent-%COMP%]{margin:16px 0;padding:12px;background:#f5f5f5;border-radius:4px;display:flex;justify-content:space-between}.change-info[_ngcontent-%COMP%]   .credit[_ngcontent-%COMP%]{color:#4caf50;font-weight:600}.section-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.btn-danger-outline[_ngcontent-%COMP%]{background:#fff;color:#f44336;border:1px solid #f44336;padding:6px 12px;border-radius:4px;font-size:13px;font-weight:500;cursor:pointer}.btn-danger-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#f44336;color:#fff}.btn-danger-outline[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.subsection[_ngcontent-%COMP%]{margin-bottom:30px}.subsection[_ngcontent-%COMP%]:last-child{margin-bottom:0}.subsection[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 12px;font-size:16px}.help-text[_ngcontent-%COMP%]{margin:0 0 12px;color:#666;font-size:14px}.waitlist-items[_ngcontent-%COMP%], .available-classes[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.waitlist-item[_ngcontent-%COMP%], .available-class[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;padding:16px;border:1px solid #e0e0e0;border-radius:8px}.waitlist-details[_ngcontent-%COMP%], .class-details[_ngcontent-%COMP%]{flex:1}.waitlist-name[_ngcontent-%COMP%], .class-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.waitlist-meta[_ngcontent-%COMP%], .class-meta[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:4px}.waitlist-status[_ngcontent-%COMP%], .class-capacity[_ngcontent-%COMP%]{font-size:13px;color:#999}.badge[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:600;margin-left:8px}.badge-success[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%], .btn-danger[_ngcontent-%COMP%], .btn-retry[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s}.btn-primary[_ngcontent-%COMP%]{background:#2196f3;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1976d2}.btn-secondary[_ngcontent-%COMP%]{background:#f5f5f5;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#e0e0e0}.btn-danger[_ngcontent-%COMP%]{background:#f44336;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#d32f2f}.btn-warning[_ngcontent-%COMP%]{background:#ff9800;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover:not(:disabled){background:#f57c00}.btn-small[_ngcontent-%COMP%]{padding:6px 12px;font-size:13px}.btn-retry[_ngcontent-%COMP%]{background:#2196f3;color:#fff;margin-top:10px}button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:24px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px}.dialog-content[_ngcontent-%COMP%]{margin-bottom:20px}.cancel-items-list[_ngcontent-%COMP%]{margin:12px 0;padding-left:20px}.cancel-items-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px}.refund-info[_ngcontent-%COMP%]{margin-top:16px;padding:16px;background:#f5f5f5;border-radius:6px}.refund-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:12px}.refund-breakdown[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.refund-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.refund-total[_ngcontent-%COMP%]{padding-top:8px;border-top:2px solid #ddd;font-weight:600;font-size:16px}.form-group[_ngcontent-%COMP%]{margin-top:16px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:600}.required[_ngcontent-%COMP%]{color:#f44336}.form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px;resize:vertical}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #2196f3;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top:2px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-right:8px;vertical-align:middle}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-icon[_ngcontent-%COMP%]{width:60px;height:60px;background:#f44336;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:700;margin:0 auto 20px}.empty-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:20px}.toast[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;padding:16px 20px;border-radius:6px;color:#fff;font-weight:500;box-shadow:0 4px 12px #00000026;z-index:1001;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.toast-success[_ngcontent-%COMP%]{background:#4caf50}.toast-error[_ngcontent-%COMP%]{background:#f44336}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(400px);opacity:0}to{transform:translate(0);opacity:1}}.refund-requests-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.refund-request-card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:16px;background:#fafafa}.request-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.request-id[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#666}.request-status[_ngcontent-%COMP%]{font-size:12px;font-weight:600;padding:4px 10px;border-radius:12px;text-transform:uppercase}.request-status.status-pending[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.request-status.status-approved[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.request-status.status-refunded[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.request-status.status-denied[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.request-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;font-size:14px}.request-items[_ngcontent-%COMP%]{color:#333}.request-item[_ngcontent-%COMP%]{margin-left:16px;color:#666}.request-meta[_ngcontent-%COMP%]{display:flex;gap:16px;color:#888;font-size:13px}.request-reason[_ngcontent-%COMP%]{color:#666;font-style:italic}@media(max-width:768px){.order-edit[_ngcontent-%COMP%], .edit-section[_ngcontent-%COMP%]{padding:16px}.waitlist-item[_ngcontent-%COMP%], .available-class[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.dialog[_ngcontent-%COMP%]{width:95%;padding:20px}.request-meta[_ngcontent-%COMP%]{flex-direction:column;gap:4px}}"]})};export{re as OrderEditComponent};
