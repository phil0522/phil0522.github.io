import{Ja as z,Ka as J,La as K}from"./chunk-7QJVSJKI.js";import{M as V,R as C,Sb as v,a as A,b as R,ha as x}from"./chunk-6GAPJCXB.js";var $=class S{functions=C(K);_loading=x(!1);_error=x(null);loading=this._loading.asReadonly();error=this._error.asReadonly();async createUser(i){return this.wrapApiCall("createUser",i)}async updateUser(i){return this.wrapApiCall("updateUser",i)}async createStudent(i){return this.wrapApiCall("addStudent",i)}async updateStudent(i){return this.wrapApiCall("updateStudent",i)}async deleteStudent(i){return this.wrapApiCall("deleteStudent",{studentId:i})}async getUserProfile(i){return this.wrapCall("getUserProfile",{uid:i})}async listAllUsers(i){return this.wrapCall("listAllUsers",{limit:i})}async searchUsers(i){return this.wrapCall("searchUsers",{query:i})}async getAdminUserDetails(i){return this.wrapCall("getAdminUserDetails",{uid:i})}async updateUserProfileAsAdmin(i,e){return this.wrapCall("updateUserProfile",{authId:i,updates:e})}clearError(){this._error.set(null)}async wrapCall(i,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.call(i,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async wrapApiCall(i,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.callApi(i,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}static \u0275fac=function(e){return new(e||S)};static \u0275prov=V({token:S,factory:S.\u0275fac,providedIn:"root"})};var te=["43dfed9d3bb5faee2c59afaf60e2f0ca","de4e8cbf34b00cba9a1122ee97ea3b00","57cef514bb4351a206f20053503648c9","33ccd328349ed0605d8ca291609c15da"];function se(S){function i(r,u){return r<<u|r>>>32-u}function e(r,u){let l=r&2147483648,m=u&2147483648,g=r&1073741824,_=u&1073741824,f=(r&1073741823)+(u&1073741823);return g&_?f^2147483648^l^m:g|_?f&1073741824?f^3221225472^l^m:f^1073741824^l^m:f^l^m}function d(r,u,l){return r&u|~r&l}function c(r,u,l){return r&l|u&~l}function U(r,u,l){return r^u^l}function P(r,u,l){return u^(r|~l)}function h(r,u,l,m,g,_,f){return r=e(r,e(e(d(u,l,m),g),f)),e(i(r,_),u)}function b(r,u,l,m,g,_,f){return r=e(r,e(e(c(u,l,m),g),f)),e(i(r,_),u)}function p(r,u,l,m,g,_,f){return r=e(r,e(e(U(u,l,m),g),f)),e(i(r,_),u)}function y(r,u,l,m,g,_,f){return r=e(r,e(e(P(u,l,m),g),f)),e(i(r,_),u)}function ee(r){let u,l=r.length,m=l+8,_=((m-m%64)/64+1)*16,f=new Array(_-1),G=0,w=0;for(;w<l;)u=(w-w%4)/4,G=w%4*8,f[u]=f[u]|r.charCodeAt(w)<<G,w++;return u=(w-w%4)/4,G=w%4*8,f[u]=f[u]|128<<G,f[_-2]=l<<3,f[_-1]=l>>>29,f}function D(r){let u="",l="",m,g;for(g=0;g<=3;g++)m=r>>>g*8&255,l="0"+m.toString(16),u=u+l.substring(l.length-2);return u}let o=ee(S),t=1732584193,s=4023233417,n=2562383102,a=271733878,M=7,N=12,E=17,q=22,I=5,T=9,L=14,B=20,F=4,H=11,W=16,j=23,Q=6,O=10,Y=15,k=21;for(let r=0;r<o.length;r+=16){let u=t,l=s,m=n,g=a;t=h(t,s,n,a,o[r+0],M,3614090360),a=h(a,t,s,n,o[r+1],N,3905402710),n=h(n,a,t,s,o[r+2],E,606105819),s=h(s,n,a,t,o[r+3],q,3250441966),t=h(t,s,n,a,o[r+4],M,4118548399),a=h(a,t,s,n,o[r+5],N,1200080426),n=h(n,a,t,s,o[r+6],E,2821735955),s=h(s,n,a,t,o[r+7],q,4249261313),t=h(t,s,n,a,o[r+8],M,1770035416),a=h(a,t,s,n,o[r+9],N,2336552879),n=h(n,a,t,s,o[r+10],E,4294925233),s=h(s,n,a,t,o[r+11],q,2304563134),t=h(t,s,n,a,o[r+12],M,1804603682),a=h(a,t,s,n,o[r+13],N,4254626195),n=h(n,a,t,s,o[r+14],E,2792965006),s=h(s,n,a,t,o[r+15],q,1236535329),t=b(t,s,n,a,o[r+1],I,4129170786),a=b(a,t,s,n,o[r+6],T,3225465664),n=b(n,a,t,s,o[r+11],L,643717713),s=b(s,n,a,t,o[r+0],B,3921069994),t=b(t,s,n,a,o[r+5],I,3593408605),a=b(a,t,s,n,o[r+10],T,38016083),n=b(n,a,t,s,o[r+15],L,3634488961),s=b(s,n,a,t,o[r+4],B,3889429448),t=b(t,s,n,a,o[r+9],I,568446438),a=b(a,t,s,n,o[r+14],T,3275163606),n=b(n,a,t,s,o[r+3],L,4107603335),s=b(s,n,a,t,o[r+8],B,1163531501),t=b(t,s,n,a,o[r+13],I,2850285829),a=b(a,t,s,n,o[r+2],T,4243563512),n=b(n,a,t,s,o[r+7],L,1735328473),s=b(s,n,a,t,o[r+12],B,2368359562),t=p(t,s,n,a,o[r+5],F,4294588738),a=p(a,t,s,n,o[r+8],H,2272392833),n=p(n,a,t,s,o[r+11],W,1839030562),s=p(s,n,a,t,o[r+14],j,4259657740),t=p(t,s,n,a,o[r+1],F,2763975236),a=p(a,t,s,n,o[r+4],H,1272893353),n=p(n,a,t,s,o[r+7],W,4139469664),s=p(s,n,a,t,o[r+10],j,3200236656),t=p(t,s,n,a,o[r+13],F,681279174),a=p(a,t,s,n,o[r+0],H,3936430074),n=p(n,a,t,s,o[r+3],W,3572445317),s=p(s,n,a,t,o[r+6],j,76029189),t=p(t,s,n,a,o[r+9],F,3654602809),a=p(a,t,s,n,o[r+12],H,3873151461),n=p(n,a,t,s,o[r+15],W,530742520),s=p(s,n,a,t,o[r+2],j,3299628645),t=y(t,s,n,a,o[r+0],Q,4096336452),a=y(a,t,s,n,o[r+7],O,1126891415),n=y(n,a,t,s,o[r+14],Y,2878612391),s=y(s,n,a,t,o[r+5],k,4237533241),t=y(t,s,n,a,o[r+12],Q,1700485571),a=y(a,t,s,n,o[r+3],O,2399980690),n=y(n,a,t,s,o[r+10],Y,4293915773),s=y(s,n,a,t,o[r+1],k,2240044497),t=y(t,s,n,a,o[r+8],Q,1873313359),a=y(a,t,s,n,o[r+15],O,4264355552),n=y(n,a,t,s,o[r+6],Y,2734768916),s=y(s,n,a,t,o[r+13],k,1309151649),t=y(t,s,n,a,o[r+4],Q,4149444226),a=y(a,t,s,n,o[r+11],O,3174756917),n=y(n,a,t,s,o[r+2],Y,718787259),s=y(s,n,a,t,o[r+9],k,3951481745),t=e(t,u),s=e(s,l),n=e(n,m),a=e(a,g)}return(D(t)+D(s)+D(n)+D(a)).toLowerCase()}function X(S){if(!S)return!1;let i=se(S.toLowerCase().trim());return te.includes(i)}var Z=class S{datastore=C(z);rpc=C($);impersonationService=C(J);_currentUser=x(null);_loading=x(!1);_error=x(null);_isAdmin=x(!1);_users=x([]);_selectedUser=x(null);_searchQuery=x("");_actionLoading=x(!1);_actionError=x(null);currentUser=v(()=>this.impersonationService.impersonatedUser()??this._currentUser());loading=this._loading.asReadonly();error=this._error.asReadonly();actualUser=this._currentUser.asReadonly();users=this._users.asReadonly();selectedUser=this._selectedUser.asReadonly();searchQuery=this._searchQuery.asReadonly();actionLoading=this._actionLoading.asReadonly();actionError=this._actionError.asReadonly();isAuthenticated=v(()=>this._currentUser()!==null);userCount=v(()=>this._users().length);hasUsers=v(()=>this._users().length>0);students=v(()=>this.currentUser()?.students??[]);studentCount=v(()=>this.students().length);hasStudents=v(()=>this.students().length>0);isProfileComplete=v(()=>{let i=this.currentUser();if(!i)return!1;let e=i.contactInfo;if(!e)return!1;let d=!!e.phone,c=!!e.wechat,U=!!e.address?.street&&!!e.address?.city&&!!e.address?.state&&!!e.address?.zipCode,P=!!e.emergencyContact?.name&&!!e.emergencyContact?.phone&&!!e.emergencyContact?.relationship;return d&&c&&U&&P});isAdmin=v(()=>this._isAdmin()&&!this.impersonationService.isImpersonating());async createUser(i){this._loading.set(!0),this._error.set(null);try{return await this.rpc.createUser(i)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateProfile(i){this._loading.set(!0),this._error.set(null);try{let e=await this.rpc.updateUser({updates:i});this._currentUser.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}setCurrentUser(i){this._currentUser.set(i),i===null?this._isAdmin.set(!1):this._isAdmin.set(X(i.email))}clearUser(){this._currentUser.set(null),this._isAdmin.set(!1)}clearError(){this._error.set(null)}getStudentById(i){return this.students().find(e=>e.id===i)}getEligibleStudents(i){let e=new Date(i,0,1);return this.students().filter(d=>{let c=new Date(d.dob),U=e.getFullYear()-c.getFullYear(),h=new Date(e.getFullYear(),c.getMonth(),c.getDate())>e?U-1:U;return h>=5&&h<=12})}async createStudent(i){if(!this._currentUser())throw new Error("No current user");this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.createStudent(i);return this._currentUser.update(c=>c&&R(A({},c),{students:[...c.students??[],d]})),d}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async updateStudent(i,e){this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.updateStudent(A({studentId:i},e));this._currentUser.update(c=>c&&R(A({},c),{students:c.students?.map(U=>U.id===i?d:U)}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async deleteStudent(i){this._loading.set(!0),this._error.set(null);try{await this.rpc.deleteStudent(i),this._currentUser.update(e=>e&&R(A({},e),{students:e.students?.filter(d=>d.id!==i)}))}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async loadAllUsers(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.listAllUsers(i);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async searchUsers(i){this._loading.set(!0),this._error.set(null),this._searchQuery.set(i);try{let e=await this.datastore.searchUsers(i);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async getUserDetails(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.getUserByAuthId(i);if(!e)throw new Error(`User not found: ${i}`);return this._selectedUser.set(e),e}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async getUserByDisplayId(i){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.getUserByDisplayId(i);return e&&this._selectedUser.set(e),e}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateUserProfile(i,e){this._actionLoading.set(!0),this._actionError.set(null);try{await this.rpc.updateUserProfileAsAdmin(i,e),this._users.update(c=>c.map(U=>U.uid===i?R(A({},U),{displayName:e.displayName??U.displayName,contactInfo:e.contactInfo??U.contactInfo}):U));let d=this._selectedUser();d&&d.uid===i&&this._selectedUser.set(R(A({},d),{displayName:e.displayName??d.displayName,contactInfo:e.contactInfo??d.contactInfo}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._actionError.set(c),d}finally{this._actionLoading.set(!1)}}setSearchQuery(i){this._searchQuery.set(i)}clearSelectedUser(){this._selectedUser.set(null)}static \u0275fac=function(e){return new(e||S)};static \u0275prov=V({token:S,factory:S.\u0275fac,providedIn:"root"})};export{$ as a,Z as b};
