import{Ca as z,Da as J}from"./chunk-2LEHUDM5.js";import{M as G,R as C,Rb as w,a as A,b as R,ha as x}from"./chunk-EVJ2WVWM.js";var V=class S{functions=C(J);_loading=x(!1);_error=x(null);loading=this._loading.asReadonly();error=this._error.asReadonly();async createUser(o){return this.wrapApiCall("createUser",o)}async updateUser(o){return this.wrapApiCall("updateUser",o)}async createStudent(o){return this.wrapApiCall("addStudent",o)}async updateStudent(o){return this.wrapApiCall("updateStudent",o)}async deleteStudent(o){return this.wrapApiCall("deleteStudent",{studentId:o})}async getUserProfile(o){return this.wrapCall("getUserProfile",{uid:o})}async listAllUsers(o){return this.wrapCall("listAllUsers",{limit:o})}async searchUsers(o){return this.wrapCall("searchUsers",{query:o})}async getAdminUserDetails(o){return this.wrapCall("getAdminUserDetails",{uid:o})}async updateUserProfileAsAdmin(o,e){return this.wrapCall("updateUserProfile",{authId:o,updates:e})}clearError(){this._error.set(null)}async wrapCall(o,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.call(o,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async wrapApiCall(o,e){this._loading.set(!0),this._error.set(null);try{return await this.functions.callApi(o,e)}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}static \u0275fac=function(e){return new(e||S)};static \u0275prov=G({token:S,factory:S.\u0275fac,providedIn:"root"})};var re=["43dfed9d3bb5faee2c59afaf60e2f0ca","de4e8cbf34b00cba9a1122ee97ea3b00","57cef514bb4351a206f20053503648c9"];function te(S){function o(r,u){return r<<u|r>>>32-u}function e(r,u){let l=r&2147483648,m=u&2147483648,g=r&1073741824,_=u&1073741824,f=(r&1073741823)+(u&1073741823);return g&_?f^2147483648^l^m:g|_?f&1073741824?f^3221225472^l^m:f^1073741824^l^m:f^l^m}function d(r,u,l){return r&u|~r&l}function c(r,u,l){return r&l|u&~l}function U(r,u,l){return r^u^l}function $(r,u,l){return u^(r|~l)}function h(r,u,l,m,g,_,f){return r=e(r,e(e(d(u,l,m),g),f)),e(o(r,_),u)}function b(r,u,l,m,g,_,f){return r=e(r,e(e(c(u,l,m),g),f)),e(o(r,_),u)}function y(r,u,l,m,g,_,f){return r=e(r,e(e(U(u,l,m),g),f)),e(o(r,_),u)}function p(r,u,l,m,g,_,f){return r=e(r,e(e($(u,l,m),g),f)),e(o(r,_),u)}function Z(r){let u,l=r.length,m=l+8,_=((m-m%64)/64+1)*16,f=new Array(_-1),k=0,v=0;for(;v<l;)u=(v-v%4)/4,k=v%4*8,f[u]=f[u]|r.charCodeAt(v)<<k,v++;return u=(v-v%4)/4,k=v%4*8,f[u]=f[u]|128<<k,f[_-2]=l<<3,f[_-1]=l>>>29,f}function P(r){let u="",l="",m,g;for(g=0;g<=3;g++)m=r>>>g*8&255,l="0"+m.toString(16),u=u+l.substring(l.length-2);return u}let i=Z(S),t=1732584193,s=4023233417,n=2562383102,a=271733878,D=7,M=12,N=17,E=22,q=5,T=9,I=14,L=20,F=4,H=11,B=16,j=23,Q=6,W=10,O=15,Y=21;for(let r=0;r<i.length;r+=16){let u=t,l=s,m=n,g=a;t=h(t,s,n,a,i[r+0],D,3614090360),a=h(a,t,s,n,i[r+1],M,3905402710),n=h(n,a,t,s,i[r+2],N,606105819),s=h(s,n,a,t,i[r+3],E,3250441966),t=h(t,s,n,a,i[r+4],D,4118548399),a=h(a,t,s,n,i[r+5],M,1200080426),n=h(n,a,t,s,i[r+6],N,2821735955),s=h(s,n,a,t,i[r+7],E,4249261313),t=h(t,s,n,a,i[r+8],D,1770035416),a=h(a,t,s,n,i[r+9],M,2336552879),n=h(n,a,t,s,i[r+10],N,4294925233),s=h(s,n,a,t,i[r+11],E,2304563134),t=h(t,s,n,a,i[r+12],D,1804603682),a=h(a,t,s,n,i[r+13],M,4254626195),n=h(n,a,t,s,i[r+14],N,2792965006),s=h(s,n,a,t,i[r+15],E,1236535329),t=b(t,s,n,a,i[r+1],q,4129170786),a=b(a,t,s,n,i[r+6],T,3225465664),n=b(n,a,t,s,i[r+11],I,643717713),s=b(s,n,a,t,i[r+0],L,3921069994),t=b(t,s,n,a,i[r+5],q,3593408605),a=b(a,t,s,n,i[r+10],T,38016083),n=b(n,a,t,s,i[r+15],I,3634488961),s=b(s,n,a,t,i[r+4],L,3889429448),t=b(t,s,n,a,i[r+9],q,568446438),a=b(a,t,s,n,i[r+14],T,3275163606),n=b(n,a,t,s,i[r+3],I,4107603335),s=b(s,n,a,t,i[r+8],L,1163531501),t=b(t,s,n,a,i[r+13],q,2850285829),a=b(a,t,s,n,i[r+2],T,4243563512),n=b(n,a,t,s,i[r+7],I,1735328473),s=b(s,n,a,t,i[r+12],L,2368359562),t=y(t,s,n,a,i[r+5],F,4294588738),a=y(a,t,s,n,i[r+8],H,2272392833),n=y(n,a,t,s,i[r+11],B,1839030562),s=y(s,n,a,t,i[r+14],j,4259657740),t=y(t,s,n,a,i[r+1],F,2763975236),a=y(a,t,s,n,i[r+4],H,1272893353),n=y(n,a,t,s,i[r+7],B,4139469664),s=y(s,n,a,t,i[r+10],j,3200236656),t=y(t,s,n,a,i[r+13],F,681279174),a=y(a,t,s,n,i[r+0],H,3936430074),n=y(n,a,t,s,i[r+3],B,3572445317),s=y(s,n,a,t,i[r+6],j,76029189),t=y(t,s,n,a,i[r+9],F,3654602809),a=y(a,t,s,n,i[r+12],H,3873151461),n=y(n,a,t,s,i[r+15],B,530742520),s=y(s,n,a,t,i[r+2],j,3299628645),t=p(t,s,n,a,i[r+0],Q,4096336452),a=p(a,t,s,n,i[r+7],W,1126891415),n=p(n,a,t,s,i[r+14],O,2878612391),s=p(s,n,a,t,i[r+5],Y,4237533241),t=p(t,s,n,a,i[r+12],Q,1700485571),a=p(a,t,s,n,i[r+3],W,2399980690),n=p(n,a,t,s,i[r+10],O,4293915773),s=p(s,n,a,t,i[r+1],Y,2240044497),t=p(t,s,n,a,i[r+8],Q,1873313359),a=p(a,t,s,n,i[r+15],W,4264355552),n=p(n,a,t,s,i[r+6],O,2734768916),s=p(s,n,a,t,i[r+13],Y,1309151649),t=p(t,s,n,a,i[r+4],Q,4149444226),a=p(a,t,s,n,i[r+11],W,3174756917),n=p(n,a,t,s,i[r+2],O,718787259),s=p(s,n,a,t,i[r+9],Y,3951481745),t=e(t,u),s=e(s,l),n=e(n,m),a=e(a,g)}return(P(t)+P(s)+P(n)+P(a)).toLowerCase()}function K(S){if(!S)return!1;let o=te(S.toLowerCase().trim());return re.includes(o)}var X=class S{datastore=C(z);rpc=C(V);_currentUser=x(null);_loading=x(!1);_error=x(null);_isAdmin=x(!1);_users=x([]);_selectedUser=x(null);_searchQuery=x("");_actionLoading=x(!1);_actionError=x(null);currentUser=this._currentUser.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();users=this._users.asReadonly();selectedUser=this._selectedUser.asReadonly();searchQuery=this._searchQuery.asReadonly();actionLoading=this._actionLoading.asReadonly();actionError=this._actionError.asReadonly();isAuthenticated=w(()=>this._currentUser()!==null);userCount=w(()=>this._users().length);hasUsers=w(()=>this._users().length>0);students=w(()=>this._currentUser()?.students??[]);studentCount=w(()=>this.students().length);hasStudents=w(()=>this.students().length>0);isProfileComplete=w(()=>{let o=this._currentUser();if(!o)return!1;let e=o.contactInfo;if(!e)return!1;let d=!!e.phone,c=!!e.address?.street&&!!e.address?.city&&!!e.address?.state&&!!e.address?.zipCode,U=!!e.emergencyContact?.name&&!!e.emergencyContact?.phone&&!!e.emergencyContact?.relationship;return d&&c&&U});isAdmin=this._isAdmin.asReadonly();async createUser(o){this._loading.set(!0),this._error.set(null);try{return await this.rpc.createUser(o)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateProfile(o){this._loading.set(!0),this._error.set(null);try{let e=await this.rpc.updateUser({updates:o});this._currentUser.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}setCurrentUser(o){this._currentUser.set(o),o===null?this._isAdmin.set(!1):this._isAdmin.set(K(o.email))}clearUser(){this._currentUser.set(null),this._isAdmin.set(!1)}clearError(){this._error.set(null)}getStudentById(o){return this.students().find(e=>e.id===o)}getEligibleStudents(o){let e=new Date(o,0,1);return this.students().filter(d=>{let c=new Date(d.dob),U=e.getFullYear()-c.getFullYear(),h=new Date(e.getFullYear(),c.getMonth(),c.getDate())>e?U-1:U;return h>=5&&h<=12})}async createStudent(o){let e=this._currentUser();if(!e)throw new Error("No current user");this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.createStudent(A({parentAuthId:e.uid},o));return this._currentUser.update(c=>c&&R(A({},c),{students:[...c.students??[],d]})),d}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async updateStudent(o,e){this._loading.set(!0),this._error.set(null);try{let d=await this.rpc.updateStudent(A({studentId:o},e));this._currentUser.update(c=>c&&R(A({},c),{students:c.students?.map(U=>U.id===o?d:U)}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._error.set(c),d}finally{this._loading.set(!1)}}async deleteStudent(o){this._loading.set(!0),this._error.set(null);try{await this.rpc.deleteStudent(o),this._currentUser.update(e=>e&&R(A({},e),{students:e.students?.filter(d=>d.id!==o)}))}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async loadAllUsers(o){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.listAllUsers(o);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async searchUsers(o){this._loading.set(!0),this._error.set(null),this._searchQuery.set(o);try{let e=await this.datastore.searchUsers(o);this._users.set(e)}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async getUserDetails(o){this._loading.set(!0),this._error.set(null);try{let e=await this.datastore.getUserByAuthId(o);if(!e)throw new Error(`User not found: ${o}`);return this._selectedUser.set(e),e}catch(e){let d=e instanceof Error?e.message:String(e);throw this._error.set(d),e}finally{this._loading.set(!1)}}async updateUserProfile(o,e){this._actionLoading.set(!0),this._actionError.set(null);try{await this.rpc.updateUserProfileAsAdmin(o,e),this._users.update(c=>c.map(U=>U.uid===o?R(A({},U),{displayName:e.displayName??U.displayName,contactInfo:e.contactInfo??U.contactInfo}):U));let d=this._selectedUser();d&&d.uid===o&&this._selectedUser.set(R(A({},d),{displayName:e.displayName??d.displayName,contactInfo:e.contactInfo??d.contactInfo}))}catch(d){let c=d instanceof Error?d.message:String(d);throw this._actionError.set(c),d}finally{this._actionLoading.set(!1)}}setSearchQuery(o){this._searchQuery.set(o)}clearSelectedUser(){this._selectedUser.set(null)}static \u0275fac=function(e){return new(e||S)};static \u0275prov=G({token:S,factory:S.\u0275fac,providedIn:"root"})};export{V as a,X as b};
