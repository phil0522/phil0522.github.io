import{Da as d,ba as l}from"./chunk-Z3TSPNBE.js";import{M as r,R as s,Rb as a,ha as o}from"./chunk-EVJ2WVWM.js";var c=class n{functions=s(d);_loading=o(!1);_error=o(null);loading=this._loading.asReadonly();error=this._error.asReadonly();async getGlobalConfig(){return this.wrapApiCall("getGlobalConfig",{})}async updateActiveYear(e){return this.wrapApiCall("updateActiveYear",{year:e})}async updateFinancialRules(e){return this.wrapApiCall("updateFinancialRules",{rules:e})}async updateSystemSwitch(e){return this.wrapApiCall("updateSystemSwitch",{switches:e})}async updatePaymentInstructions(e){return this.wrapApiCall("updatePaymentInstructions",{instructions:e})}async updateContactInfo(e){return this.wrapApiCall("updateContactInfo",{contactInfo:e})}clearError(){this._error.set(null)}async wrapApiCall(e,t){this._loading.set(!0),this._error.set(null);try{return await this.functions.callApi(e,t)}catch(i){let g=i instanceof Error?i.message:String(i);throw this._error.set(g),i}finally{this._loading.set(!1)}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=r({token:n,factory:n.\u0275fac,providedIn:"root"})};var u=class n{rpc=s(c);_config=o(l);_loading=o(!1);_error=o(null);config=this._config.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();isSystemInitialized=a(()=>this._config().isSystemInitialized);currentActiveYear=a(()=>this._config().currentActiveYear);currentDate=a(()=>this._config().currentDate);currentTime=a(()=>this._config().currentTime);systemSwitch=a(()=>this._config().systemSwitch);financials=a(()=>this._config().financials);paymentInstructions=a(()=>this._config().paymentInstructions);contactInfo=a(()=>this._config().contactInfo);async fetchConfig(){this._loading.set(!0),this._error.set(null);try{let e=await this.rpc.getGlobalConfig();console.log("Fetched global config:",e),this._config.set(e)}catch(e){let t=e instanceof Error?e.message:"Failed to load configuration";throw this._error.set(t),console.error("Failed to fetch global config:",e),e}finally{this._loading.set(!1)}}async updateActiveYear(e){this._loading.set(!0),this._error.set(null);try{await this.rpc.updateActiveYear(e),await this.fetchConfig()}catch(t){let i=t instanceof Error?t.message:"Failed to update year";throw this._error.set(i),console.error("Failed to update active year:",t),t}finally{this._loading.set(!1)}}async updateFinancialRules(e){this._loading.set(!0),this._error.set(null);try{await this.rpc.updateFinancialRules(e),await this.fetchConfig()}catch(t){let i=t instanceof Error?t.message:"Failed to update financial rules";throw this._error.set(i),console.error("Failed to update financial rules:",t),t}finally{this._loading.set(!1)}}async updateSystemSwitch(e){this._loading.set(!0),this._error.set(null);try{await this.rpc.updateSystemSwitch(e),await this.fetchConfig()}catch(t){let i=t instanceof Error?t.message:"Failed to update system switches";throw this._error.set(i),console.error("Failed to update system switches:",t),t}finally{this._loading.set(!1)}}async updatePaymentInstructions(e){this._loading.set(!0),this._error.set(null);try{await this.rpc.updatePaymentInstructions(e),await this.fetchConfig()}catch(t){let i=t instanceof Error?t.message:"Failed to update payment information";throw this._error.set(i),console.error("Failed to update payment instructions:",t),t}finally{this._loading.set(!1)}}async updateContactInfo(e){this._loading.set(!0),this._error.set(null);try{await this.rpc.updateContactInfo(e),await this.fetchConfig()}catch(t){let i=t instanceof Error?t.message:"Failed to update contact information";throw this._error.set(i),console.error("Failed to update contact info:",t),t}finally{this._loading.set(!1)}}async ensureSystemInitialized(){console.log("[ConfigService] Fetching config (server auto-bootstraps if needed)...");try{await this.fetchConfig();let e=this._config().isSystemInitialized;return console.log("[ConfigService] System initialized:",e),e}catch(e){return console.error("[ConfigService] Failed to fetch config:",e),!1}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=r({token:n,factory:n.\u0275fac,providedIn:"root"})};export{u as a};
