import{b as L,c as D,f as V,r as N}from"./chunk-CAB5RZ3E.js";import{b as A}from"./chunk-ZWPM7P6E.js";import{d as k,j as I,k as T}from"./chunk-NA25QKA5.js";import{$a as p,Ab as m,Bb as C,Eb as E,Fb as y,Ga as r,Gb as h,Hb as b,Q as M,Ra as O,V as _,W as u,ab as g,cb as S,db as P,eb as w,fb as t,ga as x,gb as n,hb as U,lb as v,nb as f,pb as c,zb as i}from"./chunk-C26OXKSD.js";var F=(o,a)=>a.uid,W=(o,a)=>a.id;function j(o,a){if(o&1){let e=v();t(0,"div",10),i(1),t(2,"button",14),f("click",function(){_(e);let s=c();return u(s.loadAllUsers())}),i(3,"Retry"),n()()}if(o&2){let e=c();r(),C(" ",e.userService.error()," ")}}function B(o,a){o&1&&(t(0,"div",11),U(1,"div",15),t(2,"p"),i(3,"Loading..."),n()())}function Q(o,a){o&1&&(t(0,"div",12)(1,"div",16),i(2,"\u{1F465}"),n(),t(3,"h2"),i(4,"No user data"),n(),t(5,"p"),i(6,'Try searching or click "Show All"'),n()())}function R(o,a){if(o&1){let e=v();t(0,"div",19)(1,"div",20)(2,"span",21),i(3),n(),t(4,"span",22),i(5),n()(),t(6,"div",23)(7,"div",24)(8,"span",25),i(9,"Email"),n(),t(10,"span",26),i(11),n()(),t(12,"div",24)(13,"span",25),i(14,"Phone"),n(),t(15,"span",26),i(16),n()(),t(17,"div",24)(18,"span",25),i(19,"Students"),n(),t(20,"span",26),i(21),n()(),t(22,"div",24)(23,"span",25),i(24,"Registered"),n(),t(25,"span",26),i(26),n()()(),t(27,"div",27)(28,"button",28),f("click",function(){let s=_(e).$implicit,d=c(2);return u(d.openViewDialog(s))}),i(29," View Details "),n(),t(30,"button",29),f("click",function(){let s=_(e).$implicit,d=c(2);return u(d.openEditDialog(s))}),i(31,"Edit"),n()()()}if(o&2){let e=a.$implicit,l=c(2);r(3),m(e.displayName),r(2),m(e.displayId),r(6),m(e.email),r(5),m((e.contactInfo==null?null:e.contactInfo.phone)||"Not set"),r(5),m((e.students==null?null:e.students.length)||0),r(5),m(l.formatDate(e.timestamps.createdAt))}}function q(o,a){if(o&1&&(t(0,"div",17),i(1),n(),t(2,"div",18),S(3,R,32,6,"div",19,F),n()),o&2){let e=c();r(),C("Total ",e.userService.userCount()," users"),r(2),P(e.userService.users())}}function G(o,a){if(o&1&&(t(0,"div",40)(1,"span",25),i(2,"Address"),n(),t(3,"span",26),i(4),n()()),o&2){let e=c(3);r(4),E(" ",e.selectedUser().contactInfo.address.street,", ",e.selectedUser().contactInfo.address.city,", ",e.selectedUser().contactInfo.address.state," ",e.selectedUser().contactInfo.address.zipCode," ")}}function H(o,a){if(o&1&&(t(0,"div",45),i(1),n()),o&2){let e=c().$implicit;r(),C("Allergies: ",e.allergies)}}function J(o,a){if(o&1&&(t(0,"div",42)(1,"div",43),i(2),n(),t(3,"div",44)(4,"span"),i(5),n(),t(6,"span"),i(7),n(),t(8,"span"),i(9),n()(),p(10,H,2,1,"div",45),n()),o&2){let e=a.$implicit;r(2),m(e.fullName),r(3),C("ID: ",e.id),r(2),C("Gender: ",e.gender==="M"?"Male":"Female"),r(2),C("DOB: ",e.dob),r(),g(e.allergies&&e.allergies!=="None"?10:-1)}}function K(o,a){if(o&1&&(t(0,"div",36)(1,"h4"),i(2),n(),t(3,"div",41),S(4,J,11,5,"div",42,W),n()()),o&2){let e=c(3);r(2),C("Student List (",e.selectedUser().students.length,")"),r(2),P(e.selectedUser().students)}}function X(o,a){if(o&1&&(t(0,"div",32)(1,"div",36)(2,"h4"),i(3,"Basic Information"),n(),t(4,"div",37)(5,"div",38)(6,"span",25),i(7,"Parent Name"),n(),t(8,"span",26),i(9),n()(),t(10,"div",38)(11,"span",25),i(12,"Email"),n(),t(13,"span",26),i(14),n()(),t(15,"div",38)(16,"span",25),i(17,"User ID"),n(),t(18,"span",39),i(19),n()(),t(20,"div",38)(21,"span",25),i(22,"Registered"),n(),t(23,"span",26),i(24),n()()()(),t(25,"div",36)(26,"h4"),i(27,"Contact Information"),n(),t(28,"div",37)(29,"div",38)(30,"span",25),i(31,"Phone"),n(),t(32,"span",26),i(33),n()(),t(34,"div",38)(35,"span",25),i(36,"WeChat"),n(),t(37,"span",26),i(38),n()()(),p(39,G,5,4,"div",40),n(),p(40,K,6,1,"div",36),n()),o&2){let e,l,s,d=c(2);r(9),m(d.selectedUser().displayName),r(5),m(d.selectedUser().email),r(5),m(d.selectedUser().displayId),r(5),m(d.formatDate(d.selectedUser().timestamps.createdAt)),r(9),m(((e=d.selectedUser().contactInfo)==null?null:e.phone)||"Not set"),r(5),m(((l=d.selectedUser().contactInfo)==null?null:l.wechat)||"Not set"),r(),g((s=d.selectedUser().contactInfo)!=null&&s.address?39:-1),r(),g(d.selectedUser().students&&d.selectedUser().students.length>0?40:-1)}}function Y(o,a){if(o&1&&(t(0,"div",54),i(1),n()),o&2){let e=c(3);r(),m(e.userService.actionError())}}function Z(o,a){if(o&1){let e=v();t(0,"div",46)(1,"label",47),i(2,"Parent Name *"),n(),t(3,"input",48),b("ngModelChange",function(s){_(e);let d=c(2);return h(d.editForm.displayName,s)||(d.editForm.displayName=s),u(s)}),n()(),t(4,"div",49)(5,"div",46)(6,"label",50),i(7,"Phone"),n(),t(8,"input",51),b("ngModelChange",function(s){_(e);let d=c(2);return h(d.editForm.phone,s)||(d.editForm.phone=s),u(s)}),n()(),t(9,"div",46)(10,"label",52),i(11,"WeChat"),n(),t(12,"input",53),b("ngModelChange",function(s){_(e);let d=c(2);return h(d.editForm.wechat,s)||(d.editForm.wechat=s),u(s)}),n()()(),p(13,Y,2,1,"div",54)}if(o&2){let e=c(2);r(3),y("ngModel",e.editForm.displayName),r(5),y("ngModel",e.editForm.phone),r(4),y("ngModel",e.editForm.wechat),r(),g(e.userService.actionError()?13:-1)}}function $(o,a){if(o&1){let e=v();t(0,"button",55),f("click",function(){_(e);let s=c(2);return u(s.openEditDialog(s.selectedUser()))}),i(1," Edit "),n()}}function ee(o,a){if(o&1){let e=v();t(0,"button",7),f("click",function(){_(e);let s=c(2);return u(s.saveUser())}),i(1),n()}if(o&2){let e=c(2);w("disabled",e.userService.actionLoading()),r(),C(" ",e.userService.actionLoading()?"Saving...":"Save"," ")}}function te(o,a){if(o&1){let e=v();t(0,"div",30),f("click",function(){_(e);let s=c();return u(s.closeDialog())}),t(1,"div",31),f("click",function(s){return _(e),u(s.stopPropagation())}),t(2,"h3"),i(3),n(),p(4,X,41,8,"div",32),p(5,Z,14,4),t(6,"div",33),p(7,$,2,0,"button",34),p(8,ee,2,2,"button",35),t(9,"button",8),f("click",function(){_(e);let s=c();return u(s.closeDialog())}),i(10,"Close"),n()()()()}if(o&2){let e=c();r(3),m(e.dialogTitle()),r(),g(e.dialogType()==="view-user"&&e.selectedUser()?4:-1),r(),g(e.dialogType()==="edit-user"?5:-1),r(2),g(e.dialogType()==="view-user"?7:-1),r(),g(e.dialogType()==="edit-user"?8:-1)}}var z=class o{router=M(I);userService=M(A);searchQuery="";showDialog=x(!1);dialogType=x(null);dialogTitle=x("");selectedUser=x(null);editForm={displayName:"",phone:"",wechat:""};async ngOnInit(){if(!this.userService.isAuthenticated()){this.router.navigate(["/login"]);return}if(!this.userService.isAdmin()){this.router.navigate(["/"]);return}await this.loadAllUsers()}async loadAllUsers(){this.searchQuery="";try{await this.userService.loadAllUsers(100)}catch{}}async onSearch(){let a=this.searchQuery.trim();if(!a){await this.loadAllUsers();return}try{await this.userService.searchUsers(a)}catch{}}openViewDialog(a){this.selectedUser.set(a),this.dialogType.set("view-user"),this.dialogTitle.set("User Details"),this.showDialog.set(!0)}openEditDialog(a){this.selectedUser.set(a),this.editForm={displayName:a.displayName,phone:a.contactInfo?.phone||"",wechat:a.contactInfo?.wechat||""},this.dialogType.set("edit-user"),this.dialogTitle.set("Edit User"),this.showDialog.set(!0)}async saveUser(){let a=this.selectedUser();if(!a)return;let e={};if(this.editForm.displayName!==a.displayName&&(e.displayName=this.editForm.displayName),(this.editForm.phone!==(a.contactInfo?.phone||"")||this.editForm.wechat!==(a.contactInfo?.wechat||""))&&(e.contactInfo={phone:this.editForm.phone||a.contactInfo?.phone||"",wechat:this.editForm.wechat||a.contactInfo?.wechat||"",address:a.contactInfo?.address||{street:"",city:"",state:"",zipCode:""},emergencyContact:a.contactInfo?.emergencyContact||{name:"",phone:"",relationship:""}}),Object.keys(e).length===0){this.closeDialog();return}try{await this.userService.updateUserProfile(a.uid,e),this.closeDialog()}catch{}}closeDialog(){this.showDialog.set(!1),this.dialogType.set(null),this.selectedUser.set(null),this.userService.clearError()}formatDate(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=O({type:o,selectors:[["app-admin-user-list"]],decls:22,vars:8,consts:[[1,"admin-users"],[1,"page-header"],["routerLink","/admin",1,"back-link"],[1,"subtitle"],[1,"search-section"],[1,"search-bar"],["type","text","placeholder","Search by username or email...",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-outline",3,"click"],[1,"search-hint"],[1,"error"],[1,"loading"],[1,"empty"],[1,"dialog-overlay"],[1,"btn","btn-sm",3,"click"],[1,"spinner"],[1,"empty-icon"],[1,"results-count"],[1,"cards-grid"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"user-id"],[1,"card-body"],[1,"info-row"],[1,"label"],[1,"value"],[1,"card-actions"],[1,"btn","btn-sm","btn-outline",3,"click"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"dialog-overlay",3,"click"],[1,"dialog","dialog-lg",3,"click"],[1,"user-details"],[1,"dialog-actions"],[1,"btn","btn-primary"],[1,"btn","btn-primary",3,"disabled"],[1,"detail-section"],[1,"info-grid"],[1,"info-item"],[1,"value","mono"],[1,"address-info"],[1,"students-list"],[1,"student-card"],[1,"student-name"],[1,"student-info"],[1,"student-allergies"],[1,"form-group"],["for","displayName"],["type","text","id","displayName","placeholder","User name",3,"ngModelChange","ngModel"],[1,"form-row"],["for","phone"],["type","tel","id","phone","placeholder","Contact phone",3,"ngModelChange","ngModel"],["for","wechat"],["type","text","id","wechat","placeholder","WeChat ID",3,"ngModelChange","ngModel"],[1,"dialog-error"],[1,"btn","btn-primary",3,"click"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"header",1)(2,"a",2),i(3,"\u2190 Back to Console"),n(),t(4,"h1"),i(5,"User Management"),n(),t(6,"p",3),i(7,"Search and manage users"),n()(),t(8,"div",4)(9,"div",5)(10,"input",6),b("ngModelChange",function(d){return h(l.searchQuery,d)||(l.searchQuery=d),d}),f("keyup.enter",function(){return l.onSearch()}),n(),t(11,"button",7),f("click",function(){return l.onSearch()}),i(12),n(),t(13,"button",8),f("click",function(){return l.loadAllUsers()}),i(14,"Show All"),n()(),t(15,"p",9),i(16," Tip: Enter full email for exact search, or enter name prefix for fuzzy search "),n()(),p(17,j,4,1,"div",10),p(18,B,4,0,"div",11),p(19,Q,7,0,"div",12),p(20,q,5,1),p(21,te,11,5,"div",13),n()),e&2&&(r(10),y("ngModel",l.searchQuery),r(),w("disabled",l.userService.loading()),r(),C(" ",l.userService.loading()?"Searching...":"Search"," "),r(5),g(l.userService.error()?17:-1),r(),g(l.userService.loading()?18:-1),r(),g(!l.userService.loading()&&!l.userService.error()&&l.userService.users().length===0?19:-1),r(),g(!l.userService.loading()&&l.userService.users().length>0?20:-1),r(),g(l.showDialog()?21:-1))},dependencies:[k,N,L,D,V,T],styles:[".admin-users[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.page-header[_ngcontent-%COMP%]{margin-bottom:2rem}.back-link[_ngcontent-%COMP%]{display:inline-block;color:var(--sys-primary, #c62828);text-decoration:none;font-size:.875rem;margin-bottom:.5rem}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.75rem}.page-header[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0;color:var(--sys-on-surface-variant, #666)}.search-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.search-bar[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-bottom:.5rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:.75rem 1rem;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;font-size:1rem}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--sys-primary, #c62828)}.search-hint[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666);margin:0}.results-count[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{padding:1.5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.empty[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:var(--sys-on-surface-variant, #666)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.cards-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1rem}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:12px;overflow:hidden}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--sys-surface-variant, #f5f5f5);border-bottom:1px solid var(--sys-outline-variant, #e0e0e0)}.card-title[_ngcontent-%COMP%]{font-weight:600;font-size:1rem}.user-id[_ngcontent-%COMP%]{font-size:.75rem;font-family:monospace;color:var(--sys-on-surface-variant, #666);background:#fff;padding:.25rem .5rem;border-radius:4px}.card-body[_ngcontent-%COMP%]{padding:1rem}.info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.375rem 0;font-size:.875rem}.info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #666)}.info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500}.card-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;padding:1rem;background:var(--sys-surface-variant, #f5f5f5);border-top:1px solid var(--sys-outline-variant, #e0e0e0)}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-outline[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);color:var(--sys-on-surface, #212121)}.btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5)}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.8125rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.dialog-lg[_ngcontent-%COMP%]{max-width:700px}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.25rem}.user-details[_ngcontent-%COMP%], .detail-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.detail-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.875rem;color:var(--sys-on-surface-variant, #666);text-transform:uppercase;letter-spacing:.05em}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.info-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.info-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500}.info-item[_ngcontent-%COMP%]   .value.mono[_ngcontent-%COMP%]{font-family:monospace}.address-info[_ngcontent-%COMP%]{margin-top:.75rem}.address-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{display:block;font-size:.75rem;color:var(--sys-on-surface-variant, #666);margin-bottom:.25rem}.address-info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:.875rem}.students-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.student-card[_ngcontent-%COMP%]{padding:.75rem;background:var(--sys-surface-variant, #f5f5f5);border-radius:8px}.student-name[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.25rem}.student-info[_ngcontent-%COMP%]{display:flex;gap:1rem;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.student-allergies[_ngcontent-%COMP%]{margin-top:.5rem;font-size:.75rem;color:var(--sys-error, #c62828);background:var(--sys-error-container, #ffebee);padding:.25rem .5rem;border-radius:4px}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.375rem;font-size:.875rem;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;font-size:.9375rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--sys-primary, #c62828)}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.dialog-error[_ngcontent-%COMP%]{padding:.75rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;font-size:.875rem;margin-bottom:1rem}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--sys-outline-variant, #e0e0e0)}@media(max-width:600px){.search-bar[_ngcontent-%COMP%]{flex-direction:column}.cards-grid[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%], .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{z as AdminUserListComponent};
