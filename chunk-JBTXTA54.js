import{ha as u}from"./chunk-VIFNHMUH.js";import{I as i,N as d,Tb as r,da as n}from"./chunk-5O64VQN5.js";var l=class a{functions=d(u);_seasonCoupons=n([]);_userCoupons=n([]);_selectedUserCouponIds=n([]);_loading=n(!1);_validating=n(!1);_error=n(null);seasonCoupons=this._seasonCoupons.asReadonly();userCoupons=this._userCoupons.asReadonly();selectedUserCouponIds=this._selectedUserCouponIds.asReadonly();loading=this._loading.asReadonly();validating=this._validating.asReadonly();error=this._error.asReadonly();couponsToApply=r(()=>[...this._seasonCoupons(),...this._userCoupons().filter(o=>this._selectedUserCouponIds().includes(o.id))]);totalCouponCredit=r(()=>this.couponsToApply().reduce((o,e)=>o+e.maxCreditCents,0));hasAvailableCoupons=r(()=>this._seasonCoupons().length>0||this._userCoupons().length>0);async loadCoupons(o){this._loading.set(!0),this._error.set(null);try{let e=await this.functions.callApi("getUserAvailableCoupons",{seasonId:o});this._seasonCoupons.set(e.seasonCoupons),this._userCoupons.set(e.userCoupons),this._selectedUserCouponIds.set(e.userCoupons.map(s=>s.id))}catch(e){console.error("Failed to load coupons:",e),this._error.set("Failed to load coupons"),this._seasonCoupons.set([]),this._userCoupons.set([]),this._selectedUserCouponIds.set([])}finally{this._loading.set(!1)}}toggleCoupon(o){let e=this._selectedUserCouponIds();e.includes(o)?this._selectedUserCouponIds.set(e.filter(s=>s!==o)):this._selectedUserCouponIds.set([...e,o])}isCouponSelected(o){return this._selectedUserCouponIds().includes(o)}clearCoupons(){this._seasonCoupons.set([]),this._userCoupons.set([]),this._selectedUserCouponIds.set([]),this._error.set(null)}getSelectedCouponIds(){return this._selectedUserCouponIds()}async validateAndAddCoupon(o){this._validating.set(!0);try{let s=(await this.functions.callApi("validateAndAddCoupon",{couponId:o})).coupon;return this._userCoupons().map(t=>t.id).includes(s.id)||(this._userCoupons.update(t=>[...t,s]),this._selectedUserCouponIds.update(t=>[...t,s.id])),{success:!0,coupon:s}}catch(e){return{success:!1,error:e.message||"Failed to validate coupon"}}finally{this._validating.set(!1)}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=i({token:a,factory:a.\u0275fac,providedIn:"root"})};export{l as a};
