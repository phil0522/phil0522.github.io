import{a as Ye,b as Ze,c as Je,d as Qe,e as ne,f as K,g as $}from"./chunk-P2AFQSJG.js";import{a as Ue,b as $e}from"./chunk-CCDKMPWH.js";import{a as qe}from"./chunk-N3KKMO4F.js";import{a as He,b as Ke}from"./chunk-MEXQHVGL.js";import{a as Ge}from"./chunk-YPC3HQP2.js";import"./chunk-RFANFYTQ.js";import{a as Ee,b as Ae,c as Te,d as Ve,e as Ne,f as je,g as Le,i as Be,j as Re,k as We,m as Fe,q as ze}from"./chunk-NW44KXAN.js";import{a as Ie,b as De}from"./chunk-RYIKU5Y3.js";import{$ as Oe,R as Ce,S as he,T as be,V as ye,W as ve,X as Se,_ as Pe,aa as we,b as J,ba as Me,h as Q,ja as ke,ka as X,la as ee,n as xe,oa as te}from"./chunk-R7Y3ICY3.js";import"./chunk-ZEYGPIIR.js";import"./chunk-KBXPF7D4.js";import"./chunk-2PX3OE6K.js";import{$a as u,Da as ge,Db as s,Ea as d,Eb as x,Fb as w,Gb as _e,Jb as M,Kb as k,Lb as I,N as T,Pb as fe,Qa as Z,S as m,T as p,Tb as y,Wb as U,ab as g,bb as le,da as E,db as F,ea as ue,eb as z,fb as b,gb as i,hb as r,ib as j,ob as P,qb as _,sb as c}from"./chunk-CNMR2ZL6.js";import{a as S,b as O}from"./chunk-Q7L6LLAK.js";var rt=(a,t)=>t.key;function at(a,t){a&1&&(i(0,"div",6),s(1,"No active items to edit."),r())}function st(a,t){if(a&1){let e=P();i(0,"div",9)(1,"div",15)(2,"div",16)(3,"div",17),s(4),r(),i(5,"div",18),s(6),r()(),i(7,"div",19)(8,"select",20),_("change",function(n){let l=m(e).$implicit,f=c(3);return p(f.onStatusChange(l.key,n))}),i(9,"option",21),s(10,"Locked"),r(),i(11,"option",22),s(12,"Submitted"),r(),i(13,"option",23),s(14,"Secured"),r(),i(15,"option",24),s(16,"Paid"),r()()(),i(17,"div",25)(18,"span",26),s(19,"Item Total"),r(),i(20,"span",27),s(21),r()()(),i(22,"div",28)(23,"div",29)(24,"div",30),s(25,"Add-ons"),r(),i(26,"div",31)(27,"label",32)(28,"input",33),_("change",function(n){let l=m(e).$implicit,f=c(3);return p(f.onOptionChange(l.key,"lunch",n))}),r(),i(29,"span"),s(30,"Lunch"),r(),i(31,"span",34),s(32),r()(),i(33,"label",32)(34,"input",33),_("change",function(n){let l=m(e).$implicit,f=c(3);return p(f.onOptionChange(l.key,"extendedCare",n))}),r(),i(35,"span"),s(36,"Ext. Care"),r(),i(37,"span",34),s(38),r()()()(),i(39,"div",29)(40,"div",30),s(41,"Base Override"),r(),i(42,"div",35)(43,"input",36),_("input",function(n){let l=m(e).$implicit,f=c(3);return p(f.onSnapshotInputChange(l.key,"basePriceInput",n))}),r()()()()()}if(a&2){let e=t.$implicit,o=c(3);d(4),x(o.getClassName(e.sessionId)),d(2),x(o.getStudentName(e.studentId)),d(2),b("ngClass",o.statusSelectClass(e.status))("value",e.status),d(13),x(o.formatCurrency(o.getDraftItemTotalCents(e))),d(7),b("checked",e.options.lunch),d(4),x(o.formatCurrency(o.getSessionLunchPriceCents(e.sessionId))),d(2),b("checked",e.options.extendedCare),d(4),x(o.formatCurrency(o.getSessionExtendedCarePriceCents(e.sessionId))),d(5),b("value",e.snapshot.basePriceInput)}}function dt(a,t){a&1&&(i(0,"span",12),s(1,"Saving..."),r())}function lt(a,t){if(a&1&&(i(0,"span",13),s(1),r()),a&2){let e=c(3);d(),x(e.success())}}function ct(a,t){if(a&1&&(i(0,"span",14),s(1),r()),a&2){let e=c(3);d(),x(e.breakglassError())}}function mt(a,t){if(a&1){let e=P();i(0,"div",7)(1,"div",8),F(2,st,44,10,"div",9,rt),r(),i(4,"div",10)(5,"button",11),_("click",function(){m(e);let n=c(2);return p(n.applyUpdate())}),s(6," Apply Changes + Recalculate "),r(),u(7,dt,2,0,"span",12),u(8,lt,2,1,"span",13),u(9,ct,2,1,"span",14),r()()}if(a&2){let e=c(2);d(2),z(e.draft()),d(3),b("disabled",e.saving()),d(2),g(e.saving()?7:-1),d(),g(e.success()?8:-1),d(),g(e.breakglassError()?9:-1)}}function pt(a,t){if(a&1){let e=P();i(0,"div",0)(1,"strong"),s(2,"BREAKGLASS MODE ENABLED"),r(),i(3,"span"),s(4,"Direct Firestore writes. No backend validation."),r()(),i(5,"div",1)(6,"div",2)(7,"h2"),s(8,"Breakglass"),r(),i(9,"div",3)(10,"button",4),_("click",function(){m(e);let n=c();return p(n.resetDraftFromOrder())}),s(11," Reload Draft "),r(),i(12,"button",5),_("click",function(){m(e);let n=c();return p(n.disableBreakglass())}),s(13," Disable "),r()()(),u(14,at,2,0,"div",6)(15,mt,10,4,"div",7),r()}if(a&2){let e=c();d(14),g(e.draft().length===0?14:15)}}var ie=class a{order=U.required();seasonId=U.required();studentMap=U(new Map);orderUser=U(null);userService=T(te);breakglassService=T(He);seasonService=T(ee);configService=T(X);breakglassEnabled=y(()=>this.breakglassService.enabled());draft=E([]);saving=E(!1);breakglassError=E(null);success=E(null);ACTIVE_YEAR=2026;formatCurrency=ne;constructor(){ue(()=>{if(!this.breakglassEnabled())return;let t=this.order();this.draft().length===0&&t.items.length>0&&this.resetDraftFromOrder()})}disableBreakglass(){this.breakglassService.disable(),this.draft.set([]),this.saving.set(!1),this.breakglassError.set(null),this.success.set(null)}getClassName(t,e=null){return this.seasonService.classes().find(n=>n.id===t)?.name??e??t}getStudentName(t){return this.studentMap().get(t)??t}resetDraftFromOrder(){let e=this.order().items.map(o=>({key:`${o.sessionId}:${o.studentId}`,sessionId:o.sessionId,studentId:o.studentId,status:o.status,options:S({},o.options),snapshot:{basePriceInput:$(o.snapshot.priceSnapshot.basePrice)}}));this.draft.set(e),this.success.set(null),this.breakglassError.set(null)}onOptionChange(t,e,o){let n=o.target.checked;this.draft.update(l=>l.map(f=>f.key===t?O(S({},f),{options:O(S({},f.options),{[e]:n})}):f)),this.success.set(null)}onStatusChange(t,e){let o=e.target.value;o!=="locked"&&o!=="submitted"&&o!=="secured"&&o!=="paid"||(this.draft.update(n=>n.map(l=>l.key===t?O(S({},l),{status:o}):l)),this.success.set(null))}onSnapshotInputChange(t,e,o){let n=o.target.value;this.draft.update(l=>l.map(f=>f.key===t?O(S({},f),{snapshot:O(S({},f.snapshot),{[e]:n})}):f)),this.success.set(null)}getSessionLunchPriceCents(t){let e=this.seasonService.getClass(t);return e?e.lunchPrice:this.order().items.find(n=>n.sessionId===t)?.snapshot.priceSnapshot.lunchPrice??0}getSessionExtendedCarePriceCents(t){let e=this.seasonService.getClass(t);return e?e.extendedCarePrice:this.order().items.find(n=>n.sessionId===t)?.snapshot.priceSnapshot.extendedCarePrice??0}getDraftItemTotalCents(t){let e=K(t.snapshot.basePriceInput),o=t.options.lunch?this.getSessionLunchPriceCents(t.sessionId):0,n=t.options.extendedCare?this.getSessionExtendedCarePriceCents(t.sessionId):0;return e+o+n}statusLabel(t){return t==="locked"?"Locked":t==="submitted"?"Submitted":t==="secured"?"Secured":"Paid"}statusBadgeClass(t){return`status-badge-${t}`}statusSelectClass(t){return`status-select-${t}`}getDiscountConfig(){let t=this.seasonService.getSeason(this.seasonId());if(!t)throw new Error(`Season not loaded: ${this.seasonId()}`);let e=this.orderUser();if(!e)throw new Error("User profile not loaded (cannot determine returning/referral discounts).");let o=e.students?.[0]?.id??void 0,n=new Set((e.students??[]).filter(f=>!!f.lastCampYear).map(f=>f.id)),l=(e.students??[]).filter(f=>!f.lastCampYear&&!!f.referCode).length;return{siblingDiscountPerWeek:t.siblingDiscountPerWeek,multiSessionDiscountTiers:t.multiSessionDiscounts,firstStudentId:o,returningStudentIds:n,referredStudentCount:l}}mergePreservedDiscounts(t,e){let o=t;if(!o)throw new Error("Missing recalculated pricing");let l=(e?.discounts??[]).filter(D=>D.type==="coupon"||D.type==="manual"),f=[...o.discounts.filter(D=>D.type!=="coupon"&&D.type!=="manual"),...l],A=new Set,V=f.filter(D=>{let L=`${D.type}:${D.amount}:${D.description??""}`;return A.has(L)?!1:(A.add(L),!0)});if(o.sessionBreakdowns&&o.sessionBreakdowns.length>0){let D=[...o.globalDiscounts??[],...l].filter(L=>{let B=`${L.type}:${L.amount}:${L.description??""}`;return A.has(`g:${B}`)?!1:(A.add(`g:${B}`),!0)});return O(S({},o),{discounts:V,globalDiscounts:D})}return O(S({},o),{discounts:V,globalDiscounts:o.globalDiscounts??null})}applyStatusUpdate(t,e,o){if(t.status===e)return t;let n=O(S({},t),{status:e});if(e==="locked")return O(S({},n),{lockedAt:n.lockedAt??o,submittedAt:null,securedAt:null,paidAt:null});if(e==="submitted")return O(S({},n),{lockedAt:n.lockedAt??o,submittedAt:n.submittedAt??o,securedAt:null,paidAt:null});if(e==="secured")return O(S({},n),{lockedAt:n.lockedAt??o,submittedAt:n.submittedAt??o,securedAt:n.securedAt??o,paidAt:null});let l=t.status==="secured"?n.securedAt??o:n.securedAt??null;return O(S({},n),{lockedAt:n.lockedAt??o,submittedAt:n.submittedAt??o,securedAt:l,paidAt:n.paidAt??o})}async applyUpdate(){if(this.success.set(null),this.breakglassError.set(null),!this.breakglassEnabled()){this.breakglassError.set("Breakglass mode is not enabled.");return}this.seasonService.getSeason(this.seasonId())||await this.seasonService.loadSeasons(),this.seasonService.hasClasses()||await this.seasonService.loadAllClasses(),this.saving.set(!0);try{let t=this.order(),e=this.configService.currentTime()||new Date().toISOString(),o=new Map;for(let C of this.draft())o.set(C.key,C);let n=[],l=t.items.map(C=>{let h=`${C.sessionId}:${C.studentId}`,v=o.get(h);if(!v)return C;let se=S({},v.options),et=v.status,ce=K(v.snapshot.basePriceInput),de=this.seasonService.getClass(C.sessionId);if(!de)throw new Error(`Session not loaded: ${C.sessionId}`);let me=se.lunch?de.lunchPrice:0,pe=se.extendedCare?de.extendedCarePrice:0,tt={basePrice:ce,lunchPrice:me,extendedCarePrice:pe,itemTotal:ce+me+pe},N=O(S({},C),{options:se,snapshot:O(S({},C.snapshot),{priceSnapshot:tt})});return N=this.applyStatusUpdate(N,et,e),(C.status!==N.status||C.options.lunch!==N.options.lunch||C.options.extendedCare!==N.options.extendedCare||C.snapshot.priceSnapshot.basePrice!==N.snapshot.priceSnapshot.basePrice||C.snapshot.priceSnapshot.lunchPrice!==N.snapshot.priceSnapshot.lunchPrice||C.snapshot.priceSnapshot.extendedCarePrice!==N.snapshot.priceSnapshot.extendedCarePrice||C.snapshot.priceSnapshot.itemTotal!==N.snapshot.priceSnapshot.itemTotal)&&n.push(N),N});if(n.length===0){this.success.set("No changes detected.");return}let f=this.getDiscountConfig(),A=l.map(C=>({sessionId:C.sessionId,studentId:C.studentId,sessionName:C.snapshot.className,priceSnapshot:{itemTotal:C.snapshot.priceSnapshot.itemTotal,basePrice:C.snapshot.priceSnapshot.basePrice,lunchPrice:C.snapshot.priceSnapshot.lunchPrice,extendedCarePrice:C.snapshot.priceSnapshot.extendedCarePrice}})),V=Se({existingItems:A,discountConfig:f}),D=this.mergePreservedDiscounts(V,t.pricing),L=this.userService.actualUser()?.displayId??this.userService.actualUser()?.email??"admin",B={action:"change_updated",timestamp:e,actor:L,details:"BREAKGLASS: Updated item status/snapshot/options and recalculated pricing.",affectedItems:n.map(C=>({sessionId:C.sessionId,studentId:C.studentId,studentName:this.getStudentName(C.studentId),className:this.getClassName(C.sessionId,C.snapshot.className),options:S({},C.options),status:C.status})),className:null,amount:null,paymentMethod:null,paymentReference:null},W=[...t.history??[],B],G=O(S({},t),{items:l,pricing:D,updatedAt:e,history:W});Ce.parse(G);let[{getApp:oe},{getFirestore:H,doc:q,updateDoc:re}]=await Promise.all([import("./chunk-VUV5TJUV.js"),import("./chunk-OC4FARK5.js")]),ae=H(oe()),Y=q(ae,`years/${2026}/seasons/${this.seasonId()}/orders`,t.userAuthId);await re(Y,{items:l,pricing:D,updatedAt:e,history:W}),this.success.set("Saved. Pricing recalculated."),this.breakglassError.set(null)}catch(t){let e=t instanceof Error?t.message:String(t);this.breakglassError.set(e)}finally{this.saving.set(!1)}}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=Z({type:a,selectors:[["app-admin-order-breakglass"]],inputs:{order:[1,"order"],seasonId:[1,"seasonId"],studentMap:[1,"studentMap"],orderUser:[1,"orderUser"]},decls:1,vars:1,consts:[["role","alert",1,"breakglass-banner"],[1,"info-card","breakglass-card","enabled"],[1,"breakglass-header"],[1,"breakglass-header-actions"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["type","button",1,"btn","btn-danger-outline","btn-sm",3,"click"],[1,"breakglass-empty"],[1,"breakglass-editor"],[1,"breakglass-items"],[1,"breakglass-item-card"],[1,"breakglass-cta-row"],["type","button",1,"btn","btn-danger",3,"click","disabled"],[1,"breakglass-saving"],[1,"breakglass-success"],[1,"breakglass-error-inline"],[1,"breakglass-item-header"],[1,"breakglass-item-title"],[1,"breakglass-item-session"],[1,"breakglass-item-student"],[1,"breakglass-item-status"],[1,"form-control","form-control-sm","status-select",3,"change","ngClass","value"],["value","locked"],["value","submitted"],["value","secured"],["value","paid"],[1,"breakglass-item-total"],[1,"muted"],[1,"breakglass-total"],[1,"breakglass-content"],[1,"breakglass-field"],[1,"breakglass-field-label"],[1,"breakglass-field-value"],[1,"addon-toggle"],["type","checkbox",3,"change","checked"],[1,"addon-price"],[1,"breakglass-field-value","breakglass-field-value-right"],["type","text",1,"form-control","form-control-sm","money-input",3,"input","value"]],template:function(e,o){e&1&&u(0,pt,16,1),e&2&&g(o.userService.isAdmin()&&o.breakglassEnabled()?0:-1)},dependencies:[Q,J],styles:[`.info-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:20px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;color:#333}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-danger-outline[_ngcontent-%COMP%]{background:#fff;color:#dc3545;border:1px solid #dc3545}.btn-danger-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc3545;color:#fff}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:14px}.breakglass-banner[_ngcontent-%COMP%]{background:#b71c1c;color:#fff;border-radius:10px;padding:12px 14px;margin-bottom:14px;display:flex;gap:10px;align-items:baseline;justify-content:space-between}.breakglass-card.enabled[_ngcontent-%COMP%]{border:2px solid #b71c1c}.breakglass-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px}.breakglass-header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.breakglass-help[_ngcontent-%COMP%]{margin:10px 0 0;color:#444;font-size:.95rem;line-height:1.35}.breakglass-editor[_ngcontent-%COMP%]{margin-top:12px;border-top:1px solid #eee;padding-top:12px}.breakglass-items[_ngcontent-%COMP%]{display:grid;gap:12px}.breakglass-item-card[_ngcontent-%COMP%]{border:1px solid #eee;border-radius:12px;padding:10px;background:#fff}.breakglass-item-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;padding-bottom:8px;border-bottom:1px solid #f0f0f0;margin-bottom:8px;flex-wrap:wrap}.breakglass-item-session[_ngcontent-%COMP%]{font-weight:800;color:#111;font-size:.95rem}.breakglass-item-student[_ngcontent-%COMP%]{margin-top:2px;font-weight:600;color:#444;font-size:.85rem}.breakglass-item-total[_ngcontent-%COMP%]{text-align:right;display:flex;flex-direction:column;gap:2px}.breakglass-item-status[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.muted[_ngcontent-%COMP%]{color:#666;font-size:.75rem;font-weight:600}.breakglass-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 260px;gap:10px}.breakglass-field[_ngcontent-%COMP%]{border:1px solid #f2f2f2;background:#fafafa;border-radius:10px;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}.breakglass-field-label[_ngcontent-%COMP%]{font-weight:800;color:#333;font-size:.85rem;white-space:nowrap}.breakglass-field-value[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}.breakglass-field-value-right[_ngcontent-%COMP%]{justify-content:flex-end}.status-select[_ngcontent-%COMP%]{min-width:170px;appearance:none;-webkit-appearance:none;-moz-appearance:none;border-radius:12px;padding:8px 40px 8px 12px;font-weight:800;letter-spacing:.01em;background-color:#fff;background-repeat:no-repeat;background-position:right 12px center;background-size:14px 14px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");box-shadow:0 1px #00000008,0 6px 18px #0000000f}.status-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 0 3px #b71c1c29,0 1px #00000008,0 6px 18px #0000000f}.status-select-locked[_ngcontent-%COMP%]{border:1.5px solid #ce93d8}.status-select-submitted[_ngcontent-%COMP%]{border:1.5px solid #ffeaa7}.status-select-secured[_ngcontent-%COMP%]{border:1.5px solid #90caf9}.status-select-paid[_ngcontent-%COMP%]{border:1.5px solid #c3e6cb}.addon-toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-weight:800;color:#333}.addon-price[_ngcontent-%COMP%]{color:#666;font-weight:800;font-size:.8rem;margin-left:2px}.money-input[_ngcontent-%COMP%]{width:120px}.form-control-sm[_ngcontent-%COMP%]{padding:6px 8px;font-size:.9rem}.breakglass-total[_ngcontent-%COMP%]{font-weight:700;color:#b71c1c;white-space:nowrap}.breakglass-cta-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap}.breakglass-saving[_ngcontent-%COMP%]{color:#555;font-weight:600}.breakglass-success[_ngcontent-%COMP%]{color:#1b5e20;font-weight:700}.breakglass-error[_ngcontent-%COMP%]{margin-top:10px;color:#b71c1c;font-weight:700}.breakglass-error-inline[_ngcontent-%COMP%]{color:#b71c1c;font-weight:700}@media(max-width:820px){.breakglass-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.status-select[_ngcontent-%COMP%]{min-width:130px}}`]})};var ut=a=>({"text-warning":a}),gt=(a,t)=>t.id,_t=(a,t)=>t.sessionId,ft=(a,t)=>t.sessionId+"-"+t.studentId;function xt(a,t){a&1&&(i(0,"div",2),j(1,"div",6),i(2,"p"),s(3,"Loading order details..."),r()())}function Ct(a,t){if(a&1){let e=P();i(0,"div",3)(1,"strong"),s(2,"Error:"),r(),s(3),i(4,"button",7),_("click",function(){m(e);let n=c();return p(n.clearError())}),s(5,"\xD7"),r()()}if(a&2){let e=c();d(3),w(" ",e.error()," ")}}function ht(a,t){if(a&1&&(i(0,"div",18)(1,"span",10),s(2,"Phone:"),r(),i(3,"span",11),s(4),r()()),a&2){let e=c(3);d(4),x(e.userData().phone)}}function bt(a,t){if(a&1&&s(0),a&2){let e=c(4);w(" ",e.userData().wechatName," ")}}function yt(a,t){if(a&1&&s(0),a&2){let e=c(5);w(" (",e.userData().wechatId,") ")}}function vt(a,t){if(a&1&&s(0),a&2){let e=c(5);w(" ",e.userData().wechatId," ")}}function St(a,t){if(a&1&&u(0,yt,1,1)(1,vt,1,1),a&2){let e=c(4);g(e.userData().wechatName?0:1)}}function Pt(a,t){if(a&1&&(i(0,"div",18)(1,"span",10),s(2,"WeChat:"),r(),i(3,"span",11),u(4,bt,1,1),u(5,St,2,1),r()()),a&2){let e=c(3);d(4),g(e.userData().wechatName?4:-1),d(),g(e.userData().wechatId?5:-1)}}function Ot(a,t){if(a&1&&(i(0,"div",18)(1,"span",10),s(2,"Address:"),r(),i(3,"span",11),s(4),r()()),a&2){let e=c(3);d(4),x(e.userData().address)}}function wt(a,t){if(a&1&&(i(0,"div",15)(1,"h2"),s(2,"User Information"),r(),i(3,"div",28)(4,"div",18)(5,"span",10),s(6,"Name:"),r(),i(7,"span",11),s(8),r()(),i(9,"div",18)(10,"span",10),s(11,"Email:"),r(),i(12,"span",11),s(13),r()(),u(14,ht,5,1,"div",18),u(15,Pt,6,2,"div",18),u(16,Ot,5,1,"div",18),r()()),a&2){let e=c(2);d(8),x(e.userData().displayName),d(5),x(e.userData().email),d(),g(e.userData().phone?14:-1),d(),g(e.userData().wechatId||e.userData().wechatName?15:-1),d(),g(e.userData().address?16:-1)}}function Mt(a,t){if(a&1&&(i(0,"span",30),s(1),r()),a&2){let e=c(3);d(),_e(" (",e.remainingLockTime().hours,"h ",e.remainingLockTime().minutes,"m remaining) ")}}function kt(a,t){if(a&1&&(i(0,"div",18)(1,"span",10),s(2,"Lock Expires:"),r(),i(3,"span",29),s(4),u(5,Mt,2,2,"span",30),r()()),a&2){let e=c(2);d(3),b("ngClass",fe(3,ut,e.isExpiringSoon())),d(),w(" ",e.formatDateTime(e.order().lockExpiresAt)," "),d(),g(e.remainingLockTime()?5:-1)}}function It(a,t){a&1&&(i(0,"div",20)(1,"p"),s(2,"No items in this order."),r()())}function Dt(a,t){if(a&1){let e=P();i(0,"app-ledger-order-items",31),_("cancelItemsClick",function(){m(e);let n=c(2);return p(n.openCancelItemsDialog())})("confirmScreenshot",function(n){m(e);let l=c(2);return p(l.confirmScreenshotPayment(n))})("rejectScreenshot",function(n){m(e);let l=c(2);return p(l.rejectScreenshotPayment(n))}),r()}if(a&2){let e=c(2);b("lockedItems",e.lockedItemsTransformed())("submittedItems",e.submittedItemsTransformed())("securedItems",e.securedItemsTransformed())("paidItems",e.paidItemsTransformed())("editable",!1)("isAdmin",!0)("screenshotGroups",e.screenshotGroups())}}function Et(a,t){if(a&1&&j(0,"app-admin-order-breakglass",22),a&2){let e=c(2);b("order",e.order())("seasonId",e.seasonId())("studentMap",e.studentMap())("orderUser",e.orderUser())}}function At(a,t){if(a&1){let e=P();i(0,"div",39)(1,"button",40),_("click",function(){m(e);let n=c().$implicit,l=c(3);return p(l.openEditPaymentDialog(n))}),s(2," Edit payment "),r()()}}function Tt(a,t){if(a&1){let e=P();i(0,"tr")(1,"td"),s(2),r(),i(3,"td",34),s(4),r(),i(5,"td")(6,"span",35),s(7),r()(),i(8,"td"),s(9),r(),i(10,"td"),s(11),r(),i(12,"td",36)(13,"div",37),_("click",function(n){return m(e),p(n.stopPropagation())}),i(14,"button",38),_("click",function(n){let l=m(e).$implicit,f=c(3);return p(f.togglePaymentMenu(l.id,n))}),s(15," \u22EF "),r(),u(16,At,3,0,"div",39),r()()()}if(a&2){let e=t.$implicit,o=c(3);d(2),x(o.formatDateTime(e.recordedAt)),d(2),x(o.formatCurrency(e.amount)),d(3),x(e.method),d(2),x(e.reference||"-"),d(2),x(e.notes||"-"),d(5),g(o.activePaymentMenuId()===e.id?16:-1)}}function Vt(a,t){if(a&1&&(i(0,"div",23)(1,"h2"),s(2,"Payment History"),r(),i(3,"table",32)(4,"thead")(5,"tr")(6,"th"),s(7,"Date"),r(),i(8,"th"),s(9,"Amount"),r(),i(10,"th"),s(11,"Method"),r(),i(12,"th"),s(13,"Reference"),r(),i(14,"th"),s(15,"Notes"),r(),j(16,"th",33),r()(),i(17,"tbody"),F(18,Tt,17,6,"tr",null,gt),r()()()),a&2){let e=c(2);d(18),z(e.payments())}}function Nt(a,t){if(a&1){let e=P();i(0,"div",42)(1,"div",43)(2,"span",44),s(3),r()(),i(4,"div",45)(5,"div",46)(6,"span",10),s(7,"Joined:"),r(),i(8,"span",11),s(9),r()()(),i(10,"button",47),_("click",function(){let n=m(e).$implicit,l=c(3);return p(l.openRemoveWaitlistDialog(n.sessionId))}),s(11," Remove Entry "),r()()}if(a&2){let e=t.$implicit,o=c(3);d(3),x(o.getClassName(e.sessionId)),d(6),x(o.formatDateTime(e.joinedAt))}}function jt(a,t){if(a&1&&(i(0,"div",24)(1,"h2"),s(2,"Waitlist Entries"),r(),i(3,"div",41),F(4,Nt,12,2,"div",42,_t),r()()),a&2){let e=c(2);d(4),z(e.waitlistEntries())}}function Lt(a,t){if(a&1&&(i(0,"div",55),s(1),r()),a&2){let e=c().$implicit;d(),x(e.details)}}function Bt(a,t){a&1&&(i(0,"span",61),s(1,"Lunch"),r())}function Rt(a,t){a&1&&(i(0,"span",61),s(1,"Extended Care"),r())}function Wt(a,t){if(a&1&&(i(0,"span",60),u(1,Bt,2,0,"span",61),u(2,Rt,2,0,"span",61),r()),a&2){let e=c().$implicit;d(),g(e.options.lunch?1:-1),d(),g(e.options.extendedCare?2:-1)}}function Ft(a,t){if(a&1&&(i(0,"div",57)(1,"span",58),s(2),r(),i(3,"span",59),s(4),r(),u(5,Wt,3,2,"span",60),r()),a&2){let e=t.$implicit,o=c(6);d(2),x(e.className),d(2),x(o.getStudentName(e.studentId)),d(),g(e.options?5:-1)}}function zt(a,t){if(a&1&&(i(0,"div",56),F(1,Ft,6,3,"div",57,le),r()),a&2){let e=c().$implicit;d(),z(e.affectedItems)}}function Ut(a,t){if(a&1&&(i(0,"div",51)(1,"div",52),s(2),r(),i(3,"div",53)(4,"div",54),s(5),r(),u(6,Lt,2,1,"div",55),u(7,zt,3,0,"div",56),r()()),a&2){let e=t.$implicit,o=c(4);d(2),x(o.formatDateTime(e.timestamp)),d(3),x(e.action),d(),g(e.details?6:-1),d(),g(e.affectedItems&&e.affectedItems.length>0?7:-1)}}function $t(a,t){if(a&1&&(i(0,"div",50),F(1,Ut,8,4,"div",51,le),r()),a&2){let e=c(3);d(),z(e.reversedHistory())}}function Gt(a,t){if(a&1){let e=P();i(0,"div",25)(1,"div",48),_("click",function(){m(e);let n=c(2);return p(n.historyExpanded.set(!n.historyExpanded()))}),i(2,"h2"),s(3),r(),i(4,"button",49),s(5),r()(),u(6,$t,3,0,"div",50),r()}if(a&2){let e=c(2);d(3),w("Order History (",e.reversedHistory().length,")"),d(2),w(" ",e.historyExpanded()?"\u25BC":"\u25B6"," "),d(),g(e.historyExpanded()?6:-1)}}function Ht(a,t){if(a&1){let e=P();i(0,"div",4)(1,"div",8)(2,"div",9)(3,"span",10),s(4,"User ID:"),r(),i(5,"span",11),s(6),r()(),i(7,"span",12),s(8),r()(),i(9,"div",13)(10,"div",14),u(11,wt,17,5,"div",15),i(12,"div",16)(13,"h2"),s(14,"Order Status"),r(),i(15,"div",17)(16,"div",18)(17,"span",10),s(18,"Status:"),r(),i(19,"span",19),s(20),r()(),u(21,kt,6,5,"div",18),i(22,"div",18)(23,"span",10),s(24,"Created:"),r(),i(25,"span",11),s(26),r()(),i(27,"div",18)(28,"span",10),s(29,"Last Updated:"),r(),i(30,"span",11),s(31),r()()()(),u(32,It,3,0,"div",20)(33,Dt,1,7,"app-ledger-order-items",21),u(34,Et,1,4,"app-admin-order-breakglass",22),u(35,Vt,20,0,"div",23),u(36,jt,6,0,"div",24),u(37,Gt,7,3,"div",25),r(),i(38,"div",26)(39,"app-ledger-settlement-sidebar",27),_("recordPaymentClick",function(){m(e);let n=c();return p(n.openRecordPaymentDialog())})("addAdjustmentClick",function(){m(e);let n=c();return p(n.openAddAdjustmentDialog())}),r()()()()}if(a&2){let e=c();d(6),x(e.order().userDisplayId),d(),b("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),d(),w(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),d(3),g(e.userData()?11:-1),d(8),b("ngClass",e.getStatusBadgeClass(e.getOrderStatus(e.order()))),d(),w(" ",e.getStatusLabel(e.getOrderStatus(e.order()))," "),d(),g(e.order().lockExpiresAt?21:-1),d(5),x(e.formatDateTime(e.order().createdAt)),d(5),x(e.formatDateTime(e.order().updatedAt)),d(),g(e.allItems().length===0?32:33),d(2),g(e.order()&&e.seasonId()?34:-1),d(),g(e.payments().length>0?35:-1),d(),g(e.waitlistEntries().length>0?36:-1),d(),g(e.reversedHistory().length>0?37:-1),d(2),b("isAdmin",!0)("orderSummary",e.orderSummaryData())}}function Kt(a,t){if(a&1&&(i(0,"div",77)(1,"div",87)(2,"span"),s(3,"Original Amount Due:"),r(),i(4,"span"),s(5),r()(),i(6,"div",88)(7,"span"),s(8,"Cash Discount (3%):"),r(),i(9,"span"),s(10),r()(),i(11,"div",89)(12,"span"),s(13,"Cash Amount Due:"),r(),i(14,"span"),s(15),r()(),i(16,"small",70),s(17),r()()),a&2){let e=c(2);d(5),x(e.formatCurrency(e.amountDue())),d(5),w("-",e.formatCurrency(e.cashDiscount())),d(5),x(e.formatCurrency(e.cashAmountDue())),d(2),w(" A credit of ",e.formatCurrency(e.cashDiscount())," will be automatically applied. ")}}function qt(a,t){if(a&1){let e=P();i(0,"div",82)(1,"label",90)(2,"input",91),I("ngModelChange",function(n){m(e);let l=c(2);return k(l.formPayment.isDepositConfirmation,n)||(l.formPayment.isDepositConfirmation=n),p(n)}),r(),i(3,"span"),s(4,"Deposit Only (mark as secured, not fully paid)"),r()(),i(5,"small",70),s(6,' Check this for cash deposit confirmations. Items will be marked as "secured" instead of "paid", and user keeps their spot until full payment. '),r()()}if(a&2){let e=c(2);d(2),M("ngModel",e.formPayment.isDepositConfirmation)}}function Yt(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function Zt(a,t){a&1&&(j(0,"span",92),s(1," Recording... "))}function Jt(a,t){a&1&&s(0," Record Payment ")}function Qt(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Record Payment"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.recordPayment())}),i(9,"div",67)(10,"label",68),s(11,"Amount *"),r(),i(12,"input",69),I("ngModelChange",function(n){m(e);let l=c();return k(l.formPayment.amountInput,n)||(l.formPayment.amountInput=n),p(n)}),r(),i(13,"small",70),s(14),r()(),i(15,"div",67)(16,"label",71),s(17,"Payment Method *"),r(),i(18,"select",72),I("ngModelChange",function(n){m(e);let l=c();return k(l.formPayment.method,n)||(l.formPayment.method=n),p(n)}),_("ngModelChange",function(n){m(e);let l=c();return p(l.onPaymentMethodChange(n))}),i(19,"option",73),s(20,"Zelle"),r(),i(21,"option",74),s(22,"Check"),r(),i(23,"option",75),s(24,"Cash (3% off)"),r(),i(25,"option",76),s(26,"Other"),r()()(),u(27,Kt,18,4,"div",77),i(28,"div",67)(29,"label",78),s(30," Reference (optional) "),r(),i(31,"input",79),I("ngModelChange",function(n){m(e);let l=c();return k(l.formPayment.reference,n)||(l.formPayment.reference=n),p(n)}),r()(),i(32,"div",67)(33,"label",80),s(34,"Notes"),r(),i(35,"textarea",81),I("ngModelChange",function(n){m(e);let l=c();return k(l.formPayment.notes,n)||(l.formPayment.notes=n),p(n)}),r()(),u(36,qt,7,1,"div",82),u(37,Yt,2,1,"div",83),i(38,"div",84)(39,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(40," Cancel "),r(),i(41,"button",86),u(42,Zt,2,0)(43,Jt,1,0),r()()()()()()}if(a&2){let e=c();d(12),M("ngModel",e.formPayment.amountInput),d(2),w(" Amount due: ",e.formatCurrency(e.amountDue())," "),d(4),M("ngModel",e.formPayment.method),d(9),g(e.formPayment.method==="cash"&&e.cashDiscount()>0?27:-1),d(4),M("ngModel",e.formPayment.reference),d(4),M("ngModel",e.formPayment.notes),d(),g(e.submittedItems().length>0?36:-1),d(),g(e.actionError()?37:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()),d(),g(e.actionLoading()?42:43)}}function Xt(a,t){if(a&1){let e=P();i(0,"label",94)(1,"input",98),_("change",function(){let n=m(e).$implicit,l=c(2);return p(l.toggleItemSelection(n))}),r(),i(2,"span",99)(3,"span",44),s(4),r(),s(5," - "),i(6,"span",100),s(7),r(),i(8,"span",101),s(9),r()()()}if(a&2){let e=t.$implicit,o=c(2);d(),b("checked",o.isItemSelected(e)),d(3),x(o.getClassName(e.sessionId,e.snapshot.className)),d(3),x(o.getStudentName(e.studentId)),d(),b("ngClass",o.getItemStatusBadgeClass(e.status)),d(),w(" ",o.getItemStatusLabel(e.status)," ")}}function en(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function tn(a,t){a&1&&(j(0,"span",92),s(1," Cancelling... "))}function nn(a,t){if(a&1&&s(0),a&2){let e=c(2);w(" Cancel ",e.selectedItems().size," Item(s) ")}}function on(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Cancel Order Items"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.cancelItems())}),i(9,"div",67)(10,"label"),s(11,"Select items to cancel:"),r(),i(12,"div",93),F(13,Xt,10,5,"label",94,ft),r()(),i(15,"div",67)(16,"label",95),s(17,"Cancellation Reason *"),r(),i(18,"textarea",96),I("ngModelChange",function(n){m(e);let l=c();return k(l.formCancel.reason,n)||(l.formCancel.reason=n),p(n)}),r()(),u(19,en,2,1,"div",83),i(20,"div",84)(21,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(22," Cancel "),r(),i(23,"button",97),u(24,tn,2,0)(25,nn,1,1),r()()()()()()}if(a&2){let e=c();d(13),z(e.cancellableItems()),d(5),M("ngModel",e.formCancel.reason),d(),g(e.actionError()?19:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()||e.selectedItems().size===0),d(),g(e.actionLoading()?24:25)}}function rn(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function an(a,t){a&1&&(j(0,"span",92),s(1," Removing... "))}function sn(a,t){a&1&&s(0," Remove Entry ")}function dn(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Remove Waitlist Entry"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.removeWaitlist())}),i(9,"div",67)(10,"label"),s(11,"Class:"),r(),i(12,"div",102),s(13),r()(),i(14,"div",103),s(15," This will remove the user from the waitlist for this class. "),r(),u(16,rn,2,1,"div",83),i(17,"div",84)(18,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(19," Cancel "),r(),i(20,"button",97),u(21,an,2,0)(22,sn,1,0),r()()()()()()}if(a&2){let e=c();d(13),w(" ",e.getClassName(e.formRemoveWaitlist.sessionId)," "),d(3),g(e.actionError()?16:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()),d(),g(e.actionLoading()?21:22)}}function ln(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function cn(a,t){a&1&&(j(0,"span",92),s(1," Adding... "))}function mn(a,t){if(a&1&&s(0),a&2){let e=c(2);w(" Add ",e.formAdjustment.type==="credit"?"Credit":"Fee"," ")}}function pn(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Add Credit or Fee"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.addAdjustment())}),i(9,"div",67)(10,"label",104),s(11,"Type *"),r(),i(12,"select",105),I("ngModelChange",function(n){m(e);let l=c();return k(l.formAdjustment.type,n)||(l.formAdjustment.type=n),p(n)}),i(13,"option",106),s(14,"Credit (reduce amount due)"),r(),i(15,"option",107),s(16,"Fee (increase amount due)"),r()()(),i(17,"div",67)(18,"label",108),s(19,"Amount *"),r(),i(20,"input",109),I("ngModelChange",function(n){m(e);let l=c();return k(l.formAdjustment.amountInput,n)||(l.formAdjustment.amountInput=n),p(n)}),r(),i(21,"small",70),s(22," Enter the amount in dollars (e.g., 25.00) "),r()(),i(23,"div",67)(24,"label",110),s(25,"Reason *"),r(),i(26,"textarea",111),I("ngModelChange",function(n){m(e);let l=c();return k(l.formAdjustment.reason,n)||(l.formAdjustment.reason=n),p(n)}),r()(),i(27,"div",112),s(28),r(),u(29,ln,2,1,"div",83),i(30,"div",84)(31,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(32," Cancel "),r(),i(33,"button",86),u(34,cn,2,0)(35,mn,1,1),r()()()()()()}if(a&2){let e=c();d(12),M("ngModel",e.formAdjustment.type),d(8),M("ngModel",e.formAdjustment.amountInput),d(6),M("ngModel",e.formAdjustment.reason),d(2),w(" ",e.formAdjustment.type==="credit"?"A credit will reduce the amount the user owes.":"A fee will increase the amount the user owes."," "),d(),g(e.actionError()?29:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()||!e.formAdjustment.amountInput||!e.formAdjustment.reason.trim()),d(),g(e.actionLoading()?34:35)}}function un(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function gn(a,t){a&1&&(j(0,"span",92),s(1," Rejecting... "))}function _n(a,t){a&1&&s(0," Reject Screenshot ")}function fn(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Reject Screenshot"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.submitRejectScreenshot())}),i(9,"div",67)(10,"label",113),s(11,"Rejection Reason *"),r(),i(12,"textarea",114),I("ngModelChange",function(n){m(e);let l=c();return k(l.formRejectScreenshot.reason,n)||(l.formRejectScreenshot.reason=n),p(n)}),r(),i(13,"small",70),s(14," This message will be shown to the user explaining why their screenshot was rejected. "),r()(),u(15,un,2,1,"div",83),i(16,"div",84)(17,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(18," Cancel "),r(),i(19,"button",97),u(20,gn,2,0)(21,_n,1,0),r()()()()()()}if(a&2){let e=c();d(12),M("ngModel",e.formRejectScreenshot.reason),d(3),g(e.actionError()?15:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()||!e.formRejectScreenshot.reason.trim()),d(),g(e.actionLoading()?20:21)}}function xn(a,t){if(a&1&&(i(0,"div",83),s(1),r()),a&2){let e=c(2);d(),x(e.actionError())}}function Cn(a,t){a&1&&(j(0,"span",92),s(1," Saving... "))}function hn(a,t){a&1&&s(0," Save Payment Edit ")}function bn(a,t){if(a&1){let e=P();i(0,"div",62),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),i(1,"div",63),_("click",function(n){return m(e),p(n.stopPropagation())}),i(2,"div",64)(3,"h3"),s(4,"Edit Payment Record"),r(),i(5,"button",7),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(6,"\xD7"),r()(),i(7,"div",65)(8,"form",66),_("ngSubmit",function(){m(e);let n=c();return p(n.updatePaymentRecord())}),i(9,"div",83)(10,"strong"),s(11,"Dangerous operation:"),r(),s(12," this replaces payment history data and can change account balance. "),r(),i(13,"div",67)(14,"label",115),s(15,"Amount *"),r(),i(16,"input",116),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.amountInput,n)||(l.formEditPayment.amountInput=n),p(n)}),r()(),i(17,"div",67)(18,"label",117),s(19,"Payment Method *"),r(),i(20,"select",118),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.method,n)||(l.formEditPayment.method=n),p(n)}),i(21,"option",73),s(22,"Zelle"),r(),i(23,"option",74),s(24,"Check"),r(),i(25,"option",75),s(26,"Cash"),r(),i(27,"option",76),s(28,"Other"),r()()(),i(29,"div",67)(30,"label",119),s(31,"Reference"),r(),i(32,"input",120),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.reference,n)||(l.formEditPayment.reference=n),p(n)}),r()(),i(33,"div",67)(34,"label",121),s(35,"Notes"),r(),i(36,"textarea",122),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.notes,n)||(l.formEditPayment.notes=n),p(n)}),r()(),i(37,"div",67)(38,"label",123),s(39,"Change Reason *"),r(),i(40,"textarea",124),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.reason,n)||(l.formEditPayment.reason=n),p(n)}),r(),i(41,"small",70),s(42,"Saved to order history for audit."),r()(),i(43,"div",67)(44,"label",125)(45,"input",126),I("ngModelChange",function(n){m(e);let l=c();return k(l.formEditPayment.confirmDanger,n)||(l.formEditPayment.confirmDanger=n),p(n)}),r(),i(46,"span"),s(47,"I understand this can impact billing records."),r()()(),u(48,xn,2,1,"div",83),i(49,"div",84)(50,"button",85),_("click",function(){m(e);let n=c();return p(n.closeDialog())}),s(51," Cancel "),r(),i(52,"button",97),u(53,Cn,2,0)(54,hn,1,0),r()()()()()()}if(a&2){let e=c();d(16),M("ngModel",e.formEditPayment.amountInput),d(4),M("ngModel",e.formEditPayment.method),d(12),M("ngModel",e.formEditPayment.reference),d(4),M("ngModel",e.formEditPayment.notes),d(4),M("ngModel",e.formEditPayment.reason),d(5),M("ngModel",e.formEditPayment.confirmDanger),d(3),g(e.actionError()?48:-1),d(2),b("disabled",e.actionLoading()),d(2),b("disabled",e.actionLoading()||!e.formEditPayment.reason.trim()||!e.formEditPayment.confirmDanger),d(),g(e.actionLoading()?53:54)}}var Xe=class a{orderId=U.required();seasonId=U(null);adminOrdersStore=T(qe);orderRpc=T(ke);userService=T(te);seasonService=T(ee);configService=T(X);router=T(xe);notificationService=T(Ge);unsubscribeOrder=null;order=E(null);loading=E(!1);error=E(null);userData=E(null);studentMap=E(new Map);orderUser=E(null);actionLoading=this.orderRpc.loading;actionError=this.orderRpc.error;dialogMode=E(null);formPayment={amountInput:"",method:"zelle",reference:"",notes:"",isDepositConfirmation:!1};formCancel={reason:""};selectedItems=E(new Set);historyExpanded=E(!1);reversedHistory=y(()=>{let t=this.order()?.history;return t?[...t].reverse():[]});formRemoveWaitlist={sessionId:""};formAdjustment={type:"credit",amountInput:"",reason:""};formRejectScreenshot={screenshotId:"",reason:"Please re-upload a clearer image of your payment receipt."};formEditPayment={paymentId:"",amountInput:"",method:"zelle",reference:"",notes:"",reason:"",confirmDanger:!1};activePaymentMenuId=E(null);Math=Math;allItems=y(()=>this.order()?.items??[]);paidItems=y(()=>{let t=this.order();return t?be(t):[]});submittedItems=y(()=>{let t=this.order();return t?he(t):[]});securedItems=y(()=>{let t=this.order();return t?ye(t):[]});lockedItems=y(()=>this.allItems().filter(t=>t.status==="locked"));cancellableItems=y(()=>[...this.lockedItems(),...this.paidItems(),...this.submittedItems(),...this.securedItems()]);waitlistEntries=y(()=>this.order()?.waitlist??[]);payments=y(()=>this.order()?.payments??[]);totalDue=y(()=>{let t=this.order();return t?Pe(t):0});amountDue=y(()=>{let t=this.order();return t?ve(t):0});cashDiscount=y(()=>{let t=this.amountDue();return t<=0?0:we(t)});cashAmountDue=y(()=>{let t=this.amountDue();return t<=0?0:Me(t)});isExpiringSoon=y(()=>{let t=this.order();if(!t||!t.lockExpiresAt)return!1;let e=this.configService.currentTime(),o=new Date(t.lockExpiresAt),n=new Date(e),l=(o.getTime()-n.getTime())/(1e3*60*60);return l>0&&l<=12});remainingLockTime=y(()=>{let t=this.order();if(!t||!t.lockExpiresAt)return null;let e=this.configService.currentTime(),o=new Date(t.lockExpiresAt),n=new Date(e),l=o.getTime()-n.getTime();if(l<=0)return null;let f=Math.floor(l/(1e3*60*60)),A=Math.floor(l%(1e3*60*60)/(1e3*60));return{hours:f,minutes:A}});transformToLedgerItem(t){return{sessionId:t.sessionId,studentId:t.studentId,studentName:this.getStudentName(t.studentId),className:this.getClassName(t.sessionId,t.snapshot?.className??null),startDate:t.snapshot?.startDate??"",endDate:t.snapshot?.endDate??"",status:t.status,options:t.options,pricing:{basePrice:t.snapshot?.priceSnapshot?.basePrice??0,lunchPrice:t.snapshot?.priceSnapshot?.lunchPrice??0,extendedCarePrice:t.snapshot?.priceSnapshot?.extendedCarePrice??0,itemTotal:t.snapshot?.priceSnapshot?.itemTotal??0}}}lockedItemsTransformed=y(()=>this.lockedItems().map(t=>this.transformToLedgerItem(t)));submittedItemsTransformed=y(()=>this.submittedItems().map(t=>this.transformToLedgerItem(t)));securedItemsTransformed=y(()=>this.securedItems().map(t=>this.transformToLedgerItem(t)));paidItemsTransformed=y(()=>this.paidItems().map(t=>this.transformToLedgerItem(t)));screenshotGroups=y(()=>{let t=this.order();if(!t)return[];let e=t.paymentScreenshots??[],o=this.submittedItemsTransformed();return e.map(n=>{let l=new Set(n.lockedItemKeys),f=o.filter(A=>{let V=`${A.sessionId}:${A.studentId}`;return l.has(V)});return{screenshot:n,items:f}}).filter(n=>n.items.length>0)});orderSummaryData=y(()=>{let t=this.order(),e=t?.pricing;if(!e)return null;let n=[...this.lockedItemsTransformed(),...this.submittedItemsTransformed(),...this.securedItemsTransformed(),...this.paidItemsTransformed()].reduce((h,v)=>h+v.pricing.itemTotal,0),l=new Map;for(let h of e.discounts){let v=l.get(h.type)??0;l.set(h.type,v+h.amount)}for(let h of t.processingFees??[]){if(h.type==="adjustment")continue;let v=l.get(h.type)??0;l.set(h.type,v+h.amount)}let f=[],A={returning_family:"Returning Family",returning_student:"Returning Student",sibling:"Sibling Discount",multi_session:"Multi-Session",coupon:"Coupon Credit",manual:"Manual Adjustment",referral:"Referral Bonus",cash_discount:"Cash Discount (3%)",adjustment:"Adjustment",forfeited_deposit:"Forfeited Deposit"};for(let[h,v]of l)v!==0&&f.push({key:`type:${h}`,type:h,label:A[h]??h,amount:v});for(let h of t.processingFees??[])h.type!=="adjustment"||h.amount===0||f.push({key:`adjustment:${h.id}`,type:"adjustment",label:h.description?.trim()?`Adjustment: ${h.description.trim()}`:"Adjustment",amount:h.amount});let D=(t.paymentScreenshots??[]).reduce((h,v)=>h+(v.claimedAmountCents??0),0),B=(t.payments??[]).reduce((h,v)=>h+v.amount,0),W=this.securedItems().length,G=this.paidItems().length,oe=5e3,H=0,q=0;W>0&&G===0?H=B:W===0&&G>0?q=B:W>0&&G>0&&(H=Math.min(W*oe,B),q=B-H);let re=[{status:"locked",label:"Awaiting Payment",count:this.lockedItems().length,total:this.lockedItemsTransformed().reduce((h,v)=>h+v.pricing.itemTotal,0)},{status:"submitted",label:"Pending Verification",count:this.submittedItems().length,total:D},{status:"secured",label:"Deposit Confirmed",count:W,total:H},{status:"paid",label:"Payment Confirmed",count:G,total:q}],ae=f.reduce((h,v)=>h+v.amount,0),Y=t.totalPaid??0,C=Math.max(0,n+ae-Y);return{subtotal:n,totalPaid:Y,discounts:f,amountDue:C,statusCounts:re}});formatCurrency=ne;formatDate=Ie;formatDateTime=De;getOrderStatus=Oe;getStatusBadgeClass=Ye;getStatusLabel=Ze;getItemStatusBadgeClass=Je;getItemStatusLabel=Qe;onDocumentClick(){this.activePaymentMenuId.set(null)}async ngOnInit(){if(!this.userService.isAuthenticated()){await this.router.navigate(["/login"]);return}this.seasonService.hasClasses()||this.seasonService.loadAllClasses().catch(t=>{console.warn("[AdminOrderDetail] Failed to load classes for name resolution:",t)}),this.seasonService.loadSeasons().catch(t=>{console.warn("[AdminOrderDetail] Failed to load seasons for breakglass pricing:",t)}),this.subscribeToOrder()}ngOnDestroy(){this.unsubscribeOrder&&(this.unsubscribeOrder(),this.unsubscribeOrder=null)}subscribeToOrder(){this.loading.set(!0),this.error.set(null);let t=this.seasonId();if(!t){this.error.set("Missing seasonId for admin order detail"),this.loading.set(!1);return}this.unsubscribeOrder=this.adminOrdersStore.subscribeToOrder(this.orderId(),async e=>{if(!e){this.order.set(null);let o=this.seasonId()?` (season: ${this.seasonId()})`:"";this.error.set(`Order not found for user: ${this.orderId()}${o}`),this.loading.set(!1);return}this.error.set(null),this.order.set(e),this.loading.set(!1),await this.loadUserData(e.userDisplayId)},e=>{let o=e instanceof Error?e.message:String(e);this.error.set(o),this.loading.set(!1)},t)}async loadUserData(t){try{let e=await this.userService.getUserByDisplayId(t);if(e){this.orderUser.set(e),this.userData.set({displayName:e.displayName,email:e.email,phone:e.primaryGuardian?.phone,wechatId:e.primaryGuardian?.wechatId??void 0,wechatName:e.primaryGuardian?.wechatName??void 0,address:e.primaryGuardian?.address?`${e.primaryGuardian.address.street}, ${e.primaryGuardian.address.city}, ${e.primaryGuardian.address.state} ${e.primaryGuardian.address.zipCode}`:void 0});let o=new Map;for(let n of e.students??[])o.set(n.id,`${n.firstName} ${n.lastName}`);this.studentMap.set(o)}else this.orderUser.set(null)}catch(e){console.error("Failed to load user data:",e)}}getClassName(t,e=null){return this.seasonService.classes().find(n=>n.id===t)?.name??e??t}getStudentName(t){return this.studentMap().get(t)??t}getItemsTotal(t){return t.reduce((e,o)=>e+(o.snapshot?.priceSnapshot?.itemTotal??0),0)}openRecordPaymentDialog(){this.formPayment.amountInput=$(Math.max(0,this.amountDue())),this.formPayment.method="zelle",this.formPayment.reference="",this.formPayment.notes="",this.formPayment.isDepositConfirmation=!1,this.dialogMode.set("record-payment")}openCancelItemsDialog(){this.selectedItems.set(new Set),this.formCancel.reason="",this.dialogMode.set("cancel-items")}openRemoveWaitlistDialog(t){this.formRemoveWaitlist.sessionId=t,this.dialogMode.set("remove-waitlist")}openAddAdjustmentDialog(){this.formAdjustment.type="credit",this.formAdjustment.amountInput="",this.formAdjustment.reason="",this.dialogMode.set("add-adjustment")}closeDialog(){this.dialogMode.set(null),this.orderRpc.clearError(),this.activePaymentMenuId.set(null),this.formEditPayment.paymentId="",this.formEditPayment.amountInput="",this.formEditPayment.method="zelle",this.formEditPayment.reference="",this.formEditPayment.notes="",this.formEditPayment.reason="",this.formEditPayment.confirmDanger=!1}togglePaymentMenu(t,e){e.stopPropagation(),this.activePaymentMenuId.update(o=>o===t?null:t)}openEditPaymentDialog(t){this.formEditPayment.paymentId=t.id,this.formEditPayment.amountInput=$(t.amount),this.formEditPayment.method=t.method,this.formEditPayment.reference=t.reference??"",this.formEditPayment.notes=t.notes??"",this.formEditPayment.reason="",this.formEditPayment.confirmDanger=!1,this.activePaymentMenuId.set(null),this.dialogMode.set("edit-payment")}onPaymentMethodChange(t){t==="cash"?this.formPayment.amountInput=$(this.cashAmountDue()):this.formPayment.amountInput=$(this.amountDue())}isItemSelected(t){let e=`${t.sessionId}::${t.studentId}`;return this.selectedItems().has(e)}toggleItemSelection(t){let e=`${t.sessionId}::${t.studentId}`,o=new Set(this.selectedItems());o.has(e)?o.delete(e):o.add(e),this.selectedItems.set(o)}async recordPayment(){let t=this.order();if(!t)return;let e=K(this.formPayment.amountInput);if(e<0){this.notificationService.warning("Please enter a valid payment amount.");return}if(e===0&&this.amountDue()>0){this.notificationService.warning("Please enter a valid payment amount.");return}try{await this.orderRpc.recordPayment({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,amount:e,reference:this.formPayment.reference||null,method:this.formPayment.method,notes:this.formPayment.notes||null,isDepositConfirmation:this.formPayment.isDepositConfirmation,itemKeys:null}),this.closeDialog()}catch(o){console.error("Failed to record payment:",o)}}async confirmScreenshotPayment(t){let e=this.order();if(!e)return;let o=e.paymentScreenshots?.find(V=>V.id===t);if(!o){this.notificationService.error("Screenshot not found");return}let n=o.claimedAmountCents??0,l=o.paymentOption==="cash_deposit",f=!l&&n===0&&this.amountDue()<=0;if(n<=0&&!f){this.notificationService.warning("No claimed amount on this screenshot");return}let A=l?"cash":"zelle";try{await this.orderRpc.recordPayment({year:2026,seasonId:e.seasonId,userAuthId:e.userAuthId,amount:n,reference:t,method:A,notes:l?"Registration fee confirmed via screenshot":"Payment confirmed via screenshot",isDepositConfirmation:l,itemKeys:o.lockedItemKeys}),this.notificationService.success(l?"Registration fee confirmed":"Payment confirmed")}catch(V){console.error("Failed to confirm screenshot payment:",V),this.notificationService.error("Failed to confirm payment")}}rejectScreenshotPayment(t){this.formRejectScreenshot.screenshotId=t,this.formRejectScreenshot.reason="Please re-upload a clearer image of your payment receipt.",this.dialogMode.set("reject-screenshot")}async submitRejectScreenshot(){let t=this.order();if(!t)return;let{screenshotId:e,reason:o}=this.formRejectScreenshot;if(!(!e||!o.trim()))try{await this.orderRpc.deleteScreenshot({seasonId:t.seasonId,screenshotId:e,userAuthId:t.userAuthId,rejectionReason:o.trim()}),this.notificationService.success("Screenshot rejected, items reverted to awaiting payment"),this.closeDialog()}catch(n){console.error("Failed to reject screenshot:",n),this.notificationService.error("Failed to reject screenshot")}}async cancelItems(){let t=this.order();if(t){if(this.selectedItems().size===0){this.notificationService.warning("Please select at least one item to cancel.");return}if(!this.formCancel.reason.trim()){this.notificationService.warning("Please enter a cancellation reason.");return}try{let e=Array.from(this.selectedItems()).map(o=>{let[n,l]=o.split("::");return{sessionId:n,studentId:l}});await this.orderRpc.cancelItems({year:2026,seasonId:t.seasonId,items:e,reason:this.formCancel.reason,userAuthId:t.userAuthId}),this.closeDialog()}catch(e){console.error("Failed to cancel items:",e)}}}async removeWaitlist(){let t=this.order();if(t)try{await this.orderRpc.removeWaitlistEntry({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,sessionId:this.formRemoveWaitlist.sessionId}),this.closeDialog()}catch(e){console.error("Failed to remove waitlist entry:",e)}}async addAdjustment(){let t=this.order();if(!t)return;let e=K(this.formAdjustment.amountInput);if(e<=0){this.notificationService.warning("Please enter a valid amount.");return}if(!this.formAdjustment.reason.trim()){this.notificationService.warning("Please enter a reason for the adjustment.");return}let o=this.formAdjustment.type==="credit"?-e:e;try{await this.orderRpc.addAdjustment({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,amount:o,reason:this.formAdjustment.reason}),this.closeDialog(),this.notificationService.success(this.formAdjustment.type==="credit"?"Credit added successfully.":"Fee added successfully.")}catch(n){console.error("Failed to add adjustment:",n)}}async updatePaymentRecord(){let t=this.order();if(!t)return;if(!this.formEditPayment.confirmDanger){this.notificationService.warning("Please confirm the dangerous operation checkbox.");return}if(!this.formEditPayment.reason.trim()){this.notificationService.warning("Please provide a reason for the payment history change.");return}let e=this.parseSignedCurrencyInput(this.formEditPayment.amountInput);if(e===0){this.notificationService.warning("Payment amount cannot be zero.");return}let o=this.formEditPayment.paymentId;if(!o){this.notificationService.error("No payment selected to edit.");return}let n=!1,l=this.payments().map(f=>f.id!==o?f:(n=!0,O(S({},f),{amount:e,method:this.formEditPayment.method,reference:this.formEditPayment.reference.trim()?this.formEditPayment.reference.trim():null,notes:this.formEditPayment.notes.trim()?this.formEditPayment.notes.trim():null})));if(!n){this.notificationService.error("Selected payment record no longer exists.");return}try{await this.orderRpc.replaceOrderPayments({year:2026,seasonId:t.seasonId,userAuthId:t.userAuthId,payments:l,reason:this.formEditPayment.reason.trim()}),this.notificationService.success("Payment history updated."),this.closeDialog()}catch(f){console.error("Failed to update payment record:",f)}}clearError(){this.error.set(null)}parseSignedCurrencyInput(t){let e=t.replace(/[^0-9.-]/g,""),o=parseFloat(e);return Number.isFinite(o)?Math.round(o*100):0}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=Z({type:a,selectors:[["app-admin-order-detail"]],hostBindings:function(e,o){e&1&&_("click",function(){return o.onDocumentClick()},ge)},inputs:{orderId:[1,"orderId"],seasonId:[1,"seasonId"]},decls:11,vars:9,consts:[["pageTitle","Order Details","pageSubtitle","View and manage order"],[1,"admin-order-detail-container"],[1,"loading-state"],[1,"error-banner"],[1,"order-content"],[1,"modal-overlay"],[1,"spinner"],["type","button",1,"btn-close",3,"click"],[1,"order-header-info"],[1,"order-user-id"],[1,"label"],[1,"value"],[1,"status-badge",3,"ngClass"],[1,"order-layout"],[1,"main-column"],[1,"info-card","user-info-card"],[1,"info-card","status-card"],[1,"status-details"],[1,"detail-row"],[1,"value","status-badge",3,"ngClass"],[1,"empty-state"],[3,"lockedItems","submittedItems","securedItems","paidItems","editable","isAdmin","screenshotGroups"],[3,"order","seasonId","studentMap","orderUser"],[1,"info-card","payments-card"],[1,"info-card","waitlist-card"],[1,"info-card","history-card"],[1,"sidebar-column"],[3,"recordPaymentClick","addAdjustmentClick","isAdmin","orderSummary"],[1,"user-details"],[1,"value",3,"ngClass"],[1,"remaining-time"],[3,"cancelItemsClick","confirmScreenshot","rejectScreenshot","lockedItems","submittedItems","securedItems","paidItems","editable","isAdmin","screenshotGroups"],[1,"payments-table"],[1,"actions-column"],[1,"amount"],[1,"method-badge"],[1,"actions-cell"],[1,"row-actions",3,"click"],["type","button","aria-label","Payment actions",1,"row-menu-trigger",3,"click"],[1,"row-menu"],["type","button",1,"row-menu-item","danger",3,"click"],[1,"waitlist-list"],[1,"waitlist-item"],[1,"waitlist-header"],[1,"class-name"],[1,"waitlist-details"],[1,"detail-item"],["type","button",1,"btn","btn-danger-outline","btn-sm",3,"click"],[1,"section-header",3,"click"],["type","button",1,"toggle-btn"],[1,"history-timeline"],[1,"history-event"],[1,"event-time"],[1,"event-details"],[1,"event-action"],[1,"event-metadata"],[1,"affected-items"],[1,"affected-item"],[1,"item-class"],[1,"item-student"],[1,"item-options"],[1,"option-tag"],[1,"modal-overlay",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-header"],[1,"modal-body"],[3,"ngSubmit"],[1,"form-group"],["for","payment-amount"],["type","text","id","payment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text"],["for","payment-method"],["id","payment-method","name","method","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","zelle"],["value","check"],["value","cash"],["value","other"],[1,"cash-discount-info"],["for","payment-reference"],["type","text","id","payment-reference","name","reference","placeholder","Confirmation number, check number, etc.",1,"form-control",3,"ngModelChange","ngModel"],["for","payment-notes"],["id","payment-notes","name","notes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-group","deposit-confirmation"],[1,"alert","alert-danger"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"cash-info-row"],[1,"cash-info-row","discount"],[1,"cash-info-row","total"],[1,"checkbox-label"],["type","checkbox","name","isDepositConfirmation",3,"ngModelChange","ngModel"],[1,"spinner-small"],[1,"items-checklist"],[1,"checkbox-item"],["for","cancel-reason"],["id","cancel-reason","name","reason","rows","3","placeholder","Enter reason for cancellation...","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-danger",3,"disabled"],["type","checkbox",3,"change","checked"],[1,"item-info"],[1,"student-name"],[1,"item-status-badge",3,"ngClass"],[1,"read-only-value"],[1,"alert","alert-warning"],["for","adjustment-type"],["id","adjustment-type","name","type","required","",1,"form-control",3,"ngModelChange","ngModel"],["value","credit"],["value","fee"],["for","adjustment-amount"],["type","text","id","adjustment-amount","name","amount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","adjustment-reason"],["id","adjustment-reason","name","reason","rows","3","placeholder","Explain the reason for this adjustment...","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-info"],["for","reject-reason"],["id","reject-reason","name","reason","rows","3","required","","placeholder","Enter reason shown to user...",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-amount"],["type","text","id","edit-payment-amount","name","editAmount","placeholder","0.00","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-method"],["id","edit-payment-method","name","editMethod","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-reference"],["type","text","id","edit-payment-reference","name","editReference","placeholder","Confirmation number, check number, etc.",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-notes"],["id","edit-payment-notes","name","editNotes","rows","3","placeholder","Optional notes...",1,"form-control",3,"ngModelChange","ngModel"],["for","edit-payment-reason"],["id","edit-payment-reason","name","editReason","rows","3","placeholder","Explain why this payment history edit is needed...","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"checkbox-label","danger-checkbox"],["type","checkbox","name","confirmDanger",3,"ngModelChange","ngModel"]],template:function(e,o){e&1&&(i(0,"app-admin-layout",0)(1,"div",1),u(2,xt,4,0,"div",2),u(3,Ct,6,1,"div",3),u(4,Ht,40,16,"div",4),u(5,Qt,44,11,"div",5),u(6,on,26,5,"div",5),u(7,dn,23,5,"div",5),u(8,pn,36,8,"div",5),u(9,fn,22,5,"div",5),u(10,bn,55,10,"div",5),r()()),e&2&&(d(2),g(o.loading()?2:-1),d(),g(o.error()&&!o.loading()?3:-1),d(),g(o.order()&&!o.loading()?4:-1),d(),g(o.dialogMode()==="record-payment"?5:-1),d(),g(o.dialogMode()==="cancel-items"?6:-1),d(),g(o.dialogMode()==="remove-waitlist"?7:-1),d(),g(o.dialogMode()==="add-adjustment"?8:-1),d(),g(o.dialogMode()==="reject-screenshot"?9:-1),d(),g(o.dialogMode()==="edit-payment"?10:-1))},dependencies:[Q,J,ze,Le,Re,We,Ae,Ee,Be,Te,Ve,Fe,je,Ne,$e,Ue,Ke,ie],styles:[".admin-order-detail-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:20px}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.spinner[_ngcontent-%COMP%]{border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;width:40px;height:40px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin:0 auto 20px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-banner[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:15px;border-radius:4px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center}.btn-close[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;cursor:pointer;color:inherit}.order-header-info[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;padding:1rem;background:#fff;border:1px solid #e0e0e0;border-radius:8px}.order-user-id[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.order-user-id[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.875rem;color:#666}.order-user-id[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-family:monospace;font-weight:500;font-size:.9375rem}.order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e0e0e0}.user-id[_ngcontent-%COMP%]{color:#666;font-size:14px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:10px}.order-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 350px;gap:1.5rem;align-items:start}.main-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.sidebar-column[_ngcontent-%COMP%]{position:sticky;top:20px}@media(max-width:900px){.order-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.sidebar-column[_ngcontent-%COMP%]{position:static;order:-1}}.info-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:8px;padding:20px;margin-bottom:20px}.info-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 20px;font-size:20px;color:#333}.card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.user-details[_ngcontent-%COMP%], .status-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0}.detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.status-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:4px;font-size:12px;font-weight:600;text-transform:uppercase;display:inline-block}.status-submitted[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-paid[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-refunded[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.status-partial[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460}.status-empty[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.text-success[_ngcontent-%COMP%]{color:#28a745!important}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.remaining-time[_ngcontent-%COMP%]{font-size:12px;color:#666}.alert[_ngcontent-%COMP%]{padding:12px 16px;border-radius:4px;margin-top:15px}.alert-danger[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}.alert-warning[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}.alert-info[_ngcontent-%COMP%]{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb}.items-section[_ngcontent-%COMP%]{margin-bottom:30px}.items-section[_ngcontent-%COMP%]:last-child{margin-bottom:0}.section-title[_ngcontent-%COMP%]{font-size:16px;font-weight:600;margin-bottom:15px;color:#333}.item-count[_ngcontent-%COMP%]{color:#666;font-weight:400;font-size:14px}.items-list[_ngcontent-%COMP%]{display:grid;gap:12px}.item-card[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.item-card.locked[_ngcontent-%COMP%]{background:#f3e5f5;border-color:#ce93d8}.item-card.pending[_ngcontent-%COMP%]{background:#fff3cd;border-color:#ffeaa7}.item-card.secured[_ngcontent-%COMP%]{background:#f3e5f5;border-color:#ce93d8}.item-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.class-name[_ngcontent-%COMP%]{font-weight:600;color:#333}.item-status-badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:3px;font-size:11px;font-weight:600;text-transform:uppercase}.item-status-locked[_ngcontent-%COMP%]{background:#7b1fa2;color:#fff}.item-status-submitted[_ngcontent-%COMP%]{background:#ffc107;color:#000}.item-status-paid[_ngcontent-%COMP%]{background:#28a745;color:#fff}.item-status-secured[_ngcontent-%COMP%]{background:#7b1fa2;color:#fff}.item-status-refunded[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.detail-item[_ngcontent-%COMP%]{display:flex;gap:8px;font-size:14px}.detail-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:#666}.detail-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#333}.option-badge[_ngcontent-%COMP%]{background:#007bff;color:#fff;padding:2px 8px;border-radius:3px;font-size:11px;margin-right:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.payments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.payments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px;background:#f8f9fa;border-bottom:2px solid #dee2e6;font-weight:600}.payments-table[_ngcontent-%COMP%]   th.actions-column[_ngcontent-%COMP%]{width:64px}.payments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #dee2e6;vertical-align:middle}.payments-table[_ngcontent-%COMP%]   .amount[_ngcontent-%COMP%]{font-weight:600}.method-badge[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;text-transform:uppercase}.actions-cell[_ngcontent-%COMP%]{text-align:right}.row-actions[_ngcontent-%COMP%]{position:relative;display:inline-flex;justify-content:flex-end}.row-menu-trigger[_ngcontent-%COMP%]{border:1px solid #dee2e6;background:#fff;color:#495057;border-radius:6px;width:30px;height:30px;line-height:1;font-size:20px;cursor:pointer}.row-menu-trigger[_ngcontent-%COMP%]:hover{background:#f8f9fa}.row-menu[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 6px);right:0;z-index:20;min-width:140px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;box-shadow:0 8px 20px #0000001f;padding:6px}.row-menu-item[_ngcontent-%COMP%]{width:100%;text-align:left;border:none;background:transparent;border-radius:6px;padding:8px 10px;font-size:13px;cursor:pointer}.row-menu-item[_ngcontent-%COMP%]:hover{background:#f8f9fa}.row-menu-item.danger[_ngcontent-%COMP%]{color:#c62828}.waitlist-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.waitlist-item[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;border-radius:6px;padding:15px}.waitlist-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.promoted-badge[_ngcontent-%COMP%]{background:#28a745;color:#fff;padding:4px 8px;border-radius:3px;font-size:12px;font-weight:600}.waitlist-details[_ngcontent-%COMP%]{margin-bottom:10px}.section-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;cursor:pointer;-webkit-user-select:none;user-select:none;margin-bottom:15px}.section-header[_ngcontent-%COMP%]:hover{opacity:.8}.section-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.toggle-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:14px;color:#666;cursor:pointer;padding:4px 8px}.history-timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.history-event[_ngcontent-%COMP%]{display:flex;gap:15px;padding:12px;background:#f8f9fa;border-radius:6px}.event-time[_ngcontent-%COMP%]{color:#666;font-size:12px;white-space:nowrap;min-width:150px}.event-details[_ngcontent-%COMP%]{flex:1}.event-action[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}.event-metadata[_ngcontent-%COMP%]{color:#666;font-size:14px}.affected-items[_ngcontent-%COMP%]{margin-top:8px;padding:8px;background:#e9ecef;border-radius:4px}.affected-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:13px;border-bottom:1px solid #dee2e6}.affected-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.affected-item[_ngcontent-%COMP%]   .item-class[_ngcontent-%COMP%]{font-weight:500;color:#333}.affected-item[_ngcontent-%COMP%]   .item-student[_ngcontent-%COMP%]{color:#666}.affected-item[_ngcontent-%COMP%]   .item-options[_ngcontent-%COMP%]{display:flex;gap:4px;margin-left:auto}.affected-item[_ngcontent-%COMP%]   .option-tag[_ngcontent-%COMP%]{background:#6c757d;color:#fff;padding:2px 6px;border-radius:3px;font-size:10px}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-primary-outline[_ngcontent-%COMP%]{background:#fff;color:#007bff;border:1px solid #007bff}.btn-primary-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#007bff;color:#fff}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-danger-outline[_ngcontent-%COMP%]{background:#fff;color:#dc3545;border:1px solid #dc3545}.btn-danger-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:#dc3545;color:#fff}.btn-sm[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid #dee2e6}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:20px}.modal-body[_ngcontent-%COMP%]{padding:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:500;margin-bottom:8px;color:#333}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:14px}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.form-text[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:12px;color:#6c757d}.items-checklist[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow-y:auto;padding:8px;background:#f8f9fa;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:8px;cursor:pointer}.checkbox-item[_ngcontent-%COMP%]:hover{background:#e9ecef;border-radius:4px}.checkbox-item[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer}.item-info[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.read-only-value[_ngcontent-%COMP%]{padding:8px 12px;background:#f8f9fa;border-radius:4px;font-weight:500}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:20px;padding-top:20px;border-top:1px solid #dee2e6}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_spin .6s linear infinite;margin-right:8px}.btn-success[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:#218838}.cash-discount-info[_ngcontent-%COMP%]{background:#e8f5e9;border:1px solid #c8e6c9;border-radius:8px;padding:12px;margin-bottom:15px}.cash-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0;font-size:14px}.cash-info-row.discount[_ngcontent-%COMP%]{color:#2e7d32}.cash-info-row.total[_ngcontent-%COMP%]{font-weight:600;font-size:16px;border-top:1px solid #c8e6c9;padding-top:8px;margin-top:4px}.cash-discount-info[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{margin-top:8px;color:#666;font-style:italic}.deposit-confirmation[_ngcontent-%COMP%]{background:#f3e5f5;border:1px solid #ce93d8;border-radius:8px;padding:12px}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:500}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:18px;height:18px;cursor:pointer;accent-color:#7b1fa2}.deposit-confirmation[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]{margin-top:8px;color:#7b1fa2}.danger-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{accent-color:#c62828}"]})};export{Xe as AdminOrderDetailComponent};
