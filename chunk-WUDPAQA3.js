import{b as $}from"./chunk-W52BTLNY.js";import{K as A,R as L,ga as T,h as R,ha as V,ja as G,ma as z,na as F,oa as j}from"./chunk-OBNAGF5X.js";import"./chunk-ZEYGPIIR.js";import"./chunk-KBXPF7D4.js";import"./chunk-2PX3OE6K.js";import{$a as C,Db as a,Ea as r,Eb as p,Fb as w,Gb as N,N as y,Qa as W,S as b,T as h,ab as x,da as g,db as P,eb as O,fb as S,gb as n,hb as o,ib as k,ob as E,qb as M,sb as m}from"./chunk-CNMR2ZL6.js";import{a as D,b as I}from"./chunk-Q7L6LLAK.js";var B=(s,t)=>t.sessionId,Y=(s,t)=>t.userId;function J(s,t){if(s&1){let e=E();n(0,"div",2),a(1),n(2,"button",6),M("click",function(){b(e);let l=m();return h(l.loadWaitlistEntries())}),a(3,"Retry"),o()()}if(s&2){let e=m();r(),w(" ",e.error()," ")}}function K(s,t){s&1&&(n(0,"div",3),k(1,"div",7),n(2,"p"),a(3,"Loading..."),o()())}function Q(s,t){s&1&&(n(0,"div",4)(1,"div",8),a(2,"assignment"),o(),n(3,"h2"),a(4,"No Waitlist Entries"),o(),n(5,"p"),a(6,"No one is currently on any waitlist"),o()())}function X(s,t){if(s&1){let e=E();n(0,"tr")(1,"td",24),a(2),o(),n(3,"td",25),a(4),o(),n(5,"td",26),a(6),o(),n(7,"td",23)(8,"button",27),M("click",function(){let l=b(e).$implicit,d=m(4);return h(d.removeEntry(l))}),a(9," Remove "),o()()()}if(s&2){let e=t.$implicit,i=m(4);r(2),p(e.userName),r(2),p(e.parentEmail),r(2),p(i.formatStudentNames(e.studentNames)),r(2),S("disabled",i.actionLoading())}}function Z(s,t){if(s&1&&(n(0,"tr",19)(1,"td",20)(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th"),a(7,"Parent Name"),o(),n(8,"th"),a(9,"Parent Email"),o(),n(10,"th"),a(11,"Student Names"),o(),n(12,"th",23),a(13,"Actions"),o()()(),n(14,"tbody"),P(15,X,10,4,"tr",null,Y),o()()()()()),s&2){let e=m().$implicit;r(15),O(e.entries)}}function ee(s,t){if(s&1){let e=E();n(0,"tr",13)(1,"td",14)(2,"span",15),a(3),o(),n(4,"span",16),a(5),o()(),n(6,"td",12),a(7),o(),n(8,"td",12),a(9),o(),n(10,"td",12),a(11),o(),n(12,"td",17)(13,"button",18),M("click",function(){let l=b(e).$implicit,d=m(2);return h(d.toggleSession(l.sessionId))}),a(14),o()()(),C(15,Z,17,0,"tr",19)}if(s&2){let e=t.$implicit,i=m(2);r(3),p(e.sessionName),r(2),p(e.sessionId),r(2),p(e.capacity),r(2),p(e.enrolledCount),r(2),p(e.entries.length),r(3),w(" ",i.isSessionExpanded(e.sessionId)?"Hide List":"View List"," "),r(),x(i.isSessionExpanded(e.sessionId)?15:-1)}}function te(s,t){if(s&1&&(n(0,"div",9),a(1),o(),n(2,"div",10)(3,"table",11)(4,"thead")(5,"tr")(6,"th"),a(7,"Session"),o(),n(8,"th",12),a(9,"Capacity"),o(),n(10,"th",12),a(11,"Enrolled"),o(),n(12,"th",12),a(13,"Waitlist"),o(),n(14,"th"),a(15,"Actions"),o()()(),n(16,"tbody"),P(17,ee,16,7,null,null,B),o()()()),s&2){let e=m();r(),N(" Total ",e.entries().length," waitlist entries across ",e.sessionGroups().length," sessions "),r(16),O(e.sessionGroups())}}function ne(s,t){if(s&1){let e=E();n(0,"div",5)(1,"div",28)(2,"h3"),a(3,"Remove Waitlist Entry"),o(),n(4,"p"),a(5," Remove "),n(6,"strong"),a(7),o(),a(8," from the waitlist for "),n(9,"strong"),a(10),o(),a(11,"? "),o(),n(12,"p",29),a(13," This will remove the user from the waitlist for this class. "),o(),n(14,"div",30)(15,"button",31),M("click",function(){b(e);let l=m();return h(l.closeRemoveDialog())}),a(16,"Cancel"),o(),n(17,"button",32),M("click",function(){b(e);let l=m();return h(l.confirmRemove())}),a(18),o()()()()}if(s&2){let e,i,l=m();r(7),p((e=l.selectedEntry())==null?null:e.userName),r(3),p((i=l.selectedEntry())==null?null:i.className),r(7),S("disabled",l.actionLoading()),r(),w(" ",l.actionLoading()?"Removing...":"Confirm Remove"," ")}}var U=class s{orderDatastore=y(G);orderRpc=y(z);userDatastore=y(V);seasonDatastore=y(T);configService=y(F);seasonService=y(j);_entries=g([]);_sessionGroups=g([]);_expandedSessionIds=g([]);_loading=g(!1);_error=g(null);_actionLoading=g(!1);_showRemoveDialog=g(!1);_selectedEntry=g(null);entries=this._entries.asReadonly();sessionGroups=this._sessionGroups.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();actionLoading=this._actionLoading.asReadonly();showRemoveDialog=this._showRemoveDialog.asReadonly();selectedEntry=this._selectedEntry.asReadonly();async ngOnInit(){await this.loadWaitlistEntries()}async loadWaitlistEntries(){this._loading.set(!0),this._error.set(null);try{let t=this.seasonService.selectedSeason();if(!t){this._entries.set([]),this._sessionGroups.set([]);return}let e=await this.orderDatastore.listAllWaitlistEntries(t.id),i=await this.enrichEntriesWithUserDetails(e),l=await this.seasonDatastore.getRegistration(t.id),d=this.buildSessionGroups(i,t.sessions??[],l);this._entries.set(i),this._sessionGroups.set(d),this._expandedSessionIds.set(this._expandedSessionIds().filter(_=>d.some(c=>c.sessionId===_)))}catch(t){let e=t instanceof Error?t.message:"Failed to load waitlist entries";this._error.set(e)}finally{this._loading.set(!1)}}removeEntry(t){this._selectedEntry.set(t),this._showRemoveDialog.set(!0)}closeRemoveDialog(){this._showRemoveDialog.set(!1),this._selectedEntry.set(null)}async confirmRemove(){let t=this._selectedEntry();if(t){this._actionLoading.set(!0);try{let e=this.configService.activeYear(),i=this.seasonService.selectedSeason();if(!i)throw new Error("No season selected");await this.orderRpc.removeWaitlistEntry({year:e,seasonId:i.id,userAuthId:t.userId,sessionId:t.sessionId}),this.closeRemoveDialog(),await this.loadWaitlistEntries()}catch(e){let i=e instanceof Error?e.message:"Failed to remove entry";this._error.set(i)}finally{this._actionLoading.set(!1)}}}toggleSession(t){let e=this._expandedSessionIds();if(e.includes(t)){this._expandedSessionIds.set(e.filter(i=>i!==t));return}this._expandedSessionIds.set([...e,t])}isSessionExpanded(t){return this._expandedSessionIds().includes(t)}formatStudentNames(t){return t.length===0?"--":t.join(", ")}async enrichEntriesWithUserDetails(t){let e=Array.from(new Set(t.map(d=>d.userId))),i=await this.userDatastore.listUsersByAuthIds(e),l=new Map(i.map(d=>[d.uid,d]));return t.map(d=>{let _=l.get(d.userId);return I(D({},d),{userName:_?.displayName??d.userName,parentEmail:_?.email??"Unknown Email",studentNames:(_?.students??[]).map(c=>A(c))})})}buildSessionGroups(t,e,i){let l=new Map(e.map(c=>[c.id,c])),d=new Map;for(let c of t){let v=d.get(c.sessionId)??[];v.push(c),d.set(c.sessionId,v)}let _=Array.from(d.entries()).map(([c,v])=>{let u=l.get(c),f=[...v].sort((H,q)=>H.joinedAt.localeCompare(q.joinedAt));return{sessionId:c,sessionName:u?.name??f[0]?.className??c,capacity:u?.capacity??0,enrolledCount:i?L(i,c):0,entries:f}});return _.sort((c,v)=>{let u=l.get(c.sessionId)?.startDate??"",f=l.get(v.sessionId)?.startDate??"";return u&&f&&u!==f?u.localeCompare(f):u&&!f?-1:!u&&f?1:c.sessionName.localeCompare(v.sessionName)}),_}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=W({type:s,selectors:[["app-admin-waitlist-list"]],decls:7,vars:5,consts:[["pageTitle","Waitlist Management","pageSubtitle","View and manage waitlist entries"],[1,"admin-waitlist"],[1,"error"],[1,"loading"],[1,"empty"],[1,"dialog-overlay"],[1,"btn","btn-sm",3,"click"],[1,"spinner"],["aria-hidden","true",1,"empty-icon","material-symbols-rounded"],[1,"results-count"],[1,"entries-table"],[1,"session-table"],[1,"col-number"],[1,"session-row"],[1,"class-info"],[1,"class-name"],[1,"session-id"],[1,"col-actions"],[1,"btn","btn-sm","btn-outline",3,"click"],[1,"detail-row"],["colspan","5"],[1,"detail-table-wrap"],[1,"detail-table"],[1,"detail-actions-col"],[1,"parent-name"],[1,"parent-email"],[1,"student-names"],[1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"dialog"],[1,"dialog-note"],[1,"dialog-actions"],[1,"btn","btn-outline",3,"click"],[1,"btn","btn-danger",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"app-admin-layout",0)(1,"div",1),C(2,J,4,1,"div",2),C(3,K,4,0,"div",3),C(4,Q,7,0,"div",4),C(5,te,19,2),C(6,ne,19,4,"div",5),o()()),e&2&&(r(2),x(i.error()?2:-1),r(),x(i.loading()?3:-1),r(),x(!i.loading()&&!i.error()&&i.sessionGroups().length===0?4:-1),r(),x(!i.loading()&&i.sessionGroups().length>0?5:-1),r(),x(i.showRemoveDialog()?6:-1))},dependencies:[R,$],styles:[".admin-waitlist[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.results-count[_ngcontent-%COMP%]{margin-bottom:1rem;color:var(--sys-on-surface-variant, #666);font-size:.875rem}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:4rem 2rem}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error[_ngcontent-%COMP%]{padding:1.5rem;background:var(--sys-error-container, #ffebee);color:var(--sys-error, #c62828);border-radius:8px;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}.empty[_ngcontent-%COMP%]{padding:4rem 2rem;text-align:center;color:var(--sys-on-surface-variant, #666)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.empty[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 .5rem}.empty[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.entries-table[_ngcontent-%COMP%]{overflow-x:auto}.session-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:8px;overflow:hidden}.session-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .session-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid var(--sys-outline-variant, #e0e0e0)}.session-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);font-weight:600;font-size:.875rem;color:var(--sys-on-surface-variant, #666)}.session-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.class-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.class-name[_ngcontent-%COMP%]{font-weight:500}.session-id[_ngcontent-%COMP%]{font-family:monospace;font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.col-number[_ngcontent-%COMP%]{text-align:right!important;font-variant-numeric:tabular-nums}.col-actions[_ngcontent-%COMP%]{text-align:right;white-space:nowrap}.detail-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background:var(--sys-surface-container-low, #fafafa);padding:.75rem}.detail-table-wrap[_ngcontent-%COMP%]{overflow-x:auto}.detail-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--sys-outline-variant, #ececec);border-radius:8px;overflow:hidden}.detail-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .detail-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);text-align:left}.detail-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.04em;color:var(--sys-on-surface-variant, #666);background:var(--sys-surface-container, #f8f8f8)}.detail-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}.parent-name[_ngcontent-%COMP%]{font-weight:500}.parent-email[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666)}.student-names[_ngcontent-%COMP%]{font-size:.8125rem}.detail-actions-col[_ngcontent-%COMP%]{width:96px;text-align:right!important;white-space:nowrap}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:8px;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-primary-dark, #a51c1c)}.btn-outline[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--sys-outline-variant, #e0e0e0);color:var(--sys-on-surface, #212121)}.btn-outline[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--sys-surface-variant, #f5f5f5)}.btn-danger[_ngcontent-%COMP%]{background:var(--sys-error, #c62828);color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#b71c1c}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem;font-size:.8125rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;padding:1rem;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1.5rem;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.25rem}.dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .75rem;color:var(--sys-on-surface-variant, #666)}.dialog-note[_ngcontent-%COMP%]{font-size:.875rem;color:var(--sys-tertiary, #1976d2)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--sys-outline-variant, #e0e0e0)}@media(max-width:768px){.session-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .session-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .detail-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .detail-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.875rem}.detail-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem}}"]})};export{U as AdminWaitlistListComponent};
