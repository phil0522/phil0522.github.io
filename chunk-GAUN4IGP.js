import{a as k}from"./chunk-YNIPQYFY.js";import{d as I}from"./chunk-RYIKU5Y3.js";import{H as E,W as D,ea as A,h as M,n as O,o as P}from"./chunk-OX3HN6KS.js";import"./chunk-UYHN5VVP.js";import{$a as x,Bb as h,Db as o,Ea as r,Eb as d,Fb as b,N as c,Pb as w,Qa as v,ab as C,da as p,db as y,eb as S,fb as _,gb as n,hb as i,ib as u,sb as g}from"./chunk-5O64VQN5.js";import"./chunk-Q7L6LLAK.js";var L=a=>["/admin/sessions",a,"registrations"],N=(a,t)=>t.id;function T(a,t){a&1&&(n(0,"div",2),u(1,"div",6),n(2,"p"),o(3,"Loading sessions..."),i()())}function z(a,t){if(a&1&&(n(0,"div",3)(1,"div",7),o(2,"!"),i(),n(3,"p"),o(4),i()()),a&2){let e=g();r(4),d(e.error())}}function F(a,t){a&1&&(n(0,"div",4)(1,"h3"),o(2,"No sessions found"),i(),n(3,"p"),o(4,"Catalog has no sessions for this year."),i()())}function H(a,t){if(a&1&&(n(0,"tr")(1,"td",9)(2,"div",10),o(3),i(),n(4,"div",11),o(5),i()(),n(6,"td"),o(7),i(),n(8,"td"),o(9),i(),n(10,"td",12),o(11),i(),n(12,"td",12),o(13),i(),n(14,"td")(15,"span",13),o(16),i()(),n(17,"td",14)(18,"a",15),o(19," View Roster "),i()()()),a&2){let e=t.$implicit,l=g(2);r(3),d(e.name),r(2),d(e.id),r(2),d(e.seasonName),r(2),d(l.formatRange(e.startDate,e.endDate)),r(2),d(e.enrolledCount),r(2),d(e.capacity),r(2),h("inactive",!e.isActive),r(),b(" ",e.isActive?"Active":"Inactive"," "),r(2),_("routerLink",w(10,L,e.id))}}function j(a,t){if(a&1&&(n(0,"div",5)(1,"table",8)(2,"thead")(3,"tr")(4,"th"),o(5,"Session"),i(),n(6,"th"),o(7,"Season"),i(),n(8,"th"),o(9,"Dates"),i(),n(10,"th"),o(11,"Enrolled"),i(),n(12,"th"),o(13,"Capacity"),i(),n(14,"th"),o(15,"Status"),i(),u(16,"th"),i()(),n(17,"tbody"),y(18,H,20,12,"tr",null,N),i()()()),a&2){let e=g();r(18),S(e.rows())}}var R=class a{userService=c(A);seasonDatastore=c(D);router=c(O);loading=p(!0);error=p(null);rows=p([]);async ngOnInit(){if(!this.userService.isAuthenticated()){this.router.navigate(["/login"]);return}if(!this.userService.isAdmin()){this.router.navigate(["/"]);return}this.loading.set(!0),this.error.set(null);try{let t=await this.seasonDatastore.listAllSeasons(),e=await Promise.all(t.map(async s=>({seasonId:s.id,registration:await this.seasonDatastore.getRegistration(s.id)}))),l=new Map(e.map(s=>[s.seasonId,s.registration])),m=t.flatMap(s=>(s.sessions??[]).map(f=>this.toRow(f,s,l.get(s.id)??null)));m.sort((s,f)=>s.startDate.localeCompare(f.startDate)),this.rows.set(m)}catch(t){let e=t instanceof Error?t.message:"Failed to load sessions.";this.error.set(e)}finally{this.loading.set(!1)}}formatRange(t,e){return!t||!e?"--":I(t,e)}toRow(t,e,l){let m=e.name??"Unknown Season";return{id:t.id,name:t.name,seasonId:t.seasonId,seasonName:m,startDate:t.startDate??"",endDate:t.endDate??"",capacity:t.capacity??0,enrolledCount:l?E(l,t.id):0,isActive:t.isActive??!1}}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=v({type:a,selectors:[["app-admin-session-list"]],decls:6,vars:1,consts:[["pageTitle","Session Registrations","pageSubtitle","Open a session to view the roster"],[1,"session-list"],[1,"loading-container"],[1,"error-container"],[1,"empty-state"],[1,"table-container"],[1,"spinner"],[1,"error-icon"],[1,"session-table"],[1,"col-session"],[1,"session-name"],[1,"session-id"],[1,"col-capacity"],[1,"status-pill"],[1,"col-link"],[1,"btn-link",3,"routerLink"]],template:function(e,l){e&1&&(n(0,"app-admin-layout",0)(1,"div",1),x(2,T,4,0,"div",2)(3,z,5,1,"div",3)(4,F,5,0,"div",4)(5,j,20,0,"div",5),i()()),e&2&&(r(2),C(l.loading()?2:l.error()?3:l.rows().length===0?4:5))},dependencies:[M,P,k],styles:[".session-list[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1.5rem}.loading-container[_ngcontent-%COMP%], .error-container[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}.spinner[_ngcontent-%COMP%]{width:32px;height:32px;border:3px solid var(--sys-outline, #e0e0e0);border-top-color:var(--sys-primary, #c62828);border-radius:50%;animation:_ngcontent-%COMP%_spin .8s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-container[_ngcontent-%COMP%]{background:var(--sys-error-container, #ffebee);border-radius:12px}.error-icon[_ngcontent-%COMP%]{width:48px;height:48px;background:var(--sys-error, #c62828);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;margin-bottom:1rem}.table-container[_ngcontent-%COMP%]{overflow-x:auto}.session-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.85rem}.session-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:.625rem .75rem;font-size:.7rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--sys-on-surface-variant, #666);border-bottom:2px solid var(--sys-outline-variant, #e0e0e0);white-space:nowrap}.session-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.625rem .75rem;border-bottom:1px solid var(--sys-outline-variant, #f0f0f0);color:var(--sys-on-surface, #212121);vertical-align:top}.col-session[_ngcontent-%COMP%]{min-width:200px}.session-name[_ngcontent-%COMP%]{font-weight:600}.session-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--sys-on-surface-variant, #666);margin-top:.2rem}.col-capacity[_ngcontent-%COMP%]{text-align:right;font-variant-numeric:tabular-nums}.status-pill[_ngcontent-%COMP%]{display:inline-block;padding:.2rem .5rem;border-radius:999px;background:var(--sys-surface-variant, #f5f5f5);font-size:.75rem;font-weight:600}.status-pill.inactive[_ngcontent-%COMP%]{background:#eee;color:#777}.col-link[_ngcontent-%COMP%]{text-align:right;white-space:nowrap}.btn-link[_ngcontent-%COMP%]{color:var(--sys-primary, #c62828);text-decoration:none;font-weight:600;font-size:.8rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})};export{R as AdminSessionListComponent};
