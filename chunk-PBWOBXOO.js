import{a as ke}from"./chunk-ZFQURFS5.js";import{b as Pe}from"./chunk-W52BTLNY.js";import{b as Ie,c as we,f as Ee,i as Me,j as Ae,k as Te,q as Oe}from"./chunk-CAB6IJBE.js";import{G as z,S as G,T as Se,X,Z,b as me,fa as ve,ga as be,h as ue,ja as _e,o as pe,q as Y,ra as xe,s as fe,va as De}from"./chunk-OBNAGF5X.js";import"./chunk-ZEYGPIIR.js";import{C as ye,v as he,ya as Ce}from"./chunk-KBXPF7D4.js";import{T as ge}from"./chunk-2PX3OE6K.js";import{$a as O,Bb as ce,Db as l,Ea as p,Eb as w,Fb as N,Gb as de,I as M,N as x,Qa as le,S as y,T as C,Tb as Q,ab as P,da as f,db as j,eb as L,fb as S,gb as a,hb as o,ob as J,qb as v,sb as g}from"./chunk-CNMR2ZL6.js";import{a as D,b as H}from"./chunk-Q7L6LLAK.js";var V=class s{firestore=ye(ge());orderDatastore=x(_e);seasonDatastore=x(be);async getAdminUserCache(){let e=he(this.firestore,"admin","userCache"),t=await Ce(e);return t.exists()?ve.parse(t.data()):null}async listAllSeasons(){return await this.seasonDatastore.listAllSeasons()}async listOrdersByUserIds(e,t){return t.length===0?[]:await this.orderDatastore.listOrdersByUserIds(e,t)}async listSeasonOrders(e){return await this.orderDatastore.listSeasonOrders(e)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};function te(s){return s.items.filter(e=>e.cancelledAt==null&&(e.status==="submitted"||e.status==="secured"||e.status==="paid"))}function U(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function A(s){let e=Math.abs(s);return`${s<0?"-":""}$${(e/100).toFixed(2)}`}function ee(s,e){return(s.pricing?.discounts??[]).filter(n=>n.type===e).reduce((n,r)=>n+r.amount,0)}function je(s,e){let n=te(s).map(i=>i.snapshot.studentName?.trim()??"").filter(i=>i.length>0),r=[...new Set(n)];return r.length>0?r:e.studentNames.length>0?e.studentNames:[e.displayName]}function Le(s){let e=te(s),t=new Map;for(let r of e){let i=r.snapshot.studentName?.trim()||r.studentId,c=t.get(i)??[],d=[];r.options.lunch&&d.push("Lunch"),r.options.extendedCare&&d.push("Extended Care"),d.length===0&&d.push("None"),c.push({sessionName:r.snapshot.className||r.sessionId,addOns:d}),t.set(i,c)}return t.size===0?"<p>No active registration items found.</p>":[...t.entries()].map(([r,i])=>{let c=i.map(m=>U(m.sessionName)).join(", "),d=i.map(m=>`${U(m.sessionName)}(${m.addOns.map(u=>U(u)).join("+")})`).join(", ");return['<div style="margin-bottom:12px;">',`<div><strong>Student Name:</strong> ${U(r)}</div>`,`<div><strong>Registered Session(s):</strong> ${c}</div>`,`<div><strong>Add-On Services:</strong> ${d}</div>`,"</div>"].join("")}).join("")}function ze(s){let e=te(s),t=e.reduce((b,E)=>b+E.snapshot.priceSnapshot.basePrice,0),n=e.reduce((b,E)=>b+(E.options.lunch?E.snapshot.priceSnapshot.lunchPrice:0)+(E.options.extendedCare?E.snapshot.priceSnapshot.extendedCarePrice:0),0),r=ee(s,G.RETURNING_STUDENT),i=ee(s,G.SIBLING),c=ee(s,G.REFERRAL),d=s.pricing?Se(s.pricing):0,m=s.totalPaid??0,u=Z(s),h=[...new Set((s.payments??[]).map(b=>b.method))],_=h.length>0?h.join(", "):"N/A";return["<div>",`<div><strong>Base Tuition:</strong> ${A(t)}</div>`,`<div><strong>Add-On Services:</strong> ${A(n)}</div>`,'<div style="margin-top:8px;">',`<div><strong>Returning Student Discount:</strong> ${A(r)}</div>`,`<div><strong>Sibling Discount:</strong> ${A(i)}</div>`,`<div><strong>Referral Discount:</strong> ${A(c)}</div>`,"</div>",'<div style="margin-top:8px;">',`<div><strong>Total Tuition After Discounts:</strong> ${A(d)}</div>`,`<div><strong>Payment Received (${U(_)}):</strong> ${A(m)}</div>`,`<div><strong>Remaining Cash Balance:</strong> ${A(u)}</div>`,"</div>","</div>"].join("")}function Ge(s){return!s.items.some(t=>t.status==="secured")||Z(s)<=0?"":['<div style="margin-top:16px;">',"<img",'  src="/wechat_blueberry.jpg"','  alt="WeChat QR Code"','  style="display:block;width:160px;max-width:100%;height:auto;border:0;"',"/>",'<p style="margin:10px 0 0;">Please add us on WeChat for the next payment steps.</p>',"</div>"].join("")}function Re(s){let e=je(s.order,s.cacheEntry);return{PARENT_NAME:s.cacheEntry.parentName||s.cacheEntry.displayName,STUDENT_NAME:e.join(", "),REGISTRATION_DETAILS_HTML:Le(s.order),TUITION_PAYMENT_SUMMARY_HTML:ze(s.order),WECHAT_CONTACT_HTML_SECURED_ONLY:Ge(s.order)}}function Ve(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ne(s,e){let t=s;for(let[n,r]of Object.entries(e)){let i=new RegExp(`{{\\s*${Ve(n)}\\s*}}`,"g");t=t.replace(i,r)}return t}var We="https://www.googleapis.com/auth/drive.readonly",Ke="https://www.googleapis.com/auth/gmail.compose",B=[We,Ke],qe=3300*1e3,re="berryfun.email.googleWorkspaceTokenCache.v1",Je=["access_token_scope_insufficient","insufficient authentication scopes","insufficient permission","insufficientpermissions"],Qe=["invalid credentials","invalid authentication credentials","request had invalid authentication credentials","token has been expired or revoked","invalid_grant","autherror","unauthorized"],R=class s{tokenCache=new Map;constructor(){this.hydrateFromSessionStorage()}async acquireAccessToken(e){let t=this.normalizeScopes([...B,...e]),n=t.join(" "),r=Date.now(),i=this.findReusableToken(t,r);if(i)return i.token;let c=new Y;for(let u of t)c.addScope(u);let d=await fe(De,c),m=Y.credentialFromResult(d);if(!m?.accessToken)throw new Error("Failed to obtain Google access token");return this.tokenCache.set(n,{token:m.accessToken,expiresAtMs:Date.now()+qe}),this.persistToSessionStorage(),m.accessToken}clearCachedTokens(){this.tokenCache.clear(),typeof window<"u"&&window.sessionStorage.removeItem(re)}isScopeInsufficientError(e){let t=e.toLowerCase();return Je.some(n=>t.includes(n))}isRecoverableAuthError(e){let t=e.toLowerCase();return this.isScopeInsufficientError(t)||t.includes("(401)")||t.includes(" 401:")||t.includes(" 401 ")?!0:Qe.some(n=>t.includes(n))}normalizeScopes(e){return[...new Set(e)].sort()}hasAllScopes(e,t){let n=new Set(e.split(" ").filter(r=>r.length>0));return t.every(r=>n.has(r))}findReusableToken(e,t){for(let[n,r]of this.tokenCache.entries()){if(r.expiresAtMs<=t){this.tokenCache.delete(n);continue}if(this.hasAllScopes(n,e))return r}return this.persistToSessionStorage(),null}hydrateFromSessionStorage(){if(!(typeof window>"u"))try{let e=window.sessionStorage.getItem(re);if(!e)return;let t=JSON.parse(e);if(!t||t.version!==1||typeof t.entries!="object")return;let n=Date.now();for(let[r,i]of Object.entries(t.entries))!i||typeof i.token!="string"||typeof i.expiresAtMs!="number"||i.expiresAtMs<=n||this.tokenCache.set(r,{token:i.token,expiresAtMs:i.expiresAtMs})}catch{}}persistToSessionStorage(){if(!(typeof window>"u"))try{let e={};for(let[n,r]of this.tokenCache.entries())e[n]=r;let t={version:1,entries:e};window.sessionStorage.setItem(re,JSON.stringify(t))}catch{}}static \u0275fac=function(t){return new(t||s)};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};var K=class s{authHelper=x(R);inlineImageCache=new Map;async createDraft(e){let t=[...B],n=await this.authHelper.acquireAccessToken(t);try{return await this.createDraftWithToken(e,n)}catch(r){let i=r instanceof Error?r.message:String(r);if(!this.authHelper.isRecoverableAuthError(i))throw r;return this.authHelper.clearCachedTokens(),n=await this.authHelper.acquireAccessToken(t),await this.createDraftWithToken(e,n)}}async createDraftWithToken(e,t){let n=await this.buildRawMessage(e),r=await fetch("https://gmail.googleapis.com/gmail/v1/users/me/drafts",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({message:{raw:n}})});if(!r.ok){let m=await r.text();throw new Error(`Gmail draft creation failed (${r.status}): ${m}`)}let i=await r.json(),c=i.id,d=i.message?.id;if(!c||!d)throw new Error("Gmail draft creation returned an invalid response");return{draftId:c,messageId:d}}async buildRawMessage(e){let t=this.encodeSubjectHeader(e.subject),n=await this.prepareHtmlBodyWithInlineImages(e.htmlBody);if(n.inlineImages.length>0){let c=`berryfun-inline-${Date.now()}-${Math.random().toString(36).slice(2)}`,d=[`To: ${e.to}`,`Subject: ${t}`,"MIME-Version: 1.0",`Content-Type: multipart/related; boundary="${c}"`,"",`--${c}`,"Content-Type: text/html; charset=UTF-8","Content-Transfer-Encoding: base64","",this.base64EncodeUtf8(n.htmlBody)];for(let u of n.inlineImages)d.push(`--${c}`,`Content-Type: ${u.payload.contentType}; name="${u.payload.filename}"`,"Content-Transfer-Encoding: base64",`Content-ID: <${u.cid}>`,`Content-Disposition: inline; filename="${u.payload.filename}"`,"",u.payload.base64);d.push(`--${c}--`);let m=d.join(`\r
`);return this.base64UrlEncodeUtf8(m)}let i=[`To: ${e.to}`,`Subject: ${t}`,"MIME-Version: 1.0","Content-Type: text/html; charset=UTF-8","",e.htmlBody].join(`\r
`);return this.base64UrlEncodeUtf8(i)}async prepareHtmlBodyWithInlineImages(e){let t=/src=(["'])([^"']+)\1/gi,n=[...e.matchAll(t)];if(n.length===0)return{htmlBody:e,inlineImages:[]};let r=new Map;for(let m of n){let u=(m[2]??"").trim(),h=this.resolveInlineImagePath(u);h&&r.set(u,h)}if(r.size===0)return{htmlBody:e,inlineImages:[]};let i=new Map,c=1;for(let m of new Set(r.values())){let u=await this.loadInlineImage(m);u&&(i.set(m,{cid:`inline-image-${c}`,payload:u}),c+=1)}if(i.size===0)return{htmlBody:e,inlineImages:[]};let d=e;for(let[m,u]of r.entries()){let h=i.get(u);if(!h)continue;let _=new RegExp(`src=(["'])${this.escapeRegex(m)}\\1`,"g");d=d.replace(_,`src="cid:${h.cid}"`)}return{htmlBody:d,inlineImages:[...i.values()]}}resolveInlineImagePath(e){let t=e.trim();if(!t)return null;let n=t.toLowerCase();if(n.startsWith("cid:")||n.startsWith("data:")||n.startsWith("http://")||n.startsWith("https://")||n.startsWith("//"))return null;let r=t.split("#")[0]?.split("?")[0]?.trim()??"";return!r||r.includes("..")?null:r.startsWith("/")?r:r.startsWith("./")?`/${r.slice(2)}`:`/${r}`}async loadInlineImage(e){let t=this.inlineImageCache.get(e);if(t)return await t;let n=this.fetchInlineImage(e).catch(()=>null);this.inlineImageCache.set(e,n);let r=await n;return r||this.inlineImageCache.delete(e),r}async fetchInlineImage(e){let t=await fetch(e,{method:"GET"});if(!t.ok)return null;let n=await t.arrayBuffer(),r=new Uint8Array(n);return{contentType:this.resolveImageContentType(e,t.headers.get("Content-Type")),filename:this.extractFilename(e),base64:this.base64EncodeBytes(r)}}resolveImageContentType(e,t){let n=t?.split(";")[0]?.trim().toLowerCase()??"";if(n.startsWith("image/"))return n;let r=e.split(".").pop()?.toLowerCase()??"";return r==="png"?"image/png":r==="gif"?"image/gif":r==="webp"?"image/webp":r==="svg"?"image/svg+xml":"image/jpeg"}extractFilename(e){let n=(e.split("#")[0]?.split("?")[0]??e).split("/").filter(r=>r.length>0);return n[n.length-1]??"inline-image.jpg"}base64UrlEncodeUtf8(e){return this.base64EncodeUtf8(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}base64EncodeUtf8(e){let n=new TextEncoder().encode(e),r="";for(let i of n)r+=String.fromCharCode(i);return btoa(r)}base64EncodeBytes(e){let t="";for(let n of e)t+=String.fromCharCode(n);return btoa(t)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}encodeSubjectHeader(e){let t=e.replace(/[\r\n]+/g," ").trim();return/^[\x20-\x7E]*$/.test(t)?t:`=?UTF-8?B?${this.base64EncodeUtf8(t)}?=`}static \u0275fac=function(t){return new(t||s)};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};var q=class s{authHelper=x(R);async resolveTemplateHtml(e){let t=this.resolveGoogleDocId(e.googleDocUrl);if(!t)throw new Error(`Template ${e.name} has invalid Google Doc URL`);let n=[...B],r=await this.authHelper.acquireAccessToken(n);try{return await this.fetchGoogleDocHtml(t,r)}catch(i){let c=i instanceof Error?i.message:String(i);if(!this.authHelper.isRecoverableAuthError(c))throw i;return this.authHelper.clearCachedTokens(),r=await this.authHelper.acquireAccessToken(n),await this.fetchGoogleDocHtml(t,r)}}resolveGoogleDocId(e){if(!e)return null;let t=e.match(/\/document\/d\/([a-zA-Z0-9_-]+)/);return!t||!t[1]?null:t[1]}async fetchGoogleDocHtml(e,t){let n=`https://www.googleapis.com/drive/v3/files/${encodeURIComponent(e)}/export?mimeType=text/html`,r=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){let i=await r.text();throw new Error(this.buildReadableExportError(r.status,i,r.statusText))}return await r.text()}buildReadableExportError(e,t,n){let i=this.extractApiMessage(t)||n||"Unknown error",c=i.toLowerCase(),d=(t||"").toLowerCase();return e===403&&(c.includes("drive api has not been used")||c.includes("accessnotconfigured")||c.includes("service_disabled")||d.includes("drive api has not been used")||d.includes("accessnotconfigured")||d.includes("service_disabled"))?'Google Drive API is not enabled for this Firebase project. Enable "Google Drive API" in Google Cloud Console, wait a few minutes, then retry.':`Google Doc export failed (${e}): ${i}`}extractApiMessage(e){if(!e)return"";try{return JSON.parse(e).error?.message?.trim()??""}catch{return e.trim()}}static \u0275fac=function(t){return new(t||s)};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};var Ne=(s,e)=>e.id,Ye=(s,e)=>e.authId;function Xe(s,e){s&1&&(a(0,"div",2)(1,"p"),l(2,"Loading email configuration..."),o()())}function Ze(s,e){if(s&1&&(a(0,"div",3),l(1),o()),s&2){let t=g(2);p(),w(t.message())}}function et(s,e){if(s&1&&(a(0,"div",4),l(1),o()),s&2){let t=g(2);p(),w(t.error())}}function tt(s,e){if(s&1&&(a(0,"option",13),l(1),o()),s&2){let t=e.$implicit;S("value",t.id),p(),w(t.name)}}function nt(s,e){if(s&1&&(a(0,"option",13),l(1),o()),s&2){let t=e.$implicit;S("value",t.id),p(),w(t.name)}}function rt(s,e){s&1&&(a(0,"div",47),l(1," No recipients match current filters. Adjust search or filter values. "),o())}function it(s,e){s&1&&(a(0,"span",66),l(1,"Drafted"),o())}function st(s,e){s&1&&(a(0,"span",67),l(1,"Unsent"),o())}function at(s,e){if(s&1){let t=J();a(0,"div",59),v("click",function(){let r=y(t).$implicit,i=g(3);return C(i.toggleUserRow(r.authId))}),a(1,"div")(2,"input",60),v("click",function(r){return y(t),C(r.stopPropagation())})("change",function(r){let i=y(t).$implicit,c=g(3);return C(c.onRecipientToggle(i.authId,r))}),o()(),a(3,"div",61)(4,"span",62),l(5),o(),a(6,"span",63),l(7),o()(),a(8,"div",64),l(9),o(),a(10,"div"),l(11),o(),a(12,"div")(13,"span",65),l(14),o()(),a(15,"div"),O(16,it,2,0,"span",66)(17,st,2,0,"span",67),o()()}if(s&2){let t=e.$implicit,n=g(3);ce("user-row-selected",n.isSelected(t.authId)),p(2),S("checked",n.isSelected(t.authId)),p(3),w(n.getInitials(t.parentName||t.displayName)),p(2),w(t.parentName||t.displayName),p(2),w(t.email),p(2),w(t.studentNames.join(", ")),p(2),S("ngClass",n.orderStatusPillClass(t.orderStatus)),p(),N(" ",n.orderStatusLabel(t.orderStatus)," "),p(2),P(n.hasDraftRecord(t.authId)?16:17)}}function ot(s,e){if(s&1&&j(0,at,18,10,"div",58,Ye),s&2){let t=g(2);L(t.filteredUsers())}}function lt(s,e){s&1&&l(0," Creating Drafts... ")}function ct(s,e){if(s&1&&l(0),s&2){let t=g(2);de(" Generate ",t.selectedAuthIds().length," Draft",t.selectedAuthIds().length===1?"":"s"," ")}}function dt(s,e){if(s&1){let t=J();O(0,Ze,2,1,"div",3),O(1,et,2,1,"div",4),a(2,"div",2)(3,"div",5)(4,"div")(5,"h3"),l(6,"Draft Setup"),o(),a(7,"p",6),l(8,"Choose season, notification type, and template."),o()(),a(9,"a",7),l(10,"Manage Templates \u2192"),o()(),a(11,"div",8)(12,"div",9)(13,"label",10),l(14,"Season"),o(),a(15,"select",11),v("ngModelChange",function(r){y(t);let i=g();return C(i.onSeasonChange(r))}),a(16,"option",12),l(17,"-- Select season --"),o(),j(18,tt,2,2,"option",13,Ne),o()(),a(20,"div",9)(21,"label",14),l(22,"Notification Type"),o(),a(23,"select",15),v("ngModelChange",function(r){y(t);let i=g();return C(i.onNotificationTypeChange(r))}),a(24,"option",16),l(25,"Registration Confirmation"),o()()(),a(26,"div",9)(27,"label",17),l(28,"Template"),o(),a(29,"select",18),v("ngModelChange",function(r){y(t);let i=g();return C(i.onTemplateChange(r))}),a(30,"option",12),l(31,"-- Select template --"),o(),j(32,nt,2,2,"option",13,Ne),o()()(),a(34,"label",19)(35,"input",20),v("change",function(r){y(t);let i=g();return C(i.onDebugModeChange(r))}),o(),l(36," Debug mode (create at most 1 draft and do not update stats) "),o()(),a(37,"details",21)(38,"summary")(39,"span"),l(40,"Template Stats (Season + Template)"),o()(),a(41,"div",22)(42,"p",6),l(43,"Draft activity for the selected season and template."),o(),a(44,"div",23)(45,"div",24)(46,"div",25),l(47,"draft"),o(),a(48,"div")(49,"p",26),l(50,"Drafts created"),o(),a(51,"p",27),l(52),o()()(),a(53,"div",24)(54,"div",25),l(55,"group"),o(),a(56,"div")(57,"p",26),l(58,"Unique recipients"),o(),a(59,"p",27),l(60),o()()(),a(61,"div",24)(62,"div",25),l(63,"schedule"),o(),a(64,"div")(65,"p",26),l(66,"Last draft created"),o(),a(67,"p",27),l(68),o()()()()()(),a(69,"div",2)(70,"h3"),l(71,"Recipient Selection"),o(),a(72,"div",28)(73,"input",29),v("ngModelChange",function(r){y(t);let i=g();return C(i.searchQuery.set(r))}),o(),a(74,"select",30),v("ngModelChange",function(r){y(t);let i=g();return C(i.onDraftStatusFilterChange(r))}),a(75,"option",31),l(76,"All Draft Status"),o(),a(77,"option",32),l(78,"Unsent Only"),o(),a(79,"option",33),l(80,"Drafted Only"),o()(),a(81,"select",34),v("ngModelChange",function(r){y(t);let i=g();return C(i.onOrderStatusFilterChange(r))}),a(82,"option",31),l(83,"All Order Status"),o(),a(84,"option",35),l(85,"Empty"),o(),a(86,"option",36),l(87,"Locked"),o(),a(88,"option",37),l(89,"Submitted"),o(),a(90,"option",38),l(91,"Secured"),o(),a(92,"option",39),l(93,"Paid"),o(),a(94,"option",40),l(95,"Unknown"),o()(),a(96,"button",41),v("click",function(){y(t);let r=g();return C(r.clearSelectedUsers())}),l(97," Clear Selection "),o()(),a(98,"div",42)(99,"div",43)(100,"div",44)(101,"div",45)(102,"input",46),v("change",function(r){y(t);let i=g();return C(i.onSelectAllFilteredChange(r))}),o()(),a(103,"div"),l(104,"Parent"),o(),a(105,"div"),l(106,"Email"),o(),a(107,"div"),l(108,"Students"),o(),a(109,"div"),l(110,"Order Status"),o(),a(111,"div"),l(112,"Draft Status"),o()(),O(113,rt,2,0,"div",47)(114,ot,2,0),o()(),a(115,"p",48),l(116),o()(),a(117,"div",49)(118,"div",50)(119,"div",51)(120,"div",52),l(121),o(),a(122,"div",53),l(123),o()(),a(124,"div",54)(125,"button",41),v("click",function(){y(t);let r=g();return C(r.clearSelectedUsers())}),l(126," Clear Selection "),o(),a(127,"button",55),v("click",function(){y(t);let r=g();return C(r.markSelectedAsUnsent())}),l(128," Mark Selected as Unsent "),o(),a(129,"button",56),v("click",function(){y(t);let r=g();return C(r.createDraftBatch())}),a(130,"span",57),l(131,"auto_awesome"),o(),O(132,lt,1,0)(133,ct,1,2),o()()()()}if(s&2){let t,n,r,i=g();P(i.message()?0:-1),p(),P(i.error()?1:-1),p(14),S("ngModel",i.selectedSeasonId()),p(3),L(i.seasons()),p(5),S("ngModel",i.selectedNotificationType()),p(6),S("ngModel",i.selectedTemplateId()),p(3),L(i.filteredTemplates()),p(3),S("checked",i.debugMode()),p(17),w(((t=i.currentStats())==null?null:t.draftCreatedCount)??0),p(8),w(((n=i.currentStats())==null?null:n.uniqueRecipientCount)??0),p(8),N(" ",i.formatStatsDate((r=i.currentStats())==null?null:r.lastDraftCreatedAt)," "),p(5),S("ngModel",i.searchQuery()),p(),S("ngModel",i.draftStatusFilter()),p(7),S("ngModel",i.orderStatusFilter()),p(21),S("checked",i.areAllFilteredSelected())("indeterminate",i.isPartiallyFilteredSelected()),p(11),P(i.filteredUsers().length===0?113:114),p(3),N("Selected ",i.selectedAuthIds().length," recipient(s)."),p(5),N(" ",i.selectedAuthIds().length," recipient(s) selected "),p(2),w(i.actionHint()),p(4),S("disabled",i.runningBatch()||i.selectedAuthIds().length===0||!i.selectedTemplateId()),p(2),S("disabled",i.runningBatch()||i.selectedAuthIds().length===0||!i.selectedTemplateId()),p(3),P(i.runningBatch()?132:133)}}var mt="berryfun.adminEmail.recipientSelection",Ue=class s{readonlyHelper=x(V);storeHelper=x(ke);userService=x(xe);docTemplateHelper=x(q);gmailDraftHelper=x(K);eligibleRecipientsBySeason=new Map;loading=f(!1);runningBatch=f(!1);message=f(null);error=f(null);seasons=f([]);selectedSeasonId=f("");selectedNotificationType=f("registrationConfirmation");allTemplatesDoc=f(null);selectedTemplateId=f("");currentStats=f(null);allCacheUsers=f([]);users=f([]);searchQuery=f("");draftStatusFilter=f("all");orderStatusFilter=f("all");selectedAuthIds=f([]);debugMode=f(!1);filteredTemplates=Q(()=>(this.allTemplatesDoc()?.templates??[]).filter(e=>e.notificationType===this.selectedNotificationType()&&e.isActive).sort((e,t)=>e.name.localeCompare(t.name)));filteredUsers=Q(()=>{let e=this.searchQuery().trim().toLowerCase(),t=this.draftStatusFilter(),n=this.orderStatusFilter();return this.users().filter(i=>{let c=[i.displayName,i.parentName,i.email,i.displayId,...i.studentNames].join(" ").toLowerCase(),d=e.length===0||c.includes(e),m=this.hasDraftRecord(i.authId),u=t==="all"||t==="unsent"&&!m||t==="drafted"&&m,h=n==="all"||i.orderStatus===n;return d&&u&&h}).sort((i,c)=>(i.parentName||i.displayName).localeCompare(c.parentName||c.displayName))});async ngOnInit(){await this.loadInitialData()}async onSeasonChange(e){this.selectedSeasonId.set(e),await Promise.all([this.refreshEligibleUsersForSelectedSeason(),this.reloadCurrentStats()]),this.restoreSelectedAuthIdsForCurrentContext()}async onNotificationTypeChange(e){if(e!=="registrationConfirmation"){this.error.set(`Unsupported notificationType: ${e}`);return}this.selectedNotificationType.set(e);let t=this.filteredTemplates()[0];this.selectedTemplateId.set(t?.id??""),await this.reloadCurrentStats(),this.restoreSelectedAuthIdsForCurrentContext()}async onTemplateChange(e){this.selectedTemplateId.set(e),await this.reloadCurrentStats(),this.restoreSelectedAuthIdsForCurrentContext()}isSelected(e){return this.selectedAuthIds().includes(e)}hasDraftRecord(e){let t=this.currentStats()?.recipientStateByAuthId[e];return!!t&&t.draftCount>0}formatStatsDate(e){if(!e)return"Never";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}getInitials(e){let t=e.trim();return t.length===0?"--":t.split(/\s+/).slice(0,2).map(r=>r.charAt(0).toUpperCase()).join("")}orderStatusLabel(e){switch(e){case"empty":return"Empty";case"locked":return"Locked";case"submitted":return"Submitted";case"secured":return"Secured";case"paid":return"Paid";default:return"Unknown"}}orderStatusPillClass(e){switch(e){case"empty":return"status-order-empty";case"locked":return"status-order-locked";case"submitted":return"status-order-submitted";case"secured":return"status-order-secured";case"paid":return"status-order-paid";default:return"status-order-unknown"}}toggleUserRow(e){this.toggleSelectedUser(e,!this.isSelected(e))}actionHint(){return this.selectedTemplateId()?this.selectedAuthIds().length===0?"Select at least one recipient.":this.debugMode()?"Debug mode is ON: at most one draft will be created.":"Ready to create Gmail drafts.":"Select a template to enable draft generation."}toggleSelectedUser(e,t){let n=new Set(this.selectedAuthIds());t?n.add(e):n.delete(e),this.setSelectedAuthIds([...n])}onRecipientToggle(e,t){let n=t.target;n instanceof HTMLInputElement&&this.toggleSelectedUser(e,n.checked)}onDebugModeChange(e){let t=e.target;t instanceof HTMLInputElement&&this.debugMode.set(t.checked)}onDraftStatusFilterChange(e){if(e==="all"||e==="unsent"||e==="drafted"){this.draftStatusFilter.set(e);return}this.draftStatusFilter.set("all")}onOrderStatusFilterChange(e){if(e==="all"||e==="empty"||e==="locked"||e==="submitted"||e==="secured"||e==="paid"||e==="unknown"){this.orderStatusFilter.set(e);return}this.orderStatusFilter.set("all")}areAllFilteredSelected(){let e=this.filteredUsers();if(e.length===0)return!1;let t=new Set(this.selectedAuthIds());return e.every(n=>t.has(n.authId))}isPartiallyFilteredSelected(){let e=this.filteredUsers();if(e.length===0)return!1;let t=new Set(this.selectedAuthIds()),n=e.filter(r=>t.has(r.authId)).length;return n>0&&n<e.length}onSelectAllFilteredChange(e){let t=e.target;if(!(t instanceof HTMLInputElement))return;let n=this.filteredUsers().map(i=>i.authId),r=new Set(this.selectedAuthIds());if(t.checked)for(let i of n)r.add(i);else for(let i of n)r.delete(i);this.setSelectedAuthIds([...r])}clearSelectedUsers(){this.setSelectedAuthIds([])}async markSelectedAsUnsent(){this.message.set(null),this.error.set(null);let e=this.selectedSeasonId(),t=this.selectedTemplate(),n=this.selectedAuthIds(),i=this.userService.actualUser()?.uid??"admin";if(!e){this.error.set("Please select a season.");return}if(!t){this.error.set("Please select a template.");return}if(n.length===0){this.error.set("Please select at least one recipient.");return}try{let c=await this.storeHelper.getSeasonTemplateStats(e,this.selectedNotificationType(),t.id)??z({seasonId:e,notificationType:this.selectedNotificationType(),templateId:t.id,templateName:t.name,updatedBy:i}),d=D({},c.recipientStateByAuthId),m=0;for(let b of n){let E=d[b];!E||E.draftCount<=0||(delete d[b],m+=1)}if(m===0){this.message.set("Selected recipients are already unsent.");return}let u=new Date().toISOString(),h=Object.values(d).filter(b=>b.draftCount>0).length,_=H(D({},c),{templateName:t.name,uniqueRecipientCount:h,recipientStateByAuthId:d,updatedAt:u,updatedBy:i});await this.storeHelper.saveSeasonTemplateStats(_),await this.reloadCurrentStats(),this.message.set(`Marked ${m} recipient(s) as unsent.`)}catch(c){let d=c instanceof Error?c.message:String(c);this.error.set(d)}}async createDraftBatch(){this.message.set(null),this.error.set(null);let e=this.selectedSeasonId(),t=this.selectedTemplate(),n=this.selectedAuthIds(),i=this.userService.actualUser()?.uid??"admin";if(!e){this.error.set("Please select a season.");return}if(!t){this.error.set("Please select a template.");return}if(n.length===0){this.error.set("Please select at least one recipient.");return}let c=this.debugMode(),d=c?n.slice(0,1):n,m=new Date().toISOString(),u=this.buildJobId(),h={jobId:u,seasonId:e,notificationType:this.selectedNotificationType(),templateId:t.id,requestedBy:i,requestedAt:m,debugMode:c,targetAuthIds:d,successAuthIds:[],failed:[],createdDraftIds:[],status:"running",completedAt:null};this.runningBatch.set(!0);try{await this.storeHelper.createBatchJob(h);let _=await this.docTemplateHelper.resolveTemplateHtml(t),b=await this.readonlyHelper.listOrdersByUserIds(e,d),E=new Map(b.map(I=>[I.userAuthId,I])),Be=new Map(this.users().map(I=>[I.authId,I])),k=[],ie=[],se=new Map,F=[];for(let I of d)try{let T=Be.get(I);if(!T)throw new Error(`Missing admin cache entry for authId ${I}`);let $=E.get(I);if(!$)throw new Error("No order found for selected season");let ae=Re({order:$,cacheEntry:T}),$e=ne(t.subjectTemplate,ae),He=ne(_,ae),oe=await this.gmailDraftHelper.createDraft({to:T.email,subject:$e,htmlBody:He});k.push(I),ie.push(oe.draftId),se.set(I,oe.draftId)}catch(T){let $=T instanceof Error?T.message:String(T);F.push({authId:I,error:$})}let Fe=F.length>0&&k.length===0?"failed":"completed";await this.storeHelper.updateBatchJob(u,{successAuthIds:k,failed:F,createdDraftIds:ie,status:Fe,completedAt:new Date().toISOString()}),!c&&k.length>0&&await this.updateSeasonTemplateStats({seasonId:e,template:t,requestedBy:i,successAuthIds:k,createdDraftIdByAuthId:se,jobId:u}),await this.reloadCurrentStats(),this.message.set(`Draft creation finished. Success: ${k.length}, Failed: ${F.length}${c?" (debug mode)":""}.`)}catch(_){let b=_ instanceof Error?_.message:String(_);this.error.set(b)}finally{this.runningBatch.set(!1)}}selectedTemplate(){let e=this.selectedTemplateId();return e?this.filteredTemplates().find(t=>t.id===e)??null:null}async loadInitialData(){this.loading.set(!0),this.error.set(null),this.message.set(null);try{let t=this.userService.actualUser()?.uid??"admin",[n,r,i]=await Promise.all([this.readonlyHelper.listAllSeasons(),this.readonlyHelper.getAdminUserCache(),this.storeHelper.getTemplatesDocOrCreate(t)]);this.seasons.set(n),n.length>0&&this.selectedSeasonId.set(n[0].id);let c=(r?.users??[]).map(m=>({authId:m.authId,email:m.email,displayName:m.displayName,displayId:m.displayId,parentName:m.parentName,studentNames:m.studentNames,wechat:m.wechat}));this.allCacheUsers.set(c),this.users.set([]),this.allTemplatesDoc.set(i);let d=i.templates.find(m=>m.notificationType===this.selectedNotificationType()&&m.isActive);this.selectedTemplateId.set(d?.id??""),await Promise.all([this.refreshEligibleUsersForSelectedSeason(),this.reloadCurrentStats()]),this.restoreSelectedAuthIdsForCurrentContext()}catch(e){let t=e instanceof Error?e.message:String(e);this.error.set(t)}finally{this.loading.set(!1)}}async reloadCurrentStats(){let e=this.selectedSeasonId(),t=this.selectedTemplate(),r=this.userService.actualUser()?.uid??"admin";if(!e||!t){this.currentStats.set(null);return}let i=await this.storeHelper.getSeasonTemplateStats(e,this.selectedNotificationType(),t.id);this.currentStats.set(i??z({seasonId:e,notificationType:this.selectedNotificationType(),templateId:t.id,templateName:t.name,updatedBy:r}))}async refreshEligibleUsersForSelectedSeason(){let e=this.selectedSeasonId();if(!e){this.users.set([]);return}let t=this.eligibleRecipientsBySeason.get(e);if(t){this.users.set(t);return}let n=this.seasons().find(u=>u.id===e),r=new Set((n?.sessions??[]).filter(u=>u.isActive).map(u=>u.id)),i=await this.readonlyHelper.listSeasonOrders(e),c=new Set,d=new Map;for(let u of i)X(u).some(_=>r.size===0?!0:r.has(_.sessionId))&&(c.add(u.userAuthId),d.set(u.userAuthId,u));let m=this.allCacheUsers().filter(u=>c.has(u.authId)).map(u=>H(D({},u),{orderStatus:this.resolveRecipientOrderStatus(d.get(u.authId))}));this.eligibleRecipientsBySeason.set(e,m),this.users.set(m)}resolveRecipientOrderStatus(e){if(!e)return"unknown";if(e.orderStatus)return e.orderStatus;let t=X(e);return t.length===0?"empty":t.some(n=>n.status==="locked")?"locked":t.some(n=>n.status==="submitted")?"submitted":t.some(n=>n.status==="secured")?"secured":"paid"}setSelectedAuthIds(e,t=!0){let n=[...new Set(e)];this.selectedAuthIds.set(n),t&&this.persistSelectedAuthIdsForCurrentContext(n)}restoreSelectedAuthIdsForCurrentContext(){let e=this.getSelectionContextKey();if(!e){this.setSelectedAuthIds([],!1);return}let n=this.readSelectionStorage().selectionsByContext[e]??[],r=new Set(this.users().map(c=>c.authId)),i=[...new Set(n)].filter(c=>r.has(c));this.setSelectedAuthIds(i,!1),n.length!==i.length&&this.persistSelectedAuthIdsForCurrentContext(i)}persistSelectedAuthIdsForCurrentContext(e){let t=this.getSelectionContextKey();if(!t)return;let n=this.readSelectionStorage();e.length===0?delete n.selectionsByContext[t]:n.selectionsByContext[t]=[...new Set(e)],this.writeSelectionStorage(n)}readSelectionStorage(){let e=this.getSelectionStorageKey();if(!e)return{version:1,selectionsByContext:{}};try{let t=localStorage.getItem(e);if(!t)return{version:1,selectionsByContext:{}};let n=JSON.parse(t);if(!n||typeof n!="object")return{version:1,selectionsByContext:{}};let i=n.selectionsByContext;if(!i||typeof i!="object")return{version:1,selectionsByContext:{}};let c={};for(let[d,m]of Object.entries(i)){if(!Array.isArray(m))continue;let u=m.filter(h=>typeof h=="string");c[d]=[...new Set(u)]}return{version:1,selectionsByContext:c}}catch{return{version:1,selectionsByContext:{}}}}writeSelectionStorage(e){let t=this.getSelectionStorageKey();if(t)try{localStorage.setItem(t,JSON.stringify(e))}catch{}}getSelectionStorageKey(){let e=this.userService.actualUser()?.uid??null;return e?`${mt}.${e}`:null}getSelectionContextKey(){let e=this.selectedSeasonId(),t=this.selectedNotificationType(),n=this.selectedTemplateId();return!e||!t||!n?null:`${e}__${t}__${n}`}async updateSeasonTemplateStats(e){let t=await this.storeHelper.getSeasonTemplateStats(e.seasonId,this.selectedNotificationType(),e.template.id)??z({seasonId:e.seasonId,notificationType:this.selectedNotificationType(),templateId:e.template.id,templateName:e.template.name,updatedBy:e.requestedBy}),n=new Date().toISOString(),r=D({},t.recipientStateByAuthId);for(let d of e.successAuthIds){let m=r[d]??{draftCount:0,lastDraftCreatedAt:null,lastDraftId:null,lastBatchJobId:null};r[d]={draftCount:m.draftCount+1,lastDraftCreatedAt:n,lastDraftId:e.createdDraftIdByAuthId.get(d)??m.lastDraftId,lastBatchJobId:e.jobId}}let i=Object.values(r).filter(d=>d.draftCount>0).length,c=H(D({},t),{templateName:e.template.name,draftCreatedCount:t.draftCreatedCount+e.successAuthIds.length,lastDraftCreatedAt:n,uniqueRecipientCount:i,recipientStateByAuthId:r,updatedAt:n,updatedBy:e.requestedBy});await this.storeHelper.saveSeasonTemplateStats(c)}buildJobId(){let e=Math.random().toString(36).slice(2,10);return`EML-${Date.now()}-${e}`}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=le({type:s,selectors:[["app-admin-email-center"]],decls:4,vars:1,consts:[["pageTitle","Email Draft Center","pageSubtitle","Create Gmail drafts for admin review"],[1,"email-center"],[1,"card"],[1,"card","success"],[1,"card","error"],[1,"card-head"],[1,"card-subtitle"],["routerLink","/admin/email/templates",1,"inline-link"],[1,"controls-grid"],[1,"field"],["for","season"],["id","season",3,"ngModelChange","ngModel"],["value",""],[3,"value"],["for","notificationType"],["id","notificationType",3,"ngModelChange","ngModel"],["value","registrationConfirmation"],["for","template"],["id","template",3,"ngModelChange","ngModel"],[1,"checkbox","checkbox-inline"],["type","checkbox",3,"change","checked"],[1,"card","card-collapsible"],[1,"collapsible-body"],[1,"stats-grid"],[1,"stat-card"],["aria-hidden","true",1,"stat-icon","material-symbols-rounded"],[1,"stat-label"],[1,"stat-value"],[1,"recipient-toolbar"],["type","text","placeholder","Search by parent/email/student name",3,"ngModelChange","ngModel"],["aria-label","Draft status filter",3,"ngModelChange","ngModel"],["value","all"],["value","unsent"],["value","drafted"],["aria-label","Order status filter",3,"ngModelChange","ngModel"],["value","empty"],["value","locked"],["value","submitted"],["value","secured"],["value","paid"],["value","unknown"],["type","button",1,"btn","btn-outline",3,"click"],[1,"user-table-scroll"],[1,"user-table"],[1,"user-table-header"],[1,"select-header-cell"],["type","checkbox",3,"change","checked","indeterminate"],[1,"empty-table-state"],[1,"hint"],[1,"sticky-action-bar"],[1,"sticky-action-inner"],[1,"selection-block"],[1,"selection-info"],[1,"selection-hint"],[1,"sticky-actions"],["type","button",1,"btn","btn-outline",3,"click","disabled"],["type","button",1,"btn","btn-primary","btn-generate",3,"click","disabled"],["aria-hidden","true",1,"material-symbols-rounded"],[1,"user-row",3,"user-row-selected"],[1,"user-row",3,"click"],["type","checkbox",3,"click","change","checked"],[1,"parent-cell"],[1,"avatar"],[1,"parent-name"],[1,"email-cell"],[1,"status-pill",3,"ngClass"],[1,"status-pill","status-drafted"],[1,"status-pill","status-unsent"]],template:function(t,n){t&1&&(a(0,"app-admin-layout",0)(1,"div",1),O(2,Xe,3,0,"div",2)(3,dt,134,21),o()()),t&2&&(p(2),P(n.loading()?2:3))},dependencies:[ue,me,Oe,Ae,Te,Ie,Me,we,Ee,pe,Pe],styles:['.email-center[_ngcontent-%COMP%]{display:grid;gap:1rem;max-width:1400px;margin:0 auto;padding:1.5rem;padding-bottom:0}.card[_ngcontent-%COMP%]{background:var(--sys-surface, #fff);border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:12px;padding:1.25rem}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1.4rem;font-weight:600;color:var(--sys-on-surface, #212121)}.card-subtitle[_ngcontent-%COMP%]{margin:-.45rem 0 0;font-size:.86rem;color:var(--sys-on-surface-variant, #616161)}.card-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.75rem;margin-bottom:.75rem}.card-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.inline-link[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:var(--sys-primary, #c62828);text-decoration:none;white-space:nowrap}.inline-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.controls-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}.field[_ngcontent-%COMP%]{display:grid;gap:.5rem}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.95rem;color:var(--sys-on-surface, #212121)}.checkbox-inline[_ngcontent-%COMP%]{margin-top:.85rem}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{border:1px solid var(--sys-outline-variant, #d1d5db);border-radius:8px;padding:.55rem .65rem;font-size:.95rem;width:100%;box-sizing:border-box;color:var(--sys-on-surface, #212121);background:var(--sys-surface, #fff)}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:2px solid color-mix(in srgb,var(--sys-primary, #c62828) 30%,white);border-color:var(--sys-primary, #c62828)}.stats-grid[_ngcontent-%COMP%]{display:grid;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.stat-card[_ngcontent-%COMP%]{border:1px solid var(--sys-outline-variant, #e0e0e0);border-radius:10px;padding:.75rem;background:color-mix(in srgb,var(--sys-surface, #fff) 75%,#f7f7f7);display:flex;align-items:center;gap:.65rem}.stat-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;font-size:1.1rem;background:color-mix(in srgb,var(--sys-primary, #c62828) 14%,white);color:var(--sys-primary, #c62828)}.stat-label[_ngcontent-%COMP%]{margin:0;font-size:.78rem;color:var(--sys-on-surface-variant, #616161);font-weight:500}.stat-value[_ngcontent-%COMP%]{margin:.08rem 0 0;font-size:1rem;font-weight:600;color:var(--sys-on-surface, #212121)}.card-collapsible[_ngcontent-%COMP%]{padding-top:.8rem}.card-collapsible[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]{list-style:none;cursor:pointer;display:flex;align-items:center;font-size:1.2rem;font-weight:600;color:var(--sys-on-surface, #212121);margin:0}.card-collapsible[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none}.card-collapsible[_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]:after{content:"expand_more";font-family:Material Symbols Rounded;font-size:1.2rem;margin-left:.3rem;transition:transform .2s ease;color:var(--sys-on-surface-variant, #616161)}.card-collapsible[open][_ngcontent-%COMP%]   summary[_ngcontent-%COMP%]:after{transform:rotate(180deg)}.collapsible-body[_ngcontent-%COMP%]{margin-top:.75rem}.recipient-toolbar[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(240px,2fr) minmax(170px,1fr) minmax(170px,1fr) auto;gap:.6rem;align-items:center;margin-bottom:.55rem}.checkbox[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.4rem;font-size:.9rem;color:var(--sys-on-surface, #212121)}.select-header-cell[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center}.user-table-scroll[_ngcontent-%COMP%]{max-height:52vh;overflow:auto;border-radius:8px;border:1px solid var(--sys-outline-variant, #e0e0e0)}.user-table[_ngcontent-%COMP%]{background:var(--sys-surface, #fff)}.user-table-header[_ngcontent-%COMP%], .user-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:80px 1fr 1fr 1fr 120px 100px;gap:.5rem;padding:.55rem .65rem;align-items:center;font-size:.9rem}.user-table-header[_ngcontent-%COMP%]{background:var(--sys-surface-variant, #f5f5f5);font-weight:600;color:var(--sys-on-surface, #212121);position:sticky;top:0;z-index:2}.user-row[_ngcontent-%COMP%]:nth-child(2n){background:color-mix(in srgb,var(--sys-surface, #fff) 70%,#f5f5f5)}.user-row[_ngcontent-%COMP%]{color:var(--sys-on-surface, #212121);cursor:pointer;transition:background .15s ease}.empty-table-state[_ngcontent-%COMP%]{padding:1.1rem .9rem;font-size:.9rem;color:var(--sys-on-surface-variant, #616161);text-align:center;background:color-mix(in srgb,var(--sys-surface, #fff) 82%,#f3f3f3)}.user-row[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--sys-primary, #c62828) 6%,#ffffff)}.user-row-selected[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--sys-primary, #c62828) 11%,#ffffff);box-shadow:inset 3px 0 0 var(--sys-primary, #c62828)}.parent-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;min-width:0}.avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;font-size:.67rem;font-weight:700;color:var(--sys-primary, #c62828);background:color-mix(in srgb,var(--sys-primary, #c62828) 10%,#ffffff);border:1px solid color-mix(in srgb,var(--sys-primary, #c62828) 28%,#ffffff);flex-shrink:0}.parent-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.email-cell[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.83rem;overflow-wrap:anywhere}.status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-radius:999px;padding:.2rem .55rem;font-size:.78rem;font-weight:600;line-height:1.3}.status-drafted[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9}.status-unsent[_ngcontent-%COMP%]{background:#f5f5f5;color:#424242;border:1px solid #e0e0e0}.status-order-empty[_ngcontent-%COMP%]{background:#eceff1;color:#455a64;border:1px solid #cfd8dc}.status-order-locked[_ngcontent-%COMP%]{background:#fff3e0;color:#ef6c00;border:1px solid #ffe0b2}.status-order-submitted[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0;border:1px solid #bbdefb}.status-order-secured[_ngcontent-%COMP%]{background:#e0f2f1;color:#00695c;border:1px solid #b2dfdb}.status-order-paid[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border:1px solid #c8e6c9}.status-order-unknown[_ngcontent-%COMP%]{background:#f5f5f5;color:#616161;border:1px solid #e0e0e0}.btn[_ngcontent-%COMP%]{border:1px solid var(--sys-outline-variant, #d1d5db);background:var(--sys-surface, #fff);color:var(--sys-on-surface, #212121);border-radius:8px;padding:.5rem .8rem;cursor:pointer;text-decoration:none;transition:background .2s ease,border-color .2s ease}.btn[_ngcontent-%COMP%]:hover{background:var(--sys-surface-variant, #f5f5f5);border-color:var(--sys-outline, #bdbdbd)}.btn-primary[_ngcontent-%COMP%]{background:var(--sys-primary, #c62828);border-color:var(--sys-primary, #c62828);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--sys-primary, #c62828) 88%,black);border-color:color-mix(in srgb,var(--sys-primary, #c62828) 88%,black)}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-outline[_ngcontent-%COMP%]{background:var(--sys-surface, #fff)}.hint[_ngcontent-%COMP%]{margin-top:.6rem;color:var(--sys-on-surface-variant, #616161);font-size:.85rem}.sticky-action-bar[_ngcontent-%COMP%]{position:sticky;bottom:0;z-index:30;border-top:1px solid var(--sys-outline-variant, #e0e0e0);background:var(--sys-surface, #fff);box-shadow:0 -2px 8px #00000014;border-radius:12px 12px 0 0;background-clip:padding-box}.sticky-action-inner[_ngcontent-%COMP%]{padding:.75rem 1rem;display:flex;align-items:center;justify-content:space-between;gap:.75rem}.selection-block[_ngcontent-%COMP%]{display:grid;gap:.15rem}.selection-info[_ngcontent-%COMP%]{color:var(--sys-on-surface, #212121);font-size:.95rem;font-weight:500}.selection-hint[_ngcontent-%COMP%]{color:var(--sys-on-surface-variant, #616161);font-size:.82rem}.sticky-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.7rem;flex-wrap:wrap}.btn-generate[_ngcontent-%COMP%]{min-height:54px;min-width:260px;padding:.9rem 1.45rem;font-size:1.08rem;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:.5rem;box-shadow:0 4px 12px color-mix(in srgb,var(--sys-primary, #c62828) 28%,transparent);transition:transform .15s ease,box-shadow .2s ease,background .2s ease}.btn-generate[_ngcontent-%COMP%]   .material-symbols-rounded[_ngcontent-%COMP%]{font-size:1.1rem}.btn-generate[_ngcontent-%COMP%]:disabled{box-shadow:none}.btn-generate[_ngcontent-%COMP%]:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 8px 18px color-mix(in srgb,var(--sys-primary, #c62828) 38%,transparent)}.success[_ngcontent-%COMP%]{border-color:var(--sys-tertiary, #2e7d32);color:#1b5e20;background:#f1f8e9}.error[_ngcontent-%COMP%]{border-color:var(--sys-error, #c62828);color:var(--sys-error, #c62828);background:var(--sys-error-container, #ffebee)}@media(max-width:900px){.email-center[_ngcontent-%COMP%]{padding:1rem;padding-bottom:0}.card-head[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.recipient-toolbar[_ngcontent-%COMP%]{grid-template-columns:1fr}.user-table-scroll[_ngcontent-%COMP%]{max-height:56vh}.user-table-header[_ngcontent-%COMP%], .user-row[_ngcontent-%COMP%]{grid-template-columns:60px 1fr 1fr}.user-table-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4), .user-table-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(5), .user-table-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(6), .user-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(4), .user-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(5), .user-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(6){display:none}.sticky-action-inner[_ngcontent-%COMP%]{padding:.75rem 1rem;flex-direction:column;align-items:stretch}.selection-info[_ngcontent-%COMP%], .selection-hint[_ngcontent-%COMP%]{text-align:center}.sticky-actions[_ngcontent-%COMP%]{justify-content:center}.btn-generate[_ngcontent-%COMP%]{width:100%;max-width:420px}}']})};export{Ue as AdminEmailCenterComponent};
